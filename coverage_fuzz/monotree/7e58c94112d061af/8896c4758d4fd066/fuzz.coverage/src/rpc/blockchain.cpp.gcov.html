<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - fuzz_coverage.info - src/rpc/blockchain.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../../index.html" title="Click to go to top-level">top level</a> - <a href="index.html" title="Click to go to directory src/rpc">src/rpc</a> - blockchain.cpp<span style="font-size: 80%;"> (source / <a href="blockchain.cpp.func-c.html" title="Click to go to function table">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">fuzz_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryLo">69.6&nbsp;%</td>
            <td class="headerCovTableEntry">2168</td>
            <td class="headerCovTableEntry">1509</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2025-09-07 10:26:08</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryMed">87.2&nbsp;%</td>
            <td class="headerCovTableEntry">133</td>
            <td class="headerCovTableEntry">116</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntryLo">39.3&nbsp;%</td>
            <td class="headerCovTableEntry">6811</td>
            <td class="headerCovTableEntry">2680</td>
          </tr>
                  <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">             Branch data     Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>                 :             : // Copyright (c) 2010 Satoshi Nakamoto</span>
<span id="L2"><span class="lineNum">       2</span>                 :             : // Copyright (c) 2009-present The Bitcoin Core developers</span>
<span id="L3"><span class="lineNum">       3</span>                 :             : // Distributed under the MIT software license, see the accompanying</span>
<span id="L4"><span class="lineNum">       4</span>                 :             : // file COPYING or http://www.opensource.org/licenses/mit-license.php.</span>
<span id="L5"><span class="lineNum">       5</span>                 :             : </span>
<span id="L6"><span class="lineNum">       6</span>                 :             : #include &lt;rpc/blockchain.h&gt;</span>
<span id="L7"><span class="lineNum">       7</span>                 :             : </span>
<span id="L8"><span class="lineNum">       8</span>                 :             : #include &lt;blockfilter.h&gt;</span>
<span id="L9"><span class="lineNum">       9</span>                 :             : #include &lt;chain.h&gt;</span>
<span id="L10"><span class="lineNum">      10</span>                 :             : #include &lt;chainparams.h&gt;</span>
<span id="L11"><span class="lineNum">      11</span>                 :             : #include &lt;chainparamsbase.h&gt;</span>
<span id="L12"><span class="lineNum">      12</span>                 :             : #include &lt;clientversion.h&gt;</span>
<span id="L13"><span class="lineNum">      13</span>                 :             : #include &lt;coins.h&gt;</span>
<span id="L14"><span class="lineNum">      14</span>                 :             : #include &lt;common/args.h&gt;</span>
<span id="L15"><span class="lineNum">      15</span>                 :             : #include &lt;consensus/amount.h&gt;</span>
<span id="L16"><span class="lineNum">      16</span>                 :             : #include &lt;consensus/params.h&gt;</span>
<span id="L17"><span class="lineNum">      17</span>                 :             : #include &lt;consensus/validation.h&gt;</span>
<span id="L18"><span class="lineNum">      18</span>                 :             : #include &lt;core_io.h&gt;</span>
<span id="L19"><span class="lineNum">      19</span>                 :             : #include &lt;deploymentinfo.h&gt;</span>
<span id="L20"><span class="lineNum">      20</span>                 :             : #include &lt;deploymentstatus.h&gt;</span>
<span id="L21"><span class="lineNum">      21</span>                 :             : #include &lt;flatfile.h&gt;</span>
<span id="L22"><span class="lineNum">      22</span>                 :             : #include &lt;hash.h&gt;</span>
<span id="L23"><span class="lineNum">      23</span>                 :             : #include &lt;index/blockfilterindex.h&gt;</span>
<span id="L24"><span class="lineNum">      24</span>                 :             : #include &lt;index/coinstatsindex.h&gt;</span>
<span id="L25"><span class="lineNum">      25</span>                 :             : #include &lt;interfaces/mining.h&gt;</span>
<span id="L26"><span class="lineNum">      26</span>                 :             : #include &lt;kernel/coinstats.h&gt;</span>
<span id="L27"><span class="lineNum">      27</span>                 :             : #include &lt;logging/timer.h&gt;</span>
<span id="L28"><span class="lineNum">      28</span>                 :             : #include &lt;net.h&gt;</span>
<span id="L29"><span class="lineNum">      29</span>                 :             : #include &lt;net_processing.h&gt;</span>
<span id="L30"><span class="lineNum">      30</span>                 :             : #include &lt;node/blockstorage.h&gt;</span>
<span id="L31"><span class="lineNum">      31</span>                 :             : #include &lt;node/context.h&gt;</span>
<span id="L32"><span class="lineNum">      32</span>                 :             : #include &lt;node/transaction.h&gt;</span>
<span id="L33"><span class="lineNum">      33</span>                 :             : #include &lt;node/utxo_snapshot.h&gt;</span>
<span id="L34"><span class="lineNum">      34</span>                 :             : #include &lt;node/warnings.h&gt;</span>
<span id="L35"><span class="lineNum">      35</span>                 :             : #include &lt;primitives/transaction.h&gt;</span>
<span id="L36"><span class="lineNum">      36</span>                 :             : #include &lt;rpc/server.h&gt;</span>
<span id="L37"><span class="lineNum">      37</span>                 :             : #include &lt;rpc/server_util.h&gt;</span>
<span id="L38"><span class="lineNum">      38</span>                 :             : #include &lt;rpc/util.h&gt;</span>
<span id="L39"><span class="lineNum">      39</span>                 :             : #include &lt;script/descriptor.h&gt;</span>
<span id="L40"><span class="lineNum">      40</span>                 :             : #include &lt;serialize.h&gt;</span>
<span id="L41"><span class="lineNum">      41</span>                 :             : #include &lt;streams.h&gt;</span>
<span id="L42"><span class="lineNum">      42</span>                 :             : #include &lt;sync.h&gt;</span>
<span id="L43"><span class="lineNum">      43</span>                 :             : #include &lt;txdb.h&gt;</span>
<span id="L44"><span class="lineNum">      44</span>                 :             : #include &lt;txmempool.h&gt;</span>
<span id="L45"><span class="lineNum">      45</span>                 :             : #include &lt;undo.h&gt;</span>
<span id="L46"><span class="lineNum">      46</span>                 :             : #include &lt;univalue.h&gt;</span>
<span id="L47"><span class="lineNum">      47</span>                 :             : #include &lt;util/check.h&gt;</span>
<span id="L48"><span class="lineNum">      48</span>                 :             : #include &lt;util/fs.h&gt;</span>
<span id="L49"><span class="lineNum">      49</span>                 :             : #include &lt;util/strencodings.h&gt;</span>
<span id="L50"><span class="lineNum">      50</span>                 :             : #include &lt;util/syserror.h&gt;</span>
<span id="L51"><span class="lineNum">      51</span>                 :             : #include &lt;util/translation.h&gt;</span>
<span id="L52"><span class="lineNum">      52</span>                 :             : #include &lt;validation.h&gt;</span>
<span id="L53"><span class="lineNum">      53</span>                 :             : #include &lt;validationinterface.h&gt;</span>
<span id="L54"><span class="lineNum">      54</span>                 :             : #include &lt;versionbits.h&gt;</span>
<span id="L55"><span class="lineNum">      55</span>                 :             : </span>
<span id="L56"><span class="lineNum">      56</span>                 :             : #include &lt;cstdint&gt;</span>
<span id="L57"><span class="lineNum">      57</span>                 :             : </span>
<span id="L58"><span class="lineNum">      58</span>                 :             : #include &lt;condition_variable&gt;</span>
<span id="L59"><span class="lineNum">      59</span>                 :             : #include &lt;iterator&gt;</span>
<span id="L60"><span class="lineNum">      60</span>                 :             : #include &lt;memory&gt;</span>
<span id="L61"><span class="lineNum">      61</span>                 :             : #include &lt;mutex&gt;</span>
<span id="L62"><span class="lineNum">      62</span>                 :             : #include &lt;optional&gt;</span>
<span id="L63"><span class="lineNum">      63</span>                 :             : #include &lt;vector&gt;</span>
<span id="L64"><span class="lineNum">      64</span>                 :             : </span>
<span id="L65"><span class="lineNum">      65</span>                 :             : using kernel::CCoinsStats;</span>
<span id="L66"><span class="lineNum">      66</span>                 :             : using kernel::CoinStatsHashType;</span>
<span id="L67"><span class="lineNum">      67</span>                 :             : </span>
<span id="L68"><span class="lineNum">      68</span>                 :             : using interfaces::BlockRef;</span>
<span id="L69"><span class="lineNum">      69</span>                 :             : using interfaces::Mining;</span>
<span id="L70"><span class="lineNum">      70</span>                 :             : using node::BlockManager;</span>
<span id="L71"><span class="lineNum">      71</span>                 :             : using node::NodeContext;</span>
<span id="L72"><span class="lineNum">      72</span>                 :             : using node::SnapshotMetadata;</span>
<span id="L73"><span class="lineNum">      73</span>                 :             : using util::MakeUnorderedList;</span>
<span id="L74"><span class="lineNum">      74</span>                 :             : </span>
<span id="L75"><span class="lineNum">      75</span>                 :             : std::tuple&lt;std::unique_ptr&lt;CCoinsViewCursor&gt;, CCoinsStats, const CBlockIndex*&gt;</span>
<span id="L76"><span class="lineNum">      76</span>                 :             : PrepareUTXOSnapshot(</span>
<span id="L77"><span class="lineNum">      77</span>                 :             :     Chainstate&amp; chainstate,</span>
<span id="L78"><span class="lineNum">      78</span>                 :             :     const std::function&lt;void()&gt;&amp; interruption_point = {})</span>
<span id="L79"><span class="lineNum">      79</span>                 :             :     EXCLUSIVE_LOCKS_REQUIRED(::cs_main);</span>
<span id="L80"><span class="lineNum">      80</span>                 :             : </span>
<span id="L81"><span class="lineNum">      81</span>                 :             : UniValue WriteUTXOSnapshot(</span>
<span id="L82"><span class="lineNum">      82</span>                 :             :     Chainstate&amp; chainstate,</span>
<span id="L83"><span class="lineNum">      83</span>                 :             :     CCoinsViewCursor* pcursor,</span>
<span id="L84"><span class="lineNum">      84</span>                 :             :     CCoinsStats* maybe_stats,</span>
<span id="L85"><span class="lineNum">      85</span>                 :             :     const CBlockIndex* tip,</span>
<span id="L86"><span class="lineNum">      86</span>                 :             :     AutoFile&amp;&amp; afile,</span>
<span id="L87"><span class="lineNum">      87</span>                 :             :     const fs::path&amp; path,</span>
<span id="L88"><span class="lineNum">      88</span>                 :             :     const fs::path&amp; temppath,</span>
<span id="L89"><span class="lineNum">      89</span>                 :             :     const std::function&lt;void()&gt;&amp; interruption_point = {});</span>
<span id="L90"><span class="lineNum">      90</span>                 :             : </span>
<span id="L91"><span class="lineNum">      91</span>                 :             : /* Calculate the difficulty for a given block index.</span>
<span id="L92"><span class="lineNum">      92</span>                 :             :  */</span>
<span id="L93"><span class="lineNum">      93</span>                 :<span class="tlaGNC">          26 : double GetDifficulty(const CBlockIndex&amp; blockindex)</span></span>
<span id="L94"><span class="lineNum">      94</span>                 :             : {</span>
<span id="L95"><span class="lineNum">      95</span>                 :<span class="tlaGNC">          26 :     int nShift = (blockindex.nBits &gt;&gt; 24) &amp; 0xff;</span></span>
<span id="L96"><span class="lineNum">      96</span>                 :<span class="tlaGNC">          26 :     double dDiff =</span></span>
<span id="L97"><span class="lineNum">      97</span>                 :<span class="tlaGNC">          26 :         (double)0x0000ffff / (double)(blockindex.nBits &amp; 0x00ffffff);</span></span>
<span id="L98"><span class="lineNum">      98</span>                 :             : </span>
<span id="L99"><span class="lineNum">      99</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 26 times"> + </span>]:<span class="tlaGNC">          26 :     while (nShift &lt; 29)</span></span>
<span id="L100"><span class="lineNum">     100</span>                 :             :     {</span>
<span id="L101"><span class="lineNum">     101</span>                 :<span class="tlaUNC">           0 :         dDiff *= 256.0;</span></span>
<span id="L102"><span class="lineNum">     102</span>                 :<span class="tlaUNC">           0 :         nShift++;</span></span>
<span id="L103"><span class="lineNum">     103</span>                 :             :     }</span>
<span id="L104"><span class="lineNum">     104</span>         [<span class="tlaGBC" title="Branch 0 was taken 78 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 26 times"> + </span>]:<span class="tlaGNC">         104 :     while (nShift &gt; 29)</span></span>
<span id="L105"><span class="lineNum">     105</span>                 :             :     {</span>
<span id="L106"><span class="lineNum">     106</span>                 :<span class="tlaGNC">          78 :         dDiff /= 256.0;</span></span>
<span id="L107"><span class="lineNum">     107</span>                 :<span class="tlaGNC">          78 :         nShift--;</span></span>
<span id="L108"><span class="lineNum">     108</span>                 :             :     }</span>
<span id="L109"><span class="lineNum">     109</span>                 :             : </span>
<span id="L110"><span class="lineNum">     110</span>                 :<span class="tlaGNC">          26 :     return dDiff;</span></span>
<span id="L111"><span class="lineNum">     111</span>                 :             : }</span>
<span id="L112"><span class="lineNum">     112</span>                 :             : </span>
<span id="L113"><span class="lineNum">     113</span>                 :<span class="tlaGNC">           4 : static int ComputeNextBlockAndDepth(const CBlockIndex&amp; tip, const CBlockIndex&amp; blockindex, const CBlockIndex*&amp; next)</span></span>
<span id="L114"><span class="lineNum">     114</span>                 :             : {</span>
<span id="L115"><span class="lineNum">     115</span>                 :<span class="tlaGNC">           4 :     next = tip.GetAncestor(blockindex.nHeight + 1);</span></span>
<span id="L116"><span class="lineNum">     116</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :     if (next &amp;&amp; next-&gt;pprev == &amp;blockindex) {</span></span>
<span id="L117"><span class="lineNum">     117</span>                 :<span class="tlaUNC">           0 :         return tip.nHeight - blockindex.nHeight + 1;</span></span>
<span id="L118"><span class="lineNum">     118</span>                 :             :     }</span>
<span id="L119"><span class="lineNum">     119</span>                 :<span class="tlaGNC">           4 :     next = nullptr;</span></span>
<span id="L120"><span class="lineNum">     120</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           4 :     return &amp;blockindex == &amp;tip ? 1 : -1;</span></span>
<span id="L121"><span class="lineNum">     121</span>                 :             : }</span>
<span id="L122"><span class="lineNum">     122</span>                 :             : </span>
<span id="L123"><span class="lineNum">     123</span>                 :<span class="tlaGNC">         150 : static const CBlockIndex* ParseHashOrHeight(const UniValue&amp; param, ChainstateManager&amp; chainman)</span></span>
<span id="L124"><span class="lineNum">     124</span>                 :             : {</span>
<span id="L125"><span class="lineNum">     125</span>                 :<span class="tlaGNC">         150 :     LOCK(::cs_main);</span></span>
<span id="L126"><span class="lineNum">     126</span>         [<span class="tlaGBC" title="Branch 0 was taken 150 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         150 :     CChain&amp; active_chain = chainman.ActiveChain();</span></span>
<span id="L127"><span class="lineNum">     127</span>                 :             : </span>
<span id="L128"><span class="lineNum">     128</span>         [<span class="tlaGBC" title="Branch 0 was taken 149 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">         150 :     if (param.isNum()) {</span></span>
<span id="L129"><span class="lineNum">     129</span>         [<span class="tlaGBC" title="Branch 0 was taken 143 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 6 times"> + </span>]:<span class="tlaGNC">         149 :         const int height{param.getInt&lt;int&gt;()};</span></span>
<span id="L130"><span class="lineNum">     130</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 140 times"> + </span>]:<span class="tlaGNC">         143 :         if (height &lt; 0) {</span></span>
<span id="L131"><span class="lineNum">     131</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           6 :             throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Target block height %d is negative&quot;, height));</span></span>
<span id="L132"><span class="lineNum">     132</span>                 :             :         }</span>
<span id="L133"><span class="lineNum">     133</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 140 times"> + </span>]:<span class="tlaGNC">         140 :         const int current_tip{active_chain.Height()};</span></span>
<span id="L134"><span class="lineNum">     134</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 136 times"> + </span>]:<span class="tlaGNC">         140 :         if (height &gt; current_tip) {</span></span>
<span id="L135"><span class="lineNum">     135</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           8 :             throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Target block height %d after current tip %d&quot;, height, current_tip));</span></span>
<span id="L136"><span class="lineNum">     136</span>                 :             :         }</span>
<span id="L137"><span class="lineNum">     137</span>                 :             : </span>
<span id="L138"><span class="lineNum">     138</span>   [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         272 :         return active_chain[height];</span></span>
<span id="L139"><span class="lineNum">     139</span>                 :             :     } else {</span>
<span id="L140"><span class="lineNum">     140</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           1 :         const uint256 hash{ParseHashV(param, &quot;hash_or_height&quot;)};</span></span>
<span id="L141"><span class="lineNum">     141</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const CBlockIndex* pindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L142"><span class="lineNum">     142</span>                 :             : </span>
<span id="L143"><span class="lineNum">     143</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!pindex) {</span></span>
<span id="L144"><span class="lineNum">     144</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L145"><span class="lineNum">     145</span>                 :             :         }</span>
<span id="L146"><span class="lineNum">     146</span>                 :             : </span>
<span id="L147"><span class="lineNum">     147</span>                 :             :         return pindex;</span>
<span id="L148"><span class="lineNum">     148</span>                 :             :     }</span>
<span id="L149"><span class="lineNum">     149</span>                 :<span class="tlaGNC">         136 : }</span></span>
<span id="L150"><span class="lineNum">     150</span>                 :             : </span>
<span id="L151"><span class="lineNum">     151</span>                 :<span class="tlaGNC">           4 : UniValue blockheaderToJSON(const CBlockIndex&amp; tip, const CBlockIndex&amp; blockindex, const uint256 pow_limit)</span></span>
<span id="L152"><span class="lineNum">     152</span>                 :             : {</span>
<span id="L153"><span class="lineNum">     153</span>                 :             :     // Serialize passed information without accessing chain state of the active chain!</span>
<span id="L154"><span class="lineNum">     154</span>                 :<span class="tlaGNC">           4 :     AssertLockNotHeld(cs_main); // For performance reasons</span></span>
<span id="L155"><span class="lineNum">     155</span>                 :             : </span>
<span id="L156"><span class="lineNum">     156</span>                 :<span class="tlaGNC">           4 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L157"><span class="lineNum">     157</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;hash&quot;, blockindex.GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L158"><span class="lineNum">     158</span>                 :<span class="tlaGNC">           4 :     const CBlockIndex* pnext;</span></span>
<span id="L159"><span class="lineNum">     159</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     int confirmations = ComputeNextBlockAndDepth(tip, blockindex, pnext);</span></span>
<span id="L160"><span class="lineNum">     160</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;confirmations&quot;, confirmations);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L161"><span class="lineNum">     161</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;height&quot;, blockindex.nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L162"><span class="lineNum">     162</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;version&quot;, blockindex.nVersion);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L163"><span class="lineNum">     163</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;versionHex&quot;, strprintf(&quot;%08x&quot;, blockindex.nVersion));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L164"><span class="lineNum">     164</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;merkleroot&quot;, blockindex.hashMerkleRoot.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L165"><span class="lineNum">     165</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;time&quot;, blockindex.nTime);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L166"><span class="lineNum">     166</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;mediantime&quot;, blockindex.GetMedianTimePast());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L167"><span class="lineNum">     167</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;nonce&quot;, blockindex.nNonce);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L168"><span class="lineNum">     168</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;bits&quot;, strprintf(&quot;%08x&quot;, blockindex.nBits));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L169"><span class="lineNum">     169</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;target&quot;, GetTarget(tip, pow_limit).GetHex());</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 4 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L170"><span class="lineNum">     170</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;difficulty&quot;, GetDifficulty(blockindex));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L171"><span class="lineNum">     171</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;chainwork&quot;, blockindex.nChainWork.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L172"><span class="lineNum">     172</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     result.pushKV(&quot;nTx&quot;, blockindex.nTx);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L173"><span class="lineNum">     173</span>                 :             : </span>
<span id="L174"><span class="lineNum">     174</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           4 :     if (blockindex.pprev)</span></span>
<span id="L175"><span class="lineNum">     175</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;previousblockhash&quot;, blockindex.pprev-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L176"><span class="lineNum">     176</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           4 :     if (pnext)</span></span>
<span id="L177"><span class="lineNum">     177</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;nextblockhash&quot;, pnext-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L178"><span class="lineNum">     178</span>                 :<span class="tlaGNC">           4 :     return result;</span></span>
<span id="L179"><span class="lineNum">     179</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L180"><span class="lineNum">     180</span>                 :             : </span>
<span id="L181"><span class="lineNum">     181</span>                 :<span class="tlaGNC">           3 : UniValue blockToJSON(BlockManager&amp; blockman, const CBlock&amp; block, const CBlockIndex&amp; tip, const CBlockIndex&amp; blockindex, TxVerbosity verbosity, const uint256 pow_limit)</span></span>
<span id="L182"><span class="lineNum">     182</span>                 :             : {</span>
<span id="L183"><span class="lineNum">     183</span>                 :<span class="tlaGNC">           3 :     UniValue result = blockheaderToJSON(tip, blockindex, pow_limit);</span></span>
<span id="L184"><span class="lineNum">     184</span>                 :             : </span>
<span id="L185"><span class="lineNum">     185</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :     result.pushKV(&quot;strippedsize&quot;, (int)::GetSerializeSize(TX_NO_WITNESS(block)));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L186"><span class="lineNum">     186</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :     result.pushKV(&quot;size&quot;, (int)::GetSerializeSize(TX_WITH_WITNESS(block)));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L187"><span class="lineNum">     187</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :     result.pushKV(&quot;weight&quot;, (int)::GetBlockWeight(block));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L188"><span class="lineNum">     188</span>                 :<span class="tlaGNC">           3 :     UniValue txs(UniValue::VARR);</span></span>
<span id="L189"><span class="lineNum">     189</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           3 :     txs.reserve(block.vtx.size());</span></span>
<span id="L190"><span class="lineNum">     190</span>                 :             : </span>
<span id="L191"><span class="lineNum">     191</span>      [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span>]:<span class="tlaGNC">           3 :     switch (verbosity) {</span></span>
<span id="L192"><span class="lineNum">     192</span>                 :<span class="tlaGNC">           1 :         case TxVerbosity::SHOW_TXID:</span></span>
<span id="L193"><span class="lineNum">     193</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           2 :             for (const CTransactionRef&amp; tx : block.vtx) {</span></span>
<span id="L194"><span class="lineNum">     194</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           1 :                 txs.push_back(tx-&gt;GetHash().GetHex());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L195"><span class="lineNum">     195</span>                 :             :             }</span>
<span id="L196"><span class="lineNum">     196</span>                 :             :             break;</span>
<span id="L197"><span class="lineNum">     197</span>                 :             : </span>
<span id="L198"><span class="lineNum">     198</span>                 :<span class="tlaGNC">           2 :         case TxVerbosity::SHOW_DETAILS:</span></span>
<span id="L199"><span class="lineNum">     199</span>                 :<span class="tlaGNC">           2 :         case TxVerbosity::SHOW_DETAILS_AND_PREVOUT:</span></span>
<span id="L200"><span class="lineNum">     200</span>                 :<span class="tlaGNC">           2 :             CBlockUndo blockUndo;</span></span>
<span id="L201"><span class="lineNum">     201</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :             const bool is_not_pruned{WITH_LOCK(::cs_main, return !blockman.IsBlockPruned(blockindex))};</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L202"><span class="lineNum">     202</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :             bool have_undo{is_not_pruned &amp;&amp; WITH_LOCK(::cs_main, return blockindex.nStatus &amp; BLOCK_HAVE_UNDO)};</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaGBC" title="Branch 5 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L203"><span class="lineNum">     203</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (have_undo &amp;&amp; !blockman.ReadBlockUndo(blockUndo, blockindex)) {</span></span>
<span id="L204"><span class="lineNum">     204</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INTERNAL_ERROR, &quot;Undo data expected but can't be read. This could be due to disk corruption or a conflict with a pruning event.&quot;);</span></span>
<span id="L205"><span class="lineNum">     205</span>                 :             :             }</span>
<span id="L206"><span class="lineNum">     206</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 2 times"> + </span>]:<span class="tlaGNC">           4 :             for (size_t i = 0; i &lt; block.vtx.size(); ++i) {</span></span>
<span id="L207"><span class="lineNum">     207</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :                 const CTransactionRef&amp; tx = block.vtx.at(i);</span></span>
<span id="L208"><span class="lineNum">     208</span>                 :             :                 // coinbase transaction (i.e. i == 0) doesn't have undo data</span>
<span id="L209"><span class="lineNum">     209</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :                 const CTxUndo* txundo = (have_undo &amp;&amp; i &gt; 0) ? &amp;blockUndo.vtxundo.at(i - 1) : nullptr;</span></span>
<span id="L210"><span class="lineNum">     210</span>                 :<span class="tlaGNC">           2 :                 UniValue objTx(UniValue::VOBJ);</span></span>
<span id="L211"><span class="lineNum">     211</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :                 TxToUniv(*tx, /*block_hash=*/uint256(), /*entry=*/objTx, /*include_hex=*/true, txundo, verbosity);</span></span>
<span id="L212"><span class="lineNum">     212</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :                 txs.push_back(std::move(objTx));</span></span>
<span id="L213"><span class="lineNum">     213</span>                 :<span class="tlaGNC">           2 :             }</span></span>
<span id="L214"><span class="lineNum">     214</span>                 :<span class="tlaGNC">           2 :             break;</span></span>
<span id="L215"><span class="lineNum">     215</span>                 :             :     }</span>
<span id="L216"><span class="lineNum">     216</span>                 :             : </span>
<span id="L217"><span class="lineNum">     217</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           6 :     result.pushKV(&quot;tx&quot;, std::move(txs));</span></span>
<span id="L218"><span class="lineNum">     218</span>                 :             : </span>
<span id="L219"><span class="lineNum">     219</span>                 :<span class="tlaGNC">           3 :     return result;</span></span>
<span id="L220"><span class="lineNum">     220</span>                 :<span class="tlaGNC">           3 : }</span></span>
<span id="L221"><span class="lineNum">     221</span>                 :             : </span>
<span id="L222"><span class="lineNum">     222</span>                 :<span class="tlaGNC">          66 : static RPCHelpMan getblockcount()</span></span>
<span id="L223"><span class="lineNum">     223</span>                 :             : {</span>
<span id="L224"><span class="lineNum">     224</span>                 :<span class="tlaGNC">          66 :     return RPCHelpMan{</span></span>
<span id="L225"><span class="lineNum">     225</span>                 :<span class="tlaGNC">          66 :         &quot;getblockcount&quot;,</span></span>
<span id="L226"><span class="lineNum">     226</span>         [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         132 :         &quot;Returns the height of the most-work fully-validated chain.\n&quot;</span></span>
<span id="L227"><span class="lineNum">     227</span>                 :             :                 &quot;The genesis block has height 0.\n&quot;,</span>
<span id="L228"><span class="lineNum">     228</span>                 :             :                 {},</span>
<span id="L229"><span class="lineNum">     229</span>         [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         132 :                 RPCResult{</span></span>
<span id="L230"><span class="lineNum">     230</span>   [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         132 :                     RPCResult::Type::NUM, &quot;&quot;, &quot;The current block count&quot;},</span></span>
<span id="L231"><span class="lineNum">     231</span>                 :<span class="tlaGNC">          66 :                 RPCExamples{</span></span>
<span id="L232"><span class="lineNum">     232</span>   [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         132 :                     HelpExampleCli(&quot;getblockcount&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L233"><span class="lineNum">     233</span>   [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         264 :             + HelpExampleRpc(&quot;getblockcount&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L234"><span class="lineNum">     234</span>         [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          66 :                 },</span></span>
<span id="L235"><span class="lineNum">     235</span>                 :<span class="tlaGNC">          66 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L236"><span class="lineNum">     236</span>                 :             : {</span>
<span id="L237"><span class="lineNum">     237</span>                 :<span class="tlaGNC">           1 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L238"><span class="lineNum">     238</span>                 :<span class="tlaGNC">           1 :     LOCK(cs_main);</span></span>
<span id="L239"><span class="lineNum">     239</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">           1 :     return chainman.ActiveChain().Height();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L240"><span class="lineNum">     240</span>                 :<span class="tlaGNC">           1 : },</span></span>
<span id="L241"><span class="lineNum">     241</span>   [<span class="tlaGBC" title="Branch 0 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 66 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         264 :     };</span></span>
<span id="L242"><span class="lineNum">     242</span>                 :             : }</span>
<span id="L243"><span class="lineNum">     243</span>                 :             : </span>
<span id="L244"><span class="lineNum">     244</span>                 :<span class="tlaGNC">          69 : static RPCHelpMan getbestblockhash()</span></span>
<span id="L245"><span class="lineNum">     245</span>                 :             : {</span>
<span id="L246"><span class="lineNum">     246</span>                 :<span class="tlaGNC">          69 :     return RPCHelpMan{</span></span>
<span id="L247"><span class="lineNum">     247</span>                 :<span class="tlaGNC">          69 :         &quot;getbestblockhash&quot;,</span></span>
<span id="L248"><span class="lineNum">     248</span>         [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         138 :         &quot;Returns the hash of the best (tip) block in the most-work fully-validated chain.\n&quot;,</span></span>
<span id="L249"><span class="lineNum">     249</span>                 :             :                 {},</span>
<span id="L250"><span class="lineNum">     250</span>         [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         138 :                 RPCResult{</span></span>
<span id="L251"><span class="lineNum">     251</span>   [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         138 :                     RPCResult::Type::STR_HEX, &quot;&quot;, &quot;the block hash, hex-encoded&quot;},</span></span>
<span id="L252"><span class="lineNum">     252</span>                 :<span class="tlaGNC">          69 :                 RPCExamples{</span></span>
<span id="L253"><span class="lineNum">     253</span>   [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         138 :                     HelpExampleCli(&quot;getbestblockhash&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L254"><span class="lineNum">     254</span>   [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         276 :             + HelpExampleRpc(&quot;getbestblockhash&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L255"><span class="lineNum">     255</span>         [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          69 :                 },</span></span>
<span id="L256"><span class="lineNum">     256</span>                 :<span class="tlaGNC">          69 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L257"><span class="lineNum">     257</span>                 :             : {</span>
<span id="L258"><span class="lineNum">     258</span>                 :<span class="tlaGNC">           1 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L259"><span class="lineNum">     259</span>                 :<span class="tlaGNC">           1 :     LOCK(cs_main);</span></span>
<span id="L260"><span class="lineNum">     260</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">           3 :     return chainman.ActiveChain().Tip()-&gt;GetBlockHash().GetHex();</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 1 time"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L261"><span class="lineNum">     261</span>                 :<span class="tlaGNC">           1 : },</span></span>
<span id="L262"><span class="lineNum">     262</span>   [<span class="tlaGBC" title="Branch 0 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 69 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         276 :     };</span></span>
<span id="L263"><span class="lineNum">     263</span>                 :             : }</span>
<span id="L264"><span class="lineNum">     264</span>                 :             : </span>
<span id="L265"><span class="lineNum">     265</span>                 :<span class="tlaGNC">          77 : static RPCHelpMan waitfornewblock()</span></span>
<span id="L266"><span class="lineNum">     266</span>                 :             : {</span>
<span id="L267"><span class="lineNum">     267</span>                 :<span class="tlaGNC">          77 :     return RPCHelpMan{</span></span>
<span id="L268"><span class="lineNum">     268</span>                 :<span class="tlaGNC">          77 :         &quot;waitfornewblock&quot;,</span></span>
<span id="L269"><span class="lineNum">     269</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         154 :         &quot;Waits for any new block and returns useful info about it.\n&quot;</span></span>
<span id="L270"><span class="lineNum">     270</span>                 :             :                 &quot;\nReturns the current block on timeout or exit.\n&quot;</span>
<span id="L271"><span class="lineNum">     271</span>                 :             :                 &quot;\nMake sure to use no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L272"><span class="lineNum">     272</span>                 :             :                 {</span>
<span id="L273"><span class="lineNum">     273</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         231 :                     {&quot;timeout&quot;, RPCArg::Type::NUM, RPCArg::Default{0}, &quot;Time in milliseconds to wait for a response. 0 indicates no timeout.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L274"><span class="lineNum">     274</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         154 :                     {&quot;current_tip&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, &quot;Method waits for the chain tip to differ from this.&quot;},</span></span>
<span id="L275"><span class="lineNum">     275</span>                 :             :                 },</span>
<span id="L276"><span class="lineNum">     276</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         154 :                 RPCResult{</span></span>
<span id="L277"><span class="lineNum">     277</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         154 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L278"><span class="lineNum">     278</span>                 :             :                     {</span>
<span id="L279"><span class="lineNum">     279</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         154 :                         {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;The blockhash&quot;},</span></span>
<span id="L280"><span class="lineNum">     280</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         154 :                         {RPCResult::Type::NUM, &quot;height&quot;, &quot;Block height&quot;},</span></span>
<span id="L281"><span class="lineNum">     281</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         385 :                     }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 154 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L282"><span class="lineNum">     282</span>                 :<span class="tlaGNC">          77 :                 RPCExamples{</span></span>
<span id="L283"><span class="lineNum">     283</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         154 :                     HelpExampleCli(&quot;waitfornewblock&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L284"><span class="lineNum">     284</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         308 :             + HelpExampleRpc(&quot;waitfornewblock&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L285"><span class="lineNum">     285</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          77 :                 },</span></span>
<span id="L286"><span class="lineNum">     286</span>                 :<span class="tlaGNC">          77 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L287"><span class="lineNum">     287</span>                 :             : {</span>
<span id="L288"><span class="lineNum">     288</span>                 :<span class="tlaGNC">           9 :     int timeout = 0;</span></span>
<span id="L289"><span class="lineNum">     289</span>         [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">           9 :     if (!request.params[0].isNull())</span></span>
<span id="L290"><span class="lineNum">     290</span>                 :<span class="tlaGNC">           6 :         timeout = request.params[0].getInt&lt;int&gt;();</span></span>
<span id="L291"><span class="lineNum">     291</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     if (timeout &lt; 0) throw JSONRPCError(RPC_MISC_ERROR, &quot;Negative timeout&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L292"><span class="lineNum">     292</span>                 :             : </span>
<span id="L293"><span class="lineNum">     293</span>                 :<span class="tlaGNC">           5 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L294"><span class="lineNum">     294</span>                 :<span class="tlaGNC">           5 :     Mining&amp; miner = EnsureMining(node);</span></span>
<span id="L295"><span class="lineNum">     295</span>                 :             : </span>
<span id="L296"><span class="lineNum">     296</span>                 :             :     // If the caller provided a current_tip value, pass it to waitTipChanged().</span>
<span id="L297"><span class="lineNum">     297</span>                 :             :     //</span>
<span id="L298"><span class="lineNum">     298</span>                 :             :     // If the caller did not provide a current tip hash, call getTip() to get</span>
<span id="L299"><span class="lineNum">     299</span>                 :             :     // one and wait for the tip to be different from this value. This mode is</span>
<span id="L300"><span class="lineNum">     300</span>                 :             :     // less reliable because if the tip changed between waitfornewblock calls,</span>
<span id="L301"><span class="lineNum">     301</span>                 :             :     // it will need to change a second time before this call returns.</span>
<span id="L302"><span class="lineNum">     302</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     BlockRef current_block{CHECK_NONFATAL(miner.getTip()).value()};</span></span>
<span id="L303"><span class="lineNum">     303</span>                 :             : </span>
<span id="L304"><span class="lineNum">     304</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     uint256 tip_hash{request.params[1].isNull()</span></span>
<span id="L305"><span class="lineNum">     305</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ? current_block.hash</span></span>
<span id="L306"><span class="lineNum">     306</span>                 :<span class="tlaUNC">           0 :         : ParseHashV(request.params[1], &quot;current_tip&quot;)};</span></span>
<span id="L307"><span class="lineNum">     307</span>                 :             : </span>
<span id="L308"><span class="lineNum">     308</span>                 :             :     // If the user provided an invalid current_tip then this call immediately</span>
<span id="L309"><span class="lineNum">     309</span>                 :             :     // returns the current tip.</span>
<span id="L310"><span class="lineNum">     310</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     std::optional&lt;BlockRef&gt; block = timeout ? miner.waitTipChanged(tip_hash, std::chrono::milliseconds(timeout)) :</span></span>
<span id="L311"><span class="lineNum">     311</span>                 :<span class="tlaUNC">           0 :                                               miner.waitTipChanged(tip_hash);</span></span>
<span id="L312"><span class="lineNum">     312</span>                 :             : </span>
<span id="L313"><span class="lineNum">     313</span>                 :             :     // Return current block upon shutdown</span>
<span id="L314"><span class="lineNum">     314</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (block) current_block = *block;</span></span>
<span id="L315"><span class="lineNum">     315</span>                 :             : </span>
<span id="L316"><span class="lineNum">     316</span>                 :<span class="tlaUNC">           0 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L317"><span class="lineNum">     317</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;hash&quot;, current_block.hash.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L318"><span class="lineNum">     318</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;height&quot;, current_block.height);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L319"><span class="lineNum">     319</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L320"><span class="lineNum">     320</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L321"><span class="lineNum">     321</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         462 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 154 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L322"><span class="lineNum">     322</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         462 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L323"><span class="lineNum">     323</span>                 :             : </span>
<span id="L324"><span class="lineNum">     324</span>                 :<span class="tlaGNC">          84 : static RPCHelpMan waitforblock()</span></span>
<span id="L325"><span class="lineNum">     325</span>                 :             : {</span>
<span id="L326"><span class="lineNum">     326</span>                 :<span class="tlaGNC">          84 :     return RPCHelpMan{</span></span>
<span id="L327"><span class="lineNum">     327</span>                 :<span class="tlaGNC">          84 :         &quot;waitforblock&quot;,</span></span>
<span id="L328"><span class="lineNum">     328</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         168 :         &quot;Waits for a specific new block and returns useful info about it.\n&quot;</span></span>
<span id="L329"><span class="lineNum">     329</span>                 :             :                 &quot;\nReturns the current block on timeout or exit.\n&quot;</span>
<span id="L330"><span class="lineNum">     330</span>                 :             :                 &quot;\nMake sure to use no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L331"><span class="lineNum">     331</span>                 :             :                 {</span>
<span id="L332"><span class="lineNum">     332</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         168 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;Block hash to wait for.&quot;},</span></span>
<span id="L333"><span class="lineNum">     333</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         252 :                     {&quot;timeout&quot;, RPCArg::Type::NUM, RPCArg::Default{0}, &quot;Time in milliseconds to wait for a response. 0 indicates no timeout.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L334"><span class="lineNum">     334</span>                 :             :                 },</span>
<span id="L335"><span class="lineNum">     335</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         168 :                 RPCResult{</span></span>
<span id="L336"><span class="lineNum">     336</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         168 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L337"><span class="lineNum">     337</span>                 :             :                     {</span>
<span id="L338"><span class="lineNum">     338</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         168 :                         {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;The blockhash&quot;},</span></span>
<span id="L339"><span class="lineNum">     339</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         168 :                         {RPCResult::Type::NUM, &quot;height&quot;, &quot;Block height&quot;},</span></span>
<span id="L340"><span class="lineNum">     340</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         420 :                     }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 168 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L341"><span class="lineNum">     341</span>                 :<span class="tlaGNC">          84 :                 RPCExamples{</span></span>
<span id="L342"><span class="lineNum">     342</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         168 :                     HelpExampleCli(&quot;waitforblock&quot;, &quot;\&quot;0000000000079f8ef3d2c688c244eb7a4570b24c9ed7b4a8c619eb02596f8862\&quot; 1000&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L343"><span class="lineNum">     343</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         336 :             + HelpExampleRpc(&quot;waitforblock&quot;, &quot;\&quot;0000000000079f8ef3d2c688c244eb7a4570b24c9ed7b4a8c619eb02596f8862\&quot;, 1000&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L344"><span class="lineNum">     344</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          84 :                 },</span></span>
<span id="L345"><span class="lineNum">     345</span>                 :<span class="tlaGNC">          84 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L346"><span class="lineNum">     346</span>                 :             : {</span>
<span id="L347"><span class="lineNum">     347</span>                 :<span class="tlaGNC">           9 :     int timeout = 0;</span></span>
<span id="L348"><span class="lineNum">     348</span>                 :             : </span>
<span id="L349"><span class="lineNum">     349</span>                 :<span class="tlaGNC">           9 :     uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L350"><span class="lineNum">     350</span>                 :             : </span>
<span id="L351"><span class="lineNum">     351</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           5 :     if (!request.params[1].isNull())</span></span>
<span id="L352"><span class="lineNum">     352</span>                 :<span class="tlaGNC">           4 :         timeout = request.params[1].getInt&lt;int&gt;();</span></span>
<span id="L353"><span class="lineNum">     353</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :     if (timeout &lt; 0) throw JSONRPCError(RPC_MISC_ERROR, &quot;Negative timeout&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L354"><span class="lineNum">     354</span>                 :             : </span>
<span id="L355"><span class="lineNum">     355</span>                 :<span class="tlaGNC">           3 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L356"><span class="lineNum">     356</span>                 :<span class="tlaGNC">           3 :     Mining&amp; miner = EnsureMining(node);</span></span>
<span id="L357"><span class="lineNum">     357</span>                 :             : </span>
<span id="L358"><span class="lineNum">     358</span>                 :             :     // Abort if RPC came out of warmup too early</span>
<span id="L359"><span class="lineNum">     359</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     BlockRef current_block{CHECK_NONFATAL(miner.getTip()).value()};</span></span>
<span id="L360"><span class="lineNum">     360</span>                 :             : </span>
<span id="L361"><span class="lineNum">     361</span>                 :<span class="tlaUNC">           0 :     const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};</span></span>
<span id="L362"><span class="lineNum">     362</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     while (current_block.hash != hash) {</span></span>
<span id="L363"><span class="lineNum">     363</span>                 :<span class="tlaUNC">           0 :         std::optional&lt;BlockRef&gt; block;</span></span>
<span id="L364"><span class="lineNum">     364</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (timeout) {</span></span>
<span id="L365"><span class="lineNum">     365</span>                 :<span class="tlaUNC">           0 :             auto now{std::chrono::steady_clock::now()};</span></span>
<span id="L366"><span class="lineNum">     366</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (now &gt;= deadline) break;</span></span>
<span id="L367"><span class="lineNum">     367</span>                 :<span class="tlaUNC">           0 :             const MillisecondsDouble remaining{deadline - now};</span></span>
<span id="L368"><span class="lineNum">     368</span>                 :<span class="tlaUNC">           0 :             block = miner.waitTipChanged(current_block.hash, remaining);</span></span>
<span id="L369"><span class="lineNum">     369</span>                 :             :         } else {</span>
<span id="L370"><span class="lineNum">     370</span>                 :<span class="tlaUNC">           0 :             block = miner.waitTipChanged(current_block.hash);</span></span>
<span id="L371"><span class="lineNum">     371</span>                 :             :         }</span>
<span id="L372"><span class="lineNum">     372</span>                 :             :         // Return current block upon shutdown</span>
<span id="L373"><span class="lineNum">     373</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!block) break;</span></span>
<span id="L374"><span class="lineNum">     374</span>                 :<span class="tlaUNC">           0 :         current_block = *block;</span></span>
<span id="L375"><span class="lineNum">     375</span>                 :             :     }</span>
<span id="L376"><span class="lineNum">     376</span>                 :             : </span>
<span id="L377"><span class="lineNum">     377</span>                 :<span class="tlaUNC">           0 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L378"><span class="lineNum">     378</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;hash&quot;, current_block.hash.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L379"><span class="lineNum">     379</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;height&quot;, current_block.height);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L380"><span class="lineNum">     380</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L381"><span class="lineNum">     381</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L382"><span class="lineNum">     382</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         504 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 168 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L383"><span class="lineNum">     383</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         504 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L384"><span class="lineNum">     384</span>                 :             : </span>
<span id="L385"><span class="lineNum">     385</span>                 :<span class="tlaGNC">          90 : static RPCHelpMan waitforblockheight()</span></span>
<span id="L386"><span class="lineNum">     386</span>                 :             : {</span>
<span id="L387"><span class="lineNum">     387</span>                 :<span class="tlaGNC">          90 :     return RPCHelpMan{</span></span>
<span id="L388"><span class="lineNum">     388</span>                 :<span class="tlaGNC">          90 :         &quot;waitforblockheight&quot;,</span></span>
<span id="L389"><span class="lineNum">     389</span>         [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         180 :         &quot;Waits for (at least) block height and returns the height and hash\n&quot;</span></span>
<span id="L390"><span class="lineNum">     390</span>                 :             :                 &quot;of the current tip.\n&quot;</span>
<span id="L391"><span class="lineNum">     391</span>                 :             :                 &quot;\nReturns the current block on timeout or exit.\n&quot;</span>
<span id="L392"><span class="lineNum">     392</span>                 :             :                 &quot;\nMake sure to use no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L393"><span class="lineNum">     393</span>                 :             :                 {</span>
<span id="L394"><span class="lineNum">     394</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         180 :                     {&quot;height&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;Block height to wait for.&quot;},</span></span>
<span id="L395"><span class="lineNum">     395</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :                     {&quot;timeout&quot;, RPCArg::Type::NUM, RPCArg::Default{0}, &quot;Time in milliseconds to wait for a response. 0 indicates no timeout.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L396"><span class="lineNum">     396</span>                 :             :                 },</span>
<span id="L397"><span class="lineNum">     397</span>         [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         180 :                 RPCResult{</span></span>
<span id="L398"><span class="lineNum">     398</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         180 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L399"><span class="lineNum">     399</span>                 :             :                     {</span>
<span id="L400"><span class="lineNum">     400</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         180 :                         {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;The blockhash&quot;},</span></span>
<span id="L401"><span class="lineNum">     401</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         180 :                         {RPCResult::Type::NUM, &quot;height&quot;, &quot;Block height&quot;},</span></span>
<span id="L402"><span class="lineNum">     402</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         450 :                     }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 180 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L403"><span class="lineNum">     403</span>                 :<span class="tlaGNC">          90 :                 RPCExamples{</span></span>
<span id="L404"><span class="lineNum">     404</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         180 :                     HelpExampleCli(&quot;waitforblockheight&quot;, &quot;100 1000&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L405"><span class="lineNum">     405</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         360 :             + HelpExampleRpc(&quot;waitforblockheight&quot;, &quot;100, 1000&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L406"><span class="lineNum">     406</span>         [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          90 :                 },</span></span>
<span id="L407"><span class="lineNum">     407</span>                 :<span class="tlaGNC">          90 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L408"><span class="lineNum">     408</span>                 :             : {</span>
<span id="L409"><span class="lineNum">     409</span>                 :<span class="tlaGNC">           6 :     int timeout = 0;</span></span>
<span id="L410"><span class="lineNum">     410</span>                 :             : </span>
<span id="L411"><span class="lineNum">     411</span>                 :<span class="tlaGNC">           6 :     int height = request.params[0].getInt&lt;int&gt;();</span></span>
<span id="L412"><span class="lineNum">     412</span>                 :             : </span>
<span id="L413"><span class="lineNum">     413</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           6 :     if (!request.params[1].isNull())</span></span>
<span id="L414"><span class="lineNum">     414</span>                 :<span class="tlaGNC">           5 :         timeout = request.params[1].getInt&lt;int&gt;();</span></span>
<span id="L415"><span class="lineNum">     415</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     if (timeout &lt; 0) throw JSONRPCError(RPC_MISC_ERROR, &quot;Negative timeout&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L416"><span class="lineNum">     416</span>                 :             : </span>
<span id="L417"><span class="lineNum">     417</span>                 :<span class="tlaGNC">           3 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L418"><span class="lineNum">     418</span>                 :<span class="tlaGNC">           3 :     Mining&amp; miner = EnsureMining(node);</span></span>
<span id="L419"><span class="lineNum">     419</span>                 :             : </span>
<span id="L420"><span class="lineNum">     420</span>                 :             :     // Abort if RPC came out of warmup too early</span>
<span id="L421"><span class="lineNum">     421</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     BlockRef current_block{CHECK_NONFATAL(miner.getTip()).value()};</span></span>
<span id="L422"><span class="lineNum">     422</span>                 :             : </span>
<span id="L423"><span class="lineNum">     423</span>                 :<span class="tlaUNC">           0 :     const auto deadline{std::chrono::steady_clock::now() + 1ms * timeout};</span></span>
<span id="L424"><span class="lineNum">     424</span>                 :             : </span>
<span id="L425"><span class="lineNum">     425</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     while (current_block.height &lt; height) {</span></span>
<span id="L426"><span class="lineNum">     426</span>                 :<span class="tlaUNC">           0 :         std::optional&lt;BlockRef&gt; block;</span></span>
<span id="L427"><span class="lineNum">     427</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (timeout) {</span></span>
<span id="L428"><span class="lineNum">     428</span>                 :<span class="tlaUNC">           0 :             auto now{std::chrono::steady_clock::now()};</span></span>
<span id="L429"><span class="lineNum">     429</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (now &gt;= deadline) break;</span></span>
<span id="L430"><span class="lineNum">     430</span>                 :<span class="tlaUNC">           0 :             const MillisecondsDouble remaining{deadline - now};</span></span>
<span id="L431"><span class="lineNum">     431</span>                 :<span class="tlaUNC">           0 :             block = miner.waitTipChanged(current_block.hash, remaining);</span></span>
<span id="L432"><span class="lineNum">     432</span>                 :             :         } else {</span>
<span id="L433"><span class="lineNum">     433</span>                 :<span class="tlaUNC">           0 :             block = miner.waitTipChanged(current_block.hash);</span></span>
<span id="L434"><span class="lineNum">     434</span>                 :             :         }</span>
<span id="L435"><span class="lineNum">     435</span>                 :             :         // Return current block on shutdown</span>
<span id="L436"><span class="lineNum">     436</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!block) break;</span></span>
<span id="L437"><span class="lineNum">     437</span>                 :<span class="tlaUNC">           0 :         current_block = *block;</span></span>
<span id="L438"><span class="lineNum">     438</span>                 :             :     }</span>
<span id="L439"><span class="lineNum">     439</span>                 :             : </span>
<span id="L440"><span class="lineNum">     440</span>                 :<span class="tlaUNC">           0 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L441"><span class="lineNum">     441</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;hash&quot;, current_block.hash.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L442"><span class="lineNum">     442</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;height&quot;, current_block.height);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L443"><span class="lineNum">     443</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L444"><span class="lineNum">     444</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L445"><span class="lineNum">     445</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         540 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 180 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L446"><span class="lineNum">     446</span>   [<span class="tlaGBC" title="Branch 0 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         540 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 90 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L447"><span class="lineNum">     447</span>                 :             : </span>
<span id="L448"><span class="lineNum">     448</span>                 :<span class="tlaGNC">          58 : static RPCHelpMan syncwithvalidationinterfacequeue()</span></span>
<span id="L449"><span class="lineNum">     449</span>                 :             : {</span>
<span id="L450"><span class="lineNum">     450</span>                 :<span class="tlaGNC">          58 :     return RPCHelpMan{</span></span>
<span id="L451"><span class="lineNum">     451</span>                 :<span class="tlaGNC">          58 :         &quot;syncwithvalidationinterfacequeue&quot;,</span></span>
<span id="L452"><span class="lineNum">     452</span>         [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         116 :         &quot;Waits for the validation interface queue to catch up on everything that was there when we entered this function.\n&quot;,</span></span>
<span id="L453"><span class="lineNum">     453</span>                 :             :                 {},</span>
<span id="L454"><span class="lineNum">     454</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         116 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L455"><span class="lineNum">     455</span>                 :<span class="tlaGNC">          58 :                 RPCExamples{</span></span>
<span id="L456"><span class="lineNum">     456</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         116 :                     HelpExampleCli(&quot;syncwithvalidationinterfacequeue&quot;,&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L457"><span class="lineNum">     457</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         232 :             + HelpExampleRpc(&quot;syncwithvalidationinterfacequeue&quot;,&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L458"><span class="lineNum">     458</span>         [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          58 :                 },</span></span>
<span id="L459"><span class="lineNum">     459</span>                 :<span class="tlaGNC">          58 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L460"><span class="lineNum">     460</span>                 :             : {</span>
<span id="L461"><span class="lineNum">     461</span>                 :<span class="tlaGNC">           2 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L462"><span class="lineNum">     462</span>                 :<span class="tlaGNC">           2 :     CHECK_NONFATAL(node.validation_signals)-&gt;SyncWithValidationInterfaceQueue();</span></span>
<span id="L463"><span class="lineNum">     463</span>                 :<span class="tlaGNC">           2 :     return UniValue::VNULL;</span></span>
<span id="L464"><span class="lineNum">     464</span>                 :             : },</span>
<span id="L465"><span class="lineNum">     465</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         232 :     };</span></span>
<span id="L466"><span class="lineNum">     466</span>                 :             : }</span>
<span id="L467"><span class="lineNum">     467</span>                 :             : </span>
<span id="L468"><span class="lineNum">     468</span>                 :<span class="tlaGNC">         100 : static RPCHelpMan getdifficulty()</span></span>
<span id="L469"><span class="lineNum">     469</span>                 :             : {</span>
<span id="L470"><span class="lineNum">     470</span>                 :<span class="tlaGNC">         100 :     return RPCHelpMan{</span></span>
<span id="L471"><span class="lineNum">     471</span>                 :<span class="tlaGNC">         100 :         &quot;getdifficulty&quot;,</span></span>
<span id="L472"><span class="lineNum">     472</span>         [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         200 :         &quot;Returns the proof-of-work difficulty as a multiple of the minimum difficulty.\n&quot;,</span></span>
<span id="L473"><span class="lineNum">     473</span>                 :             :                 {},</span>
<span id="L474"><span class="lineNum">     474</span>         [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         200 :                 RPCResult{</span></span>
<span id="L475"><span class="lineNum">     475</span>   [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         200 :                     RPCResult::Type::NUM, &quot;&quot;, &quot;the proof-of-work difficulty as a multiple of the minimum difficulty.&quot;},</span></span>
<span id="L476"><span class="lineNum">     476</span>                 :<span class="tlaGNC">         100 :                 RPCExamples{</span></span>
<span id="L477"><span class="lineNum">     477</span>   [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         200 :                     HelpExampleCli(&quot;getdifficulty&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L478"><span class="lineNum">     478</span>   [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         400 :             + HelpExampleRpc(&quot;getdifficulty&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L479"><span class="lineNum">     479</span>         [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         100 :                 },</span></span>
<span id="L480"><span class="lineNum">     480</span>                 :<span class="tlaGNC">         100 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L481"><span class="lineNum">     481</span>                 :             : {</span>
<span id="L482"><span class="lineNum">     482</span>                 :<span class="tlaGNC">           1 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L483"><span class="lineNum">     483</span>                 :<span class="tlaGNC">           1 :     LOCK(cs_main);</span></span>
<span id="L484"><span class="lineNum">     484</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">           2 :     return GetDifficulty(*CHECK_NONFATAL(chainman.ActiveChain().Tip()));</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 1 time"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L485"><span class="lineNum">     485</span>                 :<span class="tlaGNC">           1 : },</span></span>
<span id="L486"><span class="lineNum">     486</span>   [<span class="tlaGBC" title="Branch 0 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 100 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         400 :     };</span></span>
<span id="L487"><span class="lineNum">     487</span>                 :             : }</span>
<span id="L488"><span class="lineNum">     488</span>                 :             : </span>
<span id="L489"><span class="lineNum">     489</span>                 :<span class="tlaGNC">          68 : static RPCHelpMan getblockfrompeer()</span></span>
<span id="L490"><span class="lineNum">     490</span>                 :             : {</span>
<span id="L491"><span class="lineNum">     491</span>                 :<span class="tlaGNC">          68 :     return RPCHelpMan{</span></span>
<span id="L492"><span class="lineNum">     492</span>                 :<span class="tlaGNC">          68 :         &quot;getblockfrompeer&quot;,</span></span>
<span id="L493"><span class="lineNum">     493</span>         [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :         &quot;Attempt to fetch block from a given peer.\n\n&quot;</span></span>
<span id="L494"><span class="lineNum">     494</span>                 :             :         &quot;We must have the header for this block, e.g. using submitheader.\n&quot;</span>
<span id="L495"><span class="lineNum">     495</span>                 :             :         &quot;The block will not have any undo data which can limit the usage of the block data in a context where the undo data is needed.\n&quot;</span>
<span id="L496"><span class="lineNum">     496</span>                 :             :         &quot;Subsequent calls for the same block may cause the response from the previous peer to be ignored.\n&quot;</span>
<span id="L497"><span class="lineNum">     497</span>                 :             :         &quot;Peers generally ignore requests for a stale block that they never fully verified, or one that is more than a month old.\n&quot;</span>
<span id="L498"><span class="lineNum">     498</span>                 :             :         &quot;When a peer does not respond with a block, we will disconnect.\n&quot;</span>
<span id="L499"><span class="lineNum">     499</span>                 :             :         &quot;Note: The block could be re-pruned as soon as it is received.\n\n&quot;</span>
<span id="L500"><span class="lineNum">     500</span>                 :             :         &quot;Returns an empty JSON object if the request was successfully scheduled.&quot;,</span>
<span id="L501"><span class="lineNum">     501</span>                 :             :         {</span>
<span id="L502"><span class="lineNum">     502</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         136 :             {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The block hash to try to fetch&quot;},</span></span>
<span id="L503"><span class="lineNum">     503</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         136 :             {&quot;peer_id&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;The peer to fetch it from (see getpeerinfo for peer IDs)&quot;},</span></span>
<span id="L504"><span class="lineNum">     504</span>                 :             :         },</span>
<span id="L505"><span class="lineNum">     505</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         136 :         RPCResult{RPCResult::Type::OBJ, &quot;&quot;, /*optional=*/false, &quot;&quot;, {}},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L506"><span class="lineNum">     506</span>                 :<span class="tlaGNC">          68 :         RPCExamples{</span></span>
<span id="L507"><span class="lineNum">     507</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         136 :             HelpExampleCli(&quot;getblockfrompeer&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot; 0&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L508"><span class="lineNum">     508</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         272 :             + HelpExampleRpc(&quot;getblockfrompeer&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot; 0&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L509"><span class="lineNum">     509</span>         [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          68 :         },</span></span>
<span id="L510"><span class="lineNum">     510</span>                 :<span class="tlaGNC">          68 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L511"><span class="lineNum">     511</span>                 :             : {</span>
<span id="L512"><span class="lineNum">     512</span>                 :<span class="tlaGNC">           5 :     const NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L513"><span class="lineNum">     513</span>                 :<span class="tlaGNC">           5 :     ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L514"><span class="lineNum">     514</span>                 :<span class="tlaGNC">           5 :     PeerManager&amp; peerman = EnsurePeerman(node);</span></span>
<span id="L515"><span class="lineNum">     515</span>                 :             : </span>
<span id="L516"><span class="lineNum">     516</span>                 :<span class="tlaGNC">           5 :     const uint256&amp; block_hash{ParseHashV(request.params[0], &quot;blockhash&quot;)};</span></span>
<span id="L517"><span class="lineNum">     517</span>                 :<span class="tlaGNC">           5 :     const NodeId peer_id{request.params[1].getInt&lt;int64_t&gt;()};</span></span>
<span id="L518"><span class="lineNum">     518</span>                 :             : </span>
<span id="L519"><span class="lineNum">     519</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          15 :     const CBlockIndex* const index = WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(block_hash););</span></span>
<span id="L520"><span class="lineNum">     520</span>                 :             : </span>
<span id="L521"><span class="lineNum">     521</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           5 :     if (!index) {</span></span>
<span id="L522"><span class="lineNum">     522</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           8 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Block header missing&quot;);</span></span>
<span id="L523"><span class="lineNum">     523</span>                 :             :     }</span>
<span id="L524"><span class="lineNum">     524</span>                 :             : </span>
<span id="L525"><span class="lineNum">     525</span>                 :             :     // Fetching blocks before the node has syncing past their height can prevent block files from</span>
<span id="L526"><span class="lineNum">     526</span>                 :             :     // being pruned, so we avoid it if the node is in prune mode.</span>
<span id="L527"><span class="lineNum">     527</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           1 :     if (chainman.m_blockman.IsPruneMode() &amp;&amp; index-&gt;nHeight &gt; WITH_LOCK(chainman.GetMutex(), return chainman.ActiveTip()-&gt;nHeight)) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L528"><span class="lineNum">     528</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;In prune mode, only blocks that the node has already synced previously can be fetched from a peer&quot;);</span></span>
<span id="L529"><span class="lineNum">     529</span>                 :             :     }</span>
<span id="L530"><span class="lineNum">     530</span>                 :             : </span>
<span id="L531"><span class="lineNum">     531</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :     const bool block_has_data = WITH_LOCK(::cs_main, return index-&gt;nStatus &amp; BLOCK_HAVE_DATA);</span></span>
<span id="L532"><span class="lineNum">     532</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :     if (block_has_data) {</span></span>
<span id="L533"><span class="lineNum">     533</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Block already downloaded&quot;);</span></span>
<span id="L534"><span class="lineNum">     534</span>                 :             :     }</span>
<span id="L535"><span class="lineNum">     535</span>                 :             : </span>
<span id="L536"><span class="lineNum">     536</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (const auto err{peerman.FetchBlock(peer_id, *index)}) {</span></span>
<span id="L537"><span class="lineNum">     537</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, err.value());</span></span>
<span id="L538"><span class="lineNum">     538</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L539"><span class="lineNum">     539</span>                 :<span class="tlaUNC">           0 :     return UniValue::VOBJ;</span></span>
<span id="L540"><span class="lineNum">     540</span>                 :             : },</span>
<span id="L541"><span class="lineNum">     541</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         408 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 136 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L542"><span class="lineNum">     542</span>   [<span class="tlaGBC" title="Branch 0 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 68 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         272 : }</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L543"><span class="lineNum">     543</span>                 :             : </span>
<span id="L544"><span class="lineNum">     544</span>                 :<span class="tlaGNC">          89 : static RPCHelpMan getblockhash()</span></span>
<span id="L545"><span class="lineNum">     545</span>                 :             : {</span>
<span id="L546"><span class="lineNum">     546</span>                 :<span class="tlaGNC">          89 :     return RPCHelpMan{</span></span>
<span id="L547"><span class="lineNum">     547</span>                 :<span class="tlaGNC">          89 :         &quot;getblockhash&quot;,</span></span>
<span id="L548"><span class="lineNum">     548</span>         [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         178 :         &quot;Returns hash of block in best-block-chain at height provided.\n&quot;,</span></span>
<span id="L549"><span class="lineNum">     549</span>                 :             :                 {</span>
<span id="L550"><span class="lineNum">     550</span>   [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         178 :                     {&quot;height&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;The height index&quot;},</span></span>
<span id="L551"><span class="lineNum">     551</span>                 :             :                 },</span>
<span id="L552"><span class="lineNum">     552</span>         [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         178 :                 RPCResult{</span></span>
<span id="L553"><span class="lineNum">     553</span>   [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         178 :                     RPCResult::Type::STR_HEX, &quot;&quot;, &quot;The block hash&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L554"><span class="lineNum">     554</span>                 :<span class="tlaGNC">          89 :                 RPCExamples{</span></span>
<span id="L555"><span class="lineNum">     555</span>   [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         178 :                     HelpExampleCli(&quot;getblockhash&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L556"><span class="lineNum">     556</span>   [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         356 :             + HelpExampleRpc(&quot;getblockhash&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L557"><span class="lineNum">     557</span>         [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          89 :                 },</span></span>
<span id="L558"><span class="lineNum">     558</span>                 :<span class="tlaGNC">          89 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L559"><span class="lineNum">     559</span>                 :             : {</span>
<span id="L560"><span class="lineNum">     560</span>                 :<span class="tlaGNC">          15 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L561"><span class="lineNum">     561</span>                 :<span class="tlaGNC">          15 :     LOCK(cs_main);</span></span>
<span id="L562"><span class="lineNum">     562</span>         [<span class="tlaGBC" title="Branch 0 was taken 15 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          15 :     const CChain&amp; active_chain = chainman.ActiveChain();</span></span>
<span id="L563"><span class="lineNum">     563</span>                 :             : </span>
<span id="L564"><span class="lineNum">     564</span>   [<span class="tlaGBC" title="Branch 0 was taken 15 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 7 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 8 times"> + </span>]:<span class="tlaGNC">          15 :     int nHeight = request.params[0].getInt&lt;int&gt;();</span></span>
<span id="L565"><span class="lineNum">     565</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span>]:<span class="tlaGNC">          11 :     if (nHeight &lt; 0 || nHeight &gt; active_chain.Height())</span></span>
<span id="L566"><span class="lineNum">     566</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          12 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Block height out of range&quot;);</span></span>
<span id="L567"><span class="lineNum">     567</span>                 :             : </span>
<span id="L568"><span class="lineNum">     568</span>                 :<span class="tlaGNC">           1 :     const CBlockIndex* pblockindex = active_chain[nHeight];</span></span>
<span id="L569"><span class="lineNum">     569</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           2 :     return pblockindex-&gt;GetBlockHash().GetHex();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L570"><span class="lineNum">     570</span>                 :<span class="tlaGNC">           1 : },</span></span>
<span id="L571"><span class="lineNum">     571</span>   [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         445 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 89 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L572"><span class="lineNum">     572</span>         [<span class="tlaGBC" title="Branch 0 was taken 89 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         178 : }</span></span>
<span id="L573"><span class="lineNum">     573</span>                 :             : </span>
<span id="L574"><span class="lineNum">     574</span>                 :<span class="tlaGNC">          70 : static RPCHelpMan getblockheader()</span></span>
<span id="L575"><span class="lineNum">     575</span>                 :             : {</span>
<span id="L576"><span class="lineNum">     576</span>                 :<span class="tlaGNC">          70 :     return RPCHelpMan{</span></span>
<span id="L577"><span class="lineNum">     577</span>                 :<span class="tlaGNC">          70 :         &quot;getblockheader&quot;,</span></span>
<span id="L578"><span class="lineNum">     578</span>         [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         140 :         &quot;If verbose is false, returns a string that is serialized, hex-encoded data for blockheader 'hash'.\n&quot;</span></span>
<span id="L579"><span class="lineNum">     579</span>                 :             :                 &quot;If verbose is true, returns an Object with information about blockheader &lt;hash&gt;.\n&quot;,</span>
<span id="L580"><span class="lineNum">     580</span>                 :             :                 {</span>
<span id="L581"><span class="lineNum">     581</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The block hash&quot;},</span></span>
<span id="L582"><span class="lineNum">     582</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         210 :                     {&quot;verbose&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;true for a json object, false for the hex-encoded data&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L583"><span class="lineNum">     583</span>                 :             :                 },</span>
<span id="L584"><span class="lineNum">     584</span>                 :             :                 {</span>
<span id="L585"><span class="lineNum">     585</span>         [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          70 :                     RPCResult{&quot;for verbose = true&quot;,</span></span>
<span id="L586"><span class="lineNum">     586</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                         RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L587"><span class="lineNum">     587</span>                 :             :                         {</span>
<span id="L588"><span class="lineNum">     588</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;the block hash (same as provided)&quot;},</span></span>
<span id="L589"><span class="lineNum">     589</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;confirmations&quot;, &quot;The number of confirmations, or -1 if the block is not on the main chain&quot;},</span></span>
<span id="L590"><span class="lineNum">     590</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;height&quot;, &quot;The block height or index&quot;},</span></span>
<span id="L591"><span class="lineNum">     591</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;version&quot;, &quot;The block version&quot;},</span></span>
<span id="L592"><span class="lineNum">     592</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;versionHex&quot;, &quot;The block version formatted in hexadecimal&quot;},</span></span>
<span id="L593"><span class="lineNum">     593</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;merkleroot&quot;, &quot;The merkle root&quot;},</span></span>
<span id="L594"><span class="lineNum">     594</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM_TIME, &quot;time&quot;, &quot;The block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L595"><span class="lineNum">     595</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM_TIME, &quot;mediantime&quot;, &quot;The median block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L596"><span class="lineNum">     596</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;nonce&quot;, &quot;The nonce&quot;},</span></span>
<span id="L597"><span class="lineNum">     597</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;bits&quot;, &quot;nBits: compact representation of the block difficulty target&quot;},</span></span>
<span id="L598"><span class="lineNum">     598</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;target&quot;, &quot;The difficulty target&quot;},</span></span>
<span id="L599"><span class="lineNum">     599</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;difficulty&quot;, &quot;The difficulty&quot;},</span></span>
<span id="L600"><span class="lineNum">     600</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;chainwork&quot;, &quot;Expected number of hashes required to produce the current chain&quot;},</span></span>
<span id="L601"><span class="lineNum">     601</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::NUM, &quot;nTx&quot;, &quot;The number of transactions in the block&quot;},</span></span>
<span id="L602"><span class="lineNum">     602</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;previousblockhash&quot;, /*optional=*/true, &quot;The hash of the previous block (if available)&quot;},</span></span>
<span id="L603"><span class="lineNum">     603</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                             {RPCResult::Type::STR_HEX, &quot;nextblockhash&quot;, /*optional=*/true, &quot;The hash of the next block (if available)&quot;},</span></span>
<span id="L604"><span class="lineNum">     604</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1120 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 70 times"> + </span> :<span class="tlaGNC">        2310 :                         }},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L605"><span class="lineNum">     605</span>         [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         140 :                     RPCResult{&quot;for verbose=false&quot;,</span></span>
<span id="L606"><span class="lineNum">     606</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         140 :                         RPCResult::Type::STR_HEX, &quot;&quot;, &quot;A string that is serialized, hex-encoded data for block 'hash'&quot;},</span></span>
<span id="L607"><span class="lineNum">     607</span>                 :             :                 },</span>
<span id="L608"><span class="lineNum">     608</span>                 :<span class="tlaGNC">          70 :                 RPCExamples{</span></span>
<span id="L609"><span class="lineNum">     609</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         140 :                     HelpExampleCli(&quot;getblockheader&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L610"><span class="lineNum">     610</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         280 :             + HelpExampleRpc(&quot;getblockheader&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L611"><span class="lineNum">     611</span>         [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          70 :                 },</span></span>
<span id="L612"><span class="lineNum">     612</span>                 :<span class="tlaGNC">          70 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L613"><span class="lineNum">     613</span>                 :             : {</span>
<span id="L614"><span class="lineNum">     614</span>                 :<span class="tlaGNC">           5 :     uint256 hash(ParseHashV(request.params[0], &quot;hash&quot;));</span></span>
<span id="L615"><span class="lineNum">     615</span>                 :             : </span>
<span id="L616"><span class="lineNum">     616</span>                 :<span class="tlaGNC">           5 :     bool fVerbose = true;</span></span>
<span id="L617"><span class="lineNum">     617</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">           5 :     if (!request.params[1].isNull())</span></span>
<span id="L618"><span class="lineNum">     618</span>                 :<span class="tlaGNC">           2 :         fVerbose = request.params[1].get_bool();</span></span>
<span id="L619"><span class="lineNum">     619</span>                 :             : </span>
<span id="L620"><span class="lineNum">     620</span>                 :<span class="tlaGNC">           5 :     const CBlockIndex* pblockindex;</span></span>
<span id="L621"><span class="lineNum">     621</span>                 :<span class="tlaGNC">           5 :     const CBlockIndex* tip;</span></span>
<span id="L622"><span class="lineNum">     622</span>                 :<span class="tlaGNC">           5 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L623"><span class="lineNum">     623</span>                 :<span class="tlaGNC">           5 :     {</span></span>
<span id="L624"><span class="lineNum">     624</span>                 :<span class="tlaGNC">           5 :         LOCK(cs_main);</span></span>
<span id="L625"><span class="lineNum">     625</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           5 :         pblockindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L626"><span class="lineNum">     626</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 5 times"> + </span> :<span class="tlaGNC">          10 :         tip = chainman.ActiveChain().Tip();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L627"><span class="lineNum">     627</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L628"><span class="lineNum">     628</span>                 :             : </span>
<span id="L629"><span class="lineNum">     629</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">           5 :     if (!pblockindex) {</span></span>
<span id="L630"><span class="lineNum">     630</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           6 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L631"><span class="lineNum">     631</span>                 :             :     }</span>
<span id="L632"><span class="lineNum">     632</span>                 :             : </span>
<span id="L633"><span class="lineNum">     633</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           2 :     if (!fVerbose)</span></span>
<span id="L634"><span class="lineNum">     634</span>                 :             :     {</span>
<span id="L635"><span class="lineNum">     635</span>                 :<span class="tlaGNC">           1 :         DataStream ssBlock{};</span></span>
<span id="L636"><span class="lineNum">     636</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :         ssBlock &lt;&lt; pblockindex-&gt;GetBlockHeader();</span></span>
<span id="L637"><span class="lineNum">     637</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           1 :         std::string strHex = HexStr(ssBlock);</span></span>
<span id="L638"><span class="lineNum">     638</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :         return strHex;</span></span>
<span id="L639"><span class="lineNum">     639</span>                 :<span class="tlaGNC">           1 :     }</span></span>
<span id="L640"><span class="lineNum">     640</span>                 :             : </span>
<span id="L641"><span class="lineNum">     641</span>                 :<span class="tlaGNC">           1 :     return blockheaderToJSON(*tip, *pblockindex, chainman.GetConsensus().powLimit);</span></span>
<span id="L642"><span class="lineNum">     642</span>                 :             : },</span>
<span id="L643"><span class="lineNum">     643</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         770 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 140 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 70 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 140 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L644"><span class="lineNum">     644</span>   [<span class="tlaGBC" title="Branch 0 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1540 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 70 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 70 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 70 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 70 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 70 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaUNC" title="Branch 40 was not taken"> - </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaUNC" title="Branch 42 was not taken"> - </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 44 was not taken"> - </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span>]
<span id="L645"><span class="lineNum">     645</span>                 :             : </span>
<span id="L646"><span class="lineNum">     646</span>                 :<span class="tlaGNC">         139 : void CheckBlockDataAvailability(BlockManager&amp; blockman, const CBlockIndex&amp; blockindex, bool check_for_undo)</span></span>
<span id="L647"><span class="lineNum">     647</span>                 :             : {</span>
<span id="L648"><span class="lineNum">     648</span>                 :<span class="tlaGNC">         139 :     AssertLockHeld(cs_main);</span></span>
<span id="L649"><span class="lineNum">     649</span>         [<span class="tlaGBC" title="Branch 0 was taken 139 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         139 :     uint32_t flag = check_for_undo ? BLOCK_HAVE_UNDO : BLOCK_HAVE_DATA;</span></span>
<span id="L650"><span class="lineNum">     650</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 139 times"> + </span>]:<span class="tlaGNC">         139 :     if (!(blockindex.nStatus &amp; flag)) {</span></span>
<span id="L651"><span class="lineNum">     651</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (blockman.IsBlockPruned(blockindex)) {</span></span>
<span id="L652"><span class="lineNum">     652</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, strprintf(&quot;%s not available (pruned data)&quot;, check_for_undo ? &quot;Undo data&quot; : &quot;Block&quot;));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L653"><span class="lineNum">     653</span>                 :             :         }</span>
<span id="L654"><span class="lineNum">     654</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (check_for_undo) {</span></span>
<span id="L655"><span class="lineNum">     655</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Undo data not available&quot;);</span></span>
<span id="L656"><span class="lineNum">     656</span>                 :             :         }</span>
<span id="L657"><span class="lineNum">     657</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Block not available (not fully downloaded)&quot;);</span></span>
<span id="L658"><span class="lineNum">     658</span>                 :             :     }</span>
<span id="L659"><span class="lineNum">     659</span>                 :<span class="tlaGNC">         139 : }</span></span>
<span id="L660"><span class="lineNum">     660</span>                 :             : </span>
<span id="L661"><span class="lineNum">     661</span>                 :<span class="tlaGNC">         135 : static CBlock GetBlockChecked(BlockManager&amp; blockman, const CBlockIndex&amp; blockindex)</span></span>
<span id="L662"><span class="lineNum">     662</span>                 :             : {</span>
<span id="L663"><span class="lineNum">     663</span>                 :<span class="tlaGNC">         135 :     CBlock block;</span></span>
<span id="L664"><span class="lineNum">     664</span>                 :<span class="tlaGNC">         135 :     {</span></span>
<span id="L665"><span class="lineNum">     665</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :         LOCK(cs_main);</span></span>
<span id="L666"><span class="lineNum">     666</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :         CheckBlockDataAvailability(blockman, blockindex, /*check_for_undo=*/false);</span></span>
<span id="L667"><span class="lineNum">     667</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L668"><span class="lineNum">     668</span>                 :             : </span>
<span id="L669"><span class="lineNum">     669</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 135 times"> + </span>]:<span class="tlaGNC">         135 :     if (!blockman.ReadBlock(block, blockindex)) {</span></span>
<span id="L670"><span class="lineNum">     670</span>                 :             :         // Block not found on disk. This shouldn't normally happen unless the block was</span>
<span id="L671"><span class="lineNum">     671</span>                 :             :         // pruned right after we released the lock above.</span>
<span id="L672"><span class="lineNum">     672</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Block not found on disk&quot;);</span></span>
<span id="L673"><span class="lineNum">     673</span>                 :             :     }</span>
<span id="L674"><span class="lineNum">     674</span>                 :             : </span>
<span id="L675"><span class="lineNum">     675</span>                 :<span class="tlaGNC">         135 :     return block;</span></span>
<span id="L676"><span class="lineNum">     676</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L677"><span class="lineNum">     677</span>                 :             : </span>
<span id="L678"><span class="lineNum">     678</span>                 :<span class="tlaGNC">           4 : static std::vector&lt;std::byte&gt; GetRawBlockChecked(BlockManager&amp; blockman, const CBlockIndex&amp; blockindex)</span></span>
<span id="L679"><span class="lineNum">     679</span>                 :             : {</span>
<span id="L680"><span class="lineNum">     680</span>                 :<span class="tlaGNC">           4 :     std::vector&lt;std::byte&gt; data{};</span></span>
<span id="L681"><span class="lineNum">     681</span>                 :<span class="tlaGNC">           4 :     FlatFilePos pos{};</span></span>
<span id="L682"><span class="lineNum">     682</span>                 :<span class="tlaGNC">           4 :     {</span></span>
<span id="L683"><span class="lineNum">     683</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :         LOCK(cs_main);</span></span>
<span id="L684"><span class="lineNum">     684</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :         CheckBlockDataAvailability(blockman, blockindex, /*check_for_undo=*/false);</span></span>
<span id="L685"><span class="lineNum">     685</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :         pos = blockindex.GetBlockPos();</span></span>
<span id="L686"><span class="lineNum">     686</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L687"><span class="lineNum">     687</span>                 :             : </span>
<span id="L688"><span class="lineNum">     688</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 4 times"> + </span>]:<span class="tlaGNC">           4 :     if (!blockman.ReadRawBlock(data, pos)) {</span></span>
<span id="L689"><span class="lineNum">     689</span>                 :             :         // Block not found on disk. This shouldn't normally happen unless the block was</span>
<span id="L690"><span class="lineNum">     690</span>                 :             :         // pruned right after we released the lock above.</span>
<span id="L691"><span class="lineNum">     691</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Block not found on disk&quot;);</span></span>
<span id="L692"><span class="lineNum">     692</span>                 :             :     }</span>
<span id="L693"><span class="lineNum">     693</span>                 :             : </span>
<span id="L694"><span class="lineNum">     694</span>                 :<span class="tlaGNC">           4 :     return data;</span></span>
<span id="L695"><span class="lineNum">     695</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L696"><span class="lineNum">     696</span>                 :             : </span>
<span id="L697"><span class="lineNum">     697</span>                 :<span class="tlaGNC">         135 : static CBlockUndo GetUndoChecked(BlockManager&amp; blockman, const CBlockIndex&amp; blockindex)</span></span>
<span id="L698"><span class="lineNum">     698</span>                 :             : {</span>
<span id="L699"><span class="lineNum">     699</span>                 :<span class="tlaGNC">         135 :     CBlockUndo blockUndo;</span></span>
<span id="L700"><span class="lineNum">     700</span>                 :             : </span>
<span id="L701"><span class="lineNum">     701</span>                 :             :     // The Genesis block does not have undo data</span>
<span id="L702"><span class="lineNum">     702</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span>]:<span class="tlaGNC">         135 :     if (blockindex.nHeight == 0) return blockUndo;</span></span>
<span id="L703"><span class="lineNum">     703</span>                 :             : </span>
<span id="L704"><span class="lineNum">     704</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L705"><span class="lineNum">     705</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(cs_main);</span></span>
<span id="L706"><span class="lineNum">     706</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CheckBlockDataAvailability(blockman, blockindex, /*check_for_undo=*/true);</span></span>
<span id="L707"><span class="lineNum">     707</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L708"><span class="lineNum">     708</span>                 :             : </span>
<span id="L709"><span class="lineNum">     709</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!blockman.ReadBlockUndo(blockUndo, blockindex)) {</span></span>
<span id="L710"><span class="lineNum">     710</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Can't read undo data from disk&quot;);</span></span>
<span id="L711"><span class="lineNum">     711</span>                 :             :     }</span>
<span id="L712"><span class="lineNum">     712</span>                 :             : </span>
<span id="L713"><span class="lineNum">     713</span>                 :             :     return blockUndo;</span>
<span id="L714"><span class="lineNum">     714</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L715"><span class="lineNum">     715</span>                 :             : </span>
<span id="L716"><span class="lineNum">     716</span>                 :             : const RPCResult getblock_vin{</span>
<span id="L717"><span class="lineNum">     717</span>                 :             :     RPCResult::Type::ARR, &quot;vin&quot;, &quot;&quot;,</span>
<span id="L718"><span class="lineNum">     718</span>                 :             :     {</span>
<span id="L719"><span class="lineNum">     719</span>                 :             :         {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L720"><span class="lineNum">     720</span>                 :             :         {</span>
<span id="L721"><span class="lineNum">     721</span>                 :             :             {RPCResult::Type::ELISION, &quot;&quot;, &quot;The same output as verbosity = 2&quot;},</span>
<span id="L722"><span class="lineNum">     722</span>                 :             :             {RPCResult::Type::OBJ, &quot;prevout&quot;, &quot;(Only if undo information is available)&quot;,</span>
<span id="L723"><span class="lineNum">     723</span>                 :             :             {</span>
<span id="L724"><span class="lineNum">     724</span>                 :             :                 {RPCResult::Type::BOOL, &quot;generated&quot;, &quot;Coinbase or not&quot;},</span>
<span id="L725"><span class="lineNum">     725</span>                 :             :                 {RPCResult::Type::NUM, &quot;height&quot;, &quot;The height of the prevout&quot;},</span>
<span id="L726"><span class="lineNum">     726</span>                 :             :                 {RPCResult::Type::STR_AMOUNT, &quot;value&quot;, &quot;The value in &quot; + CURRENCY_UNIT},</span>
<span id="L727"><span class="lineNum">     727</span>                 :             :                 {RPCResult::Type::OBJ, &quot;scriptPubKey&quot;, &quot;&quot;,</span>
<span id="L728"><span class="lineNum">     728</span>                 :             :                 {</span>
<span id="L729"><span class="lineNum">     729</span>                 :             :                     {RPCResult::Type::STR, &quot;asm&quot;, &quot;Disassembly of the output script&quot;},</span>
<span id="L730"><span class="lineNum">     730</span>                 :             :                     {RPCResult::Type::STR, &quot;desc&quot;, &quot;Inferred descriptor for the output&quot;},</span>
<span id="L731"><span class="lineNum">     731</span>                 :             :                     {RPCResult::Type::STR_HEX, &quot;hex&quot;, &quot;The raw output script bytes, hex-encoded&quot;},</span>
<span id="L732"><span class="lineNum">     732</span>                 :             :                     {RPCResult::Type::STR, &quot;address&quot;, /*optional=*/true, &quot;The Bitcoin address (only if a well-defined address exists)&quot;},</span>
<span id="L733"><span class="lineNum">     733</span>                 :             :                     {RPCResult::Type::STR, &quot;type&quot;, &quot;The type (one of: &quot; + GetAllOutputTypes() + &quot;)&quot;},</span>
<span id="L734"><span class="lineNum">     734</span>                 :             :                 }},</span>
<span id="L735"><span class="lineNum">     735</span>                 :             :             }},</span>
<span id="L736"><span class="lineNum">     736</span>                 :             :         }},</span>
<span id="L737"><span class="lineNum">     737</span>                 :             :     }</span>
<span id="L738"><span class="lineNum">     738</span>                 :             : };</span>
<span id="L739"><span class="lineNum">     739</span>                 :             : </span>
<span id="L740"><span class="lineNum">     740</span>                 :<span class="tlaGNC">          85 : static RPCHelpMan getblock()</span></span>
<span id="L741"><span class="lineNum">     741</span>                 :             : {</span>
<span id="L742"><span class="lineNum">     742</span>                 :<span class="tlaGNC">          85 :     return RPCHelpMan{</span></span>
<span id="L743"><span class="lineNum">     743</span>                 :<span class="tlaGNC">          85 :         &quot;getblock&quot;,</span></span>
<span id="L744"><span class="lineNum">     744</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         170 :         &quot;If verbosity is 0, returns a string that is serialized, hex-encoded data for block 'hash'.\n&quot;</span></span>
<span id="L745"><span class="lineNum">     745</span>                 :             :                 &quot;If verbosity is 1, returns an Object with information about block &lt;hash&gt;.\n&quot;</span>
<span id="L746"><span class="lineNum">     746</span>                 :             :                 &quot;If verbosity is 2, returns an Object with information about block &lt;hash&gt; and information about each transaction.\n&quot;</span>
<span id="L747"><span class="lineNum">     747</span>                 :             :                 &quot;If verbosity is 3, returns an Object with information about block &lt;hash&gt; and information about each transaction, including prevout information for inputs (only for unpruned blocks in the current best chain).\n&quot;,</span>
<span id="L748"><span class="lineNum">     748</span>                 :             :                 {</span>
<span id="L749"><span class="lineNum">     749</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The block hash&quot;},</span></span>
<span id="L750"><span class="lineNum">     750</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         255 :                     {&quot;verbosity|verbose&quot;, RPCArg::Type::NUM, RPCArg::Default{1}, &quot;0 for hex-encoded data, 1 for a JSON object, 2 for JSON object with transaction data, and 3 for JSON object with transaction data including prevout information for inputs&quot;,</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L751"><span class="lineNum">     751</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         170 :                      RPCArgOptions{.skip_type_check = true}},</span></span>
<span id="L752"><span class="lineNum">     752</span>                 :             :                 },</span>
<span id="L753"><span class="lineNum">     753</span>                 :             :                 {</span>
<span id="L754"><span class="lineNum">     754</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          85 :                     RPCResult{&quot;for verbosity = 0&quot;,</span></span>
<span id="L755"><span class="lineNum">     755</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                 RPCResult::Type::STR_HEX, &quot;&quot;, &quot;A string that is serialized, hex-encoded data for block 'hash'&quot;},</span></span>
<span id="L756"><span class="lineNum">     756</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     RPCResult{&quot;for verbosity = 1&quot;,</span></span>
<span id="L757"><span class="lineNum">     757</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                 RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L758"><span class="lineNum">     758</span>                 :             :                 {</span>
<span id="L759"><span class="lineNum">     759</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;the block hash (same as provided)&quot;},</span></span>
<span id="L760"><span class="lineNum">     760</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;confirmations&quot;, &quot;The number of confirmations, or -1 if the block is not on the main chain&quot;},</span></span>
<span id="L761"><span class="lineNum">     761</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;size&quot;, &quot;The block size&quot;},</span></span>
<span id="L762"><span class="lineNum">     762</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;strippedsize&quot;, &quot;The block size excluding witness data&quot;},</span></span>
<span id="L763"><span class="lineNum">     763</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;weight&quot;, &quot;The block weight as defined in BIP 141&quot;},</span></span>
<span id="L764"><span class="lineNum">     764</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;height&quot;, &quot;The block height or index&quot;},</span></span>
<span id="L765"><span class="lineNum">     765</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;version&quot;, &quot;The block version&quot;},</span></span>
<span id="L766"><span class="lineNum">     766</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;versionHex&quot;, &quot;The block version formatted in hexadecimal&quot;},</span></span>
<span id="L767"><span class="lineNum">     767</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;merkleroot&quot;, &quot;The merkle root&quot;},</span></span>
<span id="L768"><span class="lineNum">     768</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::ARR, &quot;tx&quot;, &quot;The transaction ids&quot;,</span></span>
<span id="L769"><span class="lineNum">     769</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                         {{RPCResult::Type::STR_HEX, &quot;&quot;, &quot;The transaction id&quot;}}},</span></span>
<span id="L770"><span class="lineNum">     770</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM_TIME, &quot;time&quot;,       &quot;The block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L771"><span class="lineNum">     771</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM_TIME, &quot;mediantime&quot;, &quot;The median block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L772"><span class="lineNum">     772</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;nonce&quot;, &quot;The nonce&quot;},</span></span>
<span id="L773"><span class="lineNum">     773</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;bits&quot;, &quot;nBits: compact representation of the block difficulty target&quot;},</span></span>
<span id="L774"><span class="lineNum">     774</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;target&quot;, &quot;The difficulty target&quot;},</span></span>
<span id="L775"><span class="lineNum">     775</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;difficulty&quot;, &quot;The difficulty&quot;},</span></span>
<span id="L776"><span class="lineNum">     776</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;chainwork&quot;, &quot;Expected number of hashes required to produce the chain up to this block (in hex)&quot;},</span></span>
<span id="L777"><span class="lineNum">     777</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::NUM, &quot;nTx&quot;, &quot;The number of transactions in the block&quot;},</span></span>
<span id="L778"><span class="lineNum">     778</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;previousblockhash&quot;, /*optional=*/true, &quot;The hash of the previous block (if available)&quot;},</span></span>
<span id="L779"><span class="lineNum">     779</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::STR_HEX, &quot;nextblockhash&quot;, /*optional=*/true, &quot;The hash of the next block (if available)&quot;},</span></span>
<span id="L780"><span class="lineNum">     780</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        3655 :                 }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 1700 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 6 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L781"><span class="lineNum">     781</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     RPCResult{&quot;for verbosity = 2&quot;,</span></span>
<span id="L782"><span class="lineNum">     782</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                 RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L783"><span class="lineNum">     783</span>                 :             :                 {</span>
<span id="L784"><span class="lineNum">     784</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::ELISION, &quot;&quot;, &quot;Same output as verbosity = 1&quot;},</span></span>
<span id="L785"><span class="lineNum">     785</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::ARR, &quot;tx&quot;, &quot;&quot;,</span></span>
<span id="L786"><span class="lineNum">     786</span>                 :             :                     {</span>
<span id="L787"><span class="lineNum">     787</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                         {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L788"><span class="lineNum">     788</span>                 :             :                         {</span>
<span id="L789"><span class="lineNum">     789</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                             {RPCResult::Type::ELISION, &quot;&quot;, &quot;The transactions in the format of the getrawtransaction RPC. Different from verbosity = 1 \&quot;tx\&quot; result&quot;},</span></span>
<span id="L790"><span class="lineNum">     790</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                             {RPCResult::Type::NUM, &quot;fee&quot;, &quot;The transaction fee in &quot; + CURRENCY_UNIT + &quot;, omitted if block undo data is not available&quot;},</span></span>
<span id="L791"><span class="lineNum">     791</span>                 :             :                         }},</span>
<span id="L792"><span class="lineNum">     792</span>                 :             :                     }},</span>
<span id="L793"><span class="lineNum">     793</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         935 :                 }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 170 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 170 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaUNC" title="Branch 16 was not taken"> - </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span>]
<span id="L794"><span class="lineNum">     794</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     RPCResult{&quot;for verbosity = 3&quot;,</span></span>
<span id="L795"><span class="lineNum">     795</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                 RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L796"><span class="lineNum">     796</span>                 :             :                 {</span>
<span id="L797"><span class="lineNum">     797</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::ELISION, &quot;&quot;, &quot;Same output as verbosity = 2&quot;},</span></span>
<span id="L798"><span class="lineNum">     798</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                     {RPCResult::Type::ARR, &quot;tx&quot;, &quot;&quot;,</span></span>
<span id="L799"><span class="lineNum">     799</span>                 :             :                     {</span>
<span id="L800"><span class="lineNum">     800</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         170 :                         {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L801"><span class="lineNum">     801</span>                 :             :                         {</span>
<span id="L802"><span class="lineNum">     802</span>                 :             :                             getblock_vin,</span>
<span id="L803"><span class="lineNum">     803</span>                 :             :                         }},</span>
<span id="L804"><span class="lineNum">     804</span>                 :             :                     }},</span>
<span id="L805"><span class="lineNum">     805</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         765 :                 }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 170 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaUNC" title="Branch 16 was not taken"> - </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span>]
<span id="L806"><span class="lineNum">     806</span>                 :             :         },</span>
<span id="L807"><span class="lineNum">     807</span>                 :<span class="tlaGNC">          85 :                 RPCExamples{</span></span>
<span id="L808"><span class="lineNum">     808</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         170 :                     HelpExampleCli(&quot;getblock&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L809"><span class="lineNum">     809</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         340 :             + HelpExampleRpc(&quot;getblock&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L810"><span class="lineNum">     810</span>         [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          85 :                 },</span></span>
<span id="L811"><span class="lineNum">     811</span>                 :<span class="tlaGNC">          85 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L812"><span class="lineNum">     812</span>                 :             : {</span>
<span id="L813"><span class="lineNum">     813</span>                 :<span class="tlaGNC">          19 :     uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L814"><span class="lineNum">     814</span>                 :             : </span>
<span id="L815"><span class="lineNum">     815</span>                 :<span class="tlaGNC">          16 :     int verbosity{ParseVerbosity(request.params[1], /*default_verbosity=*/1, /*allow_bool=*/true)};</span></span>
<span id="L816"><span class="lineNum">     816</span>                 :             : </span>
<span id="L817"><span class="lineNum">     817</span>                 :<span class="tlaGNC">           5 :     const CBlockIndex* pblockindex;</span></span>
<span id="L818"><span class="lineNum">     818</span>                 :<span class="tlaGNC">           5 :     const CBlockIndex* tip;</span></span>
<span id="L819"><span class="lineNum">     819</span>                 :<span class="tlaGNC">           5 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L820"><span class="lineNum">     820</span>                 :<span class="tlaGNC">           5 :     {</span></span>
<span id="L821"><span class="lineNum">     821</span>                 :<span class="tlaGNC">           5 :         LOCK(cs_main);</span></span>
<span id="L822"><span class="lineNum">     822</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           5 :         pblockindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L823"><span class="lineNum">     823</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 5 times"> + </span>]:<span class="tlaGNC">           5 :         tip = chainman.ActiveChain().Tip();</span></span>
<span id="L824"><span class="lineNum">     824</span>                 :             : </span>
<span id="L825"><span class="lineNum">     825</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           5 :         if (!pblockindex) {</span></span>
<span id="L826"><span class="lineNum">     826</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L827"><span class="lineNum">     827</span>                 :             :         }</span>
<span id="L828"><span class="lineNum">     828</span>                 :<span class="tlaGNC">           1 :     }</span></span>
<span id="L829"><span class="lineNum">     829</span>                 :             : </span>
<span id="L830"><span class="lineNum">     830</span>                 :<span class="tlaGNC">           4 :     const std::vector&lt;std::byte&gt; block_data{GetRawBlockChecked(chainman.m_blockman, *pblockindex)};</span></span>
<span id="L831"><span class="lineNum">     831</span>                 :             : </span>
<span id="L832"><span class="lineNum">     832</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">           4 :     if (verbosity &lt;= 0) {</span></span>
<span id="L833"><span class="lineNum">     833</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           2 :         return HexStr(block_data);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L834"><span class="lineNum">     834</span>                 :             :     }</span>
<span id="L835"><span class="lineNum">     835</span>                 :             : </span>
<span id="L836"><span class="lineNum">     836</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           3 :     DataStream block_stream{block_data};</span></span>
<span id="L837"><span class="lineNum">     837</span>                 :<span class="tlaGNC">           3 :     CBlock block{};</span></span>
<span id="L838"><span class="lineNum">     838</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :     block_stream &gt;&gt; TX_WITH_WITNESS(block);</span></span>
<span id="L839"><span class="lineNum">     839</span>                 :             : </span>
<span id="L840"><span class="lineNum">     840</span>                 :<span class="tlaGNC">           3 :     TxVerbosity tx_verbosity;</span></span>
<span id="L841"><span class="lineNum">     841</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           3 :     if (verbosity == 1) {</span></span>
<span id="L842"><span class="lineNum">     842</span>                 :             :         tx_verbosity = TxVerbosity::SHOW_TXID;</span>
<span id="L843"><span class="lineNum">     843</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           2 :     } else if (verbosity == 2) {</span></span>
<span id="L844"><span class="lineNum">     844</span>                 :             :         tx_verbosity = TxVerbosity::SHOW_DETAILS;</span>
<span id="L845"><span class="lineNum">     845</span>                 :             :     } else {</span>
<span id="L846"><span class="lineNum">     846</span>                 :<span class="tlaGNC">           1 :         tx_verbosity = TxVerbosity::SHOW_DETAILS_AND_PREVOUT;</span></span>
<span id="L847"><span class="lineNum">     847</span>                 :             :     }</span>
<span id="L848"><span class="lineNum">     848</span>                 :             : </span>
<span id="L849"><span class="lineNum">     849</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :     return blockToJSON(chainman.m_blockman, block, *tip, *pblockindex, tx_verbosity, chainman.GetConsensus().powLimit);</span></span>
<span id="L850"><span class="lineNum">     850</span>                 :<span class="tlaGNC">           7 : },</span></span>
<span id="L851"><span class="lineNum">     851</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1105 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 340 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 85 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 170 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L852"><span class="lineNum">     852</span>   [<span class="tlaGBC" title="Branch 0 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        3145 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 44 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaGBC" title="Branch 46 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaGBC" title="Branch 48 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaGBC" title="Branch 50 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span><span class="tlaGBC" title="Branch 52 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 53 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 54 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 55 was not taken"> - </span><span class="tlaGBC" title="Branch 56 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 57 was not taken"> - </span><span class="tlaGBC" title="Branch 58 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 59 was not taken"> - </span><span class="tlaGBC" title="Branch 60 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 61 was not taken"> - </span><span class="tlaGBC" title="Branch 62 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 63 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 64 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 65 was not taken"> - </span><span class="tlaGBC" title="Branch 66 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 67 was not taken"> - </span><span class="tlaGBC" title="Branch 68 was taken 85 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 69 was not taken"> - </span><span class="tlaGBC" title="Branch 70 was taken 85 times"> + </span><span class="tlaUNC" title="Branch 71 was not taken"> - </span><span class="tlaUNC" title="Branch 72 was not taken"> - </span><span class="tlaUNC" title="Branch 73 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 74 was not taken"> - </span><span class="tlaUNC" title="Branch 75 was not taken"> - </span><span class="tlaUNC" title="Branch 76 was not taken"> - </span><span class="tlaUNC" title="Branch 77 was not taken"> - </span><span class="tlaUNC" title="Branch 78 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 79 was not taken"> - </span><span class="tlaUNC" title="Branch 80 was not taken"> - </span><span class="tlaUNC" title="Branch 81 was not taken"> - </span><span class="tlaUNC" title="Branch 82 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 83 was not taken"> - </span>]
<span id="L853"><span class="lineNum">     853</span>                 :             : </span>
<span id="L854"><span class="lineNum">     854</span>                 :             : //! Return height of highest block that has been pruned, or std::nullopt if no blocks have been pruned</span>
<span id="L855"><span class="lineNum">     855</span>                 :<span class="tlaUNC">           0 : std::optional&lt;int&gt; GetPruneHeight(const BlockManager&amp; blockman, const CChain&amp; chain) {</span></span>
<span id="L856"><span class="lineNum">     856</span>                 :<span class="tlaUNC">           0 :     AssertLockHeld(::cs_main);</span></span>
<span id="L857"><span class="lineNum">     857</span>                 :             : </span>
<span id="L858"><span class="lineNum">     858</span>                 :             :     // Search for the last block missing block data or undo data. Don't let the</span>
<span id="L859"><span class="lineNum">     859</span>                 :             :     // search consider the genesis block, because the genesis block does not</span>
<span id="L860"><span class="lineNum">     860</span>                 :             :     // have undo data, but should not be considered pruned.</span>
<span id="L861"><span class="lineNum">     861</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const CBlockIndex* first_block{chain[1]};</span></span>
<span id="L862"><span class="lineNum">     862</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const CBlockIndex* chain_tip{chain.Tip()};</span></span>
<span id="L863"><span class="lineNum">     863</span>                 :             : </span>
<span id="L864"><span class="lineNum">     864</span>                 :             :     // If there are no blocks after the genesis block, or no blocks at all, nothing is pruned.</span>
<span id="L865"><span class="lineNum">     865</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!first_block || !chain_tip) return std::nullopt;</span></span>
<span id="L866"><span class="lineNum">     866</span>                 :             : </span>
<span id="L867"><span class="lineNum">     867</span>                 :             :     // If the chain tip is pruned, everything is pruned.</span>
<span id="L868"><span class="lineNum">     868</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!((chain_tip-&gt;nStatus &amp; BLOCK_HAVE_MASK) == BLOCK_HAVE_MASK)) return chain_tip-&gt;nHeight;</span></span>
<span id="L869"><span class="lineNum">     869</span>                 :             : </span>
<span id="L870"><span class="lineNum">     870</span>                 :<span class="tlaUNC">           0 :     const auto&amp; first_unpruned{*CHECK_NONFATAL(blockman.GetFirstBlock(*chain_tip, /*status_mask=*/BLOCK_HAVE_MASK, first_block))};</span></span>
<span id="L871"><span class="lineNum">     871</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (&amp;first_unpruned == first_block) {</span></span>
<span id="L872"><span class="lineNum">     872</span>                 :             :         // All blocks between first_block and chain_tip have data, so nothing is pruned.</span>
<span id="L873"><span class="lineNum">     873</span>                 :<span class="tlaUNC">           0 :         return std::nullopt;</span></span>
<span id="L874"><span class="lineNum">     874</span>                 :             :     }</span>
<span id="L875"><span class="lineNum">     875</span>                 :             : </span>
<span id="L876"><span class="lineNum">     876</span>                 :             :     // Block before the first unpruned block is the last pruned block.</span>
<span id="L877"><span class="lineNum">     877</span>                 :<span class="tlaUNC">           0 :     return CHECK_NONFATAL(first_unpruned.pprev)-&gt;nHeight;</span></span>
<span id="L878"><span class="lineNum">     878</span>                 :             : }</span>
<span id="L879"><span class="lineNum">     879</span>                 :             : </span>
<span id="L880"><span class="lineNum">     880</span>                 :<span class="tlaGNC">          72 : static RPCHelpMan pruneblockchain()</span></span>
<span id="L881"><span class="lineNum">     881</span>                 :             : {</span>
<span id="L882"><span class="lineNum">     882</span>                 :<span class="tlaGNC">          72 :     return RPCHelpMan{&quot;pruneblockchain&quot;,</span></span>
<span id="L883"><span class="lineNum">     883</span>         [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         144 :                 &quot;Attempts to delete block and undo data up to a specified height or timestamp, if eligible for pruning.\n&quot;</span></span>
<span id="L884"><span class="lineNum">     884</span>                 :             :                 &quot;Requires `-prune` to be enabled at startup. While pruned data may be re-fetched in some cases (e.g., via `getblockfrompeer`), local deletion is irreversible.\n&quot;,</span>
<span id="L885"><span class="lineNum">     885</span>                 :             :                 {</span>
<span id="L886"><span class="lineNum">     886</span>   [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         144 :                     {&quot;height&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;The block height to prune up to. May be set to a discrete height, or to a &quot; + UNIX_EPOCH_TIME + &quot;\n&quot;</span></span>
<span id="L887"><span class="lineNum">     887</span>                 :<span class="tlaGNC">          72 :             &quot;                  to prune blocks whose block time is at least 2 hours older than the provided timestamp.&quot;},</span></span>
<span id="L888"><span class="lineNum">     888</span>                 :             :                 },</span>
<span id="L889"><span class="lineNum">     889</span>         [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         144 :                 RPCResult{</span></span>
<span id="L890"><span class="lineNum">     890</span>   [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         144 :                     RPCResult::Type::NUM, &quot;&quot;, &quot;Height of the last block pruned&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L891"><span class="lineNum">     891</span>                 :<span class="tlaGNC">          72 :                 RPCExamples{</span></span>
<span id="L892"><span class="lineNum">     892</span>   [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         144 :                     HelpExampleCli(&quot;pruneblockchain&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L893"><span class="lineNum">     893</span>   [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         288 :             + HelpExampleRpc(&quot;pruneblockchain&quot;, &quot;1000&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L894"><span class="lineNum">     894</span>         [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          72 :                 },</span></span>
<span id="L895"><span class="lineNum">     895</span>                 :<span class="tlaGNC">          72 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L896"><span class="lineNum">     896</span>                 :             : {</span>
<span id="L897"><span class="lineNum">     897</span>                 :<span class="tlaGNC">           1 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L898"><span class="lineNum">     898</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :     if (!chainman.m_blockman.IsPruneMode()) {</span></span>
<span id="L899"><span class="lineNum">     899</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Cannot prune blocks because node is not in prune mode.&quot;);</span></span>
<span id="L900"><span class="lineNum">     900</span>                 :             :     }</span>
<span id="L901"><span class="lineNum">     901</span>                 :             : </span>
<span id="L902"><span class="lineNum">     902</span>                 :<span class="tlaUNC">           0 :     LOCK(cs_main);</span></span>
<span id="L903"><span class="lineNum">     903</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L904"><span class="lineNum">     904</span>                 :<span class="tlaUNC">           0 :     CChain&amp; active_chain = active_chainstate.m_chain;</span></span>
<span id="L905"><span class="lineNum">     905</span>                 :             : </span>
<span id="L906"><span class="lineNum">     906</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     int heightParam = request.params[0].getInt&lt;int&gt;();</span></span>
<span id="L907"><span class="lineNum">     907</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (heightParam &lt; 0) {</span></span>
<span id="L908"><span class="lineNum">     908</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Negative block height.&quot;);</span></span>
<span id="L909"><span class="lineNum">     909</span>                 :             :     }</span>
<span id="L910"><span class="lineNum">     910</span>                 :             : </span>
<span id="L911"><span class="lineNum">     911</span>                 :             :     // Height value more than a billion is too high to be a block height, and</span>
<span id="L912"><span class="lineNum">     912</span>                 :             :     // too low to be a block time (corresponds to timestamp from Sep 2001).</span>
<span id="L913"><span class="lineNum">     913</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (heightParam &gt; 1000000000) {</span></span>
<span id="L914"><span class="lineNum">     914</span>                 :             :         // Add a 2 hour buffer to include blocks which might have had old timestamps</span>
<span id="L915"><span class="lineNum">     915</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const CBlockIndex* pindex = active_chain.FindEarliestAtLeast(heightParam - TIMESTAMP_WINDOW, 0);</span></span>
<span id="L916"><span class="lineNum">     916</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!pindex) {</span></span>
<span id="L917"><span class="lineNum">     917</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Could not find block with at least the specified timestamp.&quot;);</span></span>
<span id="L918"><span class="lineNum">     918</span>                 :             :         }</span>
<span id="L919"><span class="lineNum">     919</span>                 :<span class="tlaUNC">           0 :         heightParam = pindex-&gt;nHeight;</span></span>
<span id="L920"><span class="lineNum">     920</span>                 :             :     }</span>
<span id="L921"><span class="lineNum">     921</span>                 :             : </span>
<span id="L922"><span class="lineNum">     922</span>                 :<span class="tlaUNC">           0 :     unsigned int height = (unsigned int) heightParam;</span></span>
<span id="L923"><span class="lineNum">     923</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     unsigned int chainHeight = (unsigned int) active_chain.Height();</span></span>
<span id="L924"><span class="lineNum">     924</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (chainHeight &lt; chainman.GetParams().PruneAfterHeight()) {</span></span>
<span id="L925"><span class="lineNum">     925</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Blockchain is too short for pruning.&quot;);</span></span>
<span id="L926"><span class="lineNum">     926</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } else if (height &gt; chainHeight) {</span></span>
<span id="L927"><span class="lineNum">     927</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Blockchain is shorter than the attempted prune height.&quot;);</span></span>
<span id="L928"><span class="lineNum">     928</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } else if (height &gt; chainHeight - MIN_BLOCKS_TO_KEEP) {</span></span>
<span id="L929"><span class="lineNum">     929</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         LogDebug(BCLog::RPC, &quot;Attempt to prune blocks close to the tip.  Retaining the minimum number of blocks.\n&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L930"><span class="lineNum">     930</span>                 :             :         height = chainHeight - MIN_BLOCKS_TO_KEEP;</span>
<span id="L931"><span class="lineNum">     931</span>                 :             :     }</span>
<span id="L932"><span class="lineNum">     932</span>                 :             : </span>
<span id="L933"><span class="lineNum">     933</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     PruneBlockFilesManual(active_chainstate, height);</span></span>
<span id="L934"><span class="lineNum">     934</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     return GetPruneHeight(chainman.m_blockman, active_chain).value_or(-1);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L935"><span class="lineNum">     935</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L936"><span class="lineNum">     936</span>   [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         360 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 72 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L937"><span class="lineNum">     937</span>         [<span class="tlaGBC" title="Branch 0 was taken 72 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         144 : }</span></span>
<span id="L938"><span class="lineNum">     938</span>                 :             : </span>
<span id="L939"><span class="lineNum">     939</span>                 :<span class="tlaGNC">          24 : CoinStatsHashType ParseHashType(const std::string&amp; hash_type_input)</span></span>
<span id="L940"><span class="lineNum">     940</span>                 :             : {</span>
<span id="L941"><span class="lineNum">     941</span>         [<span class="tlaGBC" title="Branch 0 was taken 23 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">          24 :     if (hash_type_input == &quot;hash_serialized_3&quot;) {</span></span>
<span id="L942"><span class="lineNum">     942</span>                 :             :         return CoinStatsHashType::HASH_SERIALIZED;</span>
<span id="L943"><span class="lineNum">     943</span>         [<span class="tlaGBC" title="Branch 0 was taken 21 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">          23 :     } else if (hash_type_input == &quot;muhash&quot;) {</span></span>
<span id="L944"><span class="lineNum">     944</span>                 :             :         return CoinStatsHashType::MUHASH;</span>
<span id="L945"><span class="lineNum">     945</span>         [<span class="tlaGBC" title="Branch 0 was taken 7 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 14 times"> + </span>]:<span class="tlaGNC">          21 :     } else if (hash_type_input == &quot;none&quot;) {</span></span>
<span id="L946"><span class="lineNum">     946</span>                 :             :         return CoinStatsHashType::NONE;</span>
<span id="L947"><span class="lineNum">     947</span>                 :             :     } else {</span>
<span id="L948"><span class="lineNum">     948</span>   [<span class="tlaGBC" title="Branch 0 was taken 7 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 7 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          14 :         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;'%s' is not a valid hash_type&quot;, hash_type_input));</span></span>
<span id="L949"><span class="lineNum">     949</span>                 :             :     }</span>
<span id="L950"><span class="lineNum">     950</span>                 :             : }</span>
<span id="L951"><span class="lineNum">     951</span>                 :             : </span>
<span id="L952"><span class="lineNum">     952</span>                 :             : /**</span>
<span id="L953"><span class="lineNum">     953</span>                 :             :  * Calculate statistics about the unspent transaction output set</span>
<span id="L954"><span class="lineNum">     954</span>                 :             :  *</span>
<span id="L955"><span class="lineNum">     955</span>                 :             :  * @param[in] index_requested Signals if the coinstatsindex should be used (when available).</span>
<span id="L956"><span class="lineNum">     956</span>                 :             :  */</span>
<span id="L957"><span class="lineNum">     957</span>                 :<span class="tlaGNC">         122 : static std::optional&lt;kernel::CCoinsStats&gt; GetUTXOStats(CCoinsView* view, node::BlockManager&amp; blockman,</span></span>
<span id="L958"><span class="lineNum">     958</span>                 :             :                                                        kernel::CoinStatsHashType hash_type,</span>
<span id="L959"><span class="lineNum">     959</span>                 :             :                                                        const std::function&lt;void()&gt;&amp; interruption_point = {},</span>
<span id="L960"><span class="lineNum">     960</span>                 :             :                                                        const CBlockIndex* pindex = nullptr,</span>
<span id="L961"><span class="lineNum">     961</span>                 :             :                                                        bool index_requested = true)</span>
<span id="L962"><span class="lineNum">     962</span>                 :             : {</span>
<span id="L963"><span class="lineNum">     963</span>                 :             :     // Use CoinStatsIndex if it is requested and available and a hash_type of Muhash or None was requested</span>
<span id="L964"><span class="lineNum">     964</span>   [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 112 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 10 times"> + </span> :<span class="tlaGNC">         122 :     if ((hash_type == kernel::CoinStatsHashType::MUHASH || hash_type == kernel::CoinStatsHashType::NONE) &amp;&amp; g_coin_stats_index &amp;&amp; index_requested) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L965"><span class="lineNum">     965</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (pindex) {</span></span>
<span id="L966"><span class="lineNum">     966</span>                 :<span class="tlaUNC">           0 :             return g_coin_stats_index-&gt;LookUpStats(*pindex);</span></span>
<span id="L967"><span class="lineNum">     967</span>                 :             :         } else {</span>
<span id="L968"><span class="lineNum">     968</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             CBlockIndex&amp; block_index = *CHECK_NONFATAL(WITH_LOCK(::cs_main, return blockman.LookupBlockIndex(view-&gt;GetBestBlock())));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L969"><span class="lineNum">     969</span>                 :<span class="tlaUNC">           0 :             return g_coin_stats_index-&gt;LookUpStats(block_index);</span></span>
<span id="L970"><span class="lineNum">     970</span>                 :             :         }</span>
<span id="L971"><span class="lineNum">     971</span>                 :             :     }</span>
<span id="L972"><span class="lineNum">     972</span>                 :             : </span>
<span id="L973"><span class="lineNum">     973</span>                 :             :     // If the coinstats index isn't requested or is otherwise not usable, the</span>
<span id="L974"><span class="lineNum">     974</span>                 :             :     // pindex should either be null or equal to the view's best block. This is</span>
<span id="L975"><span class="lineNum">     975</span>                 :             :     // because without the coinstats index we can only get coinstats about the</span>
<span id="L976"><span class="lineNum">     976</span>                 :             :     // best block.</span>
<span id="L977"><span class="lineNum">     977</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         244 :     CHECK_NONFATAL(!pindex || pindex-&gt;GetBlockHash() == view-&gt;GetBestBlock());</span></span>
<span id="L978"><span class="lineNum">     978</span>                 :             : </span>
<span id="L979"><span class="lineNum">     979</span>                 :<span class="tlaGNC">         122 :     return kernel::ComputeUTXOStats(hash_type, view, blockman, interruption_point);</span></span>
<span id="L980"><span class="lineNum">     980</span>                 :             : }</span>
<span id="L981"><span class="lineNum">     981</span>                 :             : </span>
<span id="L982"><span class="lineNum">     982</span>                 :<span class="tlaGNC">         202 : static RPCHelpMan gettxoutsetinfo()</span></span>
<span id="L983"><span class="lineNum">     983</span>                 :             : {</span>
<span id="L984"><span class="lineNum">     984</span>                 :<span class="tlaGNC">         202 :     return RPCHelpMan{</span></span>
<span id="L985"><span class="lineNum">     985</span>                 :<span class="tlaGNC">         202 :         &quot;gettxoutsetinfo&quot;,</span></span>
<span id="L986"><span class="lineNum">     986</span>         [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         404 :         &quot;Returns statistics about the unspent transaction output set.\n&quot;</span></span>
<span id="L987"><span class="lineNum">     987</span>                 :             :                 &quot;Note this call may take some time if you are not using coinstatsindex.\n&quot;,</span>
<span id="L988"><span class="lineNum">     988</span>                 :             :                 {</span>
<span id="L989"><span class="lineNum">     989</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         606 :                     {&quot;hash_type&quot;, RPCArg::Type::STR, RPCArg::Default{&quot;hash_serialized_3&quot;}, &quot;Which UTXO set hash should be calculated. Options: 'hash_serialized_3' (the legacy algorithm), 'muhash', 'none'.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L990"><span class="lineNum">     990</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         606 :                     {&quot;hash_or_height&quot;, RPCArg::Type::NUM, RPCArg::DefaultHint{&quot;the current best block&quot;}, &quot;The block hash or height of the target height (only available with coinstatsindex).&quot;,</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L991"><span class="lineNum">     991</span>         [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         404 :                      RPCArgOptions{</span></span>
<span id="L992"><span class="lineNum">     992</span>                 :             :                          .skip_type_check = true,</span>
<span id="L993"><span class="lineNum">     993</span>                 :             :                          .type_str = {&quot;&quot;, &quot;string or numeric&quot;},</span>
<span id="L994"><span class="lineNum">     994</span>                 :             :                      }},</span>
<span id="L995"><span class="lineNum">     995</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         606 :                     {&quot;use_index&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Use coinstatsindex, if available.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L996"><span class="lineNum">     996</span>                 :             :                 },</span>
<span id="L997"><span class="lineNum">     997</span>         [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         404 :                 RPCResult{</span></span>
<span id="L998"><span class="lineNum">     998</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L999"><span class="lineNum">     999</span>                 :             :                     {</span>
<span id="L1000"><span class="lineNum">    1000</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::NUM, &quot;height&quot;, &quot;The block height (index) of the returned statistics&quot;},</span></span>
<span id="L1001"><span class="lineNum">    1001</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::STR_HEX, &quot;bestblock&quot;, &quot;The hash of the block at which these statistics are calculated&quot;},</span></span>
<span id="L1002"><span class="lineNum">    1002</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::NUM, &quot;txouts&quot;, &quot;The number of unspent transaction outputs&quot;},</span></span>
<span id="L1003"><span class="lineNum">    1003</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::NUM, &quot;bogosize&quot;, &quot;Database-independent, meaningless metric indicating the UTXO set size&quot;},</span></span>
<span id="L1004"><span class="lineNum">    1004</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::STR_HEX, &quot;hash_serialized_3&quot;, /*optional=*/true, &quot;The serialized hash (only present if 'hash_serialized_3' hash_type is chosen)&quot;},</span></span>
<span id="L1005"><span class="lineNum">    1005</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::STR_HEX, &quot;muhash&quot;, /*optional=*/true, &quot;The serialized hash (only present if 'muhash' hash_type is chosen)&quot;},</span></span>
<span id="L1006"><span class="lineNum">    1006</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::NUM, &quot;transactions&quot;, /*optional=*/true, &quot;The number of transactions with unspent outputs (not available when coinstatsindex is used)&quot;},</span></span>
<span id="L1007"><span class="lineNum">    1007</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::NUM, &quot;disk_size&quot;, /*optional=*/true, &quot;The estimated size of the chainstate on disk (not available when coinstatsindex is used)&quot;},</span></span>
<span id="L1008"><span class="lineNum">    1008</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::STR_AMOUNT, &quot;total_amount&quot;, &quot;The total amount of coins in the UTXO set&quot;},</span></span>
<span id="L1009"><span class="lineNum">    1009</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::STR_AMOUNT, &quot;total_unspendable_amount&quot;, /*optional=*/true, &quot;The total amount of coins permanently excluded from the UTXO set (only available if coinstatsindex is used)&quot;},</span></span>
<span id="L1010"><span class="lineNum">    1010</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                         {RPCResult::Type::OBJ, &quot;block_info&quot;, /*optional=*/true, &quot;Info on amounts in the block at this block height (only available if coinstatsindex is used)&quot;,</span></span>
<span id="L1011"><span class="lineNum">    1011</span>                 :             :                         {</span>
<span id="L1012"><span class="lineNum">    1012</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                             {RPCResult::Type::STR_AMOUNT, &quot;prevout_spent&quot;, &quot;Total amount of all prevouts spent in this block&quot;},</span></span>
<span id="L1013"><span class="lineNum">    1013</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                             {RPCResult::Type::STR_AMOUNT, &quot;coinbase&quot;, &quot;Coinbase subsidy amount of this block&quot;},</span></span>
<span id="L1014"><span class="lineNum">    1014</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                             {RPCResult::Type::STR_AMOUNT, &quot;new_outputs_ex_coinbase&quot;, &quot;Total amount of new outputs created by this block&quot;},</span></span>
<span id="L1015"><span class="lineNum">    1015</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                             {RPCResult::Type::STR_AMOUNT, &quot;unspendable&quot;, &quot;Total amount of unspendable outputs created in this block&quot;},</span></span>
<span id="L1016"><span class="lineNum">    1016</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                             {RPCResult::Type::OBJ, &quot;unspendables&quot;, &quot;Detailed view of the unspendable categories&quot;,</span></span>
<span id="L1017"><span class="lineNum">    1017</span>                 :             :                             {</span>
<span id="L1018"><span class="lineNum">    1018</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                                 {RPCResult::Type::STR_AMOUNT, &quot;genesis_block&quot;, &quot;The unspendable amount of the Genesis block subsidy&quot;},</span></span>
<span id="L1019"><span class="lineNum">    1019</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                                 {RPCResult::Type::STR_AMOUNT, &quot;bip30&quot;, &quot;Transactions overridden by duplicates (no longer possible with BIP30)&quot;},</span></span>
<span id="L1020"><span class="lineNum">    1020</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                                 {RPCResult::Type::STR_AMOUNT, &quot;scripts&quot;, &quot;Amounts sent to scripts that are unspendable (for example OP_RETURN outputs)&quot;},</span></span>
<span id="L1021"><span class="lineNum">    1021</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         404 :                                 {RPCResult::Type::STR_AMOUNT, &quot;unclaimed_rewards&quot;, &quot;Fee rewards that miners did not claim in their coinbase transaction&quot;},</span></span>
<span id="L1022"><span class="lineNum">    1022</span>                 :             :                             }}</span>
<span id="L1023"><span class="lineNum">    1023</span>                 :             :                         }},</span>
<span id="L1024"><span class="lineNum">    1024</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8282 :                     }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 2222 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 202 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 1010 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 202 times"> + </span><span class="tlaGBC" title="Branch 12 was taken 808 times"> + </span><span class="tlaGBC" title="Branch 13 was taken 202 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaUNC" title="Branch 16 was not taken"> - </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaUNC" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 19 was not taken"> - </span>]
<span id="L1025"><span class="lineNum">    1025</span>                 :<span class="tlaGNC">         202 :                 RPCExamples{</span></span>
<span id="L1026"><span class="lineNum">    1026</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         404 :                     HelpExampleCli(&quot;gettxoutsetinfo&quot;, &quot;&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1027"><span class="lineNum">    1027</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleCli(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot;)&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1028"><span class="lineNum">    1028</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleCli(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot; 1000)&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1029"><span class="lineNum">    1029</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleCli(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot; '&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09&quot;')&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1030"><span class="lineNum">    1030</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleCli(&quot;-named gettxoutsetinfo&quot;, R&quot;(hash_type='muhash' use_index='false')&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1031"><span class="lineNum">    1031</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleRpc(&quot;gettxoutsetinfo&quot;, &quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1032"><span class="lineNum">    1032</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleRpc(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot;)&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1033"><span class="lineNum">    1033</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         808 :                     HelpExampleRpc(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot;, 1000)&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1034"><span class="lineNum">    1034</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         606 :                     HelpExampleRpc(&quot;gettxoutsetinfo&quot;, R&quot;(&quot;none&quot;, &quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09&quot;)&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1035"><span class="lineNum">    1035</span>         [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         202 :                 },</span></span>
<span id="L1036"><span class="lineNum">    1036</span>                 :<span class="tlaGNC">         202 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1037"><span class="lineNum">    1037</span>                 :             : {</span>
<span id="L1038"><span class="lineNum">    1038</span>                 :<span class="tlaGNC">         135 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L1039"><span class="lineNum">    1039</span>                 :             : </span>
<span id="L1040"><span class="lineNum">    1040</span>                 :<span class="tlaGNC">         135 :     const CBlockIndex* pindex{nullptr};</span></span>
<span id="L1041"><span class="lineNum">    1041</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 24 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 111 times"> + </span> :<span class="tlaGNC">         135 :     const CoinStatsHashType hash_type{request.params[0].isNull() ? CoinStatsHashType::HASH_SERIALIZED : ParseHashType(request.params[0].get_str())};</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 24 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 24 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 17 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaGBC" title="Branch 9 was taken 7 times"> + </span>]
<span id="L1042"><span class="lineNum">    1042</span>   [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 126 times"> + </span> :<span class="tlaGNC">         128 :     bool index_requested = request.params[2].isNull() || request.params[2].get_bool();</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 2 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L1043"><span class="lineNum">    1043</span>                 :             : </span>
<span id="L1044"><span class="lineNum">    1044</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L1045"><span class="lineNum">    1045</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :     ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L1046"><span class="lineNum">    1046</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L1047"><span class="lineNum">    1047</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :     active_chainstate.ForceFlushStateToDisk();</span></span>
<span id="L1048"><span class="lineNum">    1048</span>                 :             : </span>
<span id="L1049"><span class="lineNum">    1049</span>                 :<span class="tlaGNC">         128 :     CCoinsView* coins_view;</span></span>
<span id="L1050"><span class="lineNum">    1050</span>                 :<span class="tlaGNC">         128 :     BlockManager* blockman;</span></span>
<span id="L1051"><span class="lineNum">    1051</span>                 :<span class="tlaGNC">         128 :     {</span></span>
<span id="L1052"><span class="lineNum">    1052</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :         LOCK(::cs_main);</span></span>
<span id="L1053"><span class="lineNum">    1053</span>         [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         128 :         coins_view = &amp;active_chainstate.CoinsDB();</span></span>
<span id="L1054"><span class="lineNum">    1054</span>                 :<span class="tlaGNC">         128 :         blockman = &amp;active_chainstate.m_blockman;</span></span>
<span id="L1055"><span class="lineNum">    1055</span>   [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         128 :         pindex = blockman-&gt;LookupBlockIndex(coins_view-&gt;GetBestBlock());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1056"><span class="lineNum">    1056</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1057"><span class="lineNum">    1057</span>                 :             : </span>
<span id="L1058"><span class="lineNum">    1058</span>   [<span class="tlaGBC" title="Branch 0 was taken 128 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 122 times"> + </span>]:<span class="tlaGNC">         128 :     if (!request.params[1].isNull()) {</span></span>
<span id="L1059"><span class="lineNum">    1059</span>         [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           6 :         if (!g_coin_stats_index) {</span></span>
<span id="L1060"><span class="lineNum">    1060</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          12 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Querying specific block heights requires coinstatsindex&quot;);</span></span>
<span id="L1061"><span class="lineNum">    1061</span>                 :             :         }</span>
<span id="L1062"><span class="lineNum">    1062</span>                 :             : </span>
<span id="L1063"><span class="lineNum">    1063</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (hash_type == CoinStatsHashType::HASH_SERIALIZED) {</span></span>
<span id="L1064"><span class="lineNum">    1064</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;hash_serialized_3 hash type cannot be queried for a specific block&quot;);</span></span>
<span id="L1065"><span class="lineNum">    1065</span>                 :             :         }</span>
<span id="L1066"><span class="lineNum">    1066</span>                 :             : </span>
<span id="L1067"><span class="lineNum">    1067</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!index_requested) {</span></span>
<span id="L1068"><span class="lineNum">    1068</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Cannot set use_index to false when querying for a specific block&quot;);</span></span>
<span id="L1069"><span class="lineNum">    1069</span>                 :             :         }</span>
<span id="L1070"><span class="lineNum">    1070</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pindex = ParseHashOrHeight(request.params[1], chainman);</span></span>
<span id="L1071"><span class="lineNum">    1071</span>                 :             :     }</span>
<span id="L1072"><span class="lineNum">    1072</span>                 :             : </span>
<span id="L1073"><span class="lineNum">    1073</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 122 times"> + </span>]:<span class="tlaGNC">         122 :     if (index_requested &amp;&amp; g_coin_stats_index) {</span></span>
<span id="L1074"><span class="lineNum">    1074</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!g_coin_stats_index-&gt;BlockUntilSyncedToCurrentChain()) {</span></span>
<span id="L1075"><span class="lineNum">    1075</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const IndexSummary summary{g_coin_stats_index-&gt;GetSummary()};</span></span>
<span id="L1076"><span class="lineNum">    1076</span>                 :             : </span>
<span id="L1077"><span class="lineNum">    1077</span>                 :             :             // If a specific block was requested and the index has already synced past that height, we can return the</span>
<span id="L1078"><span class="lineNum">    1078</span>                 :             :             // data already even though the index is not fully synced yet.</span>
<span id="L1079"><span class="lineNum">    1079</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (pindex-&gt;nHeight &gt; summary.best_block_height) {</span></span>
<span id="L1080"><span class="lineNum">    1080</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(&quot;Unable to get data because coinstatsindex is still syncing. Current height: %d&quot;, summary.best_block_height));</span></span>
<span id="L1081"><span class="lineNum">    1081</span>                 :             :             }</span>
<span id="L1082"><span class="lineNum">    1082</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1083"><span class="lineNum">    1083</span>                 :             :     }</span>
<span id="L1084"><span class="lineNum">    1084</span>                 :             : </span>
<span id="L1085"><span class="lineNum">    1085</span>         [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         122 :     const std::optional&lt;CCoinsStats&gt; maybe_stats = GetUTXOStats(coins_view, *blockman, hash_type, node.rpc_interruption_point, pindex, index_requested);</span></span>
<span id="L1086"><span class="lineNum">    1086</span>         [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         122 :     if (maybe_stats.has_value()) {</span></span>
<span id="L1087"><span class="lineNum">    1087</span>         [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         122 :         const CCoinsStats&amp; stats = maybe_stats.value();</span></span>
<span id="L1088"><span class="lineNum">    1088</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :         ret.pushKV(&quot;height&quot;, (int64_t)stats.nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1089"><span class="lineNum">    1089</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :         ret.pushKV(&quot;bestblock&quot;, stats.hashBlock.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1090"><span class="lineNum">    1090</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :         ret.pushKV(&quot;txouts&quot;, (int64_t)stats.nTransactionOutputs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1091"><span class="lineNum">    1091</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :         ret.pushKV(&quot;bogosize&quot;, (int64_t)stats.nBogoSize);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1092"><span class="lineNum">    1092</span>         [<span class="tlaGBC" title="Branch 0 was taken 112 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 10 times"> + </span>]:<span class="tlaGNC">         122 :         if (hash_type == CoinStatsHashType::HASH_SERIALIZED) {</span></span>
<span id="L1093"><span class="lineNum">    1093</span>   [<span class="tlaGBC" title="Branch 0 was taken 112 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 112 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         224 :             ret.pushKV(&quot;hash_serialized_3&quot;, stats.hashSerialized.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 112 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 112 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1094"><span class="lineNum">    1094</span>                 :             :         }</span>
<span id="L1095"><span class="lineNum">    1095</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 120 times"> + </span>]:<span class="tlaGNC">         122 :         if (hash_type == CoinStatsHashType::MUHASH) {</span></span>
<span id="L1096"><span class="lineNum">    1096</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :             ret.pushKV(&quot;muhash&quot;, stats.hashSerialized.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1097"><span class="lineNum">    1097</span>                 :             :         }</span>
<span id="L1098"><span class="lineNum">    1098</span>         [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         122 :         CHECK_NONFATAL(stats.total_amount.has_value());</span></span>
<span id="L1099"><span class="lineNum">    1099</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :         ret.pushKV(&quot;total_amount&quot;, ValueFromAmount(stats.total_amount.value()));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1100"><span class="lineNum">    1100</span>         [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         122 :         if (!stats.index_used) {</span></span>
<span id="L1101"><span class="lineNum">    1101</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :             ret.pushKV(&quot;transactions&quot;, static_cast&lt;int64_t&gt;(stats.nTransactions));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1102"><span class="lineNum">    1102</span>   [<span class="tlaGBC" title="Branch 0 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         244 :             ret.pushKV(&quot;disk_size&quot;, stats.nDiskSize);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 122 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1103"><span class="lineNum">    1103</span>                 :             :         } else {</span>
<span id="L1104"><span class="lineNum">    1104</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             ret.pushKV(&quot;total_unspendable_amount&quot;, ValueFromAmount(stats.total_unspendable_amount));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1105"><span class="lineNum">    1105</span>                 :             : </span>
<span id="L1106"><span class="lineNum">    1106</span>                 :<span class="tlaUNC">           0 :             CCoinsStats prev_stats{};</span></span>
<span id="L1107"><span class="lineNum">    1107</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (pindex-&gt;nHeight &gt; 0) {</span></span>
<span id="L1108"><span class="lineNum">    1108</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const std::optional&lt;CCoinsStats&gt; maybe_prev_stats = GetUTXOStats(coins_view, *blockman, hash_type, node.rpc_interruption_point, pindex-&gt;pprev, index_requested);</span></span>
<span id="L1109"><span class="lineNum">    1109</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!maybe_prev_stats) {</span></span>
<span id="L1110"><span class="lineNum">    1110</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_INTERNAL_ERROR, &quot;Unable to read UTXO set&quot;);</span></span>
<span id="L1111"><span class="lineNum">    1111</span>                 :             :                 }</span>
<span id="L1112"><span class="lineNum">    1112</span>                 :<span class="tlaUNC">           0 :                 prev_stats = maybe_prev_stats.value();</span></span>
<span id="L1113"><span class="lineNum">    1113</span>                 :             :             }</span>
<span id="L1114"><span class="lineNum">    1114</span>                 :             : </span>
<span id="L1115"><span class="lineNum">    1115</span>                 :<span class="tlaUNC">           0 :             UniValue block_info(UniValue::VOBJ);</span></span>
<span id="L1116"><span class="lineNum">    1116</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             block_info.pushKV(&quot;prevout_spent&quot;, ValueFromAmount(stats.total_prevout_spent_amount - prev_stats.total_prevout_spent_amount));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1117"><span class="lineNum">    1117</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             block_info.pushKV(&quot;coinbase&quot;, ValueFromAmount(stats.total_coinbase_amount - prev_stats.total_coinbase_amount));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1118"><span class="lineNum">    1118</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             block_info.pushKV(&quot;new_outputs_ex_coinbase&quot;, ValueFromAmount(stats.total_new_outputs_ex_coinbase_amount - prev_stats.total_new_outputs_ex_coinbase_amount));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1119"><span class="lineNum">    1119</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             block_info.pushKV(&quot;unspendable&quot;, ValueFromAmount(stats.total_unspendable_amount - prev_stats.total_unspendable_amount));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1120"><span class="lineNum">    1120</span>                 :             : </span>
<span id="L1121"><span class="lineNum">    1121</span>                 :<span class="tlaUNC">           0 :             UniValue unspendables(UniValue::VOBJ);</span></span>
<span id="L1122"><span class="lineNum">    1122</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspendables.pushKV(&quot;genesis_block&quot;, ValueFromAmount(stats.total_unspendables_genesis_block - prev_stats.total_unspendables_genesis_block));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1123"><span class="lineNum">    1123</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspendables.pushKV(&quot;bip30&quot;, ValueFromAmount(stats.total_unspendables_bip30 - prev_stats.total_unspendables_bip30));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1124"><span class="lineNum">    1124</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspendables.pushKV(&quot;scripts&quot;, ValueFromAmount(stats.total_unspendables_scripts - prev_stats.total_unspendables_scripts));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1125"><span class="lineNum">    1125</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspendables.pushKV(&quot;unclaimed_rewards&quot;, ValueFromAmount(stats.total_unspendables_unclaimed_rewards - prev_stats.total_unspendables_unclaimed_rewards));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1126"><span class="lineNum">    1126</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             block_info.pushKV(&quot;unspendables&quot;, std::move(unspendables));</span></span>
<span id="L1127"><span class="lineNum">    1127</span>                 :             : </span>
<span id="L1128"><span class="lineNum">    1128</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             ret.pushKV(&quot;block_info&quot;, std::move(block_info));</span></span>
<span id="L1129"><span class="lineNum">    1129</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1130"><span class="lineNum">    1130</span>                 :             :     } else {</span>
<span id="L1131"><span class="lineNum">    1131</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INTERNAL_ERROR, &quot;Unable to read UTXO set&quot;);</span></span>
<span id="L1132"><span class="lineNum">    1132</span>                 :             :     }</span>
<span id="L1133"><span class="lineNum">    1133</span>                 :<span class="tlaGNC">         122 :     return ret;</span></span>
<span id="L1134"><span class="lineNum">    1134</span>                 :<span class="tlaGNC">          13 : },</span></span>
<span id="L1135"><span class="lineNum">    1135</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1414 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 606 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1136"><span class="lineNum">    1136</span>   [<span class="tlaGBC" title="Branch 0 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        5050 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 202 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 202 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 202 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 202 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 44 was taken 202 times"> + </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaUNC" title="Branch 46 was not taken"> - </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaUNC" title="Branch 48 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaUNC" title="Branch 50 was not taken"> - </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span><span class="tlaUNC" title="Branch 52 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 53 was not taken"> - </span>]
<span id="L1137"><span class="lineNum">    1137</span>                 :             : </span>
<span id="L1138"><span class="lineNum">    1138</span>                 :<span class="tlaGNC">         114 : static RPCHelpMan gettxout()</span></span>
<span id="L1139"><span class="lineNum">    1139</span>                 :             : {</span>
<span id="L1140"><span class="lineNum">    1140</span>                 :<span class="tlaGNC">         114 :     return RPCHelpMan{</span></span>
<span id="L1141"><span class="lineNum">    1141</span>                 :<span class="tlaGNC">         114 :         &quot;gettxout&quot;,</span></span>
<span id="L1142"><span class="lineNum">    1142</span>         [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         228 :         &quot;Returns details about an unspent transaction output.\n&quot;,</span></span>
<span id="L1143"><span class="lineNum">    1143</span>                 :             :         {</span>
<span id="L1144"><span class="lineNum">    1144</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :             {&quot;txid&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The transaction id&quot;},</span></span>
<span id="L1145"><span class="lineNum">    1145</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :             {&quot;n&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;vout number&quot;},</span></span>
<span id="L1146"><span class="lineNum">    1146</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         342 :             {&quot;include_mempool&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Whether to include the mempool. Note that an unspent output that is spent in the mempool won't appear.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1147"><span class="lineNum">    1147</span>                 :             :         },</span>
<span id="L1148"><span class="lineNum">    1148</span>                 :             :         {</span>
<span id="L1149"><span class="lineNum">    1149</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         228 :             RPCResult{&quot;If the UTXO was not found&quot;, RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1150"><span class="lineNum">    1150</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         228 :             RPCResult{&quot;Otherwise&quot;, RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1151"><span class="lineNum">    1151</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                 {RPCResult::Type::STR_HEX, &quot;bestblock&quot;, &quot;The hash of the block at the tip of the chain&quot;},</span></span>
<span id="L1152"><span class="lineNum">    1152</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                 {RPCResult::Type::NUM, &quot;confirmations&quot;, &quot;The number of confirmations&quot;},</span></span>
<span id="L1153"><span class="lineNum">    1153</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                 {RPCResult::Type::STR_AMOUNT, &quot;value&quot;, &quot;The transaction value in &quot; + CURRENCY_UNIT},</span></span>
<span id="L1154"><span class="lineNum">    1154</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                 {RPCResult::Type::OBJ, &quot;scriptPubKey&quot;, &quot;&quot;, {</span></span>
<span id="L1155"><span class="lineNum">    1155</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                     {RPCResult::Type::STR, &quot;asm&quot;, &quot;Disassembly of the output script&quot;},</span></span>
<span id="L1156"><span class="lineNum">    1156</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                     {RPCResult::Type::STR, &quot;desc&quot;, &quot;Inferred descriptor for the output&quot;},</span></span>
<span id="L1157"><span class="lineNum">    1157</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                     {RPCResult::Type::STR_HEX, &quot;hex&quot;, &quot;The raw output script bytes, hex-encoded&quot;},</span></span>
<span id="L1158"><span class="lineNum">    1158</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                     {RPCResult::Type::STR, &quot;type&quot;, &quot;The type, eg pubkeyhash&quot;},</span></span>
<span id="L1159"><span class="lineNum">    1159</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                     {RPCResult::Type::STR, &quot;address&quot;, /*optional=*/true, &quot;The Bitcoin address (only if a well-defined address exists)&quot;},</span></span>
<span id="L1160"><span class="lineNum">    1160</span>                 :             :                 }},</span>
<span id="L1161"><span class="lineNum">    1161</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         228 :                 {RPCResult::Type::BOOL, &quot;coinbase&quot;, &quot;Coinbase or not&quot;},</span></span>
<span id="L1162"><span class="lineNum">    1162</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        2394 :             }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 570 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 114 times"> + </span><span class="tlaGBC" title="Branch 6 was taken 570 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1163"><span class="lineNum">    1163</span>                 :             :         },</span>
<span id="L1164"><span class="lineNum">    1164</span>                 :<span class="tlaGNC">         114 :         RPCExamples{</span></span>
<span id="L1165"><span class="lineNum">    1165</span>                 :             :             &quot;\nGet unspent transactions\n&quot;</span>
<span id="L1166"><span class="lineNum">    1166</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         228 :             + HelpExampleCli(&quot;listunspent&quot;, &quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1167"><span class="lineNum">    1167</span>                 :<span class="tlaGNC">         114 :             &quot;\nView the details\n&quot;</span></span>
<span id="L1168"><span class="lineNum">    1168</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         456 :             + HelpExampleCli(&quot;gettxout&quot;, &quot;\&quot;txid\&quot; 1&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1169"><span class="lineNum">    1169</span>                 :<span class="tlaGNC">         114 :             &quot;\nAs a JSON-RPC call\n&quot;</span></span>
<span id="L1170"><span class="lineNum">    1170</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         456 :             + HelpExampleRpc(&quot;gettxout&quot;, &quot;\&quot;txid\&quot;, 1&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1171"><span class="lineNum">    1171</span>         [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         114 :                 },</span></span>
<span id="L1172"><span class="lineNum">    1172</span>                 :<span class="tlaGNC">         114 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1173"><span class="lineNum">    1173</span>                 :             : {</span>
<span id="L1174"><span class="lineNum">    1174</span>                 :<span class="tlaGNC">          38 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L1175"><span class="lineNum">    1175</span>                 :<span class="tlaGNC">          38 :     ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L1176"><span class="lineNum">    1176</span>                 :<span class="tlaGNC">          38 :     LOCK(cs_main);</span></span>
<span id="L1177"><span class="lineNum">    1177</span>                 :             : </span>
<span id="L1178"><span class="lineNum">    1178</span>                 :<span class="tlaGNC">          38 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L1179"><span class="lineNum">    1179</span>                 :             : </span>
<span id="L1180"><span class="lineNum">    1180</span>   [<span class="tlaGBC" title="Branch 0 was taken 38 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 37 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span>]:<span class="tlaGNC">          38 :     auto hash{Txid::FromUint256(ParseHashV(request.params[0], &quot;txid&quot;))};</span></span>
<span id="L1181"><span class="lineNum">    1181</span>   [<span class="tlaGBC" title="Branch 0 was taken 37 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 17 times"> + </span> :<span class="tlaGNC">          37 :     COutPoint out{hash, request.params[1].getInt&lt;uint32_t&gt;()};</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1182"><span class="lineNum">    1182</span>                 :<span class="tlaGNC">          20 :     bool fMempool = true;</span></span>
<span id="L1183"><span class="lineNum">    1183</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 16 times"> + </span>]:<span class="tlaGNC">          20 :     if (!request.params[2].isNull())</span></span>
<span id="L1184"><span class="lineNum">    1184</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :         fMempool = request.params[2].get_bool();</span></span>
<span id="L1185"><span class="lineNum">    1185</span>                 :             : </span>
<span id="L1186"><span class="lineNum">    1186</span>         [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          20 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L1187"><span class="lineNum">    1187</span>         [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          20 :     CCoinsViewCache* coins_view = &amp;active_chainstate.CoinsTip();</span></span>
<span id="L1188"><span class="lineNum">    1188</span>                 :             : </span>
<span id="L1189"><span class="lineNum">    1189</span>                 :<span class="tlaGNC">          20 :     std::optional&lt;Coin&gt; coin;</span></span>
<span id="L1190"><span class="lineNum">    1190</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">          20 :     if (fMempool) {</span></span>
<span id="L1191"><span class="lineNum">    1191</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          17 :         const CTxMemPool&amp; mempool = EnsureMemPool(node);</span></span>
<span id="L1192"><span class="lineNum">    1192</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          17 :         LOCK(mempool.cs);</span></span>
<span id="L1193"><span class="lineNum">    1193</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          17 :         CCoinsViewMemPool view(coins_view, mempool);</span></span>
<span id="L1194"><span class="lineNum">    1194</span>   [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          34 :         if (!mempool.isSpent(out)) coin = view.GetCoin(out);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1195"><span class="lineNum">    1195</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          34 :     } else {</span></span>
<span id="L1196"><span class="lineNum">    1196</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           6 :         coin = coins_view-&gt;GetCoin(out);</span></span>
<span id="L1197"><span class="lineNum">    1197</span>                 :             :     }</span>
<span id="L1198"><span class="lineNum">    1198</span>         [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          20 :     if (!coin) return UniValue::VNULL;</span></span>
<span id="L1199"><span class="lineNum">    1199</span>                 :             : </span>
<span id="L1200"><span class="lineNum">    1200</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const CBlockIndex* pindex = active_chainstate.m_blockman.LookupBlockIndex(coins_view-&gt;GetBestBlock());</span></span>
<span id="L1201"><span class="lineNum">    1201</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;bestblock&quot;, pindex-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1202"><span class="lineNum">    1202</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (coin-&gt;nHeight == MEMPOOL_HEIGHT) {</span></span>
<span id="L1203"><span class="lineNum">    1203</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;confirmations&quot;, 0);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1204"><span class="lineNum">    1204</span>                 :             :     } else {</span>
<span id="L1205"><span class="lineNum">    1205</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;confirmations&quot;, (int64_t)(pindex-&gt;nHeight - coin-&gt;nHeight + 1));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1206"><span class="lineNum">    1206</span>                 :             :     }</span>
<span id="L1207"><span class="lineNum">    1207</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;value&quot;, ValueFromAmount(coin-&gt;out.nValue));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1208"><span class="lineNum">    1208</span>                 :<span class="tlaUNC">           0 :     UniValue o(UniValue::VOBJ);</span></span>
<span id="L1209"><span class="lineNum">    1209</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     ScriptToUniv(coin-&gt;out.scriptPubKey, /*out=*/o, /*include_hex=*/true, /*include_address=*/true);</span></span>
<span id="L1210"><span class="lineNum">    1210</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     ret.pushKV(&quot;scriptPubKey&quot;, std::move(o));</span></span>
<span id="L1211"><span class="lineNum">    1211</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;coinbase&quot;, (bool)coin-&gt;fCoinBase);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1212"><span class="lineNum">    1212</span>                 :             : </span>
<span id="L1213"><span class="lineNum">    1213</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L1214"><span class="lineNum">    1214</span>         [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          58 : },</span></span>
<span id="L1215"><span class="lineNum">    1215</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1368 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 228 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 114 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 342 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L1216"><span class="lineNum">    1216</span>   [<span class="tlaGBC" title="Branch 0 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        2052 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 114 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 114 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 114 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 114 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaUNC" title="Branch 30 was not taken"> - </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaUNC" title="Branch 32 was not taken"> - </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 34 was not taken"> - </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaUNC" title="Branch 36 was not taken"> - </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span>]
<span id="L1217"><span class="lineNum">    1217</span>                 :             : </span>
<span id="L1218"><span class="lineNum">    1218</span>                 :<span class="tlaGNC">          77 : static RPCHelpMan verifychain()</span></span>
<span id="L1219"><span class="lineNum">    1219</span>                 :             : {</span>
<span id="L1220"><span class="lineNum">    1220</span>                 :<span class="tlaGNC">          77 :     return RPCHelpMan{</span></span>
<span id="L1221"><span class="lineNum">    1221</span>                 :<span class="tlaGNC">          77 :         &quot;verifychain&quot;,</span></span>
<span id="L1222"><span class="lineNum">    1222</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         154 :         &quot;Verifies blockchain database.\n&quot;,</span></span>
<span id="L1223"><span class="lineNum">    1223</span>                 :             :                 {</span>
<span id="L1224"><span class="lineNum">    1224</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         231 :                     {&quot;checklevel&quot;, RPCArg::Type::NUM, RPCArg::DefaultHint{strprintf(&quot;%d, range=0-4&quot;, DEFAULT_CHECKLEVEL)},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1225"><span class="lineNum">    1225</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         154 :                         strprintf(&quot;How thorough the block verification is:\n%s&quot;, MakeUnorderedList(CHECKLEVEL_DOC))},</span></span>
<span id="L1226"><span class="lineNum">    1226</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         231 :                     {&quot;nblocks&quot;, RPCArg::Type::NUM, RPCArg::DefaultHint{strprintf(&quot;%d, 0=all&quot;, DEFAULT_CHECKBLOCKS)}, &quot;The number of blocks to check.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1227"><span class="lineNum">    1227</span>                 :             :                 },</span>
<span id="L1228"><span class="lineNum">    1228</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         154 :                 RPCResult{</span></span>
<span id="L1229"><span class="lineNum">    1229</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         154 :                     RPCResult::Type::BOOL, &quot;&quot;, &quot;Verification finished successfully. If false, check debug.log for reason.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1230"><span class="lineNum">    1230</span>                 :<span class="tlaGNC">          77 :                 RPCExamples{</span></span>
<span id="L1231"><span class="lineNum">    1231</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         154 :                     HelpExampleCli(&quot;verifychain&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1232"><span class="lineNum">    1232</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         308 :             + HelpExampleRpc(&quot;verifychain&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1233"><span class="lineNum">    1233</span>         [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          77 :                 },</span></span>
<span id="L1234"><span class="lineNum">    1234</span>                 :<span class="tlaGNC">          77 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1235"><span class="lineNum">    1235</span>                 :             : {</span>
<span id="L1236"><span class="lineNum">    1236</span>         [<span class="tlaGBC" title="Branch 0 was taken 11 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">          14 :     const int check_level{request.params[0].isNull() ? DEFAULT_CHECKLEVEL : request.params[0].getInt&lt;int&gt;()};</span></span>
<span id="L1237"><span class="lineNum">    1237</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 5 times"> + </span>]:<span class="tlaGNC">           7 :     const int check_depth{request.params[1].isNull() ? DEFAULT_CHECKBLOCKS : request.params[1].getInt&lt;int&gt;()};</span></span>
<span id="L1238"><span class="lineNum">    1238</span>                 :             : </span>
<span id="L1239"><span class="lineNum">    1239</span>                 :<span class="tlaGNC">           6 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1240"><span class="lineNum">    1240</span>                 :<span class="tlaGNC">           6 :     LOCK(cs_main);</span></span>
<span id="L1241"><span class="lineNum">    1241</span>                 :             : </span>
<span id="L1242"><span class="lineNum">    1242</span>         [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           6 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L1243"><span class="lineNum">    1243</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          18 :     return CVerifyDB(chainman.GetNotifications()).VerifyDB(</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1244"><span class="lineNum">    1244</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           6 :                active_chainstate, chainman.GetParams().GetConsensus(), active_chainstate.CoinsTip(), check_level, check_depth) == VerifyDBResult::SUCCESS;</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1245"><span class="lineNum">    1245</span>                 :<span class="tlaGNC">           6 : },</span></span>
<span id="L1246"><span class="lineNum">    1246</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         462 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 154 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1247"><span class="lineNum">    1247</span>   [<span class="tlaGBC" title="Branch 0 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 77 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         308 : }</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1248"><span class="lineNum">    1248</span>                 :             : </span>
<span id="L1249"><span class="lineNum">    1249</span>                 :<span class="tlaGNC">          20 : static void SoftForkDescPushBack(const CBlockIndex* blockindex, UniValue&amp; softforks, const ChainstateManager&amp; chainman, Consensus::BuriedDeployment dep)</span></span>
<span id="L1250"><span class="lineNum">    1250</span>                 :             : {</span>
<span id="L1251"><span class="lineNum">    1251</span>                 :             :     // For buried deployments.</span>
<span id="L1252"><span class="lineNum">    1252</span>                 :             : </span>
<span id="L1253"><span class="lineNum">    1253</span>         [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          20 :     if (!DeploymentEnabled(chainman, dep)) return;</span></span>
<span id="L1254"><span class="lineNum">    1254</span>                 :             : </span>
<span id="L1255"><span class="lineNum">    1255</span>                 :<span class="tlaGNC">          20 :     UniValue rv(UniValue::VOBJ);</span></span>
<span id="L1256"><span class="lineNum">    1256</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          40 :     rv.pushKV(&quot;type&quot;, &quot;buried&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1257"><span class="lineNum">    1257</span>                 :             :     // getdeploymentinfo reports the softfork as active from when the chain height is</span>
<span id="L1258"><span class="lineNum">    1258</span>                 :             :     // one below the activation height</span>
<span id="L1259"><span class="lineNum">    1259</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          40 :     rv.pushKV(&quot;active&quot;, DeploymentActiveAfter(blockindex, chainman, dep));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1260"><span class="lineNum">    1260</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          40 :     rv.pushKV(&quot;height&quot;, chainman.GetConsensus().DeploymentHeight(dep));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1261"><span class="lineNum">    1261</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          40 :     softforks.pushKV(DeploymentName(dep), std::move(rv));</span></span>
<span id="L1262"><span class="lineNum">    1262</span>                 :<span class="tlaGNC">          20 : }</span></span>
<span id="L1263"><span class="lineNum">    1263</span>                 :             : </span>
<span id="L1264"><span class="lineNum">    1264</span>                 :<span class="tlaGNC">           8 : static void SoftForkDescPushBack(const CBlockIndex* blockindex, UniValue&amp; softforks, const ChainstateManager&amp; chainman, Consensus::DeploymentPos id)</span></span>
<span id="L1265"><span class="lineNum">    1265</span>                 :             : {</span>
<span id="L1266"><span class="lineNum">    1266</span>                 :             :     // For BIP9 deployments.</span>
<span id="L1267"><span class="lineNum">    1267</span>         [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           8 :     if (!DeploymentEnabled(chainman, id)) return;</span></span>
<span id="L1268"><span class="lineNum">    1268</span>         [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           8 :     if (blockindex == nullptr) return;</span></span>
<span id="L1269"><span class="lineNum">    1269</span>                 :             : </span>
<span id="L1270"><span class="lineNum">    1270</span>                 :<span class="tlaGNC">           8 :     UniValue bip9(UniValue::VOBJ);</span></span>
<span id="L1271"><span class="lineNum">    1271</span>         [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           8 :     BIP9Info info{chainman.m_versionbitscache.Info(*blockindex, chainman.GetConsensus(), id)};</span></span>
<span id="L1272"><span class="lineNum">    1272</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 8 times"> + </span>]:<span class="tlaGNC">           8 :     const auto&amp; depparams{chainman.GetConsensus().vDeployments[id]};</span></span>
<span id="L1273"><span class="lineNum">    1273</span>                 :             : </span>
<span id="L1274"><span class="lineNum">    1274</span>                 :             :     // BIP9 parameters</span>
<span id="L1275"><span class="lineNum">    1275</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 8 times"> + </span>]:<span class="tlaGNC">           8 :     if (info.stats.has_value()) {</span></span>
<span id="L1276"><span class="lineNum">    1276</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         bip9.pushKV(&quot;bit&quot;, depparams.bit);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1277"><span class="lineNum">    1277</span>                 :             :     }</span>
<span id="L1278"><span class="lineNum">    1278</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;start_time&quot;, depparams.nStartTime);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1279"><span class="lineNum">    1279</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;timeout&quot;, depparams.nTimeout);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1280"><span class="lineNum">    1280</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;min_activation_height&quot;, depparams.min_activation_height);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1281"><span class="lineNum">    1281</span>                 :             : </span>
<span id="L1282"><span class="lineNum">    1282</span>                 :             :     // BIP9 status</span>
<span id="L1283"><span class="lineNum">    1283</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;status&quot;, info.current_state);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1284"><span class="lineNum">    1284</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;since&quot;, info.since);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1285"><span class="lineNum">    1285</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     bip9.pushKV(&quot;status_next&quot;, info.next_state);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1286"><span class="lineNum">    1286</span>                 :             : </span>
<span id="L1287"><span class="lineNum">    1287</span>                 :             :     // BIP9 signalling status, if applicable</span>
<span id="L1288"><span class="lineNum">    1288</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 8 times"> + </span>]:<span class="tlaGNC">           8 :     if (info.stats.has_value()) {</span></span>
<span id="L1289"><span class="lineNum">    1289</span>                 :<span class="tlaUNC">           0 :         UniValue statsUV(UniValue::VOBJ);</span></span>
<span id="L1290"><span class="lineNum">    1290</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         statsUV.pushKV(&quot;period&quot;, info.stats-&gt;period);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1291"><span class="lineNum">    1291</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         statsUV.pushKV(&quot;elapsed&quot;, info.stats-&gt;elapsed);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1292"><span class="lineNum">    1292</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         statsUV.pushKV(&quot;count&quot;, info.stats-&gt;count);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1293"><span class="lineNum">    1293</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (info.stats-&gt;threshold &gt; 0 || info.stats-&gt;possible) {</span></span>
<span id="L1294"><span class="lineNum">    1294</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             statsUV.pushKV(&quot;threshold&quot;, info.stats-&gt;threshold);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1295"><span class="lineNum">    1295</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             statsUV.pushKV(&quot;possible&quot;, info.stats-&gt;possible);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1296"><span class="lineNum">    1296</span>                 :             :         }</span>
<span id="L1297"><span class="lineNum">    1297</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         bip9.pushKV(&quot;statistics&quot;, std::move(statsUV));</span></span>
<span id="L1298"><span class="lineNum">    1298</span>                 :             : </span>
<span id="L1299"><span class="lineNum">    1299</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string sig;</span></span>
<span id="L1300"><span class="lineNum">    1300</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         sig.reserve(info.signalling_blocks.size());</span></span>
<span id="L1301"><span class="lineNum">    1301</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         for (const bool s : info.signalling_blocks) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1302"><span class="lineNum">    1302</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             sig.push_back(s ? '#' : '-');</span></span>
<span id="L1303"><span class="lineNum">    1303</span>                 :             :         }</span>
<span id="L1304"><span class="lineNum">    1304</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         bip9.pushKV(&quot;signalling&quot;, sig);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1305"><span class="lineNum">    1305</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1306"><span class="lineNum">    1306</span>                 :             : </span>
<span id="L1307"><span class="lineNum">    1307</span>                 :<span class="tlaGNC">           8 :     UniValue rv(UniValue::VOBJ);</span></span>
<span id="L1308"><span class="lineNum">    1308</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     rv.pushKV(&quot;type&quot;, &quot;bip9&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1309"><span class="lineNum">    1309</span>                 :<span class="tlaGNC">           8 :     bool is_active = false;</span></span>
<span id="L1310"><span class="lineNum">    1310</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           8 :     if (info.active_since.has_value()) {</span></span>
<span id="L1311"><span class="lineNum">    1311</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :         rv.pushKV(&quot;height&quot;, *info.active_since);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1312"><span class="lineNum">    1312</span>                 :<span class="tlaGNC">           4 :         is_active = (*info.active_since &lt;= blockindex-&gt;nHeight + 1);</span></span>
<span id="L1313"><span class="lineNum">    1313</span>                 :             :     }</span>
<span id="L1314"><span class="lineNum">    1314</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     rv.pushKV(&quot;active&quot;, is_active);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1315"><span class="lineNum">    1315</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          16 :     rv.pushKV(&quot;bip9&quot;, bip9);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1316"><span class="lineNum">    1316</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          16 :     softforks.pushKV(DeploymentName(id), std::move(rv));</span></span>
<span id="L1317"><span class="lineNum">    1317</span>                 :<span class="tlaGNC">           8 : }</span></span>
<span id="L1318"><span class="lineNum">    1318</span>                 :             : </span>
<span id="L1319"><span class="lineNum">    1319</span>                 :             : // used by rest.cpp:rest_chaininfo, so cannot be static</span>
<span id="L1320"><span class="lineNum">    1320</span>                 :<span class="tlaGNC">          74 : RPCHelpMan getblockchaininfo()</span></span>
<span id="L1321"><span class="lineNum">    1321</span>                 :             : {</span>
<span id="L1322"><span class="lineNum">    1322</span>                 :<span class="tlaGNC">          74 :     return RPCHelpMan{&quot;getblockchaininfo&quot;,</span></span>
<span id="L1323"><span class="lineNum">    1323</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         148 :         &quot;Returns an object containing various state info regarding blockchain processing.\n&quot;,</span></span>
<span id="L1324"><span class="lineNum">    1324</span>                 :             :         {},</span>
<span id="L1325"><span class="lineNum">    1325</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         148 :         RPCResult{</span></span>
<span id="L1326"><span class="lineNum">    1326</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         148 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L1327"><span class="lineNum">    1327</span>                 :             :             {</span>
<span id="L1328"><span class="lineNum">    1328</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR, &quot;chain&quot;, &quot;current network name (&quot; LIST_CHAIN_NAMES &quot;)&quot;},</span></span>
<span id="L1329"><span class="lineNum">    1329</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;blocks&quot;, &quot;the height of the most-work fully-validated chain. The genesis block has height 0&quot;},</span></span>
<span id="L1330"><span class="lineNum">    1330</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;headers&quot;, &quot;the current number of headers we have validated&quot;},</span></span>
<span id="L1331"><span class="lineNum">    1331</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR, &quot;bestblockhash&quot;, &quot;the hash of the currently best block&quot;},</span></span>
<span id="L1332"><span class="lineNum">    1332</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR_HEX, &quot;bits&quot;, &quot;nBits: compact representation of the block difficulty target&quot;},</span></span>
<span id="L1333"><span class="lineNum">    1333</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR_HEX, &quot;target&quot;, &quot;The difficulty target&quot;},</span></span>
<span id="L1334"><span class="lineNum">    1334</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;difficulty&quot;, &quot;the current difficulty&quot;},</span></span>
<span id="L1335"><span class="lineNum">    1335</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM_TIME, &quot;time&quot;, &quot;The block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L1336"><span class="lineNum">    1336</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM_TIME, &quot;mediantime&quot;, &quot;The median block time expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L1337"><span class="lineNum">    1337</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;verificationprogress&quot;, &quot;estimate of verification progress [0..1]&quot;},</span></span>
<span id="L1338"><span class="lineNum">    1338</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::BOOL, &quot;initialblockdownload&quot;, &quot;(debug information) estimate of whether this node is in Initial Block Download mode&quot;},</span></span>
<span id="L1339"><span class="lineNum">    1339</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR_HEX, &quot;chainwork&quot;, &quot;total amount of work in active chain, in hexadecimal&quot;},</span></span>
<span id="L1340"><span class="lineNum">    1340</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;size_on_disk&quot;, &quot;the estimated size of the block and undo files on disk&quot;},</span></span>
<span id="L1341"><span class="lineNum">    1341</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::BOOL, &quot;pruned&quot;, &quot;if the blocks are subject to pruning&quot;},</span></span>
<span id="L1342"><span class="lineNum">    1342</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;pruneheight&quot;, /*optional=*/true, &quot;height of the last block pruned, plus one (only present if pruning is enabled)&quot;},</span></span>
<span id="L1343"><span class="lineNum">    1343</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::BOOL, &quot;automatic_pruning&quot;, /*optional=*/true, &quot;whether automatic pruning is enabled (only present if pruning is enabled)&quot;},</span></span>
<span id="L1344"><span class="lineNum">    1344</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::NUM, &quot;prune_target_size&quot;, /*optional=*/true, &quot;the target size used by pruning (only present if automatic pruning is enabled)&quot;},</span></span>
<span id="L1345"><span class="lineNum">    1345</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         148 :                 {RPCResult::Type::STR_HEX, &quot;signet_challenge&quot;, /*optional=*/true, &quot;the block challenge (aka. block script), in hexadecimal (only present if the current network is a signet)&quot;},</span></span>
<span id="L1346"><span class="lineNum">    1346</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          74 :                 (IsDeprecatedRPCEnabled(&quot;warnings&quot;) ?</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaGBC" title="Branch 5 was taken 74 times"> + </span>]
<span id="L1347"><span class="lineNum">    1347</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          74 :                     RPCResult{RPCResult::Type::STR, &quot;warnings&quot;, &quot;any network and blockchain warnings (DEPRECATED)&quot;} :</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaGBC" title="Branch 5 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaGBC" title="Branch 7 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L1348"><span class="lineNum">    1348</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         296 :                     RPCResult{RPCResult::Type::ARR, &quot;warnings&quot;, &quot;any network and blockchain warnings (run with `-deprecatedrpc=warnings` to return the latest warning as a single string)&quot;,</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1349"><span class="lineNum">    1349</span>                 :             :                     {</span>
<span id="L1350"><span class="lineNum">    1350</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         296 :                         {RPCResult::Type::STR, &quot;&quot;, &quot;warning&quot;},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1351"><span class="lineNum">    1351</span>                 :             :                     }</span>
<span id="L1352"><span class="lineNum">    1352</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         296 :                     }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 74 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 74 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 74 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaUNC" title="Branch 16 was not taken"> - </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span>]
<span id="L1353"><span class="lineNum">    1353</span>                 :             :                 ),</span>
<span id="L1354"><span class="lineNum">    1354</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        2886 :             }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 1406 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1355"><span class="lineNum">    1355</span>                 :<span class="tlaGNC">          74 :         RPCExamples{</span></span>
<span id="L1356"><span class="lineNum">    1356</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         148 :             HelpExampleCli(&quot;getblockchaininfo&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1357"><span class="lineNum">    1357</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         296 :             + HelpExampleRpc(&quot;getblockchaininfo&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1358"><span class="lineNum">    1358</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          74 :         },</span></span>
<span id="L1359"><span class="lineNum">    1359</span>                 :<span class="tlaGNC">          74 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1360"><span class="lineNum">    1360</span>                 :             : {</span>
<span id="L1361"><span class="lineNum">    1361</span>                 :<span class="tlaGNC">           5 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1362"><span class="lineNum">    1362</span>                 :<span class="tlaGNC">           5 :     LOCK(cs_main);</span></span>
<span id="L1363"><span class="lineNum">    1363</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           5 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L1364"><span class="lineNum">    1364</span>                 :             : </span>
<span id="L1365"><span class="lineNum">    1365</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 5 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          10 :     const CBlockIndex&amp; tip{*CHECK_NONFATAL(active_chainstate.m_chain.Tip())};</span></span>
<span id="L1366"><span class="lineNum">    1366</span>                 :<span class="tlaGNC">           5 :     const int height{tip.nHeight};</span></span>
<span id="L1367"><span class="lineNum">    1367</span>                 :<span class="tlaGNC">           5 :     UniValue obj(UniValue::VOBJ);</span></span>
<span id="L1368"><span class="lineNum">    1368</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;chain&quot;, chainman.GetParams().GetChainTypeString());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1369"><span class="lineNum">    1369</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;blocks&quot;, height);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1370"><span class="lineNum">    1370</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;headers&quot;, chainman.m_best_header ? chainman.m_best_header-&gt;nHeight : -1);</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1371"><span class="lineNum">    1371</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;bestblockhash&quot;, tip.GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1372"><span class="lineNum">    1372</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;bits&quot;, strprintf(&quot;%08x&quot;, tip.nBits));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1373"><span class="lineNum">    1373</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;target&quot;, GetTarget(tip, chainman.GetConsensus().powLimit).GetHex());</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 5 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L1374"><span class="lineNum">    1374</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;difficulty&quot;, GetDifficulty(tip));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1375"><span class="lineNum">    1375</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;time&quot;, tip.GetBlockTime());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1376"><span class="lineNum">    1376</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;mediantime&quot;, tip.GetMedianTimePast());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1377"><span class="lineNum">    1377</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;verificationprogress&quot;, chainman.GuessVerificationProgress(&amp;tip));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1378"><span class="lineNum">    1378</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;initialblockdownload&quot;, chainman.IsInitialBlockDownload());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1379"><span class="lineNum">    1379</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;chainwork&quot;, tip.nChainWork.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1380"><span class="lineNum">    1380</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;size_on_disk&quot;, chainman.m_blockman.CalculateCurrentUsage());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1381"><span class="lineNum">    1381</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;pruned&quot;, chainman.m_blockman.IsPruneMode());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1382"><span class="lineNum">    1382</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 5 times"> + </span>]:<span class="tlaGNC">           5 :     if (chainman.m_blockman.IsPruneMode()) {</span></span>
<span id="L1383"><span class="lineNum">    1383</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto prune_height{GetPruneHeight(chainman.m_blockman, active_chainstate.m_chain)};</span></span>
<span id="L1384"><span class="lineNum">    1384</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         obj.pushKV(&quot;pruneheight&quot;, prune_height ? prune_height.value() + 1 : 0);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1385"><span class="lineNum">    1385</span>                 :             : </span>
<span id="L1386"><span class="lineNum">    1386</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const bool automatic_pruning{chainman.m_blockman.GetPruneTarget() != BlockManager::PRUNE_TARGET_MANUAL};</span></span>
<span id="L1387"><span class="lineNum">    1387</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         obj.pushKV(&quot;automatic_pruning&quot;,  automatic_pruning);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1388"><span class="lineNum">    1388</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (automatic_pruning) {</span></span>
<span id="L1389"><span class="lineNum">    1389</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             obj.pushKV(&quot;prune_target_size&quot;, chainman.m_blockman.GetPruneTarget());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1390"><span class="lineNum">    1390</span>                 :             :         }</span>
<span id="L1391"><span class="lineNum">    1391</span>                 :             :     }</span>
<span id="L1392"><span class="lineNum">    1392</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 5 times"> + </span>]:<span class="tlaGNC">           5 :     if (chainman.GetParams().GetChainType() == ChainType::SIGNET) {</span></span>
<span id="L1393"><span class="lineNum">    1393</span>                 :<span class="tlaUNC">           0 :         const std::vector&lt;uint8_t&gt;&amp; signet_challenge =</span></span>
<span id="L1394"><span class="lineNum">    1394</span>                 :<span class="tlaUNC">           0 :             chainman.GetParams().GetConsensus().signet_challenge;</span></span>
<span id="L1395"><span class="lineNum">    1395</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         obj.pushKV(&quot;signet_challenge&quot;, HexStr(signet_challenge));</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1396"><span class="lineNum">    1396</span>                 :             :     }</span>
<span id="L1397"><span class="lineNum">    1397</span>                 :             : </span>
<span id="L1398"><span class="lineNum">    1398</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           5 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L1399"><span class="lineNum">    1399</span>   [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          10 :     obj.pushKV(&quot;warnings&quot;, node::GetWarningsForRpc(*CHECK_NONFATAL(node.warnings), IsDeprecatedRPCEnabled(&quot;warnings&quot;)));</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 5 times"> + </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1400"><span class="lineNum">    1400</span>         [<span class="tlaGBC" title="Branch 0 was taken 5 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           5 :     return obj;</span></span>
<span id="L1401"><span class="lineNum">    1401</span>                 :<span class="tlaGNC">           5 : },</span></span>
<span id="L1402"><span class="lineNum">    1402</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         296 :     };</span></span>
<span id="L1403"><span class="lineNum">    1403</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1480 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 74 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 74 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 74 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaUNC" title="Branch 36 was not taken"> - </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 74 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaUNC" title="Branch 42 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 43 was not taken"> - </span>]
<span id="L1404"><span class="lineNum">    1404</span>                 :             : </span>
<span id="L1405"><span class="lineNum">    1405</span>                 :             : namespace {</span>
<span id="L1406"><span class="lineNum">    1406</span>                 :             : const std::vector&lt;RPCResult&gt; RPCHelpForDeployment{</span>
<span id="L1407"><span class="lineNum">    1407</span>                 :             :     {RPCResult::Type::STR, &quot;type&quot;, &quot;one of \&quot;buried\&quot;, \&quot;bip9\&quot;&quot;},</span>
<span id="L1408"><span class="lineNum">    1408</span>                 :             :     {RPCResult::Type::NUM, &quot;height&quot;, /*optional=*/true, &quot;height of the first block which the rules are or will be enforced (only for \&quot;buried\&quot; type, or \&quot;bip9\&quot; type with \&quot;active\&quot; status)&quot;},</span>
<span id="L1409"><span class="lineNum">    1409</span>                 :             :     {RPCResult::Type::BOOL, &quot;active&quot;, &quot;true if the rules are enforced for the mempool and the next block&quot;},</span>
<span id="L1410"><span class="lineNum">    1410</span>                 :             :     {RPCResult::Type::OBJ, &quot;bip9&quot;, /*optional=*/true, &quot;status of bip9 softforks (only for \&quot;bip9\&quot; type)&quot;,</span>
<span id="L1411"><span class="lineNum">    1411</span>                 :             :     {</span>
<span id="L1412"><span class="lineNum">    1412</span>                 :             :         {RPCResult::Type::NUM, &quot;bit&quot;, /*optional=*/true, &quot;the bit (0-28) in the block version field used to signal this softfork (only for \&quot;started\&quot; and \&quot;locked_in\&quot; status)&quot;},</span>
<span id="L1413"><span class="lineNum">    1413</span>                 :             :         {RPCResult::Type::NUM_TIME, &quot;start_time&quot;, &quot;the minimum median time past of a block at which the bit gains its meaning&quot;},</span>
<span id="L1414"><span class="lineNum">    1414</span>                 :             :         {RPCResult::Type::NUM_TIME, &quot;timeout&quot;, &quot;the median time past of a block at which the deployment is considered failed if not yet locked in&quot;},</span>
<span id="L1415"><span class="lineNum">    1415</span>                 :             :         {RPCResult::Type::NUM, &quot;min_activation_height&quot;, &quot;minimum height of blocks for which the rules may be enforced&quot;},</span>
<span id="L1416"><span class="lineNum">    1416</span>                 :             :         {RPCResult::Type::STR, &quot;status&quot;, &quot;status of deployment at specified block (one of \&quot;defined\&quot;, \&quot;started\&quot;, \&quot;locked_in\&quot;, \&quot;active\&quot;, \&quot;failed\&quot;)&quot;},</span>
<span id="L1417"><span class="lineNum">    1417</span>                 :             :         {RPCResult::Type::NUM, &quot;since&quot;, &quot;height of the first block to which the status applies&quot;},</span>
<span id="L1418"><span class="lineNum">    1418</span>                 :             :         {RPCResult::Type::STR, &quot;status_next&quot;, &quot;status of deployment at the next block&quot;},</span>
<span id="L1419"><span class="lineNum">    1419</span>                 :             :         {RPCResult::Type::OBJ, &quot;statistics&quot;, /*optional=*/true, &quot;numeric statistics about signalling for a softfork (only for \&quot;started\&quot; and \&quot;locked_in\&quot; status)&quot;,</span>
<span id="L1420"><span class="lineNum">    1420</span>                 :             :         {</span>
<span id="L1421"><span class="lineNum">    1421</span>                 :             :             {RPCResult::Type::NUM, &quot;period&quot;, &quot;the length in blocks of the signalling period&quot;},</span>
<span id="L1422"><span class="lineNum">    1422</span>                 :             :             {RPCResult::Type::NUM, &quot;threshold&quot;, /*optional=*/true, &quot;the number of blocks with the version bit set required to activate the feature (only for \&quot;started\&quot; status)&quot;},</span>
<span id="L1423"><span class="lineNum">    1423</span>                 :             :             {RPCResult::Type::NUM, &quot;elapsed&quot;, &quot;the number of blocks elapsed since the beginning of the current period&quot;},</span>
<span id="L1424"><span class="lineNum">    1424</span>                 :             :             {RPCResult::Type::NUM, &quot;count&quot;, &quot;the number of blocks with the version bit set in the current period&quot;},</span>
<span id="L1425"><span class="lineNum">    1425</span>                 :             :             {RPCResult::Type::BOOL, &quot;possible&quot;, /*optional=*/true, &quot;returns false if there are not enough blocks left in this period to pass activation threshold (only for \&quot;started\&quot; status)&quot;},</span>
<span id="L1426"><span class="lineNum">    1426</span>                 :             :         }},</span>
<span id="L1427"><span class="lineNum">    1427</span>                 :             :         {RPCResult::Type::STR, &quot;signalling&quot;, /*optional=*/true, &quot;indicates blocks that signalled with a # and blocks that did not with a -&quot;},</span>
<span id="L1428"><span class="lineNum">    1428</span>                 :             :     }},</span>
<span id="L1429"><span class="lineNum">    1429</span>                 :             : };</span>
<span id="L1430"><span class="lineNum">    1430</span>                 :             : </span>
<span id="L1431"><span class="lineNum">    1431</span>                 :<span class="tlaGNC">           4 : UniValue DeploymentInfo(const CBlockIndex* blockindex, const ChainstateManager&amp; chainman)</span></span>
<span id="L1432"><span class="lineNum">    1432</span>                 :             : {</span>
<span id="L1433"><span class="lineNum">    1433</span>                 :<span class="tlaGNC">           4 :     UniValue softforks(UniValue::VOBJ);</span></span>
<span id="L1434"><span class="lineNum">    1434</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_HEIGHTINCB);</span></span>
<span id="L1435"><span class="lineNum">    1435</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_DERSIG);</span></span>
<span id="L1436"><span class="lineNum">    1436</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_CLTV);</span></span>
<span id="L1437"><span class="lineNum">    1437</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_CSV);</span></span>
<span id="L1438"><span class="lineNum">    1438</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_SEGWIT);</span></span>
<span id="L1439"><span class="lineNum">    1439</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_TESTDUMMY);</span></span>
<span id="L1440"><span class="lineNum">    1440</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     SoftForkDescPushBack(blockindex, softforks, chainman, Consensus::DEPLOYMENT_TAPROOT);</span></span>
<span id="L1441"><span class="lineNum">    1441</span>                 :<span class="tlaGNC">           4 :     return softforks;</span></span>
<span id="L1442"><span class="lineNum">    1442</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L1443"><span class="lineNum">    1443</span>                 :             : } // anon namespace</span>
<span id="L1444"><span class="lineNum">    1444</span>                 :             : </span>
<span id="L1445"><span class="lineNum">    1445</span>                 :<span class="tlaGNC">          87 : RPCHelpMan getdeploymentinfo()</span></span>
<span id="L1446"><span class="lineNum">    1446</span>                 :             : {</span>
<span id="L1447"><span class="lineNum">    1447</span>                 :<span class="tlaGNC">          87 :     return RPCHelpMan{&quot;getdeploymentinfo&quot;,</span></span>
<span id="L1448"><span class="lineNum">    1448</span>         [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         174 :         &quot;Returns an object containing various state info regarding deployments of consensus changes.&quot;,</span></span>
<span id="L1449"><span class="lineNum">    1449</span>                 :             :         {</span>
<span id="L1450"><span class="lineNum">    1450</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         261 :             {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Default{&quot;hash of current chain tip&quot;}, &quot;The block hash at which to query deployment state&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1451"><span class="lineNum">    1451</span>                 :             :         },</span>
<span id="L1452"><span class="lineNum">    1452</span>         [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         174 :         RPCResult{</span></span>
<span id="L1453"><span class="lineNum">    1453</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         174 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L1454"><span class="lineNum">    1454</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         174 :                 {RPCResult::Type::STR, &quot;hash&quot;, &quot;requested block hash (or tip)&quot;},</span></span>
<span id="L1455"><span class="lineNum">    1455</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         174 :                 {RPCResult::Type::NUM, &quot;height&quot;, &quot;requested block height (or tip)&quot;},</span></span>
<span id="L1456"><span class="lineNum">    1456</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         174 :                 {RPCResult::Type::OBJ_DYN, &quot;deployments&quot;, &quot;&quot;, {</span></span>
<span id="L1457"><span class="lineNum">    1457</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         174 :                     {RPCResult::Type::OBJ, &quot;xxxx&quot;, &quot;name of the deployment&quot;, RPCHelpForDeployment}</span></span>
<span id="L1458"><span class="lineNum">    1458</span>                 :             :                 }},</span>
<span id="L1459"><span class="lineNum">    1459</span>                 :             :             }</span>
<span id="L1460"><span class="lineNum">    1460</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         870 :         },</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 261 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 87 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 87 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L1461"><span class="lineNum">    1461</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         261 :         RPCExamples{ HelpExampleCli(&quot;getdeploymentinfo&quot;, &quot;&quot;) + HelpExampleRpc(&quot;getdeploymentinfo&quot;, &quot;&quot;) },</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 87 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 14 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L1462"><span class="lineNum">    1462</span>                 :<span class="tlaGNC">          87 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1463"><span class="lineNum">    1463</span>                 :             :         {</span>
<span id="L1464"><span class="lineNum">    1464</span>                 :<span class="tlaGNC">          17 :             const ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1465"><span class="lineNum">    1465</span>                 :<span class="tlaGNC">          17 :             LOCK(cs_main);</span></span>
<span id="L1466"><span class="lineNum">    1466</span>         [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          17 :             const Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L1467"><span class="lineNum">    1467</span>                 :             : </span>
<span id="L1468"><span class="lineNum">    1468</span>                 :<span class="tlaGNC">          17 :             const CBlockIndex* blockindex;</span></span>
<span id="L1469"><span class="lineNum">    1469</span>   [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 15 times"> + </span>]:<span class="tlaGNC">          17 :             if (request.params[0].isNull()) {</span></span>
<span id="L1470"><span class="lineNum">    1470</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :                 blockindex = CHECK_NONFATAL(active_chainstate.m_chain.Tip());</span></span>
<span id="L1471"><span class="lineNum">    1471</span>                 :             :             } else {</span>
<span id="L1472"><span class="lineNum">    1472</span>   [<span class="tlaGBC" title="Branch 0 was taken 15 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 12 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 3 times"> + </span>]:<span class="tlaGNC">          15 :                 const uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L1473"><span class="lineNum">    1473</span>         [<span class="tlaGBC" title="Branch 0 was taken 12 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          12 :                 blockindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L1474"><span class="lineNum">    1474</span>         [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">          12 :                 if (!blockindex) {</span></span>
<span id="L1475"><span class="lineNum">    1475</span>   [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          20 :                     throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L1476"><span class="lineNum">    1476</span>                 :             :                 }</span>
<span id="L1477"><span class="lineNum">    1477</span>                 :             :             }</span>
<span id="L1478"><span class="lineNum">    1478</span>                 :             : </span>
<span id="L1479"><span class="lineNum">    1479</span>                 :<span class="tlaGNC">           4 :             UniValue deploymentinfo(UniValue::VOBJ);</span></span>
<span id="L1480"><span class="lineNum">    1480</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :             deploymentinfo.pushKV(&quot;hash&quot;, blockindex-&gt;GetBlockHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1481"><span class="lineNum">    1481</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :             deploymentinfo.pushKV(&quot;height&quot;, blockindex-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1482"><span class="lineNum">    1482</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :             deploymentinfo.pushKV(&quot;deployments&quot;, DeploymentInfo(blockindex, chainman));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1483"><span class="lineNum">    1483</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :             return deploymentinfo;</span></span>
<span id="L1484"><span class="lineNum">    1484</span>                 :<span class="tlaGNC">           4 :         },</span></span>
<span id="L1485"><span class="lineNum">    1485</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         435 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 87 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1486"><span class="lineNum">    1486</span>   [<span class="tlaGBC" title="Branch 0 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         522 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 87 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 87 times"> + </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1487"><span class="lineNum">    1487</span>                 :             : </span>
<span id="L1488"><span class="lineNum">    1488</span>                 :             : /** Comparison function for sorting the getchaintips heads.  */</span>
<span id="L1489"><span class="lineNum">    1489</span>                 :             : struct CompareBlocksByHeight</span>
<span id="L1490"><span class="lineNum">    1490</span>                 :             : {</span>
<span id="L1491"><span class="lineNum">    1491</span>                 :<span class="tlaGNC">       38929 :     bool operator()(const CBlockIndex* a, const CBlockIndex* b) const</span></span>
<span id="L1492"><span class="lineNum">    1492</span>                 :             :     {</span>
<span id="L1493"><span class="lineNum">    1493</span>                 :             :         /* Make sure that unequal blocks with the same height do not compare</span>
<span id="L1494"><span class="lineNum">    1494</span>                 :             :            equal. Use the pointers themselves to make a distinction. */</span>
<span id="L1495"><span class="lineNum">    1495</span>                 :             : </span>
<span id="L1496"><span class="lineNum">    1496</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 3979 times"> + </span> :<span class="tlaGNC">       38929 :         if (a-&gt;nHeight != b-&gt;nHeight)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 548 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 30299 times"> + </span><span class="tlaGBC" title="Branch 6 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 3979 times"> + </span>]
<span id="L1497"><span class="lineNum">    1497</span>                 :<span class="tlaGNC">         672 :           return (a-&gt;nHeight &gt; b-&gt;nHeight);</span></span>
<span id="L1498"><span class="lineNum">    1498</span>                 :             : </span>
<span id="L1499"><span class="lineNum">    1499</span>                 :<span class="tlaGNC">       38257 :         return a &lt; b;</span></span>
<span id="L1500"><span class="lineNum">    1500</span>                 :             :     }</span>
<span id="L1501"><span class="lineNum">    1501</span>                 :             : };</span>
<span id="L1502"><span class="lineNum">    1502</span>                 :             : </span>
<span id="L1503"><span class="lineNum">    1503</span>                 :<span class="tlaGNC">         135 : static RPCHelpMan getchaintips()</span></span>
<span id="L1504"><span class="lineNum">    1504</span>                 :             : {</span>
<span id="L1505"><span class="lineNum">    1505</span>                 :<span class="tlaGNC">         135 :     return RPCHelpMan{&quot;getchaintips&quot;,</span></span>
<span id="L1506"><span class="lineNum">    1506</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         270 :                 &quot;Return information about all known tips in the block tree,&quot;</span></span>
<span id="L1507"><span class="lineNum">    1507</span>                 :             :                 &quot; including the main chain as well as orphaned branches.\n&quot;,</span>
<span id="L1508"><span class="lineNum">    1508</span>                 :             :                 {},</span>
<span id="L1509"><span class="lineNum">    1509</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         270 :                 RPCResult{</span></span>
<span id="L1510"><span class="lineNum">    1510</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         270 :                     RPCResult::Type::ARR, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L1511"><span class="lineNum">    1511</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :                     {{RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L1512"><span class="lineNum">    1512</span>                 :             :                         {</span>
<span id="L1513"><span class="lineNum">    1513</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :                             {RPCResult::Type::NUM, &quot;height&quot;, &quot;height of the chain tip&quot;},</span></span>
<span id="L1514"><span class="lineNum">    1514</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :                             {RPCResult::Type::STR_HEX, &quot;hash&quot;, &quot;block hash of the tip&quot;},</span></span>
<span id="L1515"><span class="lineNum">    1515</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :                             {RPCResult::Type::NUM, &quot;branchlen&quot;, &quot;zero for main chain, otherwise length of branch connecting the tip to the main chain&quot;},</span></span>
<span id="L1516"><span class="lineNum">    1516</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :                             {RPCResult::Type::STR, &quot;status&quot;, &quot;status of the chain, \&quot;active\&quot; for the main chain\n&quot;</span></span>
<span id="L1517"><span class="lineNum">    1517</span>                 :             :             &quot;Possible values for status:\n&quot;</span>
<span id="L1518"><span class="lineNum">    1518</span>                 :             :             &quot;1.  \&quot;invalid\&quot;               This branch contains at least one invalid block\n&quot;</span>
<span id="L1519"><span class="lineNum">    1519</span>                 :             :             &quot;2.  \&quot;headers-only\&quot;          Not all blocks for this branch are available, but the headers are valid\n&quot;</span>
<span id="L1520"><span class="lineNum">    1520</span>                 :             :             &quot;3.  \&quot;valid-headers\&quot;         All blocks are available for this branch, but they were never fully validated\n&quot;</span>
<span id="L1521"><span class="lineNum">    1521</span>                 :             :             &quot;4.  \&quot;valid-fork\&quot;            This branch is not part of the active chain, but is fully validated\n&quot;</span>
<span id="L1522"><span class="lineNum">    1522</span>                 :             :             &quot;5.  \&quot;active\&quot;                This is the tip of the active main chain, which is certainly valid&quot;},</span>
<span id="L1523"><span class="lineNum">    1523</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1485 :                         }}}},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 540 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 9 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not taken"> - </span>]
<span id="L1524"><span class="lineNum">    1524</span>                 :<span class="tlaGNC">         135 :                 RPCExamples{</span></span>
<span id="L1525"><span class="lineNum">    1525</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :                     HelpExampleCli(&quot;getchaintips&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1526"><span class="lineNum">    1526</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         540 :             + HelpExampleRpc(&quot;getchaintips&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1527"><span class="lineNum">    1527</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :                 },</span></span>
<span id="L1528"><span class="lineNum">    1528</span>                 :<span class="tlaGNC">         135 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1529"><span class="lineNum">    1529</span>                 :             : {</span>
<span id="L1530"><span class="lineNum">    1530</span>                 :<span class="tlaGNC">          62 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1531"><span class="lineNum">    1531</span>                 :<span class="tlaGNC">          62 :     LOCK(cs_main);</span></span>
<span id="L1532"><span class="lineNum">    1532</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          62 :     CChain&amp; active_chain = chainman.ActiveChain();</span></span>
<span id="L1533"><span class="lineNum">    1533</span>                 :             : </span>
<span id="L1534"><span class="lineNum">    1534</span>                 :             :     /*</span>
<span id="L1535"><span class="lineNum">    1535</span>                 :             :      * Idea: The set of chain tips is the active chain tip, plus orphan blocks which do not have another orphan building off of them.</span>
<span id="L1536"><span class="lineNum">    1536</span>                 :             :      * Algorithm:</span>
<span id="L1537"><span class="lineNum">    1537</span>                 :             :      *  - Make one pass through BlockIndex(), picking out the orphan blocks, and also storing a set of the orphan block's pprev pointers.</span>
<span id="L1538"><span class="lineNum">    1538</span>                 :             :      *  - Iterate through the orphan blocks. If the block isn't pointed to by another orphan, it is a chain tip.</span>
<span id="L1539"><span class="lineNum">    1539</span>                 :             :      *  - Add the active chain tip</span>
<span id="L1540"><span class="lineNum">    1540</span>                 :             :      */</span>
<span id="L1541"><span class="lineNum">    1541</span>                 :<span class="tlaGNC">          62 :     std::set&lt;const CBlockIndex*, CompareBlocksByHeight&gt; setTips;</span></span>
<span id="L1542"><span class="lineNum">    1542</span>                 :<span class="tlaGNC">          62 :     std::set&lt;const CBlockIndex*&gt; setOrphans;</span></span>
<span id="L1543"><span class="lineNum">    1543</span>                 :<span class="tlaGNC">          62 :     std::set&lt;const CBlockIndex*&gt; setPrevs;</span></span>
<span id="L1544"><span class="lineNum">    1544</span>                 :             : </span>
<span id="L1545"><span class="lineNum">    1545</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 4103 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 4041 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 62 times"> + </span>]:<span class="tlaGNC">        4165 :     for (const auto&amp; [_, block_index] : chainman.BlockIndex()) {</span></span>
<span id="L1546"><span class="lineNum">    1546</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 62 times"> + </span>]:<span class="tlaGNC">        4103 :         if (!active_chain.Contains(&amp;block_index)) {</span></span>
<span id="L1547"><span class="lineNum">    1547</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :             setOrphans.insert(&amp;block_index);</span></span>
<span id="L1548"><span class="lineNum">    1548</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :             setPrevs.insert(block_index.pprev);</span></span>
<span id="L1549"><span class="lineNum">    1549</span>                 :             :         }</span>
<span id="L1550"><span class="lineNum">    1550</span>                 :             :     }</span>
<span id="L1551"><span class="lineNum">    1551</span>                 :             : </span>
<span id="L1552"><span class="lineNum">    1552</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 62 times"> + </span>]:<span class="tlaGNC">        4103 :     for (std::set&lt;const CBlockIndex*&gt;::iterator it = setOrphans.begin(); it != setOrphans.end(); ++it) {</span></span>
<span id="L1553"><span class="lineNum">    1553</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :         if (setPrevs.erase(*it) == 0) {</span></span>
<span id="L1554"><span class="lineNum">    1554</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :             setTips.insert(*it);</span></span>
<span id="L1555"><span class="lineNum">    1555</span>                 :             :         }</span>
<span id="L1556"><span class="lineNum">    1556</span>                 :             :     }</span>
<span id="L1557"><span class="lineNum">    1557</span>                 :             : </span>
<span id="L1558"><span class="lineNum">    1558</span>                 :             :     // Always report the currently active tip.</span>
<span id="L1559"><span class="lineNum">    1559</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :     setTips.insert(active_chain.Tip());</span></span>
<span id="L1560"><span class="lineNum">    1560</span>                 :             : </span>
<span id="L1561"><span class="lineNum">    1561</span>                 :             :     /* Construct the output array.  */</span>
<span id="L1562"><span class="lineNum">    1562</span>                 :<span class="tlaGNC">          62 :     UniValue res(UniValue::VARR);</span></span>
<span id="L1563"><span class="lineNum">    1563</span>         [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 62 times"> + </span>]:<span class="tlaGNC">        4165 :     for (const CBlockIndex* block : setTips) {</span></span>
<span id="L1564"><span class="lineNum">    1564</span>                 :<span class="tlaGNC">        4103 :         UniValue obj(UniValue::VOBJ);</span></span>
<span id="L1565"><span class="lineNum">    1565</span>   [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8206 :         obj.pushKV(&quot;height&quot;, block-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1566"><span class="lineNum">    1566</span>   [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8206 :         obj.pushKV(&quot;hash&quot;, block-&gt;phashBlock-&gt;GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1567"><span class="lineNum">    1567</span>                 :             : </span>
<span id="L1568"><span class="lineNum">    1568</span>         [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4103 :         const int branchLen = block-&gt;nHeight - active_chain.FindFork(block)-&gt;nHeight;</span></span>
<span id="L1569"><span class="lineNum">    1569</span>   [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8206 :         obj.pushKV(&quot;branchlen&quot;, branchLen);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1570"><span class="lineNum">    1570</span>                 :             : </span>
<span id="L1571"><span class="lineNum">    1571</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 4041 times"> + </span>]:<span class="tlaGNC">        4103 :         std::string status;</span></span>
<span id="L1572"><span class="lineNum">    1572</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 4041 times"> + </span>]:<span class="tlaGNC">        4103 :         if (active_chain.Contains(block)) {</span></span>
<span id="L1573"><span class="lineNum">    1573</span>                 :             :             // This block is part of the currently active chain.</span>
<span id="L1574"><span class="lineNum">    1574</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          62 :             status = &quot;active&quot;;</span></span>
<span id="L1575"><span class="lineNum">    1575</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4041 times"> + </span>]:<span class="tlaGNC">        4041 :         } else if (block-&gt;nStatus &amp; BLOCK_FAILED_MASK) {</span></span>
<span id="L1576"><span class="lineNum">    1576</span>                 :             :             // This block or one of its ancestors is invalid.</span>
<span id="L1577"><span class="lineNum">    1577</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             status = &quot;invalid&quot;;</span></span>
<span id="L1578"><span class="lineNum">    1578</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :         } else if (!block-&gt;HaveNumChainTxs()) {</span></span>
<span id="L1579"><span class="lineNum">    1579</span>                 :             :             // This block cannot be connected because full block data for it or one of its parents is missing.</span>
<span id="L1580"><span class="lineNum">    1580</span>         [<span class="tlaGBC" title="Branch 0 was taken 4041 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4041 :             status = &quot;headers-only&quot;;</span></span>
<span id="L1581"><span class="lineNum">    1581</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (block-&gt;IsValid(BLOCK_VALID_SCRIPTS)) {</span></span>
<span id="L1582"><span class="lineNum">    1582</span>                 :             :             // This block is fully validated, but no longer part of the active chain. It was probably the active block once, but was reorganized.</span>
<span id="L1583"><span class="lineNum">    1583</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             status = &quot;valid-fork&quot;;</span></span>
<span id="L1584"><span class="lineNum">    1584</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (block-&gt;IsValid(BLOCK_VALID_TREE)) {</span></span>
<span id="L1585"><span class="lineNum">    1585</span>                 :             :             // The headers for this block are valid, but it has not been validated. It was probably never part of the most-work chain.</span>
<span id="L1586"><span class="lineNum">    1586</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             status = &quot;valid-headers&quot;;</span></span>
<span id="L1587"><span class="lineNum">    1587</span>                 :             :         } else {</span>
<span id="L1588"><span class="lineNum">    1588</span>                 :             :             // No clue.</span>
<span id="L1589"><span class="lineNum">    1589</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             status = &quot;unknown&quot;;</span></span>
<span id="L1590"><span class="lineNum">    1590</span>                 :             :         }</span>
<span id="L1591"><span class="lineNum">    1591</span>   [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8206 :         obj.pushKV(&quot;status&quot;, status);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1592"><span class="lineNum">    1592</span>                 :             : </span>
<span id="L1593"><span class="lineNum">    1593</span>         [<span class="tlaGBC" title="Branch 0 was taken 4103 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        4103 :         res.push_back(std::move(obj));</span></span>
<span id="L1594"><span class="lineNum">    1594</span>                 :<span class="tlaGNC">        4103 :     }</span></span>
<span id="L1595"><span class="lineNum">    1595</span>                 :             : </span>
<span id="L1596"><span class="lineNum">    1596</span>                 :<span class="tlaGNC">          62 :     return res;</span></span>
<span id="L1597"><span class="lineNum">    1597</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         124 : },</span></span>
<span id="L1598"><span class="lineNum">    1598</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         540 :     };</span></span>
<span id="L1599"><span class="lineNum">    1599</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         675 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 135 times"> + </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L1600"><span class="lineNum">    1600</span>                 :             : </span>
<span id="L1601"><span class="lineNum">    1601</span>                 :<span class="tlaGNC">          67 : static RPCHelpMan preciousblock()</span></span>
<span id="L1602"><span class="lineNum">    1602</span>                 :             : {</span>
<span id="L1603"><span class="lineNum">    1603</span>                 :<span class="tlaGNC">          67 :     return RPCHelpMan{</span></span>
<span id="L1604"><span class="lineNum">    1604</span>                 :<span class="tlaGNC">          67 :         &quot;preciousblock&quot;,</span></span>
<span id="L1605"><span class="lineNum">    1605</span>         [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         134 :         &quot;Treats a block as if it were received before others with the same work.\n&quot;</span></span>
<span id="L1606"><span class="lineNum">    1606</span>                 :             :                 &quot;\nA later preciousblock call can override the effect of an earlier one.\n&quot;</span>
<span id="L1607"><span class="lineNum">    1607</span>                 :             :                 &quot;\nThe effects of preciousblock are not retained across restarts.\n&quot;,</span>
<span id="L1608"><span class="lineNum">    1608</span>                 :             :                 {</span>
<span id="L1609"><span class="lineNum">    1609</span>   [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         134 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;the hash of the block to mark as precious&quot;},</span></span>
<span id="L1610"><span class="lineNum">    1610</span>                 :             :                 },</span>
<span id="L1611"><span class="lineNum">    1611</span>   [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         134 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1612"><span class="lineNum">    1612</span>                 :<span class="tlaGNC">          67 :                 RPCExamples{</span></span>
<span id="L1613"><span class="lineNum">    1613</span>   [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         134 :                     HelpExampleCli(&quot;preciousblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1614"><span class="lineNum">    1614</span>   [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         268 :             + HelpExampleRpc(&quot;preciousblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1615"><span class="lineNum">    1615</span>         [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          67 :                 },</span></span>
<span id="L1616"><span class="lineNum">    1616</span>                 :<span class="tlaGNC">          67 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1617"><span class="lineNum">    1617</span>                 :             : {</span>
<span id="L1618"><span class="lineNum">    1618</span>                 :<span class="tlaGNC">           4 :     uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L1619"><span class="lineNum">    1619</span>                 :<span class="tlaGNC">           4 :     CBlockIndex* pblockindex;</span></span>
<span id="L1620"><span class="lineNum">    1620</span>                 :             : </span>
<span id="L1621"><span class="lineNum">    1621</span>                 :<span class="tlaGNC">           4 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1622"><span class="lineNum">    1622</span>                 :<span class="tlaGNC">           4 :     {</span></span>
<span id="L1623"><span class="lineNum">    1623</span>                 :<span class="tlaGNC">           4 :         LOCK(cs_main);</span></span>
<span id="L1624"><span class="lineNum">    1624</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :         pblockindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L1625"><span class="lineNum">    1625</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">           4 :         if (!pblockindex) {</span></span>
<span id="L1626"><span class="lineNum">    1626</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L1627"><span class="lineNum">    1627</span>                 :             :         }</span>
<span id="L1628"><span class="lineNum">    1628</span>                 :<span class="tlaGNC">           1 :     }</span></span>
<span id="L1629"><span class="lineNum">    1629</span>                 :             : </span>
<span id="L1630"><span class="lineNum">    1630</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :     BlockValidationState state;</span></span>
<span id="L1631"><span class="lineNum">    1631</span>   [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           3 :     chainman.ActiveChainstate().PreciousBlock(state, pblockindex);</span></span>
<span id="L1632"><span class="lineNum">    1632</span>                 :             : </span>
<span id="L1633"><span class="lineNum">    1633</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span>]:<span class="tlaGNC">           3 :     if (!state.IsValid()) {</span></span>
<span id="L1634"><span class="lineNum">    1634</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_DATABASE_ERROR, state.ToString());</span></span>
<span id="L1635"><span class="lineNum">    1635</span>                 :             :     }</span>
<span id="L1636"><span class="lineNum">    1636</span>                 :             : </span>
<span id="L1637"><span class="lineNum">    1637</span>                 :<span class="tlaGNC">           3 :     return UniValue::VNULL;</span></span>
<span id="L1638"><span class="lineNum">    1638</span>                 :<span class="tlaGNC">           3 : },</span></span>
<span id="L1639"><span class="lineNum">    1639</span>   [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         335 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 67 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1640"><span class="lineNum">    1640</span>         [<span class="tlaGBC" title="Branch 0 was taken 67 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         134 : }</span></span>
<span id="L1641"><span class="lineNum">    1641</span>                 :             : </span>
<span id="L1642"><span class="lineNum">    1642</span>                 :<span class="tlaGNC">           3 : void InvalidateBlock(ChainstateManager&amp; chainman, const uint256 block_hash) {</span></span>
<span id="L1643"><span class="lineNum">    1643</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :     BlockValidationState state;</span></span>
<span id="L1644"><span class="lineNum">    1644</span>                 :<span class="tlaGNC">           3 :     CBlockIndex* pblockindex;</span></span>
<span id="L1645"><span class="lineNum">    1645</span>                 :<span class="tlaGNC">           3 :     {</span></span>
<span id="L1646"><span class="lineNum">    1646</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :         LOCK(chainman.GetMutex());</span></span>
<span id="L1647"><span class="lineNum">    1647</span>         [<span class="tlaGBC" title="Branch 0 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           3 :         pblockindex = chainman.m_blockman.LookupBlockIndex(block_hash);</span></span>
<span id="L1648"><span class="lineNum">    1648</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           3 :         if (!pblockindex) {</span></span>
<span id="L1649"><span class="lineNum">    1649</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L1650"><span class="lineNum">    1650</span>                 :             :         }</span>
<span id="L1651"><span class="lineNum">    1651</span>                 :<span class="tlaGNC">           2 :     }</span></span>
<span id="L1652"><span class="lineNum">    1652</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           1 :     chainman.ActiveChainstate().InvalidateBlock(state, pblockindex);</span></span>
<span id="L1653"><span class="lineNum">    1653</span>                 :             : </span>
<span id="L1654"><span class="lineNum">    1654</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :     if (state.IsValid()) {</span></span>
<span id="L1655"><span class="lineNum">    1655</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :         chainman.ActiveChainstate().ActivateBestChain(state);</span></span>
<span id="L1656"><span class="lineNum">    1656</span>                 :             :     }</span>
<span id="L1657"><span class="lineNum">    1657</span>                 :             : </span>
<span id="L1658"><span class="lineNum">    1658</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">           1 :     if (!state.IsValid()) {</span></span>
<span id="L1659"><span class="lineNum">    1659</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_DATABASE_ERROR, state.ToString());</span></span>
<span id="L1660"><span class="lineNum">    1660</span>                 :             :     }</span>
<span id="L1661"><span class="lineNum">    1661</span>                 :<span class="tlaGNC">           1 : }</span></span>
<span id="L1662"><span class="lineNum">    1662</span>                 :             : </span>
<span id="L1663"><span class="lineNum">    1663</span>                 :<span class="tlaGNC">          58 : static RPCHelpMan invalidateblock()</span></span>
<span id="L1664"><span class="lineNum">    1664</span>                 :             : {</span>
<span id="L1665"><span class="lineNum">    1665</span>                 :<span class="tlaGNC">          58 :     return RPCHelpMan{</span></span>
<span id="L1666"><span class="lineNum">    1666</span>                 :<span class="tlaGNC">          58 :         &quot;invalidateblock&quot;,</span></span>
<span id="L1667"><span class="lineNum">    1667</span>         [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         116 :         &quot;Permanently marks a block as invalid, as if it violated a consensus rule.\n&quot;,</span></span>
<span id="L1668"><span class="lineNum">    1668</span>                 :             :                 {</span>
<span id="L1669"><span class="lineNum">    1669</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         116 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;the hash of the block to mark as invalid&quot;},</span></span>
<span id="L1670"><span class="lineNum">    1670</span>                 :             :                 },</span>
<span id="L1671"><span class="lineNum">    1671</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         116 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1672"><span class="lineNum">    1672</span>                 :<span class="tlaGNC">          58 :                 RPCExamples{</span></span>
<span id="L1673"><span class="lineNum">    1673</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         116 :                     HelpExampleCli(&quot;invalidateblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1674"><span class="lineNum">    1674</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         232 :             + HelpExampleRpc(&quot;invalidateblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1675"><span class="lineNum">    1675</span>         [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          58 :                 },</span></span>
<span id="L1676"><span class="lineNum">    1676</span>                 :<span class="tlaGNC">          58 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1677"><span class="lineNum">    1677</span>                 :             : {</span>
<span id="L1678"><span class="lineNum">    1678</span>                 :<span class="tlaGNC">           3 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1679"><span class="lineNum">    1679</span>                 :<span class="tlaGNC">           3 :     uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L1680"><span class="lineNum">    1680</span>                 :             : </span>
<span id="L1681"><span class="lineNum">    1681</span>                 :<span class="tlaGNC">           3 :     InvalidateBlock(chainman, hash);</span></span>
<span id="L1682"><span class="lineNum">    1682</span>                 :             : </span>
<span id="L1683"><span class="lineNum">    1683</span>                 :<span class="tlaGNC">           1 :     return UniValue::VNULL;</span></span>
<span id="L1684"><span class="lineNum">    1684</span>                 :             : },</span>
<span id="L1685"><span class="lineNum">    1685</span>   [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         290 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 58 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1686"><span class="lineNum">    1686</span>         [<span class="tlaGBC" title="Branch 0 was taken 58 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         116 : }</span></span>
<span id="L1687"><span class="lineNum">    1687</span>                 :             : </span>
<span id="L1688"><span class="lineNum">    1688</span>                 :<span class="tlaGNC">          35 : void ReconsiderBlock(ChainstateManager&amp; chainman, uint256 block_hash) {</span></span>
<span id="L1689"><span class="lineNum">    1689</span>                 :<span class="tlaGNC">          35 :     {</span></span>
<span id="L1690"><span class="lineNum">    1690</span>                 :<span class="tlaGNC">          35 :         LOCK(chainman.GetMutex());</span></span>
<span id="L1691"><span class="lineNum">    1691</span>         [<span class="tlaGBC" title="Branch 0 was taken 35 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          35 :         CBlockIndex* pblockindex = chainman.m_blockman.LookupBlockIndex(block_hash);</span></span>
<span id="L1692"><span class="lineNum">    1692</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 33 times"> + </span>]:<span class="tlaGNC">          35 :         if (!pblockindex) {</span></span>
<span id="L1693"><span class="lineNum">    1693</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L1694"><span class="lineNum">    1694</span>                 :             :         }</span>
<span id="L1695"><span class="lineNum">    1695</span>                 :             : </span>
<span id="L1696"><span class="lineNum">    1696</span>   [<span class="tlaGBC" title="Branch 0 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          33 :         chainman.ActiveChainstate().ResetBlockFailureFlags(pblockindex);</span></span>
<span id="L1697"><span class="lineNum">    1697</span>         [<span class="tlaGBC" title="Branch 0 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          33 :         chainman.RecalculateBestHeader();</span></span>
<span id="L1698"><span class="lineNum">    1698</span>                 :<span class="tlaGNC">           2 :     }</span></span>
<span id="L1699"><span class="lineNum">    1699</span>                 :             : </span>
<span id="L1700"><span class="lineNum">    1700</span>         [<span class="tlaGBC" title="Branch 0 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          33 :     BlockValidationState state;</span></span>
<span id="L1701"><span class="lineNum">    1701</span>   [<span class="tlaGBC" title="Branch 0 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 33 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          33 :     chainman.ActiveChainstate().ActivateBestChain(state);</span></span>
<span id="L1702"><span class="lineNum">    1702</span>                 :             : </span>
<span id="L1703"><span class="lineNum">    1703</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 33 times"> + </span>]:<span class="tlaGNC">          33 :     if (!state.IsValid()) {</span></span>
<span id="L1704"><span class="lineNum">    1704</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_DATABASE_ERROR, state.ToString());</span></span>
<span id="L1705"><span class="lineNum">    1705</span>                 :             :     }</span>
<span id="L1706"><span class="lineNum">    1706</span>                 :<span class="tlaGNC">          33 : }</span></span>
<span id="L1707"><span class="lineNum">    1707</span>                 :             : </span>
<span id="L1708"><span class="lineNum">    1708</span>                 :<span class="tlaGNC">          94 : static RPCHelpMan reconsiderblock()</span></span>
<span id="L1709"><span class="lineNum">    1709</span>                 :             : {</span>
<span id="L1710"><span class="lineNum">    1710</span>                 :<span class="tlaGNC">          94 :     return RPCHelpMan{</span></span>
<span id="L1711"><span class="lineNum">    1711</span>                 :<span class="tlaGNC">          94 :         &quot;reconsiderblock&quot;,</span></span>
<span id="L1712"><span class="lineNum">    1712</span>         [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         188 :         &quot;Removes invalidity status of a block, its ancestors and its descendants, reconsider them for activation.\n&quot;</span></span>
<span id="L1713"><span class="lineNum">    1713</span>                 :             :                 &quot;This can be used to undo the effects of invalidateblock.\n&quot;,</span>
<span id="L1714"><span class="lineNum">    1714</span>                 :             :                 {</span>
<span id="L1715"><span class="lineNum">    1715</span>   [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         188 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;the hash of the block to reconsider&quot;},</span></span>
<span id="L1716"><span class="lineNum">    1716</span>                 :             :                 },</span>
<span id="L1717"><span class="lineNum">    1717</span>   [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         188 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1718"><span class="lineNum">    1718</span>                 :<span class="tlaGNC">          94 :                 RPCExamples{</span></span>
<span id="L1719"><span class="lineNum">    1719</span>   [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         188 :                     HelpExampleCli(&quot;reconsiderblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1720"><span class="lineNum">    1720</span>   [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         376 :             + HelpExampleRpc(&quot;reconsiderblock&quot;, &quot;\&quot;blockhash\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1721"><span class="lineNum">    1721</span>         [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          94 :                 },</span></span>
<span id="L1722"><span class="lineNum">    1722</span>                 :<span class="tlaGNC">          94 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1723"><span class="lineNum">    1723</span>                 :             : {</span>
<span id="L1724"><span class="lineNum">    1724</span>                 :<span class="tlaGNC">          35 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1725"><span class="lineNum">    1725</span>                 :<span class="tlaGNC">          35 :     uint256 hash(ParseHashV(request.params[0], &quot;blockhash&quot;));</span></span>
<span id="L1726"><span class="lineNum">    1726</span>                 :             : </span>
<span id="L1727"><span class="lineNum">    1727</span>                 :<span class="tlaGNC">          35 :     ReconsiderBlock(chainman, hash);</span></span>
<span id="L1728"><span class="lineNum">    1728</span>                 :             : </span>
<span id="L1729"><span class="lineNum">    1729</span>                 :<span class="tlaGNC">          33 :     return UniValue::VNULL;</span></span>
<span id="L1730"><span class="lineNum">    1730</span>                 :             : },</span>
<span id="L1731"><span class="lineNum">    1731</span>   [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         470 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 94 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1732"><span class="lineNum">    1732</span>         [<span class="tlaGBC" title="Branch 0 was taken 94 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         188 : }</span></span>
<span id="L1733"><span class="lineNum">    1733</span>                 :             : </span>
<span id="L1734"><span class="lineNum">    1734</span>                 :<span class="tlaGNC">          79 : static RPCHelpMan getchaintxstats()</span></span>
<span id="L1735"><span class="lineNum">    1735</span>                 :             : {</span>
<span id="L1736"><span class="lineNum">    1736</span>                 :<span class="tlaGNC">          79 :     return RPCHelpMan{</span></span>
<span id="L1737"><span class="lineNum">    1737</span>                 :<span class="tlaGNC">          79 :         &quot;getchaintxstats&quot;,</span></span>
<span id="L1738"><span class="lineNum">    1738</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         158 :         &quot;Compute statistics about the total number and rate of transactions in the chain.\n&quot;,</span></span>
<span id="L1739"><span class="lineNum">    1739</span>                 :             :                 {</span>
<span id="L1740"><span class="lineNum">    1740</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         237 :                     {&quot;nblocks&quot;, RPCArg::Type::NUM, RPCArg::DefaultHint{&quot;one month&quot;}, &quot;Size of the window in number of blocks&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1741"><span class="lineNum">    1741</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         237 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::DefaultHint{&quot;chain tip&quot;}, &quot;The hash of the block that ends the window.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1742"><span class="lineNum">    1742</span>                 :             :                 },</span>
<span id="L1743"><span class="lineNum">    1743</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         158 :                 RPCResult{</span></span>
<span id="L1744"><span class="lineNum">    1744</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L1745"><span class="lineNum">    1745</span>                 :             :                     {</span>
<span id="L1746"><span class="lineNum">    1746</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                         {RPCResult::Type::NUM_TIME, &quot;time&quot;, &quot;The timestamp for the final block in the window, expressed in &quot; + UNIX_EPOCH_TIME},</span></span>
<span id="L1747"><span class="lineNum">    1747</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          79 :                         {RPCResult::Type::NUM, &quot;txcount&quot;, /*optional=*/true,</span></span>
<span id="L1748"><span class="lineNum">    1748</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         158 :                          &quot;The total number of transactions in the chain up to that point, if known. &quot;</span></span>
<span id="L1749"><span class="lineNum">    1749</span>                 :             :                          &quot;It may be unknown when using assumeutxo.&quot;},</span>
<span id="L1750"><span class="lineNum">    1750</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                         {RPCResult::Type::STR_HEX, &quot;window_final_block_hash&quot;, &quot;The hash of the final block in the window&quot;},</span></span>
<span id="L1751"><span class="lineNum">    1751</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                         {RPCResult::Type::NUM, &quot;window_final_block_height&quot;, &quot;The height of the final block in the window.&quot;},</span></span>
<span id="L1752"><span class="lineNum">    1752</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                         {RPCResult::Type::NUM, &quot;window_block_count&quot;, &quot;Size of the window in number of blocks&quot;},</span></span>
<span id="L1753"><span class="lineNum">    1753</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         158 :                         {RPCResult::Type::NUM, &quot;window_interval&quot;, /*optional=*/true, &quot;The elapsed time in the window in seconds. Only returned if \&quot;window_block_count\&quot; is &gt; 0&quot;},</span></span>
<span id="L1754"><span class="lineNum">    1754</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          79 :                         {RPCResult::Type::NUM, &quot;window_tx_count&quot;, /*optional=*/true,</span></span>
<span id="L1755"><span class="lineNum">    1755</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         158 :                          &quot;The number of transactions in the window. &quot;</span></span>
<span id="L1756"><span class="lineNum">    1756</span>                 :             :                          &quot;Only returned if \&quot;window_block_count\&quot; is &gt; 0 and if txcount exists for the start and end of the window.&quot;},</span>
<span id="L1757"><span class="lineNum">    1757</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          79 :                         {RPCResult::Type::NUM, &quot;txrate&quot;, /*optional=*/true,</span></span>
<span id="L1758"><span class="lineNum">    1758</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         158 :                          &quot;The average rate of transactions per second in the window. &quot;</span></span>
<span id="L1759"><span class="lineNum">    1759</span>                 :             :                          &quot;Only returned if \&quot;window_interval\&quot; is &gt; 0 and if window_tx_count exists.&quot;},</span>
<span id="L1760"><span class="lineNum">    1760</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1343 :                     }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 632 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1761"><span class="lineNum">    1761</span>                 :<span class="tlaGNC">          79 :                 RPCExamples{</span></span>
<span id="L1762"><span class="lineNum">    1762</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         158 :                     HelpExampleCli(&quot;getchaintxstats&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1763"><span class="lineNum">    1763</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         316 :             + HelpExampleRpc(&quot;getchaintxstats&quot;, &quot;2016&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1764"><span class="lineNum">    1764</span>         [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          79 :                 },</span></span>
<span id="L1765"><span class="lineNum">    1765</span>                 :<span class="tlaGNC">          79 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1766"><span class="lineNum">    1766</span>                 :             : {</span>
<span id="L1767"><span class="lineNum">    1767</span>                 :<span class="tlaGNC">          12 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1768"><span class="lineNum">    1768</span>                 :<span class="tlaGNC">          12 :     const CBlockIndex* pindex;</span></span>
<span id="L1769"><span class="lineNum">    1769</span>                 :<span class="tlaGNC">          12 :     int blockcount = 30 * 24 * 60 * 60 / chainman.GetParams().GetConsensus().nPowTargetSpacing; // By default: 1 month</span></span>
<span id="L1770"><span class="lineNum">    1770</span>                 :             : </span>
<span id="L1771"><span class="lineNum">    1771</span>         [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">          12 :     if (request.params[1].isNull()) {</span></span>
<span id="L1772"><span class="lineNum">    1772</span>                 :<span class="tlaGNC">          10 :         LOCK(cs_main);</span></span>
<span id="L1773"><span class="lineNum">    1773</span>   [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 10 times"> + </span> :<span class="tlaGNC">          20 :         pindex = chainman.ActiveChain().Tip();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1774"><span class="lineNum">    1774</span>                 :<span class="tlaGNC">          10 :     } else {</span></span>
<span id="L1775"><span class="lineNum">    1775</span>                 :<span class="tlaGNC">           2 :         uint256 hash(ParseHashV(request.params[1], &quot;blockhash&quot;));</span></span>
<span id="L1776"><span class="lineNum">    1776</span>                 :<span class="tlaGNC">           2 :         LOCK(cs_main);</span></span>
<span id="L1777"><span class="lineNum">    1777</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :         pindex = chainman.m_blockman.LookupBlockIndex(hash);</span></span>
<span id="L1778"><span class="lineNum">    1778</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :         if (!pindex) {</span></span>
<span id="L1779"><span class="lineNum">    1779</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L1780"><span class="lineNum">    1780</span>                 :             :         }</span>
<span id="L1781"><span class="lineNum">    1781</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!chainman.ActiveChain().Contains(pindex)) {</span></span>
<span id="L1782"><span class="lineNum">    1782</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Block is not in main chain&quot;);</span></span>
<span id="L1783"><span class="lineNum">    1783</span>                 :             :         }</span>
<span id="L1784"><span class="lineNum">    1784</span>                 :<span class="tlaGNC">           2 :     }</span></span>
<span id="L1785"><span class="lineNum">    1785</span>                 :             : </span>
<span id="L1786"><span class="lineNum">    1786</span>                 :<span class="tlaGNC">          10 :     CHECK_NONFATAL(pindex != nullptr);</span></span>
<span id="L1787"><span class="lineNum">    1787</span>                 :             : </span>
<span id="L1788"><span class="lineNum">    1788</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 9 times"> + </span>]:<span class="tlaGNC">          10 :     if (request.params[0].isNull()) {</span></span>
<span id="L1789"><span class="lineNum">    1789</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span>]:<span class="tlaGNC">           2 :         blockcount = std::max(0, std::min(blockcount, pindex-&gt;nHeight - 1));</span></span>
<span id="L1790"><span class="lineNum">    1790</span>                 :             :     } else {</span>
<span id="L1791"><span class="lineNum">    1791</span>                 :<span class="tlaGNC">           9 :         blockcount = request.params[0].getInt&lt;int&gt;();</span></span>
<span id="L1792"><span class="lineNum">    1792</span>                 :             : </span>
<span id="L1793"><span class="lineNum">    1793</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 3 times"> + </span> :<span class="tlaGNC">           9 :         if (blockcount &lt; 0 || (blockcount &gt; 0 &amp;&amp; blockcount &gt;= pindex-&gt;nHeight)) {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 3 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1794"><span class="lineNum">    1794</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          12 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Invalid block count: should be between 0 and the block's height - 1&quot;);</span></span>
<span id="L1795"><span class="lineNum">    1795</span>                 :             :         }</span>
<span id="L1796"><span class="lineNum">    1796</span>                 :             :     }</span>
<span id="L1797"><span class="lineNum">    1797</span>                 :             : </span>
<span id="L1798"><span class="lineNum">    1798</span>                 :<span class="tlaGNC">           4 :     const CBlockIndex&amp; past_block{*CHECK_NONFATAL(pindex-&gt;GetAncestor(pindex-&gt;nHeight - blockcount))};</span></span>
<span id="L1799"><span class="lineNum">    1799</span>                 :<span class="tlaGNC">           4 :     const int64_t nTimeDiff{pindex-&gt;GetMedianTimePast() - past_block.GetMedianTimePast()};</span></span>
<span id="L1800"><span class="lineNum">    1800</span>                 :             : </span>
<span id="L1801"><span class="lineNum">    1801</span>                 :<span class="tlaGNC">           4 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L1802"><span class="lineNum">    1802</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     ret.pushKV(&quot;time&quot;, (int64_t)pindex-&gt;nTime);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1803"><span class="lineNum">    1803</span>         [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 :     if (pindex-&gt;m_chain_tx_count) {</span></span>
<span id="L1804"><span class="lineNum">    1804</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :         ret.pushKV(&quot;txcount&quot;, pindex-&gt;m_chain_tx_count);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1805"><span class="lineNum">    1805</span>                 :             :     }</span>
<span id="L1806"><span class="lineNum">    1806</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     ret.pushKV(&quot;window_final_block_hash&quot;, pindex-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1807"><span class="lineNum">    1807</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     ret.pushKV(&quot;window_final_block_height&quot;, pindex-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1808"><span class="lineNum">    1808</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           8 :     ret.pushKV(&quot;window_block_count&quot;, blockcount);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1809"><span class="lineNum">    1809</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 4 times"> + </span>]:<span class="tlaGNC">           4 :     if (blockcount &gt; 0) {</span></span>
<span id="L1810"><span class="lineNum">    1810</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;window_interval&quot;, nTimeDiff);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1811"><span class="lineNum">    1811</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (pindex-&gt;m_chain_tx_count != 0 &amp;&amp; past_block.m_chain_tx_count != 0) {</span></span>
<span id="L1812"><span class="lineNum">    1812</span>                 :<span class="tlaUNC">           0 :             const auto window_tx_count = pindex-&gt;m_chain_tx_count - past_block.m_chain_tx_count;</span></span>
<span id="L1813"><span class="lineNum">    1813</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             ret.pushKV(&quot;window_tx_count&quot;, window_tx_count);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1814"><span class="lineNum">    1814</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (nTimeDiff &gt; 0) {</span></span>
<span id="L1815"><span class="lineNum">    1815</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 ret.pushKV(&quot;txrate&quot;, double(window_tx_count) / nTimeDiff);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1816"><span class="lineNum">    1816</span>                 :             :             }</span>
<span id="L1817"><span class="lineNum">    1817</span>                 :             :         }</span>
<span id="L1818"><span class="lineNum">    1818</span>                 :             :     }</span>
<span id="L1819"><span class="lineNum">    1819</span>                 :             : </span>
<span id="L1820"><span class="lineNum">    1820</span>                 :<span class="tlaGNC">           4 :     return ret;</span></span>
<span id="L1821"><span class="lineNum">    1821</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L1822"><span class="lineNum">    1822</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         474 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 158 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1823"><span class="lineNum">    1823</span>   [<span class="tlaGBC" title="Branch 0 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         948 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 79 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 79 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 79 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaUNC" title="Branch 20 was not taken"> - </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaUNC" title="Branch 22 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not taken"> - </span>]
<span id="L1824"><span class="lineNum">    1824</span>                 :             : </span>
<span id="L1825"><span class="lineNum">    1825</span>                 :             : template&lt;typename T&gt;</span>
<span id="L1826"><span class="lineNum">    1826</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 270 times"> + </span>]:<span class="tlaGNC">         270 : static T CalculateTruncatedMedian(std::vector&lt;T&gt;&amp; scores)</span></span>
<span id="L1827"><span class="lineNum">    1827</span>                 :             : {</span>
<span id="L1828"><span class="lineNum">    1828</span>                 :<span class="tlaGNC">         270 :     size_t size = scores.size();</span></span>
<span id="L1829"><span class="lineNum">    1829</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 270 times"> + </span>]:<span class="tlaGNC">         270 :     if (size == 0) {</span></span>
<span id="L1830"><span class="lineNum">    1830</span>                 :             :         return 0;</span>
<span id="L1831"><span class="lineNum">    1831</span>                 :             :     }</span>
<span id="L1832"><span class="lineNum">    1832</span>                 :             : </span>
<span id="L1833"><span class="lineNum">    1833</span>                 :<span class="tlaUNC">           0 :     std::sort(scores.begin(), scores.end());</span></span>
<span id="L1834"><span class="lineNum">    1834</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (size % 2 == 0) {</span></span>
<span id="L1835"><span class="lineNum">    1835</span>                 :<span class="tlaUNC">           0 :         return (scores[size / 2 - 1] + scores[size / 2]) / 2;</span></span>
<span id="L1836"><span class="lineNum">    1836</span>                 :             :     } else {</span>
<span id="L1837"><span class="lineNum">    1837</span>                 :<span class="tlaUNC">           0 :         return scores[size / 2];</span></span>
<span id="L1838"><span class="lineNum">    1838</span>                 :             :     }</span>
<span id="L1839"><span class="lineNum">    1839</span>                 :             : }</span>
<span id="L1840"><span class="lineNum">    1840</span>                 :             : </span>
<span id="L1841"><span class="lineNum">    1841</span>                 :<span class="tlaGNC">         135 : void CalculatePercentilesByWeight(CAmount result[NUM_GETBLOCKSTATS_PERCENTILES], std::vector&lt;std::pair&lt;CAmount, int64_t&gt;&gt;&amp; scores, int64_t total_weight)</span></span>
<span id="L1842"><span class="lineNum">    1842</span>                 :             : {</span>
<span id="L1843"><span class="lineNum">    1843</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span>]:<span class="tlaGNC">         135 :     if (scores.empty()) {</span></span>
<span id="L1844"><span class="lineNum">    1844</span>                 :             :         return;</span>
<span id="L1845"><span class="lineNum">    1845</span>                 :             :     }</span>
<span id="L1846"><span class="lineNum">    1846</span>                 :             : </span>
<span id="L1847"><span class="lineNum">    1847</span>                 :<span class="tlaUNC">           0 :     std::sort(scores.begin(), scores.end());</span></span>
<span id="L1848"><span class="lineNum">    1848</span>                 :             : </span>
<span id="L1849"><span class="lineNum">    1849</span>                 :             :     // 10th, 25th, 50th, 75th, and 90th percentile weight units.</span>
<span id="L1850"><span class="lineNum">    1850</span>                 :<span class="tlaUNC">           0 :     const double weights[NUM_GETBLOCKSTATS_PERCENTILES] = {</span></span>
<span id="L1851"><span class="lineNum">    1851</span>                 :<span class="tlaUNC">           0 :         total_weight / 10.0, total_weight / 4.0, total_weight / 2.0, (total_weight * 3.0) / 4.0, (total_weight * 9.0) / 10.0</span></span>
<span id="L1852"><span class="lineNum">    1852</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L1853"><span class="lineNum">    1853</span>                 :             : </span>
<span id="L1854"><span class="lineNum">    1854</span>                 :<span class="tlaUNC">           0 :     int64_t next_percentile_index = 0;</span></span>
<span id="L1855"><span class="lineNum">    1855</span>                 :<span class="tlaUNC">           0 :     int64_t cumulative_weight = 0;</span></span>
<span id="L1856"><span class="lineNum">    1856</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const auto&amp; element : scores) {</span></span>
<span id="L1857"><span class="lineNum">    1857</span>                 :<span class="tlaUNC">           0 :         cumulative_weight += element.second;</span></span>
<span id="L1858"><span class="lineNum">    1858</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         while (next_percentile_index &lt; NUM_GETBLOCKSTATS_PERCENTILES &amp;&amp; cumulative_weight &gt;= weights[next_percentile_index]) {</span></span>
<span id="L1859"><span class="lineNum">    1859</span>                 :<span class="tlaUNC">           0 :             result[next_percentile_index] = element.first;</span></span>
<span id="L1860"><span class="lineNum">    1860</span>                 :<span class="tlaUNC">           0 :             ++next_percentile_index;</span></span>
<span id="L1861"><span class="lineNum">    1861</span>                 :             :         }</span>
<span id="L1862"><span class="lineNum">    1862</span>                 :             :     }</span>
<span id="L1863"><span class="lineNum">    1863</span>                 :             : </span>
<span id="L1864"><span class="lineNum">    1864</span>                 :             :     // Fill any remaining percentiles with the last value.</span>
<span id="L1865"><span class="lineNum">    1865</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (int64_t i = next_percentile_index; i &lt; NUM_GETBLOCKSTATS_PERCENTILES; i++) {</span></span>
<span id="L1866"><span class="lineNum">    1866</span>                 :<span class="tlaUNC">           0 :         result[i] = scores.back().first;</span></span>
<span id="L1867"><span class="lineNum">    1867</span>                 :             :     }</span>
<span id="L1868"><span class="lineNum">    1868</span>                 :             : }</span>
<span id="L1869"><span class="lineNum">    1869</span>                 :             : </span>
<span id="L1870"><span class="lineNum">    1870</span>                 :             : template&lt;typename T&gt;</span>
<span id="L1871"><span class="lineNum">    1871</span>                 :             : static inline bool SetHasKeys(const std::set&lt;T&gt;&amp; set) {return false;}</span>
<span id="L1872"><span class="lineNum">    1872</span>                 :             : template&lt;typename T, typename Tk, typename... Args&gt;</span>
<span id="L1873"><span class="lineNum">    1873</span>                 :<span class="tlaGNC">        3254 : static inline bool SetHasKeys(const std::set&lt;T&gt;&amp; set, const Tk&amp; key, const Args&amp;... args)</span></span>
<span id="L1874"><span class="lineNum">    1874</span>                 :             : {</span>
<span id="L1875"><span class="lineNum">    1875</span>   [<span class="tlaGBC" title="Branch 0 was taken 2734 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 520 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2724 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        6034 :     return (set.count(key) != 0) || SetHasKeys(set, args...);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 314 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 2410 times"> + </span>]
<span id="L1876"><span class="lineNum">    1876</span>                 :             : }</span>
<span id="L1877"><span class="lineNum">    1877</span>                 :             : </span>
<span id="L1878"><span class="lineNum">    1878</span>                 :             : // outpoint (needed for the utxo index) + nHeight + fCoinBase</span>
<span id="L1879"><span class="lineNum">    1879</span>                 :             : static constexpr size_t PER_UTXO_OVERHEAD = sizeof(COutPoint) + sizeof(uint32_t) + sizeof(bool);</span>
<span id="L1880"><span class="lineNum">    1880</span>                 :             : </span>
<span id="L1881"><span class="lineNum">    1881</span>                 :<span class="tlaGNC">         219 : static RPCHelpMan getblockstats()</span></span>
<span id="L1882"><span class="lineNum">    1882</span>                 :             : {</span>
<span id="L1883"><span class="lineNum">    1883</span>                 :<span class="tlaGNC">         219 :     return RPCHelpMan{</span></span>
<span id="L1884"><span class="lineNum">    1884</span>                 :<span class="tlaGNC">         219 :         &quot;getblockstats&quot;,</span></span>
<span id="L1885"><span class="lineNum">    1885</span>         [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         438 :         &quot;Compute per block statistics for a given window. All amounts are in satoshis.\n&quot;</span></span>
<span id="L1886"><span class="lineNum">    1886</span>                 :             :                 &quot;It won't work for some heights with pruning.\n&quot;,</span>
<span id="L1887"><span class="lineNum">    1887</span>                 :             :                 {</span>
<span id="L1888"><span class="lineNum">    1888</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {&quot;hash_or_height&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;The block hash or height of the target block&quot;,</span></span>
<span id="L1889"><span class="lineNum">    1889</span>         [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         438 :                      RPCArgOptions{</span></span>
<span id="L1890"><span class="lineNum">    1890</span>                 :             :                          .skip_type_check = true,</span>
<span id="L1891"><span class="lineNum">    1891</span>                 :             :                          .type_str = {&quot;&quot;, &quot;string or numeric&quot;},</span>
<span id="L1892"><span class="lineNum">    1892</span>                 :             :                      }},</span>
<span id="L1893"><span class="lineNum">    1893</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         657 :                     {&quot;stats&quot;, RPCArg::Type::ARR, RPCArg::DefaultHint{&quot;all values&quot;}, &quot;Values to plot (see result below)&quot;,</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1894"><span class="lineNum">    1894</span>                 :             :                         {</span>
<span id="L1895"><span class="lineNum">    1895</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                             {&quot;height&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;Selected statistic&quot;},</span></span>
<span id="L1896"><span class="lineNum">    1896</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                             {&quot;time&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;Selected statistic&quot;},</span></span>
<span id="L1897"><span class="lineNum">    1897</span>                 :             :                         },</span>
<span id="L1898"><span class="lineNum">    1898</span>         [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         219 :                         RPCArgOptions{.oneline_description=&quot;stats&quot;}},</span></span>
<span id="L1899"><span class="lineNum">    1899</span>                 :             :                 },</span>
<span id="L1900"><span class="lineNum">    1900</span>         [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 RPCResult{</span></span>
<span id="L1901"><span class="lineNum">    1901</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L1902"><span class="lineNum">    1902</span>                 :             :             {</span>
<span id="L1903"><span class="lineNum">    1903</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;avgfee&quot;, /*optional=*/true, &quot;Average fee in the block&quot;},</span></span>
<span id="L1904"><span class="lineNum">    1904</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;avgfeerate&quot;, /*optional=*/true, &quot;Average feerate (in satoshis per virtual byte)&quot;},</span></span>
<span id="L1905"><span class="lineNum">    1905</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;avgtxsize&quot;, /*optional=*/true, &quot;Average transaction size&quot;},</span></span>
<span id="L1906"><span class="lineNum">    1906</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::STR_HEX, &quot;blockhash&quot;, /*optional=*/true, &quot;The block hash (to check for potential reorgs)&quot;},</span></span>
<span id="L1907"><span class="lineNum">    1907</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::ARR_FIXED, &quot;feerate_percentiles&quot;, /*optional=*/true, &quot;Feerates at the 10th, 25th, 50th, 75th, and 90th percentile weight unit (in satoshis per virtual byte)&quot;,</span></span>
<span id="L1908"><span class="lineNum">    1908</span>                 :             :                 {</span>
<span id="L1909"><span class="lineNum">    1909</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {RPCResult::Type::NUM, &quot;10th_percentile_feerate&quot;, &quot;The 10th percentile feerate&quot;},</span></span>
<span id="L1910"><span class="lineNum">    1910</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {RPCResult::Type::NUM, &quot;25th_percentile_feerate&quot;, &quot;The 25th percentile feerate&quot;},</span></span>
<span id="L1911"><span class="lineNum">    1911</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {RPCResult::Type::NUM, &quot;50th_percentile_feerate&quot;, &quot;The 50th percentile feerate&quot;},</span></span>
<span id="L1912"><span class="lineNum">    1912</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {RPCResult::Type::NUM, &quot;75th_percentile_feerate&quot;, &quot;The 75th percentile feerate&quot;},</span></span>
<span id="L1913"><span class="lineNum">    1913</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                     {RPCResult::Type::NUM, &quot;90th_percentile_feerate&quot;, &quot;The 90th percentile feerate&quot;},</span></span>
<span id="L1914"><span class="lineNum">    1914</span>                 :             :                 }},</span>
<span id="L1915"><span class="lineNum">    1915</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;height&quot;, /*optional=*/true, &quot;The height of the block&quot;},</span></span>
<span id="L1916"><span class="lineNum">    1916</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;ins&quot;, /*optional=*/true, &quot;The number of inputs (excluding coinbase)&quot;},</span></span>
<span id="L1917"><span class="lineNum">    1917</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;maxfee&quot;, /*optional=*/true, &quot;Maximum fee in the block&quot;},</span></span>
<span id="L1918"><span class="lineNum">    1918</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;maxfeerate&quot;, /*optional=*/true, &quot;Maximum feerate (in satoshis per virtual byte)&quot;},</span></span>
<span id="L1919"><span class="lineNum">    1919</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;maxtxsize&quot;, /*optional=*/true, &quot;Maximum transaction size&quot;},</span></span>
<span id="L1920"><span class="lineNum">    1920</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;medianfee&quot;, /*optional=*/true, &quot;Truncated median fee in the block&quot;},</span></span>
<span id="L1921"><span class="lineNum">    1921</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;mediantime&quot;, /*optional=*/true, &quot;The block median time past&quot;},</span></span>
<span id="L1922"><span class="lineNum">    1922</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;mediantxsize&quot;, /*optional=*/true, &quot;Truncated median transaction size&quot;},</span></span>
<span id="L1923"><span class="lineNum">    1923</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;minfee&quot;, /*optional=*/true, &quot;Minimum fee in the block&quot;},</span></span>
<span id="L1924"><span class="lineNum">    1924</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;minfeerate&quot;, /*optional=*/true, &quot;Minimum feerate (in satoshis per virtual byte)&quot;},</span></span>
<span id="L1925"><span class="lineNum">    1925</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;mintxsize&quot;, /*optional=*/true, &quot;Minimum transaction size&quot;},</span></span>
<span id="L1926"><span class="lineNum">    1926</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;outs&quot;, /*optional=*/true, &quot;The number of outputs&quot;},</span></span>
<span id="L1927"><span class="lineNum">    1927</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;subsidy&quot;, /*optional=*/true, &quot;The block subsidy&quot;},</span></span>
<span id="L1928"><span class="lineNum">    1928</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;swtotal_size&quot;, /*optional=*/true, &quot;Total size of all segwit transactions&quot;},</span></span>
<span id="L1929"><span class="lineNum">    1929</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;swtotal_weight&quot;, /*optional=*/true, &quot;Total weight of all segwit transactions&quot;},</span></span>
<span id="L1930"><span class="lineNum">    1930</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;swtxs&quot;, /*optional=*/true, &quot;The number of segwit transactions&quot;},</span></span>
<span id="L1931"><span class="lineNum">    1931</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;time&quot;, /*optional=*/true, &quot;The block time&quot;},</span></span>
<span id="L1932"><span class="lineNum">    1932</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;total_out&quot;, /*optional=*/true, &quot;Total amount in all outputs (excluding coinbase and thus reward [ie subsidy + totalfee])&quot;},</span></span>
<span id="L1933"><span class="lineNum">    1933</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;total_size&quot;, /*optional=*/true, &quot;Total size of all non-coinbase transactions&quot;},</span></span>
<span id="L1934"><span class="lineNum">    1934</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;total_weight&quot;, /*optional=*/true, &quot;Total weight of all non-coinbase transactions&quot;},</span></span>
<span id="L1935"><span class="lineNum">    1935</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;totalfee&quot;, /*optional=*/true, &quot;The fee total&quot;},</span></span>
<span id="L1936"><span class="lineNum">    1936</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;txs&quot;, /*optional=*/true, &quot;The number of transactions (including coinbase)&quot;},</span></span>
<span id="L1937"><span class="lineNum">    1937</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;utxo_increase&quot;, /*optional=*/true, &quot;The increase/decrease in the number of unspent outputs (not discounting op_return and similar)&quot;},</span></span>
<span id="L1938"><span class="lineNum">    1938</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;utxo_size_inc&quot;, /*optional=*/true, &quot;The increase/decrease in size for the utxo index (not discounting op_return and similar)&quot;},</span></span>
<span id="L1939"><span class="lineNum">    1939</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;utxo_increase_actual&quot;, /*optional=*/true, &quot;The increase/decrease in the number of unspent outputs, not counting unspendables&quot;},</span></span>
<span id="L1940"><span class="lineNum">    1940</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         438 :                 {RPCResult::Type::NUM, &quot;utxo_size_inc_actual&quot;, /*optional=*/true, &quot;The increase/decrease in size for the utxo index, not counting unspendables&quot;},</span></span>
<span id="L1941"><span class="lineNum">    1941</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">       15987 :             }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 6789 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 219 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 1095 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 9 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not taken"> - </span>]
<span id="L1942"><span class="lineNum">    1942</span>                 :<span class="tlaGNC">         219 :                 RPCExamples{</span></span>
<span id="L1943"><span class="lineNum">    1943</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         438 :                     HelpExampleCli(&quot;getblockstats&quot;, R&quot;('&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09&quot;' '[&quot;minfeerate&quot;,&quot;avgfeerate&quot;]')&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1944"><span class="lineNum">    1944</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         876 :                     HelpExampleCli(&quot;getblockstats&quot;, R&quot;(1000 '[&quot;minfeerate&quot;,&quot;avgfeerate&quot;]')&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1945"><span class="lineNum">    1945</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         876 :                     HelpExampleRpc(&quot;getblockstats&quot;, R&quot;(&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09&quot;, [&quot;minfeerate&quot;,&quot;avgfeerate&quot;])&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1946"><span class="lineNum">    1946</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         657 :                     HelpExampleRpc(&quot;getblockstats&quot;, R&quot;(1000, [&quot;minfeerate&quot;,&quot;avgfeerate&quot;])&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1947"><span class="lineNum">    1947</span>         [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         219 :                 },</span></span>
<span id="L1948"><span class="lineNum">    1948</span>                 :<span class="tlaGNC">         219 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1949"><span class="lineNum">    1949</span>                 :             : {</span>
<span id="L1950"><span class="lineNum">    1950</span>                 :<span class="tlaGNC">         150 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L1951"><span class="lineNum">    1951</span>                 :<span class="tlaGNC">         150 :     const CBlockIndex&amp; pindex{*CHECK_NONFATAL(ParseHashOrHeight(request.params[0], chainman))};</span></span>
<span id="L1952"><span class="lineNum">    1952</span>                 :             : </span>
<span id="L1953"><span class="lineNum">    1953</span>         [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :     std::set&lt;std::string&gt; stats;</span></span>
<span id="L1954"><span class="lineNum">    1954</span>   [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span>]:<span class="tlaGNC">         136 :     if (!request.params[1].isNull()) {</span></span>
<span id="L1955"><span class="lineNum">    1955</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         135 :         const UniValue stats_univalue = request.params[1].get_array();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1956"><span class="lineNum">    1956</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 3350 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 3216 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 134 times"> + </span>]:<span class="tlaGNC">        3350 :         for (unsigned int i = 0; i &lt; stats_univalue.size(); i++) {</span></span>
<span id="L1957"><span class="lineNum">    1957</span>   [<span class="tlaGBC" title="Branch 0 was taken 3216 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 3215 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">        3216 :             const std::string stat = stats_univalue[i].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaGBC" title="Branch 5 was taken 3215 times"> + </span>]
<span id="L1958"><span class="lineNum">    1958</span>         [<span class="tlaGBC" title="Branch 0 was taken 3215 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        3215 :             stats.insert(stat);</span></span>
<span id="L1959"><span class="lineNum">    1959</span>                 :<span class="tlaGNC">        3215 :         }</span></span>
<span id="L1960"><span class="lineNum">    1960</span>                 :<span class="tlaGNC">         135 :     }</span></span>
<span id="L1961"><span class="lineNum">    1961</span>                 :             : </span>
<span id="L1962"><span class="lineNum">    1962</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :     const CBlock&amp; block = GetBlockChecked(chainman.m_blockman, pindex);</span></span>
<span id="L1963"><span class="lineNum">    1963</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :     const CBlockUndo&amp; blockUndo = GetUndoChecked(chainman.m_blockman, pindex);</span></span>
<span id="L1964"><span class="lineNum">    1964</span>                 :             : </span>
<span id="L1965"><span class="lineNum">    1965</span>         [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span>]:<span class="tlaGNC">         135 :     const bool do_all = stats.size() == 0; // Calculate everything if nothing selected (default)</span></span>
<span id="L1966"><span class="lineNum">    1966</span>   [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         269 :     const bool do_mediantxsize = do_all || stats.count(&quot;mediantxsize&quot;) != 0;</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 130 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 4 times"> + </span>]
<span id="L1967"><span class="lineNum">    1967</span>   [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         269 :     const bool do_medianfee = do_all || stats.count(&quot;medianfee&quot;) != 0;</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 133 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 1 time"> + </span>]
<span id="L1968"><span class="lineNum">    1968</span>   [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         269 :     const bool do_feerate_percentiles = do_all || stats.count(&quot;feerate_percentiles&quot;) != 0;</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 133 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 1 time"> + </span>]
<span id="L1969"><span class="lineNum">    1969</span>   [<span class="tlaGBC" title="Branch 0 was taken 133 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 132 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">         267 :     const bool loop_inputs = do_all || do_medianfee || do_feerate_percentiles ||</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 96 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 36 times"> + </span>]
<span id="L1970"><span class="lineNum">    1970</span>   [<span class="tlaGBC" title="Branch 0 was taken 132 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 130 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 5 times"> + </span>]:<span class="tlaGNC">         267 :         SetHasKeys(stats, &quot;utxo_increase&quot;, &quot;utxo_increase_actual&quot;, &quot;utxo_size_inc&quot;, &quot;utxo_size_inc_actual&quot;, &quot;totalfee&quot;, &quot;avgfee&quot;, &quot;avgfeerate&quot;, &quot;minfee&quot;, &quot;maxfee&quot;, &quot;minfeerate&quot;, &quot;maxfeerate&quot;);</span></span>
<span id="L1971"><span class="lineNum">    1971</span>   [<span class="tlaGBC" title="Branch 0 was taken 96 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 3 times"> + </span>]:<span class="tlaGNC">         192 :     const bool loop_outputs = do_all || loop_inputs || stats.count(&quot;total_out&quot;);</span></span>
<span id="L1972"><span class="lineNum">    1972</span>   [<span class="tlaGBC" title="Branch 0 was taken 130 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 5 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 9 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 121 times"> + </span>]:<span class="tlaGNC">         265 :     const bool do_calculate_size = do_mediantxsize ||</span></span>
<span id="L1973"><span class="lineNum">    1973</span>         [<span class="tlaGBC" title="Branch 0 was taken 130 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         130 :         SetHasKeys(stats, &quot;total_size&quot;, &quot;avgtxsize&quot;, &quot;mintxsize&quot;, &quot;maxtxsize&quot;, &quot;swtotal_size&quot;);</span></span>
<span id="L1974"><span class="lineNum">    1974</span>   [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 2 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         135 :     const bool do_calculate_weight = do_all || SetHasKeys(stats, &quot;total_weight&quot;, &quot;avgfeerate&quot;, &quot;swtotal_weight&quot;, &quot;avgfeerate&quot;, &quot;feerate_percentiles&quot;, &quot;minfeerate&quot;, &quot;maxfeerate&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 16 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 118 times"> + </span>]
<span id="L1975"><span class="lineNum">    1975</span>   [<span class="tlaGBC" title="Branch 0 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 134 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         134 :     const bool do_calculate_sw = do_all || SetHasKeys(stats, &quot;swtxs&quot;, &quot;swtotal_size&quot;, &quot;swtotal_weight&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 5 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 129 times"> + </span>]
<span id="L1976"><span class="lineNum">    1976</span>                 :             : </span>
<span id="L1977"><span class="lineNum">    1977</span>                 :<span class="tlaGNC">         135 :     CAmount maxfee = 0;</span></span>
<span id="L1978"><span class="lineNum">    1978</span>                 :<span class="tlaGNC">         135 :     CAmount maxfeerate = 0;</span></span>
<span id="L1979"><span class="lineNum">    1979</span>                 :<span class="tlaGNC">         135 :     CAmount minfee = MAX_MONEY;</span></span>
<span id="L1980"><span class="lineNum">    1980</span>                 :<span class="tlaGNC">         135 :     CAmount minfeerate = MAX_MONEY;</span></span>
<span id="L1981"><span class="lineNum">    1981</span>                 :<span class="tlaGNC">         135 :     CAmount total_out = 0;</span></span>
<span id="L1982"><span class="lineNum">    1982</span>                 :<span class="tlaGNC">         135 :     CAmount totalfee = 0;</span></span>
<span id="L1983"><span class="lineNum">    1983</span>                 :<span class="tlaGNC">         135 :     int64_t inputs = 0;</span></span>
<span id="L1984"><span class="lineNum">    1984</span>                 :<span class="tlaGNC">         135 :     int64_t maxtxsize = 0;</span></span>
<span id="L1985"><span class="lineNum">    1985</span>                 :<span class="tlaGNC">         135 :     int64_t mintxsize = MAX_BLOCK_SERIALIZED_SIZE;</span></span>
<span id="L1986"><span class="lineNum">    1986</span>                 :<span class="tlaGNC">         135 :     int64_t outputs = 0;</span></span>
<span id="L1987"><span class="lineNum">    1987</span>                 :<span class="tlaGNC">         135 :     int64_t swtotal_size = 0;</span></span>
<span id="L1988"><span class="lineNum">    1988</span>                 :<span class="tlaGNC">         135 :     int64_t swtotal_weight = 0;</span></span>
<span id="L1989"><span class="lineNum">    1989</span>                 :<span class="tlaGNC">         135 :     int64_t swtxs = 0;</span></span>
<span id="L1990"><span class="lineNum">    1990</span>                 :<span class="tlaGNC">         135 :     int64_t total_size = 0;</span></span>
<span id="L1991"><span class="lineNum">    1991</span>                 :<span class="tlaGNC">         135 :     int64_t total_weight = 0;</span></span>
<span id="L1992"><span class="lineNum">    1992</span>                 :<span class="tlaGNC">         135 :     int64_t utxos = 0;</span></span>
<span id="L1993"><span class="lineNum">    1993</span>                 :<span class="tlaGNC">         135 :     int64_t utxo_size_inc = 0;</span></span>
<span id="L1994"><span class="lineNum">    1994</span>                 :<span class="tlaGNC">         135 :     int64_t utxo_size_inc_actual = 0;</span></span>
<span id="L1995"><span class="lineNum">    1995</span>                 :<span class="tlaGNC">         135 :     std::vector&lt;CAmount&gt; fee_array;</span></span>
<span id="L1996"><span class="lineNum">    1996</span>                 :<span class="tlaGNC">         135 :     std::vector&lt;std::pair&lt;CAmount, int64_t&gt;&gt; feerate_array;</span></span>
<span id="L1997"><span class="lineNum">    1997</span>                 :<span class="tlaGNC">         135 :     std::vector&lt;int64_t&gt; txsize_array;</span></span>
<span id="L1998"><span class="lineNum">    1998</span>                 :             : </span>
<span id="L1999"><span class="lineNum">    1999</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 270 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 135 times"> + </span>]:<span class="tlaGNC">         270 :     for (size_t i = 0; i &lt; block.vtx.size(); ++i) {</span></span>
<span id="L2000"><span class="lineNum">    2000</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :         const auto&amp; tx = block.vtx.at(i);</span></span>
<span id="L2001"><span class="lineNum">    2001</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span>]:<span class="tlaGNC">         135 :         outputs += tx-&gt;vout.size();</span></span>
<span id="L2002"><span class="lineNum">    2002</span>                 :             : </span>
<span id="L2003"><span class="lineNum">    2003</span>                 :<span class="tlaGNC">         135 :         CAmount tx_total_out = 0;</span></span>
<span id="L2004"><span class="lineNum">    2004</span>         [<span class="tlaGBC" title="Branch 0 was taken 42 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 93 times"> + </span>]:<span class="tlaGNC">         135 :         if (loop_outputs) {</span></span>
<span id="L2005"><span class="lineNum">    2005</span>         [<span class="tlaGBC" title="Branch 0 was taken 42 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 42 times"> + </span>]:<span class="tlaGNC">          84 :             for (const CTxOut&amp; out : tx-&gt;vout) {</span></span>
<span id="L2006"><span class="lineNum">    2006</span>                 :<span class="tlaGNC">          42 :                 tx_total_out += out.nValue;</span></span>
<span id="L2007"><span class="lineNum">    2007</span>                 :             : </span>
<span id="L2008"><span class="lineNum">    2008</span>                 :<span class="tlaGNC">          42 :                 size_t out_size = GetSerializeSize(out) + PER_UTXO_OVERHEAD;</span></span>
<span id="L2009"><span class="lineNum">    2009</span>                 :<span class="tlaGNC">          42 :                 utxo_size_inc += out_size;</span></span>
<span id="L2010"><span class="lineNum">    2010</span>                 :             : </span>
<span id="L2011"><span class="lineNum">    2011</span>                 :             :                 // The Genesis block and the repeated BIP30 block coinbases don't change the UTXO</span>
<span id="L2012"><span class="lineNum">    2012</span>                 :             :                 // set counts, so they have to be excluded from the statistics</span>
<span id="L2013"><span class="lineNum">    2013</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 42 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          42 :                 if (pindex.nHeight == 0 || (IsBIP30Repeat(pindex) &amp;&amp; tx-&gt;IsCoinBase())) continue;</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2014"><span class="lineNum">    2014</span>                 :             :                 // Skip unspendable outputs since they are not included in the UTXO set</span>
<span id="L2015"><span class="lineNum">    2015</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (out.scriptPubKey.IsUnspendable()) continue;</span></span>
<span id="L2016"><span class="lineNum">    2016</span>                 :             : </span>
<span id="L2017"><span class="lineNum">    2017</span>                 :<span class="tlaUNC">           0 :                 ++utxos;</span></span>
<span id="L2018"><span class="lineNum">    2018</span>                 :<span class="tlaUNC">           0 :                 utxo_size_inc_actual += out_size;</span></span>
<span id="L2019"><span class="lineNum">    2019</span>                 :             :             }</span>
<span id="L2020"><span class="lineNum">    2020</span>                 :             :         }</span>
<span id="L2021"><span class="lineNum">    2021</span>                 :             : </span>
<span id="L2022"><span class="lineNum">    2022</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :         if (tx-&gt;IsCoinBase()) {</span></span>
<span id="L2023"><span class="lineNum">    2023</span>                 :<span class="tlaGNC">         135 :             continue;</span></span>
<span id="L2024"><span class="lineNum">    2024</span>                 :             :         }</span>
<span id="L2025"><span class="lineNum">    2025</span>                 :             : </span>
<span id="L2026"><span class="lineNum">    2026</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         inputs += tx-&gt;vin.size(); // Don't count coinbase's fake input</span></span>
<span id="L2027"><span class="lineNum">    2027</span>                 :<span class="tlaUNC">           0 :         total_out += tx_total_out; // Don't count coinbase reward</span></span>
<span id="L2028"><span class="lineNum">    2028</span>                 :             : </span>
<span id="L2029"><span class="lineNum">    2029</span>                 :<span class="tlaUNC">           0 :         int64_t tx_size = 0;</span></span>
<span id="L2030"><span class="lineNum">    2030</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (do_calculate_size) {</span></span>
<span id="L2031"><span class="lineNum">    2031</span>                 :             : </span>
<span id="L2032"><span class="lineNum">    2032</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             tx_size = tx-&gt;GetTotalSize();</span></span>
<span id="L2033"><span class="lineNum">    2033</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (do_mediantxsize) {</span></span>
<span id="L2034"><span class="lineNum">    2034</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 txsize_array.push_back(tx_size);</span></span>
<span id="L2035"><span class="lineNum">    2035</span>                 :             :             }</span>
<span id="L2036"><span class="lineNum">    2036</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             maxtxsize = std::max(maxtxsize, tx_size);</span></span>
<span id="L2037"><span class="lineNum">    2037</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             mintxsize = std::min(mintxsize, tx_size);</span></span>
<span id="L2038"><span class="lineNum">    2038</span>                 :<span class="tlaUNC">           0 :             total_size += tx_size;</span></span>
<span id="L2039"><span class="lineNum">    2039</span>                 :             :         }</span>
<span id="L2040"><span class="lineNum">    2040</span>                 :             : </span>
<span id="L2041"><span class="lineNum">    2041</span>                 :<span class="tlaUNC">           0 :         int64_t weight = 0;</span></span>
<span id="L2042"><span class="lineNum">    2042</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (do_calculate_weight) {</span></span>
<span id="L2043"><span class="lineNum">    2043</span>                 :<span class="tlaUNC">           0 :             weight = GetTransactionWeight(*tx);</span></span>
<span id="L2044"><span class="lineNum">    2044</span>                 :<span class="tlaUNC">           0 :             total_weight += weight;</span></span>
<span id="L2045"><span class="lineNum">    2045</span>                 :             :         }</span>
<span id="L2046"><span class="lineNum">    2046</span>                 :             : </span>
<span id="L2047"><span class="lineNum">    2047</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (do_calculate_sw &amp;&amp; tx-&gt;HasWitness()) {</span></span>
<span id="L2048"><span class="lineNum">    2048</span>                 :<span class="tlaUNC">           0 :             ++swtxs;</span></span>
<span id="L2049"><span class="lineNum">    2049</span>                 :<span class="tlaUNC">           0 :             swtotal_size += tx_size;</span></span>
<span id="L2050"><span class="lineNum">    2050</span>                 :<span class="tlaUNC">           0 :             swtotal_weight += weight;</span></span>
<span id="L2051"><span class="lineNum">    2051</span>                 :             :         }</span>
<span id="L2052"><span class="lineNum">    2052</span>                 :             : </span>
<span id="L2053"><span class="lineNum">    2053</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (loop_inputs) {</span></span>
<span id="L2054"><span class="lineNum">    2054</span>                 :<span class="tlaUNC">           0 :             CAmount tx_total_in = 0;</span></span>
<span id="L2055"><span class="lineNum">    2055</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const auto&amp; txundo = blockUndo.vtxundo.at(i - 1);</span></span>
<span id="L2056"><span class="lineNum">    2056</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const Coin&amp; coin: txundo.vprevout) {</span></span>
<span id="L2057"><span class="lineNum">    2057</span>                 :<span class="tlaUNC">           0 :                 const CTxOut&amp; prevoutput = coin.out;</span></span>
<span id="L2058"><span class="lineNum">    2058</span>                 :             : </span>
<span id="L2059"><span class="lineNum">    2059</span>                 :<span class="tlaUNC">           0 :                 tx_total_in += prevoutput.nValue;</span></span>
<span id="L2060"><span class="lineNum">    2060</span>                 :<span class="tlaUNC">           0 :                 size_t prevout_size = GetSerializeSize(prevoutput) + PER_UTXO_OVERHEAD;</span></span>
<span id="L2061"><span class="lineNum">    2061</span>                 :<span class="tlaUNC">           0 :                 utxo_size_inc -= prevout_size;</span></span>
<span id="L2062"><span class="lineNum">    2062</span>                 :<span class="tlaUNC">           0 :                 utxo_size_inc_actual -= prevout_size;</span></span>
<span id="L2063"><span class="lineNum">    2063</span>                 :             :             }</span>
<span id="L2064"><span class="lineNum">    2064</span>                 :             : </span>
<span id="L2065"><span class="lineNum">    2065</span>                 :<span class="tlaUNC">           0 :             CAmount txfee = tx_total_in - tx_total_out;</span></span>
<span id="L2066"><span class="lineNum">    2066</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CHECK_NONFATAL(MoneyRange(txfee));</span></span>
<span id="L2067"><span class="lineNum">    2067</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (do_medianfee) {</span></span>
<span id="L2068"><span class="lineNum">    2068</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 fee_array.push_back(txfee);</span></span>
<span id="L2069"><span class="lineNum">    2069</span>                 :             :             }</span>
<span id="L2070"><span class="lineNum">    2070</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             maxfee = std::max(maxfee, txfee);</span></span>
<span id="L2071"><span class="lineNum">    2071</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             minfee = std::min(minfee, txfee);</span></span>
<span id="L2072"><span class="lineNum">    2072</span>                 :<span class="tlaUNC">           0 :             totalfee += txfee;</span></span>
<span id="L2073"><span class="lineNum">    2073</span>                 :             : </span>
<span id="L2074"><span class="lineNum">    2074</span>                 :             :             // New feerate uses satoshis per virtual byte instead of per serialized byte</span>
<span id="L2075"><span class="lineNum">    2075</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CAmount feerate = weight ? (txfee * WITNESS_SCALE_FACTOR) / weight : 0;</span></span>
<span id="L2076"><span class="lineNum">    2076</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (do_feerate_percentiles) {</span></span>
<span id="L2077"><span class="lineNum">    2077</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 feerate_array.emplace_back(feerate, weight);</span></span>
<span id="L2078"><span class="lineNum">    2078</span>                 :             :             }</span>
<span id="L2079"><span class="lineNum">    2079</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             maxfeerate = std::max(maxfeerate, feerate);</span></span>
<span id="L2080"><span class="lineNum">    2080</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             minfeerate = std::min(minfeerate, feerate);</span></span>
<span id="L2081"><span class="lineNum">    2081</span>                 :             :         }</span>
<span id="L2082"><span class="lineNum">    2082</span>                 :             :     }</span>
<span id="L2083"><span class="lineNum">    2083</span>                 :             : </span>
<span id="L2084"><span class="lineNum">    2084</span>                 :<span class="tlaGNC">         135 :     CAmount feerate_percentiles[NUM_GETBLOCKSTATS_PERCENTILES] = { 0 };</span></span>
<span id="L2085"><span class="lineNum">    2085</span>         [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         135 :     CalculatePercentilesByWeight(feerate_percentiles, feerate_array, total_weight);</span></span>
<span id="L2086"><span class="lineNum">    2086</span>                 :             : </span>
<span id="L2087"><span class="lineNum">    2087</span>                 :<span class="tlaGNC">         135 :     UniValue feerates_res(UniValue::VARR);</span></span>
<span id="L2088"><span class="lineNum">    2088</span>         [<span class="tlaGBC" title="Branch 0 was taken 675 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span>]:<span class="tlaGNC">         810 :     for (int64_t i = 0; i &lt; NUM_GETBLOCKSTATS_PERCENTILES; i++) {</span></span>
<span id="L2089"><span class="lineNum">    2089</span>   [<span class="tlaGBC" title="Branch 0 was taken 675 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 675 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         675 :         feerates_res.push_back(feerate_percentiles[i]);</span></span>
<span id="L2090"><span class="lineNum">    2090</span>                 :             :     }</span>
<span id="L2091"><span class="lineNum">    2091</span>                 :             : </span>
<span id="L2092"><span class="lineNum">    2092</span>                 :<span class="tlaGNC">         135 :     UniValue ret_all(UniValue::VOBJ);</span></span>
<span id="L2093"><span class="lineNum">    2093</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 135 times"> + </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;avgfee&quot;, (block.vtx.size() &gt; 1) ? totalfee / (block.vtx.size() - 1) : 0);</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 135 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L2094"><span class="lineNum">    2094</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;avgfeerate&quot;, total_weight ? (totalfee * WITNESS_SCALE_FACTOR) / total_weight : 0); // Unit: sat/vbyte</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2095"><span class="lineNum">    2095</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 135 times"> + </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;avgtxsize&quot;, (block.vtx.size() &gt; 1) ? total_size / (block.vtx.size() - 1) : 0);</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 135 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L2096"><span class="lineNum">    2096</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;blockhash&quot;, pindex.GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2097"><span class="lineNum">    2097</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;feerate_percentiles&quot;, std::move(feerates_res));</span></span>
<span id="L2098"><span class="lineNum">    2098</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;height&quot;, (int64_t)pindex.nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2099"><span class="lineNum">    2099</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;ins&quot;, inputs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2100"><span class="lineNum">    2100</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;maxfee&quot;, maxfee);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2101"><span class="lineNum">    2101</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;maxfeerate&quot;, maxfeerate);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2102"><span class="lineNum">    2102</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;maxtxsize&quot;, maxtxsize);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2103"><span class="lineNum">    2103</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;medianfee&quot;, CalculateTruncatedMedian(fee_array));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2104"><span class="lineNum">    2104</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;mediantime&quot;, pindex.GetMedianTimePast());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2105"><span class="lineNum">    2105</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;mediantxsize&quot;, CalculateTruncatedMedian(txsize_array));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2106"><span class="lineNum">    2106</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;minfee&quot;, (minfee == MAX_MONEY) ? 0 : minfee);</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2107"><span class="lineNum">    2107</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;minfeerate&quot;, (minfeerate == MAX_MONEY) ? 0 : minfeerate);</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2108"><span class="lineNum">    2108</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;mintxsize&quot;, mintxsize == MAX_BLOCK_SERIALIZED_SIZE ? 0 : mintxsize);</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2109"><span class="lineNum">    2109</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;outs&quot;, outputs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2110"><span class="lineNum">    2110</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;subsidy&quot;, GetBlockSubsidy(pindex.nHeight, chainman.GetParams().GetConsensus()));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2111"><span class="lineNum">    2111</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;swtotal_size&quot;, swtotal_size);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2112"><span class="lineNum">    2112</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;swtotal_weight&quot;, swtotal_weight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2113"><span class="lineNum">    2113</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;swtxs&quot;, swtxs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2114"><span class="lineNum">    2114</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;time&quot;, pindex.GetBlockTime());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2115"><span class="lineNum">    2115</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;total_out&quot;, total_out);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2116"><span class="lineNum">    2116</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;total_size&quot;, total_size);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2117"><span class="lineNum">    2117</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;total_weight&quot;, total_weight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2118"><span class="lineNum">    2118</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;totalfee&quot;, totalfee);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2119"><span class="lineNum">    2119</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 135 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;txs&quot;, (int64_t)block.vtx.size());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2120"><span class="lineNum">    2120</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;utxo_increase&quot;, outputs - inputs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2121"><span class="lineNum">    2121</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;utxo_size_inc&quot;, utxo_size_inc);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2122"><span class="lineNum">    2122</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;utxo_increase_actual&quot;, utxos - inputs);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2123"><span class="lineNum">    2123</span>   [<span class="tlaGBC" title="Branch 0 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         270 :     ret_all.pushKV(&quot;utxo_size_inc_actual&quot;, utxo_size_inc_actual);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 135 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2124"><span class="lineNum">    2124</span>                 :             : </span>
<span id="L2125"><span class="lineNum">    2125</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 134 times"> + </span>]:<span class="tlaGNC">         135 :     if (do_all) {</span></span>
<span id="L2126"><span class="lineNum">    2126</span>                 :<span class="tlaGNC">           1 :         return ret_all;</span></span>
<span id="L2127"><span class="lineNum">    2127</span>                 :             :     }</span>
<span id="L2128"><span class="lineNum">    2128</span>                 :             : </span>
<span id="L2129"><span class="lineNum">    2129</span>                 :<span class="tlaGNC">         134 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L2130"><span class="lineNum">    2130</span>         [<span class="tlaGBC" title="Branch 0 was taken 157 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 26 times"> + </span>]:<span class="tlaGNC">         183 :     for (const std::string&amp; stat : stats) {</span></span>
<span id="L2131"><span class="lineNum">    2131</span>         [<span class="tlaGBC" title="Branch 0 was taken 157 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         157 :         const UniValue&amp; value = ret_all[stat];</span></span>
<span id="L2132"><span class="lineNum">    2132</span>         [<span class="tlaGBC" title="Branch 0 was taken 108 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 49 times"> + </span>]:<span class="tlaGNC">         157 :         if (value.isNull()) {</span></span>
<span id="L2133"><span class="lineNum">    2133</span>   [<span class="tlaGBC" title="Branch 0 was taken 108 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 108 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         216 :             throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Invalid selected statistic '%s'&quot;, stat));</span></span>
<span id="L2134"><span class="lineNum">    2134</span>                 :             :         }</span>
<span id="L2135"><span class="lineNum">    2135</span>   [<span class="tlaGBC" title="Branch 0 was taken 49 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 49 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         147 :         ret.pushKV(stat, value);</span></span>
<span id="L2136"><span class="lineNum">    2136</span>                 :             :     }</span>
<span id="L2137"><span class="lineNum">    2137</span>                 :<span class="tlaGNC">          26 :     return ret;</span></span>
<span id="L2138"><span class="lineNum">    2138</span>                 :<span class="tlaGNC">         891 : },</span></span>
<span id="L2139"><span class="lineNum">    2139</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        2190 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 438 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 219 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 438 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 9 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not taken"> - </span>]
<span id="L2140"><span class="lineNum">    2140</span>   [<span class="tlaGBC" title="Branch 0 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        9198 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 44 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaGBC" title="Branch 46 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaGBC" title="Branch 48 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaGBC" title="Branch 50 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span><span class="tlaGBC" title="Branch 52 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 53 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 54 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 55 was not taken"> - </span><span class="tlaGBC" title="Branch 56 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 57 was not taken"> - </span><span class="tlaGBC" title="Branch 58 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 59 was not taken"> - </span><span class="tlaGBC" title="Branch 60 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 61 was not taken"> - </span><span class="tlaGBC" title="Branch 62 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 63 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 64 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 65 was not taken"> - </span><span class="tlaGBC" title="Branch 66 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 67 was not taken"> - </span><span class="tlaGBC" title="Branch 68 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 69 was not taken"> - </span><span class="tlaGBC" title="Branch 70 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 71 was not taken"> - </span><span class="tlaGBC" title="Branch 72 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 73 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 74 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 75 was not taken"> - </span><span class="tlaGBC" title="Branch 76 was taken 219 times"> + </span><span class="tlaUNC" title="Branch 77 was not taken"> - </span><span class="tlaGBC" title="Branch 78 was taken 219 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 79 was not taken"> - </span><span class="tlaUNC" title="Branch 80 was not taken"> - </span><span class="tlaUNC" title="Branch 81 was not taken"> - </span><span class="tlaUNC" title="Branch 82 was not taken"> - </span><span class="tlaUNC" title="Branch 83 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 84 was not taken"> - </span><span class="tlaUNC" title="Branch 85 was not taken"> - </span><span class="tlaUNC" title="Branch 86 was not taken"> - </span><span class="tlaUNC" title="Branch 87 was not taken"> - </span>]
<span id="L2141"><span class="lineNum">    2141</span>                 :             : </span>
<span id="L2142"><span class="lineNum">    2142</span>                 :             : namespace {</span>
<span id="L2143"><span class="lineNum">    2143</span>                 :             : //! Search for a given set of pubkey scripts</span>
<span id="L2144"><span class="lineNum">    2144</span>                 :<span class="tlaGNC">         173 : bool FindScriptPubKey(std::atomic&lt;int&gt;&amp; scan_progress, const std::atomic&lt;bool&gt;&amp; should_abort, int64_t&amp; count, CCoinsViewCursor* cursor, const std::set&lt;CScript&gt;&amp; needles, std::map&lt;COutPoint, Coin&gt;&amp; out_results, std::function&lt;void()&gt;&amp; interruption_point)</span></span>
<span id="L2145"><span class="lineNum">    2145</span>                 :             : {</span>
<span id="L2146"><span class="lineNum">    2146</span>                 :<span class="tlaGNC">         173 :     scan_progress = 0;</span></span>
<span id="L2147"><span class="lineNum">    2147</span>                 :<span class="tlaGNC">         173 :     count = 0;</span></span>
<span id="L2148"><span class="lineNum">    2148</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 173 times"> + </span>]:<span class="tlaGNC">         173 :     while (cursor-&gt;Valid()) {</span></span>
<span id="L2149"><span class="lineNum">    2149</span>                 :<span class="tlaUNC">           0 :         COutPoint key;</span></span>
<span id="L2150"><span class="lineNum">    2150</span>                 :<span class="tlaUNC">           0 :         Coin coin;</span></span>
<span id="L2151"><span class="lineNum">    2151</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (!cursor-&gt;GetKey(key) || !cursor-&gt;GetValue(coin)) return false;</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2152"><span class="lineNum">    2152</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (++count % 8192 == 0) {</span></span>
<span id="L2153"><span class="lineNum">    2153</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             interruption_point();</span></span>
<span id="L2154"><span class="lineNum">    2154</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (should_abort) {</span></span>
<span id="L2155"><span class="lineNum">    2155</span>                 :             :                 // allow to abort the scan via the abort reference</span>
<span id="L2156"><span class="lineNum">    2156</span>                 :             :                 return false;</span>
<span id="L2157"><span class="lineNum">    2157</span>                 :             :             }</span>
<span id="L2158"><span class="lineNum">    2158</span>                 :             :         }</span>
<span id="L2159"><span class="lineNum">    2159</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (count % 256 == 0) {</span></span>
<span id="L2160"><span class="lineNum">    2160</span>                 :             :             // update progress reference every 256 item</span>
<span id="L2161"><span class="lineNum">    2161</span>                 :<span class="tlaUNC">           0 :             uint32_t high = 0x100 * *UCharCast(key.hash.begin()) + *(UCharCast(key.hash.begin()) + 1);</span></span>
<span id="L2162"><span class="lineNum">    2162</span>                 :<span class="tlaUNC">           0 :             scan_progress = (int)(high * 100.0 / 65536.0 + 0.5);</span></span>
<span id="L2163"><span class="lineNum">    2163</span>                 :             :         }</span>
<span id="L2164"><span class="lineNum">    2164</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (needles.count(coin.out.scriptPubKey)) {</span></span>
<span id="L2165"><span class="lineNum">    2165</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             out_results.emplace(key, coin);</span></span>
<span id="L2166"><span class="lineNum">    2166</span>                 :             :         }</span>
<span id="L2167"><span class="lineNum">    2167</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         cursor-&gt;Next();</span></span>
<span id="L2168"><span class="lineNum">    2168</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L2169"><span class="lineNum">    2169</span>                 :<span class="tlaGNC">         173 :     scan_progress = 100;</span></span>
<span id="L2170"><span class="lineNum">    2170</span>                 :<span class="tlaGNC">         173 :     return true;</span></span>
<span id="L2171"><span class="lineNum">    2171</span>                 :             : }</span>
<span id="L2172"><span class="lineNum">    2172</span>                 :             : } // namespace</span>
<span id="L2173"><span class="lineNum">    2173</span>                 :             : </span>
<span id="L2174"><span class="lineNum">    2174</span>                 :             : /** RAII object to prevent concurrency issue when scanning the txout set */</span>
<span id="L2175"><span class="lineNum">    2175</span>                 :             : static std::atomic&lt;int&gt; g_scan_progress;</span>
<span id="L2176"><span class="lineNum">    2176</span>                 :             : static std::atomic&lt;bool&gt; g_scan_in_progress;</span>
<span id="L2177"><span class="lineNum">    2177</span>                 :             : static std::atomic&lt;bool&gt; g_should_abort_scan;</span>
<span id="L2178"><span class="lineNum">    2178</span>                 :             : class CoinsViewScanReserver</span>
<span id="L2179"><span class="lineNum">    2179</span>                 :             : {</span>
<span id="L2180"><span class="lineNum">    2180</span>                 :             : private:</span>
<span id="L2181"><span class="lineNum">    2181</span>                 :             :     bool m_could_reserve{false};</span>
<span id="L2182"><span class="lineNum">    2182</span>                 :             : public:</span>
<span id="L2183"><span class="lineNum">    2183</span>                 :             :     explicit CoinsViewScanReserver() = default;</span>
<span id="L2184"><span class="lineNum">    2184</span>                 :             : </span>
<span id="L2185"><span class="lineNum">    2185</span>                 :<span class="tlaGNC">         325 :     bool reserve() {</span></span>
<span id="L2186"><span class="lineNum">    2186</span>                 :<span class="tlaGNC">         325 :         CHECK_NONFATAL(!m_could_reserve);</span></span>
<span id="L2187"><span class="lineNum">    2187</span>         [<span class="tlaGBC" title="Branch 0 was taken 325 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         325 :         if (g_scan_in_progress.exchange(true)) {</span></span>
<span id="L2188"><span class="lineNum">    2188</span>                 :             :             return false;</span>
<span id="L2189"><span class="lineNum">    2189</span>                 :             :         }</span>
<span id="L2190"><span class="lineNum">    2190</span>                 :<span class="tlaGNC">         325 :         CHECK_NONFATAL(g_scan_progress == 0);</span></span>
<span id="L2191"><span class="lineNum">    2191</span>                 :<span class="tlaGNC">         325 :         m_could_reserve = true;</span></span>
<span id="L2192"><span class="lineNum">    2192</span>                 :<span class="tlaGNC">         325 :         return true;</span></span>
<span id="L2193"><span class="lineNum">    2193</span>                 :             :     }</span>
<span id="L2194"><span class="lineNum">    2194</span>                 :             : </span>
<span id="L2195"><span class="lineNum">    2195</span>                 :<span class="tlaGNC">         325 :     ~CoinsViewScanReserver() {</span></span>
<span id="L2196"><span class="lineNum">    2196</span>         [<span class="tlaGBC" title="Branch 0 was taken 325 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         325 :         if (m_could_reserve) {</span></span>
<span id="L2197"><span class="lineNum">    2197</span>                 :<span class="tlaGNC">         325 :             g_scan_in_progress = false;</span></span>
<span id="L2198"><span class="lineNum">    2198</span>                 :<span class="tlaGNC">         325 :             g_scan_progress = 0;</span></span>
<span id="L2199"><span class="lineNum">    2199</span>                 :             :         }</span>
<span id="L2200"><span class="lineNum">    2200</span>                 :<span class="tlaGNC">         325 :     }</span></span>
<span id="L2201"><span class="lineNum">    2201</span>                 :             : };</span>
<span id="L2202"><span class="lineNum">    2202</span>                 :             : </span>
<span id="L2203"><span class="lineNum">    2203</span>                 :             : static const auto scan_action_arg_desc = RPCArg{</span>
<span id="L2204"><span class="lineNum">    2204</span>                 :             :     &quot;action&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The action to execute\n&quot;</span>
<span id="L2205"><span class="lineNum">    2205</span>                 :             :         &quot;\&quot;start\&quot; for starting a scan\n&quot;</span>
<span id="L2206"><span class="lineNum">    2206</span>                 :             :         &quot;\&quot;abort\&quot; for aborting the current scan (returns true when abort was successful)\n&quot;</span>
<span id="L2207"><span class="lineNum">    2207</span>                 :             :         &quot;\&quot;status\&quot; for progress report (in %) of the current scan&quot;</span>
<span id="L2208"><span class="lineNum">    2208</span>                 :             : };</span>
<span id="L2209"><span class="lineNum">    2209</span>                 :             : </span>
<span id="L2210"><span class="lineNum">    2210</span>                 :             : static const auto output_descriptor_obj = RPCArg{</span>
<span id="L2211"><span class="lineNum">    2211</span>                 :             :     &quot;&quot;, RPCArg::Type::OBJ, RPCArg::Optional::OMITTED, &quot;An object with output descriptor and metadata&quot;,</span>
<span id="L2212"><span class="lineNum">    2212</span>                 :             :     {</span>
<span id="L2213"><span class="lineNum">    2213</span>                 :             :         {&quot;desc&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;An output descriptor&quot;},</span>
<span id="L2214"><span class="lineNum">    2214</span>                 :             :         {&quot;range&quot;, RPCArg::Type::RANGE, RPCArg::Default{1000}, &quot;The range of HD chain indexes to explore (either end or [begin,end])&quot;},</span>
<span id="L2215"><span class="lineNum">    2215</span>                 :             :     }</span>
<span id="L2216"><span class="lineNum">    2216</span>                 :             : };</span>
<span id="L2217"><span class="lineNum">    2217</span>                 :             : </span>
<span id="L2218"><span class="lineNum">    2218</span>                 :             : static const auto scan_objects_arg_desc = RPCArg{</span>
<span id="L2219"><span class="lineNum">    2219</span>                 :             :     &quot;scanobjects&quot;, RPCArg::Type::ARR, RPCArg::Optional::OMITTED, &quot;Array of scan objects. Required for \&quot;start\&quot; action\n&quot;</span>
<span id="L2220"><span class="lineNum">    2220</span>                 :             :         &quot;Every scan object is either a string descriptor or an object:&quot;,</span>
<span id="L2221"><span class="lineNum">    2221</span>                 :             :     {</span>
<span id="L2222"><span class="lineNum">    2222</span>                 :             :         {&quot;descriptor&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;An output descriptor&quot;},</span>
<span id="L2223"><span class="lineNum">    2223</span>                 :             :         output_descriptor_obj,</span>
<span id="L2224"><span class="lineNum">    2224</span>                 :             :     },</span>
<span id="L2225"><span class="lineNum">    2225</span>                 :             :     RPCArgOptions{.oneline_description=&quot;[scanobjects,...]&quot;},</span>
<span id="L2226"><span class="lineNum">    2226</span>                 :             : };</span>
<span id="L2227"><span class="lineNum">    2227</span>                 :             : </span>
<span id="L2228"><span class="lineNum">    2228</span>                 :             : static const auto scan_result_abort = RPCResult{</span>
<span id="L2229"><span class="lineNum">    2229</span>                 :             :     &quot;when action=='abort'&quot;, RPCResult::Type::BOOL, &quot;success&quot;,</span>
<span id="L2230"><span class="lineNum">    2230</span>                 :             :     &quot;True if scan will be aborted (not necessarily before this RPC returns), or false if there is no scan to abort&quot;</span>
<span id="L2231"><span class="lineNum">    2231</span>                 :             : };</span>
<span id="L2232"><span class="lineNum">    2232</span>                 :             : static const auto scan_result_status_none = RPCResult{</span>
<span id="L2233"><span class="lineNum">    2233</span>                 :             :     &quot;when action=='status' and no scan is in progress - possibly already completed&quot;, RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;</span>
<span id="L2234"><span class="lineNum">    2234</span>                 :             : };</span>
<span id="L2235"><span class="lineNum">    2235</span>                 :             : static const auto scan_result_status_some = RPCResult{</span>
<span id="L2236"><span class="lineNum">    2236</span>                 :             :     &quot;when action=='status' and a scan is currently in progress&quot;, RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L2237"><span class="lineNum">    2237</span>                 :             :     {{RPCResult::Type::NUM, &quot;progress&quot;, &quot;Approximate percent complete&quot;},}</span>
<span id="L2238"><span class="lineNum">    2238</span>                 :             : };</span>
<span id="L2239"><span class="lineNum">    2239</span>                 :             : </span>
<span id="L2240"><span class="lineNum">    2240</span>                 :             : </span>
<span id="L2241"><span class="lineNum">    2241</span>                 :<span class="tlaGNC">         400 : static RPCHelpMan scantxoutset()</span></span>
<span id="L2242"><span class="lineNum">    2242</span>                 :             : {</span>
<span id="L2243"><span class="lineNum">    2243</span>                 :             :     // raw() descriptor corresponding to mainnet address 12cbQLTFMXRnSzktFkuoG3eHoMeFtpTu3S</span>
<span id="L2244"><span class="lineNum">    2244</span>                 :<span class="tlaGNC">         400 :     const std::string EXAMPLE_DESCRIPTOR_RAW = &quot;raw(76a91411b366edfc0a8b66feebae5c2e25a7b6a5d1cf3188ac)#fm24fxxy&quot;;</span></span>
<span id="L2245"><span class="lineNum">    2245</span>                 :             : </span>
<span id="L2246"><span class="lineNum">    2246</span>                 :<span class="tlaGNC">         400 :     return RPCHelpMan{</span></span>
<span id="L2247"><span class="lineNum">    2247</span>         [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         800 :         &quot;scantxoutset&quot;,</span></span>
<span id="L2248"><span class="lineNum">    2248</span>         [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         800 :         &quot;Scans the unspent transaction output set for entries that match certain output descriptors.\n&quot;</span></span>
<span id="L2249"><span class="lineNum">    2249</span>                 :             :         &quot;Examples of output descriptors are:\n&quot;</span>
<span id="L2250"><span class="lineNum">    2250</span>                 :             :         &quot;    addr(&lt;address&gt;)                      Outputs whose output script corresponds to the specified address (does not include P2PK)\n&quot;</span>
<span id="L2251"><span class="lineNum">    2251</span>                 :             :         &quot;    raw(&lt;hex script&gt;)                    Outputs whose output script equals the specified hex-encoded bytes\n&quot;</span>
<span id="L2252"><span class="lineNum">    2252</span>                 :             :         &quot;    combo(&lt;pubkey&gt;)                      P2PK, P2PKH, P2WPKH, and P2SH-P2WPKH outputs for the given pubkey\n&quot;</span>
<span id="L2253"><span class="lineNum">    2253</span>                 :             :         &quot;    pkh(&lt;pubkey&gt;)                        P2PKH outputs for the given pubkey\n&quot;</span>
<span id="L2254"><span class="lineNum">    2254</span>                 :             :         &quot;    sh(multi(&lt;n&gt;,&lt;pubkey&gt;,&lt;pubkey&gt;,...)) P2SH-multisig outputs for the given threshold and pubkeys\n&quot;</span>
<span id="L2255"><span class="lineNum">    2255</span>                 :             :         &quot;    tr(&lt;pubkey&gt;)                         P2TR\n&quot;</span>
<span id="L2256"><span class="lineNum">    2256</span>                 :             :         &quot;    tr(&lt;pubkey&gt;,{pk(&lt;pubkey&gt;)})          P2TR with single fallback pubkey in tapscript\n&quot;</span>
<span id="L2257"><span class="lineNum">    2257</span>                 :             :         &quot;    rawtr(&lt;pubkey&gt;)                      P2TR with the specified key as output key rather than inner\n&quot;</span>
<span id="L2258"><span class="lineNum">    2258</span>                 :             :         &quot;    wsh(and_v(v:pk(&lt;pubkey&gt;),after(2)))  P2WSH miniscript with mandatory pubkey and a timelock\n&quot;</span>
<span id="L2259"><span class="lineNum">    2259</span>                 :             :         &quot;\nIn the above, &lt;pubkey&gt; either refers to a fixed public key in hexadecimal notation, or to an xpub/xprv optionally followed by one\n&quot;</span>
<span id="L2260"><span class="lineNum">    2260</span>                 :             :         &quot;or more path elements separated by \&quot;/\&quot;, and optionally ending in \&quot;/*\&quot; (unhardened), or \&quot;/*'\&quot; or \&quot;/*h\&quot; (hardened) to specify all\n&quot;</span>
<span id="L2261"><span class="lineNum">    2261</span>                 :             :         &quot;unhardened or hardened child keys.\n&quot;</span>
<span id="L2262"><span class="lineNum">    2262</span>                 :             :         &quot;In the latter case, a range needs to be specified by below if different from 1000.\n&quot;</span>
<span id="L2263"><span class="lineNum">    2263</span>                 :             :         &quot;For more information on output descriptors, see the documentation in the doc/descriptors.md file.\n&quot;,</span>
<span id="L2264"><span class="lineNum">    2264</span>                 :             :         {</span>
<span id="L2265"><span class="lineNum">    2265</span>                 :             :             scan_action_arg_desc,</span>
<span id="L2266"><span class="lineNum">    2266</span>                 :             :             scan_objects_arg_desc,</span>
<span id="L2267"><span class="lineNum">    2267</span>                 :             :         },</span>
<span id="L2268"><span class="lineNum">    2268</span>                 :             :         {</span>
<span id="L2269"><span class="lineNum">    2269</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         800 :             RPCResult{&quot;when action=='start'; only returns after scan completes&quot;, RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2270"><span class="lineNum">    2270</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::BOOL, &quot;success&quot;, &quot;Whether the scan was completed&quot;},</span></span>
<span id="L2271"><span class="lineNum">    2271</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::NUM, &quot;txouts&quot;, &quot;The number of unspent transaction outputs scanned&quot;},</span></span>
<span id="L2272"><span class="lineNum">    2272</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::NUM, &quot;height&quot;, &quot;The block height at which the scan was done&quot;},</span></span>
<span id="L2273"><span class="lineNum">    2273</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::STR_HEX, &quot;bestblock&quot;, &quot;The hash of the block at the tip of the chain&quot;},</span></span>
<span id="L2274"><span class="lineNum">    2274</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::ARR, &quot;unspents&quot;, &quot;&quot;,</span></span>
<span id="L2275"><span class="lineNum">    2275</span>                 :             :                 {</span>
<span id="L2276"><span class="lineNum">    2276</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                     {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L2277"><span class="lineNum">    2277</span>                 :             :                     {</span>
<span id="L2278"><span class="lineNum">    2278</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::STR_HEX, &quot;txid&quot;, &quot;The transaction id&quot;},</span></span>
<span id="L2279"><span class="lineNum">    2279</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::NUM, &quot;vout&quot;, &quot;The vout value&quot;},</span></span>
<span id="L2280"><span class="lineNum">    2280</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::STR_HEX, &quot;scriptPubKey&quot;, &quot;The output script&quot;},</span></span>
<span id="L2281"><span class="lineNum">    2281</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::STR, &quot;desc&quot;, &quot;A specialized descriptor for the matched output script&quot;},</span></span>
<span id="L2282"><span class="lineNum">    2282</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::STR_AMOUNT, &quot;amount&quot;, &quot;The total amount in &quot; + CURRENCY_UNIT + &quot; of the unspent output&quot;},</span></span>
<span id="L2283"><span class="lineNum">    2283</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::BOOL, &quot;coinbase&quot;, &quot;Whether this is a coinbase output&quot;},</span></span>
<span id="L2284"><span class="lineNum">    2284</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::NUM, &quot;height&quot;, &quot;Height of the unspent transaction output&quot;},</span></span>
<span id="L2285"><span class="lineNum">    2285</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::STR_HEX, &quot;blockhash&quot;, &quot;Blockhash of the unspent transaction output&quot;},</span></span>
<span id="L2286"><span class="lineNum">    2286</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                         {RPCResult::Type::NUM, &quot;confirmations&quot;, &quot;Number of confirmations of the unspent transaction output when the scan was done&quot;},</span></span>
<span id="L2287"><span class="lineNum">    2287</span>                 :             :                     }},</span>
<span id="L2288"><span class="lineNum">    2288</span>                 :             :                 }},</span>
<span id="L2289"><span class="lineNum">    2289</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         800 :                 {RPCResult::Type::STR_AMOUNT, &quot;total_amount&quot;, &quot;The total amount of all found unspent outputs in &quot; + CURRENCY_UNIT},</span></span>
<span id="L2290"><span class="lineNum">    2290</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">       13200 :             }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2400 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 400 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 400 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 400 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 3600 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaUNC" title="Branch 16 was not taken"> - </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span>]
<span id="L2291"><span class="lineNum">    2291</span>                 :             :             scan_result_abort,</span>
<span id="L2292"><span class="lineNum">    2292</span>                 :             :             scan_result_status_some,</span>
<span id="L2293"><span class="lineNum">    2293</span>                 :             :             scan_result_status_none,</span>
<span id="L2294"><span class="lineNum">    2294</span>                 :             :         },</span>
<span id="L2295"><span class="lineNum">    2295</span>                 :<span class="tlaGNC">         400 :         RPCExamples{</span></span>
<span id="L2296"><span class="lineNum">    2296</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1200 :             HelpExampleCli(&quot;scantxoutset&quot;, &quot;start \'[\&quot;&quot; + EXAMPLE_DESCRIPTOR_RAW + &quot;\&quot;]\'&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2297"><span class="lineNum">    2297</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1600 :             HelpExampleCli(&quot;scantxoutset&quot;, &quot;status&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2298"><span class="lineNum">    2298</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1600 :             HelpExampleCli(&quot;scantxoutset&quot;, &quot;abort&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2299"><span class="lineNum">    2299</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        2000 :             HelpExampleRpc(&quot;scantxoutset&quot;, &quot;\&quot;start\&quot;, [\&quot;&quot; + EXAMPLE_DESCRIPTOR_RAW + &quot;\&quot;]&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2300"><span class="lineNum">    2300</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1600 :             HelpExampleRpc(&quot;scantxoutset&quot;, &quot;\&quot;status\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2301"><span class="lineNum">    2301</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1200 :             HelpExampleRpc(&quot;scantxoutset&quot;, &quot;\&quot;abort\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2302"><span class="lineNum">    2302</span>         [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         400 :         },</span></span>
<span id="L2303"><span class="lineNum">    2303</span>                 :<span class="tlaGNC">         400 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L2304"><span class="lineNum">    2304</span>                 :             : {</span>
<span id="L2305"><span class="lineNum">    2305</span>                 :<span class="tlaGNC">         335 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L2306"><span class="lineNum">    2306</span>         [<span class="tlaGBC" title="Branch 0 was taken 335 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         335 :     const auto action{self.Arg&lt;std::string&gt;(&quot;action&quot;)};</span></span>
<span id="L2307"><span class="lineNum">    2307</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 334 times"> + </span>]:<span class="tlaGNC">         335 :     if (action == &quot;status&quot;) {</span></span>
<span id="L2308"><span class="lineNum">    2308</span>                 :<span class="tlaGNC">           1 :         CoinsViewScanReserver reserver;</span></span>
<span id="L2309"><span class="lineNum">    2309</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           1 :         if (reserver.reserve()) {</span></span>
<span id="L2310"><span class="lineNum">    2310</span>                 :             :             // no scan in progress</span>
<span id="L2311"><span class="lineNum">    2311</span>                 :<span class="tlaGNC">           1 :             return UniValue::VNULL;</span></span>
<span id="L2312"><span class="lineNum">    2312</span>                 :             :         }</span>
<span id="L2313"><span class="lineNum">    2313</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;progress&quot;, g_scan_progress.load());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2314"><span class="lineNum">    2314</span>                 :<span class="tlaUNC">           0 :         return result;</span></span>
<span id="L2315"><span class="lineNum">    2315</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 333 times"> + </span>]:<span class="tlaGNC">         335 :     } else if (action == &quot;abort&quot;) {</span></span>
<span id="L2316"><span class="lineNum">    2316</span>                 :<span class="tlaGNC">           1 :         CoinsViewScanReserver reserver;</span></span>
<span id="L2317"><span class="lineNum">    2317</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           1 :         if (reserver.reserve()) {</span></span>
<span id="L2318"><span class="lineNum">    2318</span>                 :             :             // reserve was possible which means no scan was running</span>
<span id="L2319"><span class="lineNum">    2319</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :             return false;</span></span>
<span id="L2320"><span class="lineNum">    2320</span>                 :             :         }</span>
<span id="L2321"><span class="lineNum">    2321</span>                 :             :         // set the abort flag</span>
<span id="L2322"><span class="lineNum">    2322</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         g_should_abort_scan = true;</span></span>
<span id="L2323"><span class="lineNum">    2323</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return true;</span></span>
<span id="L2324"><span class="lineNum">    2324</span>         [<span class="tlaGBC" title="Branch 0 was taken 323 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 10 times"> + </span>]:<span class="tlaGNC">         334 :     } else if (action == &quot;start&quot;) {</span></span>
<span id="L2325"><span class="lineNum">    2325</span>                 :<span class="tlaGNC">         323 :         CoinsViewScanReserver reserver;</span></span>
<span id="L2326"><span class="lineNum">    2326</span>   [<span class="tlaGBC" title="Branch 0 was taken 323 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 323 times"> + </span>]:<span class="tlaGNC">         323 :         if (!reserver.reserve()) {</span></span>
<span id="L2327"><span class="lineNum">    2327</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Scan already in progress, use action \&quot;abort\&quot; or \&quot;status\&quot;&quot;);</span></span>
<span id="L2328"><span class="lineNum">    2328</span>                 :             :         }</span>
<span id="L2329"><span class="lineNum">    2329</span>                 :             : </span>
<span id="L2330"><span class="lineNum">    2330</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 323 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 321 times"> + </span>]:<span class="tlaGNC">         323 :         if (request.params.size() &lt; 2) {</span></span>
<span id="L2331"><span class="lineNum">    2331</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;scanobjects argument is required for the start action&quot;);</span></span>
<span id="L2332"><span class="lineNum">    2332</span>                 :             :         }</span>
<span id="L2333"><span class="lineNum">    2333</span>                 :             : </span>
<span id="L2334"><span class="lineNum">    2334</span>         [<span class="tlaGBC" title="Branch 0 was taken 321 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         321 :         std::set&lt;CScript&gt; needles;</span></span>
<span id="L2335"><span class="lineNum">    2335</span>         [<span class="tlaGBC" title="Branch 0 was taken 321 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         321 :         std::map&lt;CScript, std::string&gt; descriptors;</span></span>
<span id="L2336"><span class="lineNum">    2336</span>                 :<span class="tlaGNC">         321 :         CAmount total_in = 0;</span></span>
<span id="L2337"><span class="lineNum">    2337</span>                 :             : </span>
<span id="L2338"><span class="lineNum">    2338</span>                 :             :         // loop through the scan objects</span>
<span id="L2339"><span class="lineNum">    2339</span>   [<span class="tlaGBC" title="Branch 0 was taken 321 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 320 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">        2138 :         for (const UniValue&amp; scanobject : request.params[1].get_array().getValues()) {</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 320 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 1964 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 173 times"> + </span>]
<span id="L2340"><span class="lineNum">    2340</span>                 :<span class="tlaGNC">        1964 :             FlatSigningProvider provider;</span></span>
<span id="L2341"><span class="lineNum">    2341</span>         [<span class="tlaGBC" title="Branch 0 was taken 1817 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 147 times"> + </span>]:<span class="tlaGNC">        1964 :             auto scripts = EvalDescriptorStringOrObject(scanobject, provider);</span></span>
<span id="L2342"><span class="lineNum">    2342</span>         [<span class="tlaGBC" title="Branch 0 was taken 1847 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 1817 times"> + </span>]:<span class="tlaGNC">        3664 :             for (CScript&amp; script : scripts) {</span></span>
<span id="L2343"><span class="lineNum">    2343</span>   [<span class="tlaGBC" title="Branch 0 was taken 1847 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1847 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">        1847 :                 std::string inferred = InferDescriptor(script, provider)-&gt;ToString();</span></span>
<span id="L2344"><span class="lineNum">    2344</span>         [<span class="tlaGBC" title="Branch 0 was taken 1847 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        1847 :                 needles.emplace(script);</span></span>
<span id="L2345"><span class="lineNum">    2345</span>         [<span class="tlaGBC" title="Branch 0 was taken 1847 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">        1847 :                 descriptors.emplace(std::move(script), std::move(inferred));</span></span>
<span id="L2346"><span class="lineNum">    2346</span>                 :<span class="tlaGNC">        1847 :             }</span></span>
<span id="L2347"><span class="lineNum">    2347</span>                 :<span class="tlaGNC">        1964 :         }</span></span>
<span id="L2348"><span class="lineNum">    2348</span>                 :             : </span>
<span id="L2349"><span class="lineNum">    2349</span>                 :             :         // Scan the unspent transaction output set for inputs</span>
<span id="L2350"><span class="lineNum">    2350</span>                 :<span class="tlaGNC">         173 :         UniValue unspents(UniValue::VARR);</span></span>
<span id="L2351"><span class="lineNum">    2351</span>                 :<span class="tlaGNC">         173 :         std::vector&lt;CTxOut&gt; input_txos;</span></span>
<span id="L2352"><span class="lineNum">    2352</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :         std::map&lt;COutPoint, Coin&gt; coins;</span></span>
<span id="L2353"><span class="lineNum">    2353</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :         g_should_abort_scan = false;</span></span>
<span id="L2354"><span class="lineNum">    2354</span>                 :<span class="tlaGNC">         173 :         int64_t count = 0;</span></span>
<span id="L2355"><span class="lineNum">    2355</span>                 :<span class="tlaGNC">         173 :         std::unique_ptr&lt;CCoinsViewCursor&gt; pcursor;</span></span>
<span id="L2356"><span class="lineNum">    2356</span>                 :<span class="tlaGNC">         173 :         const CBlockIndex* tip;</span></span>
<span id="L2357"><span class="lineNum">    2357</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :         NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L2358"><span class="lineNum">    2358</span>                 :<span class="tlaGNC">         173 :         {</span></span>
<span id="L2359"><span class="lineNum">    2359</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :             ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L2360"><span class="lineNum">    2360</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :             LOCK(cs_main);</span></span>
<span id="L2361"><span class="lineNum">    2361</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :             Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L2362"><span class="lineNum">    2362</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :             active_chainstate.ForceFlushStateToDisk();</span></span>
<span id="L2363"><span class="lineNum">    2363</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         173 :             pcursor = CHECK_NONFATAL(active_chainstate.CoinsDB().Cursor());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2364"><span class="lineNum">    2364</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 173 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :             tip = CHECK_NONFATAL(active_chainstate.m_chain.Tip());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2365"><span class="lineNum">    2365</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L2366"><span class="lineNum">    2366</span>         [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         173 :         bool res = FindScriptPubKey(g_scan_progress, g_should_abort_scan, count, pcursor.get(), needles, coins, node.rpc_interruption_point);</span></span>
<span id="L2367"><span class="lineNum">    2367</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :         result.pushKV(&quot;success&quot;, res);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2368"><span class="lineNum">    2368</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :         result.pushKV(&quot;txouts&quot;, count);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2369"><span class="lineNum">    2369</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :         result.pushKV(&quot;height&quot;, tip-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2370"><span class="lineNum">    2370</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :         result.pushKV(&quot;bestblock&quot;, tip-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2371"><span class="lineNum">    2371</span>                 :             : </span>
<span id="L2372"><span class="lineNum">    2372</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 173 times"> + </span>]:<span class="tlaGNC">         173 :         for (const auto&amp; it : coins) {</span></span>
<span id="L2373"><span class="lineNum">    2373</span>                 :<span class="tlaUNC">           0 :             const COutPoint&amp; outpoint = it.first;</span></span>
<span id="L2374"><span class="lineNum">    2374</span>                 :<span class="tlaUNC">           0 :             const Coin&amp; coin = it.second;</span></span>
<span id="L2375"><span class="lineNum">    2375</span>                 :<span class="tlaUNC">           0 :             const CTxOut&amp; txo = coin.out;</span></span>
<span id="L2376"><span class="lineNum">    2376</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const CBlockIndex&amp; coinb_block{*CHECK_NONFATAL(tip-&gt;GetAncestor(coin.nHeight))};</span></span>
<span id="L2377"><span class="lineNum">    2377</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             input_txos.push_back(txo);</span></span>
<span id="L2378"><span class="lineNum">    2378</span>                 :<span class="tlaUNC">           0 :             total_in += txo.nValue;</span></span>
<span id="L2379"><span class="lineNum">    2379</span>                 :             : </span>
<span id="L2380"><span class="lineNum">    2380</span>                 :<span class="tlaUNC">           0 :             UniValue unspent(UniValue::VOBJ);</span></span>
<span id="L2381"><span class="lineNum">    2381</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;txid&quot;, outpoint.hash.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2382"><span class="lineNum">    2382</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;vout&quot;, outpoint.n);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2383"><span class="lineNum">    2383</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;scriptPubKey&quot;, HexStr(txo.scriptPubKey));</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L2384"><span class="lineNum">    2384</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;desc&quot;, descriptors[txo.scriptPubKey]);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2385"><span class="lineNum">    2385</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;amount&quot;, ValueFromAmount(txo.nValue));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2386"><span class="lineNum">    2386</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;coinbase&quot;, coin.IsCoinBase());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2387"><span class="lineNum">    2387</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;height&quot;, coin.nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2388"><span class="lineNum">    2388</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;blockhash&quot;, coinb_block.GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2389"><span class="lineNum">    2389</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             unspent.pushKV(&quot;confirmations&quot;, tip-&gt;nHeight - coin.nHeight + 1);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2390"><span class="lineNum">    2390</span>                 :             : </span>
<span id="L2391"><span class="lineNum">    2391</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             unspents.push_back(std::move(unspent));</span></span>
<span id="L2392"><span class="lineNum">    2392</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L2393"><span class="lineNum">    2393</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         346 :         result.pushKV(&quot;unspents&quot;, std::move(unspents));</span></span>
<span id="L2394"><span class="lineNum">    2394</span>   [<span class="tlaGBC" title="Branch 0 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         346 :         result.pushKV(&quot;total_amount&quot;, ValueFromAmount(total_in));</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 173 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2395"><span class="lineNum">    2395</span>                 :<span class="tlaGNC">         471 :     } else {</span></span>
<span id="L2396"><span class="lineNum">    2396</span>   [<span class="tlaGBC" title="Branch 0 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 10 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          20 :         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Invalid action '%s'&quot;, action));</span></span>
<span id="L2397"><span class="lineNum">    2397</span>                 :             :     }</span>
<span id="L2398"><span class="lineNum">    2398</span>                 :<span class="tlaGNC">         173 :     return result;</span></span>
<span id="L2399"><span class="lineNum">    2399</span>                 :<span class="tlaGNC">         335 : },</span></span>
<span id="L2400"><span class="lineNum">    2400</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        4800 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 1600 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 400 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 800 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L2401"><span class="lineNum">    2401</span>   [<span class="tlaGBC" title="Branch 0 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        7600 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 400 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 400 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 400 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 400 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 400 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not taken"> - </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaUNC" title="Branch 46 was not taken"> - </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaUNC" title="Branch 48 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaUNC" title="Branch 50 was not taken"> - </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span>]
<span id="L2402"><span class="lineNum">    2402</span>                 :             : </span>
<span id="L2403"><span class="lineNum">    2403</span>                 :             : /** RAII object to prevent concurrency issue when scanning blockfilters */</span>
<span id="L2404"><span class="lineNum">    2404</span>                 :             : static std::atomic&lt;int&gt; g_scanfilter_progress;</span>
<span id="L2405"><span class="lineNum">    2405</span>                 :             : static std::atomic&lt;int&gt; g_scanfilter_progress_height;</span>
<span id="L2406"><span class="lineNum">    2406</span>                 :             : static std::atomic&lt;bool&gt; g_scanfilter_in_progress;</span>
<span id="L2407"><span class="lineNum">    2407</span>                 :             : static std::atomic&lt;bool&gt; g_scanfilter_should_abort_scan;</span>
<span id="L2408"><span class="lineNum">    2408</span>                 :             : class BlockFiltersScanReserver</span>
<span id="L2409"><span class="lineNum">    2409</span>                 :             : {</span>
<span id="L2410"><span class="lineNum">    2410</span>                 :             : private:</span>
<span id="L2411"><span class="lineNum">    2411</span>                 :             :     bool m_could_reserve{false};</span>
<span id="L2412"><span class="lineNum">    2412</span>                 :             : public:</span>
<span id="L2413"><span class="lineNum">    2413</span>                 :             :     explicit BlockFiltersScanReserver() = default;</span>
<span id="L2414"><span class="lineNum">    2414</span>                 :             : </span>
<span id="L2415"><span class="lineNum">    2415</span>                 :<span class="tlaGNC">          11 :     bool reserve() {</span></span>
<span id="L2416"><span class="lineNum">    2416</span>                 :<span class="tlaGNC">          11 :         CHECK_NONFATAL(!m_could_reserve);</span></span>
<span id="L2417"><span class="lineNum">    2417</span>         [<span class="tlaGBC" title="Branch 0 was taken 11 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          11 :         if (g_scanfilter_in_progress.exchange(true)) {</span></span>
<span id="L2418"><span class="lineNum">    2418</span>                 :             :             return false;</span>
<span id="L2419"><span class="lineNum">    2419</span>                 :             :         }</span>
<span id="L2420"><span class="lineNum">    2420</span>                 :<span class="tlaGNC">          11 :         m_could_reserve = true;</span></span>
<span id="L2421"><span class="lineNum">    2421</span>                 :<span class="tlaGNC">          11 :         return true;</span></span>
<span id="L2422"><span class="lineNum">    2422</span>                 :             :     }</span>
<span id="L2423"><span class="lineNum">    2423</span>                 :             : </span>
<span id="L2424"><span class="lineNum">    2424</span>                 :<span class="tlaGNC">          11 :     ~BlockFiltersScanReserver() {</span></span>
<span id="L2425"><span class="lineNum">    2425</span>         [<span class="tlaGBC" title="Branch 0 was taken 11 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          11 :         if (m_could_reserve) {</span></span>
<span id="L2426"><span class="lineNum">    2426</span>                 :<span class="tlaGNC">          11 :             g_scanfilter_in_progress = false;</span></span>
<span id="L2427"><span class="lineNum">    2427</span>                 :             :         }</span>
<span id="L2428"><span class="lineNum">    2428</span>                 :<span class="tlaGNC">          11 :     }</span></span>
<span id="L2429"><span class="lineNum">    2429</span>                 :             : };</span>
<span id="L2430"><span class="lineNum">    2430</span>                 :             : </span>
<span id="L2431"><span class="lineNum">    2431</span>                 :<span class="tlaUNC">           0 : static bool CheckBlockFilterMatches(BlockManager&amp; blockman, const CBlockIndex&amp; blockindex, const GCSFilter::ElementSet&amp; needles)</span></span>
<span id="L2432"><span class="lineNum">    2432</span>                 :             : {</span>
<span id="L2433"><span class="lineNum">    2433</span>                 :<span class="tlaUNC">           0 :     const CBlock block{GetBlockChecked(blockman, blockindex)};</span></span>
<span id="L2434"><span class="lineNum">    2434</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const CBlockUndo block_undo{GetUndoChecked(blockman, blockindex)};</span></span>
<span id="L2435"><span class="lineNum">    2435</span>                 :             : </span>
<span id="L2436"><span class="lineNum">    2436</span>                 :             :     // Check if any of the outputs match the scriptPubKey</span>
<span id="L2437"><span class="lineNum">    2437</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const auto&amp; tx : block.vtx) {</span></span>
<span id="L2438"><span class="lineNum">    2438</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (std::any_of(tx-&gt;vout.cbegin(), tx-&gt;vout.cend(), [&amp;](const auto&amp; txout) {</span></span>
<span id="L2439"><span class="lineNum">    2439</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 return needles.count(std::vector&lt;unsigned char&gt;(txout.scriptPubKey.begin(), txout.scriptPubKey.end())) != 0;</span></span>
<span id="L2440"><span class="lineNum">    2440</span>                 :             :             })) {</span>
<span id="L2441"><span class="lineNum">    2441</span>                 :             :             return true;</span>
<span id="L2442"><span class="lineNum">    2442</span>                 :             :         }</span>
<span id="L2443"><span class="lineNum">    2443</span>                 :             :     }</span>
<span id="L2444"><span class="lineNum">    2444</span>                 :             :     // Check if any of the inputs match the scriptPubKey</span>
<span id="L2445"><span class="lineNum">    2445</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const auto&amp; txundo : block_undo.vtxundo) {</span></span>
<span id="L2446"><span class="lineNum">    2446</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (std::any_of(txundo.vprevout.cbegin(), txundo.vprevout.cend(), [&amp;](const auto&amp; coin) {</span></span>
<span id="L2447"><span class="lineNum">    2447</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 return needles.count(std::vector&lt;unsigned char&gt;(coin.out.scriptPubKey.begin(), coin.out.scriptPubKey.end())) != 0;</span></span>
<span id="L2448"><span class="lineNum">    2448</span>                 :             :             })) {</span>
<span id="L2449"><span class="lineNum">    2449</span>                 :             :             return true;</span>
<span id="L2450"><span class="lineNum">    2450</span>                 :             :         }</span>
<span id="L2451"><span class="lineNum">    2451</span>                 :             :     }</span>
<span id="L2452"><span class="lineNum">    2452</span>                 :             : </span>
<span id="L2453"><span class="lineNum">    2453</span>                 :             :     return false;</span>
<span id="L2454"><span class="lineNum">    2454</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L2455"><span class="lineNum">    2455</span>                 :             : </span>
<span id="L2456"><span class="lineNum">    2456</span>                 :<span class="tlaGNC">          93 : static RPCHelpMan scanblocks()</span></span>
<span id="L2457"><span class="lineNum">    2457</span>                 :             : {</span>
<span id="L2458"><span class="lineNum">    2458</span>                 :<span class="tlaGNC">          93 :     return RPCHelpMan{</span></span>
<span id="L2459"><span class="lineNum">    2459</span>                 :<span class="tlaGNC">          93 :         &quot;scanblocks&quot;,</span></span>
<span id="L2460"><span class="lineNum">    2460</span>         [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         186 :         &quot;Return relevant blockhashes for given descriptors (requires blockfilterindex).\n&quot;</span></span>
<span id="L2461"><span class="lineNum">    2461</span>                 :             :         &quot;This call may take several minutes. Make sure to use no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L2462"><span class="lineNum">    2462</span>                 :             :         {</span>
<span id="L2463"><span class="lineNum">    2463</span>                 :             :             scan_action_arg_desc,</span>
<span id="L2464"><span class="lineNum">    2464</span>                 :             :             scan_objects_arg_desc,</span>
<span id="L2465"><span class="lineNum">    2465</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :             RPCArg{&quot;start_height&quot;, RPCArg::Type::NUM, RPCArg::Default{0}, &quot;Height to start to scan from&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2466"><span class="lineNum">    2466</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :             RPCArg{&quot;stop_height&quot;, RPCArg::Type::NUM, RPCArg::DefaultHint{&quot;chain tip&quot;}, &quot;Height to stop to scan&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2467"><span class="lineNum">    2467</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :             RPCArg{&quot;filtertype&quot;, RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, &quot;The type name of the filter&quot;},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2468"><span class="lineNum">    2468</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :             RPCArg{&quot;options&quot;, RPCArg::Type::OBJ_NAMED_PARAMS, RPCArg::Optional::OMITTED, &quot;&quot;,</span></span>
<span id="L2469"><span class="lineNum">    2469</span>                 :             :                 {</span>
<span id="L2470"><span class="lineNum">    2470</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :                     {&quot;filter_false_positives&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Filter false positives (slower and may fail on pruned nodes). Otherwise they may occur at a rate of 1/M&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2471"><span class="lineNum">    2471</span>                 :             :                 },</span>
<span id="L2472"><span class="lineNum">    2472</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :                 RPCArgOptions{.oneline_description=&quot;options&quot;}},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2473"><span class="lineNum">    2473</span>                 :             :         },</span>
<span id="L2474"><span class="lineNum">    2474</span>                 :             :         {</span>
<span id="L2475"><span class="lineNum">    2475</span>                 :             :             scan_result_status_none,</span>
<span id="L2476"><span class="lineNum">    2476</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         186 :             RPCResult{&quot;When action=='start'; only returns after scan completes&quot;, RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2477"><span class="lineNum">    2477</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                 {RPCResult::Type::NUM, &quot;from_height&quot;, &quot;The height we started the scan from&quot;},</span></span>
<span id="L2478"><span class="lineNum">    2478</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                 {RPCResult::Type::NUM, &quot;to_height&quot;, &quot;The height we ended the scan at&quot;},</span></span>
<span id="L2479"><span class="lineNum">    2479</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                 {RPCResult::Type::ARR, &quot;relevant_blocks&quot;, &quot;Blocks that may have matched a scanobject.&quot;, {</span></span>
<span id="L2480"><span class="lineNum">    2480</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                     {RPCResult::Type::STR_HEX, &quot;blockhash&quot;, &quot;A relevant blockhash&quot;},</span></span>
<span id="L2481"><span class="lineNum">    2481</span>                 :             :                 }},</span>
<span id="L2482"><span class="lineNum">    2482</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                 {RPCResult::Type::BOOL, &quot;completed&quot;, &quot;true if the scan process was not aborted&quot;}</span></span>
<span id="L2483"><span class="lineNum">    2483</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1023 :             }},</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 372 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 93 times"> + </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L2484"><span class="lineNum">    2484</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         186 :             RPCResult{&quot;when action=='status' and a scan is currently in progress&quot;, RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2485"><span class="lineNum">    2485</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                     {RPCResult::Type::NUM, &quot;progress&quot;, &quot;Approximate percent complete&quot;},</span></span>
<span id="L2486"><span class="lineNum">    2486</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         186 :                     {RPCResult::Type::NUM, &quot;current_height&quot;, &quot;Height of the block currently being scanned&quot;},</span></span>
<span id="L2487"><span class="lineNum">    2487</span>                 :             :                 },</span>
<span id="L2488"><span class="lineNum">    2488</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 186 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 93 times"> + </span> :<span class="tlaGNC">         465 :             },</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2489"><span class="lineNum">    2489</span>                 :             :             scan_result_abort,</span>
<span id="L2490"><span class="lineNum">    2490</span>                 :             :         },</span>
<span id="L2491"><span class="lineNum">    2491</span>                 :<span class="tlaGNC">          93 :         RPCExamples{</span></span>
<span id="L2492"><span class="lineNum">    2492</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         186 :             HelpExampleCli(&quot;scanblocks&quot;, &quot;start '[\&quot;addr(bcrt1q4u4nsgk6ug0sqz7r3rj9tykjxrsl0yy4d0wwte)\&quot;]' 300000&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2493"><span class="lineNum">    2493</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         372 :             HelpExampleCli(&quot;scanblocks&quot;, &quot;start '[\&quot;addr(bcrt1q4u4nsgk6ug0sqz7r3rj9tykjxrsl0yy4d0wwte)\&quot;]' 100 150 basic&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2494"><span class="lineNum">    2494</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         372 :             HelpExampleCli(&quot;scanblocks&quot;, &quot;status&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2495"><span class="lineNum">    2495</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         372 :             HelpExampleRpc(&quot;scanblocks&quot;, &quot;\&quot;start\&quot;, [\&quot;addr(bcrt1q4u4nsgk6ug0sqz7r3rj9tykjxrsl0yy4d0wwte)\&quot;], 300000&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2496"><span class="lineNum">    2496</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         372 :             HelpExampleRpc(&quot;scanblocks&quot;, &quot;\&quot;start\&quot;, [\&quot;addr(bcrt1q4u4nsgk6ug0sqz7r3rj9tykjxrsl0yy4d0wwte)\&quot;], 100, 150, \&quot;basic\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2497"><span class="lineNum">    2497</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         279 :             HelpExampleRpc(&quot;scanblocks&quot;, &quot;\&quot;status\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2498"><span class="lineNum">    2498</span>         [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          93 :         },</span></span>
<span id="L2499"><span class="lineNum">    2499</span>                 :<span class="tlaGNC">          93 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L2500"><span class="lineNum">    2500</span>                 :             : {</span>
<span id="L2501"><span class="lineNum">    2501</span>                 :<span class="tlaGNC">          20 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L2502"><span class="lineNum">    2502</span>   [<span class="tlaGBC" title="Branch 0 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 20 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          20 :     if (request.params[0].get_str() == &quot;status&quot;) {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 5 was taken 19 times"> + </span>]
<span id="L2503"><span class="lineNum">    2503</span>                 :<span class="tlaGNC">           1 :         BlockFiltersScanReserver reserver;</span></span>
<span id="L2504"><span class="lineNum">    2504</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           1 :         if (reserver.reserve()) {</span></span>
<span id="L2505"><span class="lineNum">    2505</span>                 :             :             // no scan in progress</span>
<span id="L2506"><span class="lineNum">    2506</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :             return NullUniValue;</span></span>
<span id="L2507"><span class="lineNum">    2507</span>                 :             :         }</span>
<span id="L2508"><span class="lineNum">    2508</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;progress&quot;, g_scanfilter_progress.load());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2509"><span class="lineNum">    2509</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;current_height&quot;, g_scanfilter_progress_height.load());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2510"><span class="lineNum">    2510</span>                 :<span class="tlaUNC">           0 :         return ret;</span></span>
<span id="L2511"><span class="lineNum">    2511</span>   [<span class="tlaGBC" title="Branch 0 was taken 19 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 19 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          20 :     } else if (request.params[0].get_str() == &quot;abort&quot;) {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 17 times"> + </span>]
<span id="L2512"><span class="lineNum">    2512</span>                 :<span class="tlaGNC">           2 :         BlockFiltersScanReserver reserver;</span></span>
<span id="L2513"><span class="lineNum">    2513</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :         if (reserver.reserve()) {</span></span>
<span id="L2514"><span class="lineNum">    2514</span>                 :             :             // reserve was possible which means no scan was running</span>
<span id="L2515"><span class="lineNum">    2515</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :             return false;</span></span>
<span id="L2516"><span class="lineNum">    2516</span>                 :             :         }</span>
<span id="L2517"><span class="lineNum">    2517</span>                 :             :         // set the abort flag</span>
<span id="L2518"><span class="lineNum">    2518</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         g_scanfilter_should_abort_scan = true;</span></span>
<span id="L2519"><span class="lineNum">    2519</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return true;</span></span>
<span id="L2520"><span class="lineNum">    2520</span>   [<span class="tlaGBC" title="Branch 0 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 17 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          19 :     } else if (request.params[0].get_str() == &quot;start&quot;) {</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 8 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 9 times"> + </span>]
<span id="L2521"><span class="lineNum">    2521</span>                 :<span class="tlaGNC">           8 :         BlockFiltersScanReserver reserver;</span></span>
<span id="L2522"><span class="lineNum">    2522</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 8 times"> + </span>]:<span class="tlaGNC">           8 :         if (!reserver.reserve()) {</span></span>
<span id="L2523"><span class="lineNum">    2523</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Scan already in progress, use action \&quot;abort\&quot; or \&quot;status\&quot;&quot;);</span></span>
<span id="L2524"><span class="lineNum">    2524</span>                 :             :         }</span>
<span id="L2525"><span class="lineNum">    2525</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 3 was taken 7 times"> + </span> :<span class="tlaGNC">          15 :         const std::string filtertype_name{request.params[4].isNull() ? &quot;basic&quot; : request.params[4].get_str()};</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 7 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 7 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaGBC" title="Branch 11 was taken 7 times"> + </span><span class="tlaGBC" title="Branch 12 was taken 8 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not taken"> - </span>]
<span id="L2526"><span class="lineNum">    2526</span>                 :             : </span>
<span id="L2527"><span class="lineNum">    2527</span>                 :<span class="tlaGNC">           8 :         BlockFilterType filtertype;</span></span>
<span id="L2528"><span class="lineNum">    2528</span>   [<span class="tlaGBC" title="Branch 0 was taken 8 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 7 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span>]:<span class="tlaGNC">           8 :         if (!BlockFilterTypeByName(filtertype_name, filtertype)) {</span></span>
<span id="L2529"><span class="lineNum">    2529</span>   [<span class="tlaGBC" title="Branch 0 was taken 7 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 7 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          14 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Unknown filtertype&quot;);</span></span>
<span id="L2530"><span class="lineNum">    2530</span>                 :             :         }</span>
<span id="L2531"><span class="lineNum">    2531</span>                 :             : </span>
<span id="L2532"><span class="lineNum">    2532</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           1 :         UniValue options{request.params[5].isNull() ? UniValue::VOBJ : request.params[5]};</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2533"><span class="lineNum">    2533</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaGBC" title="Branch 3 was taken 1 time"> + </span> :<span class="tlaGNC">           2 :         bool filter_false_positives{options.exists(&quot;filter_false_positives&quot;) ? options[&quot;filter_false_positives&quot;].get_bool() : false};</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L2534"><span class="lineNum">    2534</span>                 :             : </span>
<span id="L2535"><span class="lineNum">    2535</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :         BlockFilterIndex* index = GetBlockFilterIndex(filtertype);</span></span>
<span id="L2536"><span class="lineNum">    2536</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           1 :         if (!index) {</span></span>
<span id="L2537"><span class="lineNum">    2537</span>   [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 1 time"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           2 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Index is not enabled for filtertype &quot; + filtertype_name);</span></span>
<span id="L2538"><span class="lineNum">    2538</span>                 :             :         }</span>
<span id="L2539"><span class="lineNum">    2539</span>                 :             : </span>
<span id="L2540"><span class="lineNum">    2540</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L2541"><span class="lineNum">    2541</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L2542"><span class="lineNum">    2542</span>                 :             : </span>
<span id="L2543"><span class="lineNum">    2543</span>                 :             :         // set the start-height</span>
<span id="L2544"><span class="lineNum">    2544</span>                 :<span class="tlaUNC">           0 :         const CBlockIndex* start_index = nullptr;</span></span>
<span id="L2545"><span class="lineNum">    2545</span>                 :<span class="tlaUNC">           0 :         const CBlockIndex* stop_block = nullptr;</span></span>
<span id="L2546"><span class="lineNum">    2546</span>                 :<span class="tlaUNC">           0 :         {</span></span>
<span id="L2547"><span class="lineNum">    2547</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             LOCK(cs_main);</span></span>
<span id="L2548"><span class="lineNum">    2548</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CChain&amp; active_chain = chainman.ActiveChain();</span></span>
<span id="L2549"><span class="lineNum">    2549</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             start_index = active_chain.Genesis();</span></span>
<span id="L2550"><span class="lineNum">    2550</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             stop_block = active_chain.Tip(); // If no stop block is provided, stop at the chain tip.</span></span>
<span id="L2551"><span class="lineNum">    2551</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!request.params[2].isNull()) {</span></span>
<span id="L2552"><span class="lineNum">    2552</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 start_index = active_chain[request.params[2].getInt&lt;int&gt;()];</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2553"><span class="lineNum">    2553</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!start_index) {</span></span>
<span id="L2554"><span class="lineNum">    2554</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_MISC_ERROR, &quot;Invalid start_height&quot;);</span></span>
<span id="L2555"><span class="lineNum">    2555</span>                 :             :                 }</span>
<span id="L2556"><span class="lineNum">    2556</span>                 :             :             }</span>
<span id="L2557"><span class="lineNum">    2557</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!request.params[3].isNull()) {</span></span>
<span id="L2558"><span class="lineNum">    2558</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 stop_block = active_chain[request.params[3].getInt&lt;int&gt;()];</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2559"><span class="lineNum">    2559</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!stop_block || stop_block-&gt;nHeight &lt; start_index-&gt;nHeight) {</span></span>
<span id="L2560"><span class="lineNum">    2560</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_MISC_ERROR, &quot;Invalid stop_height&quot;);</span></span>
<span id="L2561"><span class="lineNum">    2561</span>                 :             :                 }</span>
<span id="L2562"><span class="lineNum">    2562</span>                 :             :             }</span>
<span id="L2563"><span class="lineNum">    2563</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L2564"><span class="lineNum">    2564</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(start_index);</span></span>
<span id="L2565"><span class="lineNum">    2565</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(stop_block);</span></span>
<span id="L2566"><span class="lineNum">    2566</span>                 :             : </span>
<span id="L2567"><span class="lineNum">    2567</span>                 :             :         // loop through the scan objects, add scripts to the needle_set</span>
<span id="L2568"><span class="lineNum">    2568</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         GCSFilter::ElementSet needle_set;</span></span>
<span id="L2569"><span class="lineNum">    2569</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         for (const UniValue&amp; scanobject : request.params[1].get_array().getValues()) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2570"><span class="lineNum">    2570</span>                 :<span class="tlaUNC">           0 :             FlatSigningProvider provider;</span></span>
<span id="L2571"><span class="lineNum">    2571</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::vector&lt;CScript&gt; scripts = EvalDescriptorStringOrObject(scanobject, provider);</span></span>
<span id="L2572"><span class="lineNum">    2572</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const CScript&amp; script : scripts) {</span></span>
<span id="L2573"><span class="lineNum">    2573</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 needle_set.emplace(script.begin(), script.end());</span></span>
<span id="L2574"><span class="lineNum">    2574</span>                 :             :             }</span>
<span id="L2575"><span class="lineNum">    2575</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L2576"><span class="lineNum">    2576</span>                 :<span class="tlaUNC">           0 :         UniValue blocks(UniValue::VARR);</span></span>
<span id="L2577"><span class="lineNum">    2577</span>                 :<span class="tlaUNC">           0 :         const int amount_per_chunk = 10000;</span></span>
<span id="L2578"><span class="lineNum">    2578</span>                 :<span class="tlaUNC">           0 :         std::vector&lt;BlockFilter&gt; filters;</span></span>
<span id="L2579"><span class="lineNum">    2579</span>                 :<span class="tlaUNC">           0 :         int start_block_height = start_index-&gt;nHeight; // for progress reporting</span></span>
<span id="L2580"><span class="lineNum">    2580</span>                 :<span class="tlaUNC">           0 :         const int total_blocks_to_process = stop_block-&gt;nHeight - start_block_height;</span></span>
<span id="L2581"><span class="lineNum">    2581</span>                 :             : </span>
<span id="L2582"><span class="lineNum">    2582</span>                 :<span class="tlaUNC">           0 :         g_scanfilter_should_abort_scan = false;</span></span>
<span id="L2583"><span class="lineNum">    2583</span>                 :<span class="tlaUNC">           0 :         g_scanfilter_progress = 0;</span></span>
<span id="L2584"><span class="lineNum">    2584</span>                 :<span class="tlaUNC">           0 :         g_scanfilter_progress_height = start_block_height;</span></span>
<span id="L2585"><span class="lineNum">    2585</span>                 :<span class="tlaUNC">           0 :         bool completed = true;</span></span>
<span id="L2586"><span class="lineNum">    2586</span>                 :             : </span>
<span id="L2587"><span class="lineNum">    2587</span>                 :<span class="tlaUNC">           0 :         const CBlockIndex* end_range = nullptr;</span></span>
<span id="L2588"><span class="lineNum">    2588</span>                 :<span class="tlaUNC">           0 :         do {</span></span>
<span id="L2589"><span class="lineNum">    2589</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             node.rpc_interruption_point(); // allow a clean shutdown</span></span>
<span id="L2590"><span class="lineNum">    2590</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (g_scanfilter_should_abort_scan) {</span></span>
<span id="L2591"><span class="lineNum">    2591</span>                 :<span class="tlaUNC">           0 :                 completed = false;</span></span>
<span id="L2592"><span class="lineNum">    2592</span>                 :<span class="tlaUNC">           0 :                 break;</span></span>
<span id="L2593"><span class="lineNum">    2593</span>                 :             :             }</span>
<span id="L2594"><span class="lineNum">    2594</span>                 :             : </span>
<span id="L2595"><span class="lineNum">    2595</span>                 :             :             // split the lookup range in chunks if we are deeper than 'amount_per_chunk' blocks from the stopping block</span>
<span id="L2596"><span class="lineNum">    2596</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             int start_block = !end_range ? start_index-&gt;nHeight : start_index-&gt;nHeight + 1; // to not include the previous round 'end_range' block</span></span>
<span id="L2597"><span class="lineNum">    2597</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             end_range = (start_block + amount_per_chunk &lt; stop_block-&gt;nHeight) ?</span></span>
<span id="L2598"><span class="lineNum">    2598</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     WITH_LOCK(::cs_main, return chainman.ActiveChain()[start_block + amount_per_chunk]) :</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2599"><span class="lineNum">    2599</span>                 :             :                     stop_block;</span>
<span id="L2600"><span class="lineNum">    2600</span>                 :             : </span>
<span id="L2601"><span class="lineNum">    2601</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (index-&gt;LookupFilterRange(start_block, end_range, filters)) {</span></span>
<span id="L2602"><span class="lineNum">    2602</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 for (const BlockFilter&amp; filter : filters) {</span></span>
<span id="L2603"><span class="lineNum">    2603</span>                 :             :                     // compare the elements-set with each filter</span>
<span id="L2604"><span class="lineNum">    2604</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (filter.GetFilter().MatchAny(needle_set)) {</span></span>
<span id="L2605"><span class="lineNum">    2605</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         if (filter_false_positives) {</span></span>
<span id="L2606"><span class="lineNum">    2606</span>                 :             :                             // Double check the filter matches by scanning the block</span>
<span id="L2607"><span class="lineNum">    2607</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                             const CBlockIndex&amp; blockindex = *CHECK_NONFATAL(WITH_LOCK(cs_main, return chainman.m_blockman.LookupBlockIndex(filter.GetBlockHash())));</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2608"><span class="lineNum">    2608</span>                 :             : </span>
<span id="L2609"><span class="lineNum">    2609</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                             if (!CheckBlockFilterMatches(chainman.m_blockman, blockindex, needle_set)) {</span></span>
<span id="L2610"><span class="lineNum">    2610</span>                 :<span class="tlaUNC">           0 :                                 continue;</span></span>
<span id="L2611"><span class="lineNum">    2611</span>                 :             :                             }</span>
<span id="L2612"><span class="lineNum">    2612</span>                 :             :                         }</span>
<span id="L2613"><span class="lineNum">    2613</span>                 :             : </span>
<span id="L2614"><span class="lineNum">    2614</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                         blocks.push_back(filter.GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2615"><span class="lineNum">    2615</span>                 :             :                     }</span>
<span id="L2616"><span class="lineNum">    2616</span>                 :             :                 }</span>
<span id="L2617"><span class="lineNum">    2617</span>                 :             :             }</span>
<span id="L2618"><span class="lineNum">    2618</span>                 :<span class="tlaUNC">           0 :             start_index = end_range;</span></span>
<span id="L2619"><span class="lineNum">    2619</span>                 :             : </span>
<span id="L2620"><span class="lineNum">    2620</span>                 :             :             // update progress</span>
<span id="L2621"><span class="lineNum">    2621</span>                 :<span class="tlaUNC">           0 :             int blocks_processed = end_range-&gt;nHeight - start_block_height;</span></span>
<span id="L2622"><span class="lineNum">    2622</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (total_blocks_to_process &gt; 0) { // avoid division by zero</span></span>
<span id="L2623"><span class="lineNum">    2623</span>                 :<span class="tlaUNC">           0 :                 g_scanfilter_progress = (int)(100.0 / total_blocks_to_process * blocks_processed);</span></span>
<span id="L2624"><span class="lineNum">    2624</span>                 :             :             } else {</span>
<span id="L2625"><span class="lineNum">    2625</span>                 :<span class="tlaUNC">           0 :                 g_scanfilter_progress = 100;</span></span>
<span id="L2626"><span class="lineNum">    2626</span>                 :             :             }</span>
<span id="L2627"><span class="lineNum">    2627</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             g_scanfilter_progress_height = end_range-&gt;nHeight;</span></span>
<span id="L2628"><span class="lineNum">    2628</span>                 :             : </span>
<span id="L2629"><span class="lineNum">    2629</span>                 :             :         // Finish if we reached the stop block</span>
<span id="L2630"><span class="lineNum">    2630</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } while (start_index != stop_block);</span></span>
<span id="L2631"><span class="lineNum">    2631</span>                 :             : </span>
<span id="L2632"><span class="lineNum">    2632</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;from_height&quot;, start_block_height);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2633"><span class="lineNum">    2633</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;to_height&quot;, start_index-&gt;nHeight); // start_index is always the last scanned block here</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2634"><span class="lineNum">    2634</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ret.pushKV(&quot;relevant_blocks&quot;, std::move(blocks));</span></span>
<span id="L2635"><span class="lineNum">    2635</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         ret.pushKV(&quot;completed&quot;, completed);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2636"><span class="lineNum">    2636</span>                 :<span class="tlaGNC">           9 :     }</span></span>
<span id="L2637"><span class="lineNum">    2637</span>                 :             :     else {</span>
<span id="L2638"><span class="lineNum">    2638</span>   [<span class="tlaGBC" title="Branch 0 was taken 9 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 9 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          18 :         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Invalid action '%s'&quot;, request.params[0].get_str()));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 9 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 9 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2639"><span class="lineNum">    2639</span>                 :             :     }</span>
<span id="L2640"><span class="lineNum">    2640</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L2641"><span class="lineNum">    2641</span>                 :<span class="tlaGNC">          20 : },</span></span>
<span id="L2642"><span class="lineNum">    2642</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1581 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 372 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 93 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 558 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L2643"><span class="lineNum">    2643</span>   [<span class="tlaGBC" title="Branch 0 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1860 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 93 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 93 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 93 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 93 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaUNC" title="Branch 36 was not taken"> - </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaUNC" title="Branch 38 was not taken"> - </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaUNC" title="Branch 40 was not taken"> - </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaUNC" title="Branch 42 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 43 was not taken"> - </span>]
<span id="L2644"><span class="lineNum">    2644</span>                 :             : </span>
<span id="L2645"><span class="lineNum">    2645</span>                 :<span class="tlaGNC">         207 : static RPCHelpMan getdescriptoractivity()</span></span>
<span id="L2646"><span class="lineNum">    2646</span>                 :             : {</span>
<span id="L2647"><span class="lineNum">    2647</span>                 :<span class="tlaGNC">         207 :     return RPCHelpMan{</span></span>
<span id="L2648"><span class="lineNum">    2648</span>                 :<span class="tlaGNC">         207 :         &quot;getdescriptoractivity&quot;,</span></span>
<span id="L2649"><span class="lineNum">    2649</span>         [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         414 :         &quot;Get spend and receive activity associated with a set of descriptors for a set of blocks. &quot;</span></span>
<span id="L2650"><span class="lineNum">    2650</span>                 :             :         &quot;This command pairs well with the `relevant_blocks` output of `scanblocks()`.\n&quot;</span>
<span id="L2651"><span class="lineNum">    2651</span>                 :             :         &quot;This call may take several minutes. If you encounter timeouts, try specifying no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L2652"><span class="lineNum">    2652</span>                 :             :         {</span>
<span id="L2653"><span class="lineNum">    2653</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :             RPCArg{&quot;blockhashes&quot;, RPCArg::Type::ARR, RPCArg::Optional::NO, &quot;The list of blockhashes to examine for activity. Order doesn't matter. Must be along main chain or an error is thrown.\n&quot;, {</span></span>
<span id="L2654"><span class="lineNum">    2654</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                 {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::OMITTED, &quot;A valid blockhash&quot;},</span></span>
<span id="L2655"><span class="lineNum">    2655</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 207 times"> + </span> :<span class="tlaGNC">         621 :             }},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2656"><span class="lineNum">    2656</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :             RPCArg{&quot;scanobjects&quot;, RPCArg::Type::ARR, RPCArg::Optional::NO, &quot;The list of descriptors (scan objects) to examine for activity. Every scan object is either a string descriptor or an object:&quot;,</span></span>
<span id="L2657"><span class="lineNum">    2657</span>                 :             :                 {</span>
<span id="L2658"><span class="lineNum">    2658</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                     {&quot;descriptor&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;An output descriptor&quot;},</span></span>
<span id="L2659"><span class="lineNum">    2659</span>                 :             :                     output_descriptor_obj,</span>
<span id="L2660"><span class="lineNum">    2660</span>                 :             :                 },</span>
<span id="L2661"><span class="lineNum">    2661</span>         [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         207 :                 RPCArgOptions{.oneline_description=&quot;[scanobjects,...]&quot;},</span></span>
<span id="L2662"><span class="lineNum">    2662</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 414 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 207 times"> + </span> :<span class="tlaGNC">         828 :             },</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2663"><span class="lineNum">    2663</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         621 :             {&quot;include_mempool&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Whether to include unconfirmed activity&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2664"><span class="lineNum">    2664</span>                 :             :         },</span>
<span id="L2665"><span class="lineNum">    2665</span>         [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         414 :         RPCResult{</span></span>
<span id="L2666"><span class="lineNum">    2666</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L2667"><span class="lineNum">    2667</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                 {RPCResult::Type::ARR, &quot;activity&quot;, &quot;events&quot;, {</span></span>
<span id="L2668"><span class="lineNum">    2668</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                     {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L2669"><span class="lineNum">    2669</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR, &quot;type&quot;, &quot;always 'spend'&quot;},</span></span>
<span id="L2670"><span class="lineNum">    2670</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_AMOUNT, &quot;amount&quot;, &quot;The total amount in &quot; + CURRENCY_UNIT + &quot; of the spent output&quot;},</span></span>
<span id="L2671"><span class="lineNum">    2671</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_HEX, &quot;blockhash&quot;, /*optional=*/true, &quot;The blockhash this spend appears in (omitted if unconfirmed)&quot;},</span></span>
<span id="L2672"><span class="lineNum">    2672</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::NUM, &quot;height&quot;, /*optional=*/true, &quot;Height of the spend (omitted if unconfirmed)&quot;},</span></span>
<span id="L2673"><span class="lineNum">    2673</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_HEX, &quot;spend_txid&quot;, &quot;The txid of the spending transaction&quot;},</span></span>
<span id="L2674"><span class="lineNum">    2674</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::NUM, &quot;spend_vin&quot;, &quot;The input index of the spend&quot;},</span></span>
<span id="L2675"><span class="lineNum">    2675</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_HEX, &quot;prevout_txid&quot;, &quot;The txid of the prevout&quot;},</span></span>
<span id="L2676"><span class="lineNum">    2676</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::NUM, &quot;prevout_vout&quot;, &quot;The vout of the prevout&quot;},</span></span>
<span id="L2677"><span class="lineNum">    2677</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         414 :                         {RPCResult::Type::OBJ, &quot;prevout_spk&quot;, &quot;&quot;, ScriptPubKeyDoc()},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2678"><span class="lineNum">    2678</span>                 :             :                     }},</span>
<span id="L2679"><span class="lineNum">    2679</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                     {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L2680"><span class="lineNum">    2680</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR, &quot;type&quot;, &quot;always 'receive'&quot;},</span></span>
<span id="L2681"><span class="lineNum">    2681</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_AMOUNT, &quot;amount&quot;, &quot;The total amount in &quot; + CURRENCY_UNIT + &quot; of the new output&quot;},</span></span>
<span id="L2682"><span class="lineNum">    2682</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_HEX, &quot;blockhash&quot;, /*optional=*/true, &quot;The block that this receive is in (omitted if unconfirmed)&quot;},</span></span>
<span id="L2683"><span class="lineNum">    2683</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::NUM, &quot;height&quot;, /*optional=*/true, &quot;The height of the receive (omitted if unconfirmed)&quot;},</span></span>
<span id="L2684"><span class="lineNum">    2684</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::STR_HEX, &quot;txid&quot;, &quot;The txid of the receiving transaction&quot;},</span></span>
<span id="L2685"><span class="lineNum">    2685</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         414 :                         {RPCResult::Type::NUM, &quot;vout&quot;, &quot;The vout of the receiving output&quot;},</span></span>
<span id="L2686"><span class="lineNum">    2686</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         414 :                         {RPCResult::Type::OBJ, &quot;output_spk&quot;, &quot;&quot;, ScriptPubKeyDoc()},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2687"><span class="lineNum">    2687</span>                 :             :                     }},</span>
<span id="L2688"><span class="lineNum">    2688</span>                 :             :                     // TODO is the skip_type_check avoidable with a heterogeneous ARR?</span>
<span id="L2689"><span class="lineNum">    2689</span>                 :             :                 }, /*skip_type_check=*/true},</span>
<span id="L2690"><span class="lineNum">    2690</span>                 :             :             },</span>
<span id="L2691"><span class="lineNum">    2691</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        8073 :         },</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 207 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 207 times"> + </span><span class="tlaGBC" title="Branch 12 was taken 414 times"> + </span><span class="tlaGBC" title="Branch 13 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 1449 times"> + </span><span class="tlaGBC" title="Branch 15 was taken 207 times"> + </span><span class="tlaGBC" title="Branch 16 was taken 1863 times"> + </span><span class="tlaGBC" title="Branch 17 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaUNC" title="Branch 20 was not taken"> - </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaUNC" title="Branch 22 was not taken"> - </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 24 was not taken"> - </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span>]
<span id="L2692"><span class="lineNum">    2692</span>                 :<span class="tlaGNC">         207 :         RPCExamples{</span></span>
<span id="L2693"><span class="lineNum">    2693</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         414 :             HelpExampleCli(&quot;getdescriptoractivity&quot;, &quot;'[\&quot;000000000000000000001347062c12fded7c528943c8ce133987e2e2f5a840ee\&quot;]' '[\&quot;addr(bc1qzl6nsgqzu89a66l50cvwapnkw5shh23zarqkw9)\&quot;]'&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2694"><span class="lineNum">    2694</span>         [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         207 :         },</span></span>
<span id="L2695"><span class="lineNum">    2695</span>                 :<span class="tlaGNC">         207 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L2696"><span class="lineNum">    2696</span>                 :             : {</span>
<span id="L2697"><span class="lineNum">    2697</span>                 :<span class="tlaGNC">         136 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L2698"><span class="lineNum">    2698</span>                 :<span class="tlaGNC">         136 :     UniValue activity(UniValue::VARR);</span></span>
<span id="L2699"><span class="lineNum">    2699</span>         [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L2700"><span class="lineNum">    2700</span>         [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :     ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L2701"><span class="lineNum">    2701</span>                 :             : </span>
<span id="L2702"><span class="lineNum">    2702</span>                 :<span class="tlaGNC">         136 :     struct CompareByHeightAscending {</span></span>
<span id="L2703"><span class="lineNum">    2703</span>                 :<span class="tlaUNC">           0 :         bool operator()(const CBlockIndex* a, const CBlockIndex* b) const {</span></span>
<span id="L2704"><span class="lineNum">    2704</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             return a-&gt;nHeight &lt; b-&gt;nHeight;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2705"><span class="lineNum">    2705</span>                 :             :         }</span>
<span id="L2706"><span class="lineNum">    2706</span>                 :             :     };</span>
<span id="L2707"><span class="lineNum">    2707</span>                 :             : </span>
<span id="L2708"><span class="lineNum">    2708</span>         [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :     std::set&lt;const CBlockIndex*, CompareByHeightAscending&gt; blockindexes_sorted;</span></span>
<span id="L2709"><span class="lineNum">    2709</span>                 :             : </span>
<span id="L2710"><span class="lineNum">    2710</span>                 :<span class="tlaGNC">         136 :     {</span></span>
<span id="L2711"><span class="lineNum">    2711</span>                 :             :         // Validate all given blockhashes, and ensure blocks are along a single chain.</span>
<span id="L2712"><span class="lineNum">    2712</span>         [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         136 :         LOCK(::cs_main);</span></span>
<span id="L2713"><span class="lineNum">    2713</span>   [<span class="tlaGBC" title="Branch 0 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         136 :         for (const UniValue&amp; blockhash : request.params[0].get_array().getValues()) {</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 136 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 132 times"> + </span>]
<span id="L2714"><span class="lineNum">    2714</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">           4 :             uint256 bhash = ParseHashV(blockhash, &quot;blockhash&quot;);</span></span>
<span id="L2715"><span class="lineNum">    2715</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :             CBlockIndex* pindex = chainman.m_blockman.LookupBlockIndex(bhash);</span></span>
<span id="L2716"><span class="lineNum">    2716</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :             if (!pindex) {</span></span>
<span id="L2717"><span class="lineNum">    2717</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :                 throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L2718"><span class="lineNum">    2718</span>                 :             :             }</span>
<span id="L2719"><span class="lineNum">    2719</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!chainman.ActiveChain().Contains(pindex)) {</span></span>
<span id="L2720"><span class="lineNum">    2720</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Block is not in main chain&quot;);</span></span>
<span id="L2721"><span class="lineNum">    2721</span>                 :             :             }</span>
<span id="L2722"><span class="lineNum">    2722</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             blockindexes_sorted.insert(pindex);</span></span>
<span id="L2723"><span class="lineNum">    2723</span>                 :             :         }</span>
<span id="L2724"><span class="lineNum">    2724</span>                 :<span class="tlaGNC">           4 :     }</span></span>
<span id="L2725"><span class="lineNum">    2725</span>                 :             : </span>
<span id="L2726"><span class="lineNum">    2726</span>         [<span class="tlaGBC" title="Branch 0 was taken 132 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         132 :     std::set&lt;CScript&gt; scripts_to_watch;</span></span>
<span id="L2727"><span class="lineNum">    2727</span>                 :             : </span>
<span id="L2728"><span class="lineNum">    2728</span>                 :             :     // Determine scripts to watch.</span>
<span id="L2729"><span class="lineNum">    2729</span>   [<span class="tlaGBC" title="Branch 0 was taken 132 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 132 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         602 :     for (const UniValue&amp; scanobject : request.params[1].get_array().getValues()) {</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 132 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 528 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 74 times"> + </span>]
<span id="L2730"><span class="lineNum">    2730</span>                 :<span class="tlaGNC">         528 :         FlatSigningProvider provider;</span></span>
<span id="L2731"><span class="lineNum">    2731</span>         [<span class="tlaGBC" title="Branch 0 was taken 470 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 58 times"> + </span>]:<span class="tlaGNC">         528 :         std::vector&lt;CScript&gt; scripts = EvalDescriptorStringOrObject(scanobject, provider);</span></span>
<span id="L2732"><span class="lineNum">    2732</span>                 :             : </span>
<span id="L2733"><span class="lineNum">    2733</span>         [<span class="tlaGBC" title="Branch 0 was taken 470 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 470 times"> + </span>]:<span class="tlaGNC">         940 :         for (const CScript&amp; script : scripts) {</span></span>
<span id="L2734"><span class="lineNum">    2734</span>         [<span class="tlaGBC" title="Branch 0 was taken 470 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         470 :             scripts_to_watch.insert(script);</span></span>
<span id="L2735"><span class="lineNum">    2735</span>                 :             :         }</span>
<span id="L2736"><span class="lineNum">    2736</span>                 :<span class="tlaGNC">         528 :     }</span></span>
<span id="L2737"><span class="lineNum">    2737</span>                 :             : </span>
<span id="L2738"><span class="lineNum">    2738</span>                 :<span class="tlaGNC">          74 :     const auto AddSpend = [&amp;](</span></span>
<span id="L2739"><span class="lineNum">    2739</span>                 :             :             const CScript&amp; spk,</span>
<span id="L2740"><span class="lineNum">    2740</span>                 :             :             const CAmount val,</span>
<span id="L2741"><span class="lineNum">    2741</span>                 :             :             const CTransactionRef&amp; tx,</span>
<span id="L2742"><span class="lineNum">    2742</span>                 :             :             int vin,</span>
<span id="L2743"><span class="lineNum">    2743</span>                 :             :             const CTxIn&amp; txin,</span>
<span id="L2744"><span class="lineNum">    2744</span>                 :             :             const CBlockIndex* index</span>
<span id="L2745"><span class="lineNum">    2745</span>                 :             :             ) {</span>
<span id="L2746"><span class="lineNum">    2746</span>                 :<span class="tlaUNC">           0 :         UniValue event(UniValue::VOBJ);</span></span>
<span id="L2747"><span class="lineNum">    2747</span>                 :<span class="tlaUNC">           0 :         UniValue spkUv(UniValue::VOBJ);</span></span>
<span id="L2748"><span class="lineNum">    2748</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ScriptToUniv(spk, /*out=*/spkUv, /*include_hex=*/true, /*include_address=*/true);</span></span>
<span id="L2749"><span class="lineNum">    2749</span>                 :             : </span>
<span id="L2750"><span class="lineNum">    2750</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;type&quot;, &quot;spend&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2751"><span class="lineNum">    2751</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;amount&quot;, ValueFromAmount(val));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2752"><span class="lineNum">    2752</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (index) {</span></span>
<span id="L2753"><span class="lineNum">    2753</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             event.pushKV(&quot;blockhash&quot;, index-&gt;GetBlockHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2754"><span class="lineNum">    2754</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             event.pushKV(&quot;height&quot;, index-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2755"><span class="lineNum">    2755</span>                 :             :         }</span>
<span id="L2756"><span class="lineNum">    2756</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;spend_txid&quot;, tx-&gt;GetHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2757"><span class="lineNum">    2757</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;spend_vin&quot;, vin);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2758"><span class="lineNum">    2758</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;prevout_txid&quot;, txin.prevout.hash.ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2759"><span class="lineNum">    2759</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;prevout_vout&quot;, txin.prevout.n);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2760"><span class="lineNum">    2760</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;prevout_spk&quot;, spkUv);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2761"><span class="lineNum">    2761</span>                 :             : </span>
<span id="L2762"><span class="lineNum">    2762</span>                 :<span class="tlaUNC">           0 :         return event;</span></span>
<span id="L2763"><span class="lineNum">    2763</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2764"><span class="lineNum">    2764</span>                 :             : </span>
<span id="L2765"><span class="lineNum">    2765</span>                 :<span class="tlaGNC">          74 :     const auto AddReceive = [&amp;](const CTxOut&amp; txout, const CBlockIndex* index, int vout, const CTransactionRef&amp; tx) {</span></span>
<span id="L2766"><span class="lineNum">    2766</span>                 :<span class="tlaUNC">           0 :         UniValue event(UniValue::VOBJ);</span></span>
<span id="L2767"><span class="lineNum">    2767</span>                 :<span class="tlaUNC">           0 :         UniValue spkUv(UniValue::VOBJ);</span></span>
<span id="L2768"><span class="lineNum">    2768</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ScriptToUniv(txout.scriptPubKey, /*out=*/spkUv, /*include_hex=*/true, /*include_address=*/true);</span></span>
<span id="L2769"><span class="lineNum">    2769</span>                 :             : </span>
<span id="L2770"><span class="lineNum">    2770</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;type&quot;, &quot;receive&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2771"><span class="lineNum">    2771</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;amount&quot;, ValueFromAmount(txout.nValue));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2772"><span class="lineNum">    2772</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (index) {</span></span>
<span id="L2773"><span class="lineNum">    2773</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             event.pushKV(&quot;blockhash&quot;, index-&gt;GetBlockHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2774"><span class="lineNum">    2774</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             event.pushKV(&quot;height&quot;, index-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2775"><span class="lineNum">    2775</span>                 :             :         }</span>
<span id="L2776"><span class="lineNum">    2776</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;txid&quot;, tx-&gt;GetHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2777"><span class="lineNum">    2777</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;vout&quot;, vout);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2778"><span class="lineNum">    2778</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         event.pushKV(&quot;output_spk&quot;, spkUv);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2779"><span class="lineNum">    2779</span>                 :             : </span>
<span id="L2780"><span class="lineNum">    2780</span>                 :<span class="tlaUNC">           0 :         return event;</span></span>
<span id="L2781"><span class="lineNum">    2781</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2782"><span class="lineNum">    2782</span>                 :             : </span>
<span id="L2783"><span class="lineNum">    2783</span>                 :<span class="tlaGNC">          74 :     BlockManager* blockman;</span></span>
<span id="L2784"><span class="lineNum">    2784</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          74 :     Chainstate&amp; active_chainstate = chainman.ActiveChainstate();</span></span>
<span id="L2785"><span class="lineNum">    2785</span>                 :<span class="tlaGNC">          74 :     {</span></span>
<span id="L2786"><span class="lineNum">    2786</span>         [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          74 :         LOCK(::cs_main);</span></span>
<span id="L2787"><span class="lineNum">    2787</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          74 :         blockman = CHECK_NONFATAL(&amp;active_chainstate.m_blockman);</span></span>
<span id="L2788"><span class="lineNum">    2788</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L2789"><span class="lineNum">    2789</span>                 :             : </span>
<span id="L2790"><span class="lineNum">    2790</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 74 times"> + </span>]:<span class="tlaGNC">          74 :     for (const CBlockIndex* blockindex : blockindexes_sorted) {</span></span>
<span id="L2791"><span class="lineNum">    2791</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const CBlock block{GetBlockChecked(chainman.m_blockman, *blockindex)};</span></span>
<span id="L2792"><span class="lineNum">    2792</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const CBlockUndo block_undo{GetUndoChecked(*blockman, *blockindex)};</span></span>
<span id="L2793"><span class="lineNum">    2793</span>                 :             : </span>
<span id="L2794"><span class="lineNum">    2794</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (size_t i = 0; i &lt; block.vtx.size(); ++i) {</span></span>
<span id="L2795"><span class="lineNum">    2795</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const auto&amp; tx = block.vtx.at(i);</span></span>
<span id="L2796"><span class="lineNum">    2796</span>                 :             : </span>
<span id="L2797"><span class="lineNum">    2797</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!tx-&gt;IsCoinBase()) {</span></span>
<span id="L2798"><span class="lineNum">    2798</span>                 :             :                 // skip coinbase; spends can't happen there.</span>
<span id="L2799"><span class="lineNum">    2799</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const auto&amp; txundo = block_undo.vtxundo.at(i - 1);</span></span>
<span id="L2800"><span class="lineNum">    2800</span>                 :             : </span>
<span id="L2801"><span class="lineNum">    2801</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 for (size_t vin_idx = 0; vin_idx &lt; tx-&gt;vin.size(); ++vin_idx) {</span></span>
<span id="L2802"><span class="lineNum">    2802</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     const auto&amp; coin = txundo.vprevout.at(vin_idx);</span></span>
<span id="L2803"><span class="lineNum">    2803</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     const auto&amp; txin = tx-&gt;vin.at(vin_idx);</span></span>
<span id="L2804"><span class="lineNum">    2804</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (scripts_to_watch.contains(coin.out.scriptPubKey)) {</span></span>
<span id="L2805"><span class="lineNum">    2805</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         activity.push_back(AddSpend(</span></span>
<span id="L2806"><span class="lineNum">    2806</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     coin.out.scriptPubKey, coin.out.nValue, tx, vin_idx, txin, blockindex));</span></span>
<span id="L2807"><span class="lineNum">    2807</span>                 :             :                     }</span>
<span id="L2808"><span class="lineNum">    2808</span>                 :             :                 }</span>
<span id="L2809"><span class="lineNum">    2809</span>                 :             :             }</span>
<span id="L2810"><span class="lineNum">    2810</span>                 :             : </span>
<span id="L2811"><span class="lineNum">    2811</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (size_t vout_idx = 0; vout_idx &lt; tx-&gt;vout.size(); ++vout_idx) {</span></span>
<span id="L2812"><span class="lineNum">    2812</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const auto&amp; vout = tx-&gt;vout.at(vout_idx);</span></span>
<span id="L2813"><span class="lineNum">    2813</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (scripts_to_watch.contains(vout.scriptPubKey)) {</span></span>
<span id="L2814"><span class="lineNum">    2814</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     activity.push_back(AddReceive(vout, blockindex, vout_idx, tx));</span></span>
<span id="L2815"><span class="lineNum">    2815</span>                 :             :                 }</span>
<span id="L2816"><span class="lineNum">    2816</span>                 :             :             }</span>
<span id="L2817"><span class="lineNum">    2817</span>                 :             :         }</span>
<span id="L2818"><span class="lineNum">    2818</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L2819"><span class="lineNum">    2819</span>                 :             : </span>
<span id="L2820"><span class="lineNum">    2820</span>                 :<span class="tlaGNC">          74 :     bool search_mempool = true;</span></span>
<span id="L2821"><span class="lineNum">    2821</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 14 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 60 times"> + </span>]:<span class="tlaGNC">          74 :     if (!request.params[2].isNull()) {</span></span>
<span id="L2822"><span class="lineNum">    2822</span>   [<span class="tlaGBC" title="Branch 0 was taken 14 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 14 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          14 :         search_mempool = request.params[2].get_bool();</span></span>
<span id="L2823"><span class="lineNum">    2823</span>                 :             :     }</span>
<span id="L2824"><span class="lineNum">    2824</span>                 :             : </span>
<span id="L2825"><span class="lineNum">    2825</span>         [<span class="tlaGBC" title="Branch 0 was taken 1 time"> + </span><span class="tlaGBC" title="Branch 1 was taken 13 times"> + </span>]:<span class="tlaGNC">          14 :     if (search_mempool) {</span></span>
<span id="L2826"><span class="lineNum">    2826</span>         [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          61 :         const CTxMemPool&amp; mempool = EnsureMemPool(node);</span></span>
<span id="L2827"><span class="lineNum">    2827</span>         [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          61 :         LOCK(::cs_main);</span></span>
<span id="L2828"><span class="lineNum">    2828</span>         [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          61 :         LOCK(mempool.cs);</span></span>
<span id="L2829"><span class="lineNum">    2829</span>   [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">          61 :         const CCoinsViewCache&amp; coins_view = &amp;active_chainstate.CoinsTip();</span></span>
<span id="L2830"><span class="lineNum">    2830</span>                 :             : </span>
<span id="L2831"><span class="lineNum">    2831</span>   [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">          61 :         for (const CTxMemPoolEntry&amp; e : mempool.entryAll()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaGBC" title="Branch 5 was taken 61 times"> + </span>]
<span id="L2832"><span class="lineNum">    2832</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const auto&amp; tx = e.GetSharedTx();</span></span>
<span id="L2833"><span class="lineNum">    2833</span>                 :             : </span>
<span id="L2834"><span class="lineNum">    2834</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (size_t vin_idx = 0; vin_idx &lt; tx-&gt;vin.size(); ++vin_idx) {</span></span>
<span id="L2835"><span class="lineNum">    2835</span>                 :<span class="tlaUNC">           0 :                 CScript scriptPubKey;</span></span>
<span id="L2836"><span class="lineNum">    2836</span>                 :<span class="tlaUNC">           0 :                 CAmount value;</span></span>
<span id="L2837"><span class="lineNum">    2837</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const auto&amp; txin = tx-&gt;vin.at(vin_idx);</span></span>
<span id="L2838"><span class="lineNum">    2838</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 std::optional&lt;Coin&gt; coin = coins_view.GetCoin(txin.prevout);</span></span>
<span id="L2839"><span class="lineNum">    2839</span>                 :             : </span>
<span id="L2840"><span class="lineNum">    2840</span>                 :             :                 // Check if the previous output is in the chain</span>
<span id="L2841"><span class="lineNum">    2841</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!coin) {</span></span>
<span id="L2842"><span class="lineNum">    2842</span>                 :             :                     // If not found in the chain, check the mempool. Likely, this is a</span>
<span id="L2843"><span class="lineNum">    2843</span>                 :             :                     // child transaction of another transaction in the mempool.</span>
<span id="L2844"><span class="lineNum">    2844</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     CTransactionRef prev_tx = CHECK_NONFATAL(mempool.get(txin.prevout.hash));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2845"><span class="lineNum">    2845</span>                 :             : </span>
<span id="L2846"><span class="lineNum">    2846</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (txin.prevout.n &gt;= prev_tx-&gt;vout.size()) {</span></span>
<span id="L2847"><span class="lineNum">    2847</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         throw std::runtime_error(&quot;Invalid output index&quot;);</span></span>
<span id="L2848"><span class="lineNum">    2848</span>                 :             :                     }</span>
<span id="L2849"><span class="lineNum">    2849</span>                 :<span class="tlaUNC">           0 :                     const CTxOut&amp; out = prev_tx-&gt;vout[txin.prevout.n];</span></span>
<span id="L2850"><span class="lineNum">    2850</span>                 :<span class="tlaUNC">           0 :                     scriptPubKey = out.scriptPubKey;</span></span>
<span id="L2851"><span class="lineNum">    2851</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     value = out.nValue;</span></span>
<span id="L2852"><span class="lineNum">    2852</span>                 :<span class="tlaUNC">           0 :                 } else {</span></span>
<span id="L2853"><span class="lineNum">    2853</span>                 :             :                     // Coin found in the chain</span>
<span id="L2854"><span class="lineNum">    2854</span>                 :<span class="tlaUNC">           0 :                     const CTxOut&amp; out = coin-&gt;out;</span></span>
<span id="L2855"><span class="lineNum">    2855</span>                 :<span class="tlaUNC">           0 :                     scriptPubKey = out.scriptPubKey;</span></span>
<span id="L2856"><span class="lineNum">    2856</span>                 :<span class="tlaUNC">           0 :                     value = out.nValue;</span></span>
<span id="L2857"><span class="lineNum">    2857</span>                 :             :                 }</span>
<span id="L2858"><span class="lineNum">    2858</span>                 :             : </span>
<span id="L2859"><span class="lineNum">    2859</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (scripts_to_watch.contains(scriptPubKey)) {</span></span>
<span id="L2860"><span class="lineNum">    2860</span>                 :<span class="tlaUNC">           0 :                     UniValue event(UniValue::VOBJ);</span></span>
<span id="L2861"><span class="lineNum">    2861</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     activity.push_back(AddSpend(</span></span>
<span id="L2862"><span class="lineNum">    2862</span>                 :             :                                 scriptPubKey, value, tx, vin_idx, txin, nullptr));</span>
<span id="L2863"><span class="lineNum">    2863</span>                 :<span class="tlaUNC">           0 :                 }</span></span>
<span id="L2864"><span class="lineNum">    2864</span>                 :<span class="tlaUNC">           0 :             }</span></span>
<span id="L2865"><span class="lineNum">    2865</span>                 :             : </span>
<span id="L2866"><span class="lineNum">    2866</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (size_t vout_idx = 0; vout_idx &lt; tx-&gt;vout.size(); ++vout_idx) {</span></span>
<span id="L2867"><span class="lineNum">    2867</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const auto&amp; vout = tx-&gt;vout.at(vout_idx);</span></span>
<span id="L2868"><span class="lineNum">    2868</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (scripts_to_watch.contains(vout.scriptPubKey)) {</span></span>
<span id="L2869"><span class="lineNum">    2869</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     activity.push_back(AddReceive(vout, nullptr, vout_idx, tx));</span></span>
<span id="L2870"><span class="lineNum">    2870</span>                 :             :                 }</span>
<span id="L2871"><span class="lineNum">    2871</span>                 :             :             }</span>
<span id="L2872"><span class="lineNum">    2872</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L2873"><span class="lineNum">    2873</span>   [<span class="tlaGBC" title="Branch 0 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 61 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         183 :     }</span></span>
<span id="L2874"><span class="lineNum">    2874</span>                 :             : </span>
<span id="L2875"><span class="lineNum">    2875</span>   [<span class="tlaGBC" title="Branch 0 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         148 :     ret.pushKV(&quot;activity&quot;, activity);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 74 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2876"><span class="lineNum">    2876</span>                 :<span class="tlaGNC">         148 :     return ret;</span></span>
<span id="L2877"><span class="lineNum">    2877</span>                 :<span class="tlaGNC">         256 : },</span></span>
<span id="L2878"><span class="lineNum">    2878</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        1449 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 621 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2879"><span class="lineNum">    2879</span>   [<span class="tlaGBC" title="Branch 0 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">        5796 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 44 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaGBC" title="Branch 46 was taken 207 times"> + </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaGBC" title="Branch 48 was taken 207 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaUNC" title="Branch 50 was not taken"> - </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span><span class="tlaUNC" title="Branch 52 was not taken"> - </span><span class="tlaUNC" title="Branch 53 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not taken"> - </span><span class="tlaUNC" title="Branch 55 was not taken"> - </span><span class="tlaUNC" title="Branch 56 was not taken"> - </span><span class="tlaUNC" title="Branch 57 was not taken"> - </span><span class="tlaUNC" title="Branch 58 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 59 was not taken"> - </span>]
<span id="L2880"><span class="lineNum">    2880</span>                 :             : </span>
<span id="L2881"><span class="lineNum">    2881</span>                 :<span class="tlaGNC">          82 : static RPCHelpMan getblockfilter()</span></span>
<span id="L2882"><span class="lineNum">    2882</span>                 :             : {</span>
<span id="L2883"><span class="lineNum">    2883</span>                 :<span class="tlaGNC">          82 :     return RPCHelpMan{</span></span>
<span id="L2884"><span class="lineNum">    2884</span>                 :<span class="tlaGNC">          82 :         &quot;getblockfilter&quot;,</span></span>
<span id="L2885"><span class="lineNum">    2885</span>         [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         164 :         &quot;Retrieve a BIP 157 content filter for a particular block.\n&quot;,</span></span>
<span id="L2886"><span class="lineNum">    2886</span>                 :             :                 {</span>
<span id="L2887"><span class="lineNum">    2887</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         164 :                     {&quot;blockhash&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The hash of the block&quot;},</span></span>
<span id="L2888"><span class="lineNum">    2888</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         246 :                     {&quot;filtertype&quot;, RPCArg::Type::STR, RPCArg::Default{BlockFilterTypeName(BlockFilterType::BASIC)}, &quot;The type name of the filter&quot;},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2889"><span class="lineNum">    2889</span>                 :             :                 },</span>
<span id="L2890"><span class="lineNum">    2890</span>         [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         164 :                 RPCResult{</span></span>
<span id="L2891"><span class="lineNum">    2891</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         164 :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L2892"><span class="lineNum">    2892</span>                 :             :                     {</span>
<span id="L2893"><span class="lineNum">    2893</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         164 :                         {RPCResult::Type::STR_HEX, &quot;filter&quot;, &quot;the hex-encoded filter data&quot;},</span></span>
<span id="L2894"><span class="lineNum">    2894</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         164 :                         {RPCResult::Type::STR_HEX, &quot;header&quot;, &quot;the hex-encoded filter header&quot;},</span></span>
<span id="L2895"><span class="lineNum">    2895</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         410 :                     }},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 164 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2896"><span class="lineNum">    2896</span>                 :<span class="tlaGNC">          82 :                 RPCExamples{</span></span>
<span id="L2897"><span class="lineNum">    2897</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         164 :                     HelpExampleCli(&quot;getblockfilter&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot; \&quot;basic\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2898"><span class="lineNum">    2898</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         246 :                     HelpExampleRpc(&quot;getblockfilter&quot;, &quot;\&quot;00000000c937983704a73af28acdec37b049d214adbda81d7e2a3dd146f6ed09\&quot;, \&quot;basic\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2899"><span class="lineNum">    2899</span>         [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          82 :                 },</span></span>
<span id="L2900"><span class="lineNum">    2900</span>                 :<span class="tlaGNC">          82 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L2901"><span class="lineNum">    2901</span>                 :             : {</span>
<span id="L2902"><span class="lineNum">    2902</span>                 :<span class="tlaGNC">           6 :     uint256 block_hash = ParseHashV(request.params[0], &quot;blockhash&quot;);</span></span>
<span id="L2903"><span class="lineNum">    2903</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 6 times"> + </span>]:<span class="tlaGNC">           6 :     std::string filtertype_name = BlockFilterTypeName(BlockFilterType::BASIC);</span></span>
<span id="L2904"><span class="lineNum">    2904</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 2 times"> + </span>]:<span class="tlaGNC">           6 :     if (!request.params[1].isNull()) {</span></span>
<span id="L2905"><span class="lineNum">    2905</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         filtertype_name = request.params[1].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L2906"><span class="lineNum">    2906</span>                 :             :     }</span>
<span id="L2907"><span class="lineNum">    2907</span>                 :             : </span>
<span id="L2908"><span class="lineNum">    2908</span>                 :<span class="tlaGNC">           6 :     BlockFilterType filtertype;</span></span>
<span id="L2909"><span class="lineNum">    2909</span>   [<span class="tlaGBC" title="Branch 0 was taken 6 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaGBC" title="Branch 3 was taken 2 times"> + </span>]:<span class="tlaGNC">           6 :     if (!BlockFilterTypeByName(filtertype_name, filtertype)) {</span></span>
<span id="L2910"><span class="lineNum">    2910</span>   [<span class="tlaGBC" title="Branch 0 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 4 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           8 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Unknown filtertype&quot;);</span></span>
<span id="L2911"><span class="lineNum">    2911</span>                 :             :     }</span>
<span id="L2912"><span class="lineNum">    2912</span>                 :             : </span>
<span id="L2913"><span class="lineNum">    2913</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :     BlockFilterIndex* index = GetBlockFilterIndex(filtertype);</span></span>
<span id="L2914"><span class="lineNum">    2914</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :     if (!index) {</span></span>
<span id="L2915"><span class="lineNum">    2915</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Index is not enabled for filtertype &quot; + filtertype_name);</span></span>
<span id="L2916"><span class="lineNum">    2916</span>                 :             :     }</span>
<span id="L2917"><span class="lineNum">    2917</span>                 :             : </span>
<span id="L2918"><span class="lineNum">    2918</span>                 :<span class="tlaUNC">           0 :     const CBlockIndex* block_index;</span></span>
<span id="L2919"><span class="lineNum">    2919</span>                 :<span class="tlaUNC">           0 :     bool block_was_connected;</span></span>
<span id="L2920"><span class="lineNum">    2920</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L2921"><span class="lineNum">    2921</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L2922"><span class="lineNum">    2922</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(cs_main);</span></span>
<span id="L2923"><span class="lineNum">    2923</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         block_index = chainman.m_blockman.LookupBlockIndex(block_hash);</span></span>
<span id="L2924"><span class="lineNum">    2924</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!block_index) {</span></span>
<span id="L2925"><span class="lineNum">    2925</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found&quot;);</span></span>
<span id="L2926"><span class="lineNum">    2926</span>                 :             :         }</span>
<span id="L2927"><span class="lineNum">    2927</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         block_was_connected = block_index-&gt;IsValid(BLOCK_VALID_SCRIPTS);</span></span>
<span id="L2928"><span class="lineNum">    2928</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L2929"><span class="lineNum">    2929</span>                 :             : </span>
<span id="L2930"><span class="lineNum">    2930</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     bool index_ready = index-&gt;BlockUntilSyncedToCurrentChain();</span></span>
<span id="L2931"><span class="lineNum">    2931</span>                 :             : </span>
<span id="L2932"><span class="lineNum">    2932</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     BlockFilter filter;</span></span>
<span id="L2933"><span class="lineNum">    2933</span>                 :<span class="tlaUNC">           0 :     uint256 filter_header;</span></span>
<span id="L2934"><span class="lineNum">    2934</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (!index-&gt;LookupFilter(block_index, filter) ||</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L2935"><span class="lineNum">    2935</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         !index-&gt;LookupFilterHeader(block_index, filter_header)) {</span></span>
<span id="L2936"><span class="lineNum">    2936</span>                 :<span class="tlaUNC">           0 :         int err_code;</span></span>
<span id="L2937"><span class="lineNum">    2937</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string errmsg = &quot;Filter not found.&quot;;</span></span>
<span id="L2938"><span class="lineNum">    2938</span>                 :             : </span>
<span id="L2939"><span class="lineNum">    2939</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!block_was_connected) {</span></span>
<span id="L2940"><span class="lineNum">    2940</span>                 :<span class="tlaUNC">           0 :             err_code = RPC_INVALID_ADDRESS_OR_KEY;</span></span>
<span id="L2941"><span class="lineNum">    2941</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             errmsg += &quot; Block was not connected to active chain.&quot;;</span></span>
<span id="L2942"><span class="lineNum">    2942</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (!index_ready) {</span></span>
<span id="L2943"><span class="lineNum">    2943</span>                 :<span class="tlaUNC">           0 :             err_code = RPC_MISC_ERROR;</span></span>
<span id="L2944"><span class="lineNum">    2944</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             errmsg += &quot; Block filters are still in the process of being indexed.&quot;;</span></span>
<span id="L2945"><span class="lineNum">    2945</span>                 :             :         } else {</span>
<span id="L2946"><span class="lineNum">    2946</span>                 :<span class="tlaUNC">           0 :             err_code = RPC_INTERNAL_ERROR;</span></span>
<span id="L2947"><span class="lineNum">    2947</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             errmsg += &quot; This error is unexpected and indicates index corruption.&quot;;</span></span>
<span id="L2948"><span class="lineNum">    2948</span>                 :             :         }</span>
<span id="L2949"><span class="lineNum">    2949</span>                 :             : </span>
<span id="L2950"><span class="lineNum">    2950</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(err_code, errmsg);</span></span>
<span id="L2951"><span class="lineNum">    2951</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L2952"><span class="lineNum">    2952</span>                 :             : </span>
<span id="L2953"><span class="lineNum">    2953</span>                 :<span class="tlaUNC">           0 :     UniValue ret(UniValue::VOBJ);</span></span>
<span id="L2954"><span class="lineNum">    2954</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;filter&quot;, HexStr(filter.GetEncodedFilter()));</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L2955"><span class="lineNum">    2955</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     ret.pushKV(&quot;header&quot;, filter_header.GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L2956"><span class="lineNum">    2956</span>                 :<span class="tlaUNC">           0 :     return ret;</span></span>
<span id="L2957"><span class="lineNum">    2957</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L2958"><span class="lineNum">    2958</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         492 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 164 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L2959"><span class="lineNum">    2959</span>   [<span class="tlaGBC" title="Branch 0 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         492 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 82 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaUNC" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L2960"><span class="lineNum">    2960</span>                 :             : </span>
<span id="L2961"><span class="lineNum">    2961</span>                 :             : /**</span>
<span id="L2962"><span class="lineNum">    2962</span>                 :             :  * RAII class that disables the network in its constructor and enables it in its</span>
<span id="L2963"><span class="lineNum">    2963</span>                 :             :  * destructor.</span>
<span id="L2964"><span class="lineNum">    2964</span>                 :             :  */</span>
<span id="L2965"><span class="lineNum">    2965</span>                 :             : class NetworkDisable</span>
<span id="L2966"><span class="lineNum">    2966</span>                 :             : {</span>
<span id="L2967"><span class="lineNum">    2967</span>                 :             :     CConnman&amp; m_connman;</span>
<span id="L2968"><span class="lineNum">    2968</span>                 :             : public:</span>
<span id="L2969"><span class="lineNum">    2969</span>                 :<span class="tlaUNC">           0 :     NetworkDisable(CConnman&amp; connman) : m_connman(connman) {</span></span>
<span id="L2970"><span class="lineNum">    2970</span>                 :<span class="tlaUNC">           0 :         m_connman.SetNetworkActive(false);</span></span>
<span id="L2971"><span class="lineNum">    2971</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (m_connman.GetNetworkActive()) {</span></span>
<span id="L2972"><span class="lineNum">    2972</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Network activity could not be suspended.&quot;);</span></span>
<span id="L2973"><span class="lineNum">    2973</span>                 :             :         }</span>
<span id="L2974"><span class="lineNum">    2974</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2975"><span class="lineNum">    2975</span>                 :<span class="tlaUNC">           0 :     ~NetworkDisable() {</span></span>
<span id="L2976"><span class="lineNum">    2976</span>                 :<span class="tlaUNC">           0 :         m_connman.SetNetworkActive(true);</span></span>
<span id="L2977"><span class="lineNum">    2977</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2978"><span class="lineNum">    2978</span>                 :             : };</span>
<span id="L2979"><span class="lineNum">    2979</span>                 :             : </span>
<span id="L2980"><span class="lineNum">    2980</span>                 :             : /**</span>
<span id="L2981"><span class="lineNum">    2981</span>                 :             :  * RAII class that temporarily rolls back the local chain in it's constructor</span>
<span id="L2982"><span class="lineNum">    2982</span>                 :             :  * and rolls it forward again in it's destructor.</span>
<span id="L2983"><span class="lineNum">    2983</span>                 :             :  */</span>
<span id="L2984"><span class="lineNum">    2984</span>                 :             : class TemporaryRollback</span>
<span id="L2985"><span class="lineNum">    2985</span>                 :             : {</span>
<span id="L2986"><span class="lineNum">    2986</span>                 :             :     ChainstateManager&amp; m_chainman;</span>
<span id="L2987"><span class="lineNum">    2987</span>                 :             :     const CBlockIndex&amp; m_invalidate_index;</span>
<span id="L2988"><span class="lineNum">    2988</span>                 :             : public:</span>
<span id="L2989"><span class="lineNum">    2989</span>                 :<span class="tlaUNC">           0 :     TemporaryRollback(ChainstateManager&amp; chainman, const CBlockIndex&amp; index) : m_chainman(chainman), m_invalidate_index(index) {</span></span>
<span id="L2990"><span class="lineNum">    2990</span>                 :<span class="tlaUNC">           0 :         InvalidateBlock(m_chainman, m_invalidate_index.GetBlockHash());</span></span>
<span id="L2991"><span class="lineNum">    2991</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2992"><span class="lineNum">    2992</span>                 :<span class="tlaUNC">           0 :     ~TemporaryRollback() {</span></span>
<span id="L2993"><span class="lineNum">    2993</span>                 :<span class="tlaUNC">           0 :         ReconsiderBlock(m_chainman, m_invalidate_index.GetBlockHash());</span></span>
<span id="L2994"><span class="lineNum">    2994</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L2995"><span class="lineNum">    2995</span>                 :             : };</span>
<span id="L2996"><span class="lineNum">    2996</span>                 :             : </span>
<span id="L2997"><span class="lineNum">    2997</span>                 :             : /**</span>
<span id="L2998"><span class="lineNum">    2998</span>                 :             :  * Serialize the UTXO set to a file for loading elsewhere.</span>
<span id="L2999"><span class="lineNum">    2999</span>                 :             :  *</span>
<span id="L3000"><span class="lineNum">    3000</span>                 :             :  * @see SnapshotMetadata</span>
<span id="L3001"><span class="lineNum">    3001</span>                 :             :  */</span>
<span id="L3002"><span class="lineNum">    3002</span>                 :<span class="tlaGNC">          63 : static RPCHelpMan dumptxoutset()</span></span>
<span id="L3003"><span class="lineNum">    3003</span>                 :             : {</span>
<span id="L3004"><span class="lineNum">    3004</span>                 :<span class="tlaGNC">          63 :     return RPCHelpMan{</span></span>
<span id="L3005"><span class="lineNum">    3005</span>                 :<span class="tlaGNC">          63 :         &quot;dumptxoutset&quot;,</span></span>
<span id="L3006"><span class="lineNum">    3006</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         126 :         &quot;Write the serialized UTXO set to a file. This can be used in loadtxoutset afterwards if this snapshot height is supported in the chainparams as well.\n\n&quot;</span></span>
<span id="L3007"><span class="lineNum">    3007</span>                 :             :         &quot;Unless the \&quot;latest\&quot; type is requested, the node will roll back to the requested height and network activity will be suspended during this process. &quot;</span>
<span id="L3008"><span class="lineNum">    3008</span>                 :             :         &quot;Because of this it is discouraged to interact with the node in any other way during the execution of this call to avoid inconsistent results and race conditions, particularly RPCs that interact with blockstorage.\n\n&quot;</span>
<span id="L3009"><span class="lineNum">    3009</span>                 :             :         &quot;This call may take several minutes. Make sure to use no RPC timeout (bitcoin-cli -rpcclienttimeout=0)&quot;,</span>
<span id="L3010"><span class="lineNum">    3010</span>                 :             :         {</span>
<span id="L3011"><span class="lineNum">    3011</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :             {&quot;path&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;Path to the output file. If relative, will be prefixed by datadir.&quot;},</span></span>
<span id="L3012"><span class="lineNum">    3012</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         189 :             {&quot;type&quot;, RPCArg::Type::STR, RPCArg::Default(&quot;&quot;), &quot;The type of snapshot to create. Can be \&quot;latest\&quot; to create a snapshot of the current UTXO set or \&quot;rollback\&quot; to temporarily roll back the state of the node to a historical block before creating the snapshot of a historical UTXO set. This parameter can be omitted if a separate \&quot;rollback\&quot; named parameter is specified indicating the height or hash of a specific historical block. If \&quot;rollback\&quot; is specified and separate \&quot;rollback\&quot; named parameter is not specified, this will roll back to the latest valid snapshot block that can currently be loaded with loadtxoutset.&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3013"><span class="lineNum">    3013</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :             {&quot;options&quot;, RPCArg::Type::OBJ_NAMED_PARAMS, RPCArg::Optional::OMITTED, &quot;&quot;,</span></span>
<span id="L3014"><span class="lineNum">    3014</span>                 :             :                 {</span>
<span id="L3015"><span class="lineNum">    3015</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {&quot;rollback&quot;, RPCArg::Type::NUM, RPCArg::Optional::OMITTED,</span></span>
<span id="L3016"><span class="lineNum">    3016</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         126 :                         &quot;Height or hash of the block to roll back to before creating the snapshot. Note: The further this number is from the tip, the longer this process will take. Consider setting a higher -rpcclienttimeout value in this case.&quot;,</span></span>
<span id="L3017"><span class="lineNum">    3017</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     RPCArgOptions{.skip_type_check = true, .type_str = {&quot;&quot;, &quot;string or numeric&quot;}}},</span></span>
<span id="L3018"><span class="lineNum">    3018</span>                 :             :                 },</span>
<span id="L3019"><span class="lineNum">    3019</span>                 :             :             },</span>
<span id="L3020"><span class="lineNum">    3020</span>                 :             :         },</span>
<span id="L3021"><span class="lineNum">    3021</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         126 :         RPCResult{</span></span>
<span id="L3022"><span class="lineNum">    3022</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L3023"><span class="lineNum">    3023</span>                 :             :                 {</span>
<span id="L3024"><span class="lineNum">    3024</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::NUM, &quot;coins_written&quot;, &quot;the number of coins written in the snapshot&quot;},</span></span>
<span id="L3025"><span class="lineNum">    3025</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::STR_HEX, &quot;base_hash&quot;, &quot;the hash of the base of the snapshot&quot;},</span></span>
<span id="L3026"><span class="lineNum">    3026</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::NUM, &quot;base_height&quot;, &quot;the height of the base of the snapshot&quot;},</span></span>
<span id="L3027"><span class="lineNum">    3027</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::STR, &quot;path&quot;, &quot;the absolute path that the snapshot was written to&quot;},</span></span>
<span id="L3028"><span class="lineNum">    3028</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::STR_HEX, &quot;txoutset_hash&quot;, &quot;the hash of the UTXO set contents&quot;},</span></span>
<span id="L3029"><span class="lineNum">    3029</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         126 :                     {RPCResult::Type::NUM, &quot;nchaintx&quot;, &quot;the number of transactions in the chain up to and including the base block&quot;},</span></span>
<span id="L3030"><span class="lineNum">    3030</span>                 :             :                 }</span>
<span id="L3031"><span class="lineNum">    3031</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         819 :         },</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 378 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3032"><span class="lineNum">    3032</span>                 :<span class="tlaGNC">          63 :         RPCExamples{</span></span>
<span id="L3033"><span class="lineNum">    3033</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         126 :             HelpExampleCli(&quot;-rpcclienttimeout=0 dumptxoutset&quot;, &quot;utxo.dat latest&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3034"><span class="lineNum">    3034</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         252 :             HelpExampleCli(&quot;-rpcclienttimeout=0 dumptxoutset&quot;, &quot;utxo.dat rollback&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3035"><span class="lineNum">    3035</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         189 :             HelpExampleCli(&quot;-rpcclienttimeout=0 -named dumptxoutset&quot;, R&quot;(utxo.dat rollback=853456)&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3036"><span class="lineNum">    3036</span>         [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          63 :         },</span></span>
<span id="L3037"><span class="lineNum">    3037</span>                 :<span class="tlaGNC">          63 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L3038"><span class="lineNum">    3038</span>                 :             : {</span>
<span id="L3039"><span class="lineNum">    3039</span>                 :<span class="tlaUNC">           0 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L3040"><span class="lineNum">    3040</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const CBlockIndex* tip{WITH_LOCK(::cs_main, return node.chainman-&gt;ActiveChain().Tip())};</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3041"><span class="lineNum">    3041</span>                 :<span class="tlaUNC">           0 :     const CBlockIndex* target_index{nullptr};</span></span>
<span id="L3042"><span class="lineNum">    3042</span>                 :<span class="tlaUNC">           0 :     const std::string snapshot_type{self.Arg&lt;std::string&gt;(&quot;type&quot;)};</span></span>
<span id="L3043"><span class="lineNum">    3043</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const UniValue options{request.params[2].isNull() ? UniValue::VOBJ : request.params[2]};</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3044"><span class="lineNum">    3044</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (options.exists(&quot;rollback&quot;)) {</span></span>
<span id="L3045"><span class="lineNum">    3045</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!snapshot_type.empty() &amp;&amp; snapshot_type != &quot;rollback&quot;) {</span></span>
<span id="L3046"><span class="lineNum">    3046</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Invalid snapshot type \&quot;%s\&quot; specified with rollback option&quot;, snapshot_type));</span></span>
<span id="L3047"><span class="lineNum">    3047</span>                 :             :         }</span>
<span id="L3048"><span class="lineNum">    3048</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         target_index = ParseHashOrHeight(options[&quot;rollback&quot;], *node.chainman);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3049"><span class="lineNum">    3049</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } else if (snapshot_type == &quot;rollback&quot;) {</span></span>
<span id="L3050"><span class="lineNum">    3050</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto snapshot_heights = node.chainman-&gt;GetParams().GetAvailableSnapshotHeights();</span></span>
<span id="L3051"><span class="lineNum">    3051</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(snapshot_heights.size() &gt; 0);</span></span>
<span id="L3052"><span class="lineNum">    3052</span>                 :<span class="tlaUNC">           0 :         auto max_height = std::max_element(snapshot_heights.begin(), snapshot_heights.end());</span></span>
<span id="L3053"><span class="lineNum">    3053</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         target_index = ParseHashOrHeight(*max_height, *node.chainman);</span></span>
<span id="L3054"><span class="lineNum">    3054</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } else if (snapshot_type == &quot;latest&quot;) {</span></span>
<span id="L3055"><span class="lineNum">    3055</span>                 :<span class="tlaUNC">           0 :         target_index = tip;</span></span>
<span id="L3056"><span class="lineNum">    3056</span>                 :             :     } else {</span>
<span id="L3057"><span class="lineNum">    3057</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(&quot;Invalid snapshot type \&quot;%s\&quot; specified. Please specify \&quot;rollback\&quot; or \&quot;latest\&quot;&quot;, snapshot_type));</span></span>
<span id="L3058"><span class="lineNum">    3058</span>                 :             :     }</span>
<span id="L3059"><span class="lineNum">    3059</span>                 :             : </span>
<span id="L3060"><span class="lineNum">    3060</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const ArgsManager&amp; args{EnsureAnyArgsman(request.context)};</span></span>
<span id="L3061"><span class="lineNum">    3061</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const fs::path path = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str()));</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3062"><span class="lineNum">    3062</span>                 :             :     // Write to a temporary path and then move into `path` on completion</span>
<span id="L3063"><span class="lineNum">    3063</span>                 :             :     // to avoid confusion due to an interruption.</span>
<span id="L3064"><span class="lineNum">    3064</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const fs::path temppath = fsbridge::AbsPathJoin(args.GetDataDirNet(), fs::u8path(request.params[0].get_str() + &quot;.incomplete&quot;));</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L3065"><span class="lineNum">    3065</span>                 :             : </span>
<span id="L3066"><span class="lineNum">    3066</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fs::exists(path)) {</span></span>
<span id="L3067"><span class="lineNum">    3067</span>                 :<span class="tlaUNC">           0 :         throw JSONRPCError(</span></span>
<span id="L3068"><span class="lineNum">    3068</span>                 :             :             RPC_INVALID_PARAMETER,</span>
<span id="L3069"><span class="lineNum">    3069</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             path.utf8string() + &quot; already exists. If you are sure this is what you want, &quot;</span></span>
<span id="L3070"><span class="lineNum">    3070</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             &quot;move it out of the way first&quot;);</span></span>
<span id="L3071"><span class="lineNum">    3071</span>                 :             :     }</span>
<span id="L3072"><span class="lineNum">    3072</span>                 :             : </span>
<span id="L3073"><span class="lineNum">    3073</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     FILE* file{fsbridge::fopen(temppath, &quot;wb&quot;)};</span></span>
<span id="L3074"><span class="lineNum">    3074</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     AutoFile afile{file};</span></span>
<span id="L3075"><span class="lineNum">    3075</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (afile.IsNull()) {</span></span>
<span id="L3076"><span class="lineNum">    3076</span>                 :<span class="tlaUNC">           0 :         throw JSONRPCError(</span></span>
<span id="L3077"><span class="lineNum">    3077</span>                 :             :             RPC_INVALID_PARAMETER,</span>
<span id="L3078"><span class="lineNum">    3078</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             &quot;Couldn't open file &quot; + temppath.utf8string() + &quot; for writing.&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3079"><span class="lineNum">    3079</span>                 :             :     }</span>
<span id="L3080"><span class="lineNum">    3080</span>                 :             : </span>
<span id="L3081"><span class="lineNum">    3081</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CConnman&amp; connman = EnsureConnman(node);</span></span>
<span id="L3082"><span class="lineNum">    3082</span>                 :<span class="tlaUNC">           0 :     const CBlockIndex* invalidate_index{nullptr};</span></span>
<span id="L3083"><span class="lineNum">    3083</span>                 :<span class="tlaUNC">           0 :     std::optional&lt;NetworkDisable&gt; disable_network;</span></span>
<span id="L3084"><span class="lineNum">    3084</span>                 :<span class="tlaUNC">           0 :     std::optional&lt;TemporaryRollback&gt; temporary_rollback;</span></span>
<span id="L3085"><span class="lineNum">    3085</span>                 :             : </span>
<span id="L3086"><span class="lineNum">    3086</span>                 :             :     // If the user wants to dump the txoutset of the current tip, we don't have</span>
<span id="L3087"><span class="lineNum">    3087</span>                 :             :     // to roll back at all</span>
<span id="L3088"><span class="lineNum">    3088</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (target_index != tip) {</span></span>
<span id="L3089"><span class="lineNum">    3089</span>                 :             :         // If the node is running in pruned mode we ensure all necessary block</span>
<span id="L3090"><span class="lineNum">    3090</span>                 :             :         // data is available before starting to roll back.</span>
<span id="L3091"><span class="lineNum">    3091</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (node.chainman-&gt;m_blockman.IsPruneMode()) {</span></span>
<span id="L3092"><span class="lineNum">    3092</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             LOCK(node.chainman-&gt;GetMutex());</span></span>
<span id="L3093"><span class="lineNum">    3093</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const CBlockIndex* current_tip{node.chainman-&gt;ActiveChain().Tip()};</span></span>
<span id="L3094"><span class="lineNum">    3094</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const CBlockIndex* first_block{node.chainman-&gt;m_blockman.GetFirstBlock(*current_tip, /*status_mask=*/BLOCK_HAVE_MASK)};</span></span>
<span id="L3095"><span class="lineNum">    3095</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (first_block-&gt;nHeight &gt; target_index-&gt;nHeight) {</span></span>
<span id="L3096"><span class="lineNum">    3096</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_MISC_ERROR, &quot;Could not roll back to requested height since necessary block data is already pruned.&quot;);</span></span>
<span id="L3097"><span class="lineNum">    3097</span>                 :             :             }</span>
<span id="L3098"><span class="lineNum">    3098</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L3099"><span class="lineNum">    3099</span>                 :             : </span>
<span id="L3100"><span class="lineNum">    3100</span>                 :             :         // Suspend network activity for the duration of the process when we are</span>
<span id="L3101"><span class="lineNum">    3101</span>                 :             :         // rolling back the chain to get a utxo set from a past height. We do</span>
<span id="L3102"><span class="lineNum">    3102</span>                 :             :         // this so we don't punish peers that send us that send us data that</span>
<span id="L3103"><span class="lineNum">    3103</span>                 :             :         // seems wrong in this temporary state. For example a normal new block</span>
<span id="L3104"><span class="lineNum">    3104</span>                 :             :         // would be classified as a block connecting an invalid block.</span>
<span id="L3105"><span class="lineNum">    3105</span>                 :             :         // Skip if the network is already disabled because this</span>
<span id="L3106"><span class="lineNum">    3106</span>                 :             :         // automatically re-enables the network activity at the end of the</span>
<span id="L3107"><span class="lineNum">    3107</span>                 :             :         // process which may not be what the user wants.</span>
<span id="L3108"><span class="lineNum">    3108</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (connman.GetNetworkActive()) {</span></span>
<span id="L3109"><span class="lineNum">    3109</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             disable_network.emplace(connman);</span></span>
<span id="L3110"><span class="lineNum">    3110</span>                 :             :         }</span>
<span id="L3111"><span class="lineNum">    3111</span>                 :             : </span>
<span id="L3112"><span class="lineNum">    3112</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         invalidate_index = WITH_LOCK(::cs_main, return node.chainman-&gt;ActiveChain().Next(target_index));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3113"><span class="lineNum">    3113</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         temporary_rollback.emplace(*node.chainman, *invalidate_index);</span></span>
<span id="L3114"><span class="lineNum">    3114</span>                 :             :     }</span>
<span id="L3115"><span class="lineNum">    3115</span>                 :             : </span>
<span id="L3116"><span class="lineNum">    3116</span>                 :<span class="tlaUNC">           0 :     Chainstate* chainstate;</span></span>
<span id="L3117"><span class="lineNum">    3117</span>                 :<span class="tlaUNC">           0 :     std::unique_ptr&lt;CCoinsViewCursor&gt; cursor;</span></span>
<span id="L3118"><span class="lineNum">    3118</span>                 :<span class="tlaUNC">           0 :     CCoinsStats stats;</span></span>
<span id="L3119"><span class="lineNum">    3119</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L3120"><span class="lineNum">    3120</span>                 :             :         // Lock the chainstate before calling PrepareUtxoSnapshot, to be able</span>
<span id="L3121"><span class="lineNum">    3121</span>                 :             :         // to get a UTXO database cursor while the chain is pointing at the</span>
<span id="L3122"><span class="lineNum">    3122</span>                 :             :         // target block. After that, release the lock while calling</span>
<span id="L3123"><span class="lineNum">    3123</span>                 :             :         // WriteUTXOSnapshot. The cursor will remain valid and be used by</span>
<span id="L3124"><span class="lineNum">    3124</span>                 :             :         // WriteUTXOSnapshot to write a consistent snapshot even if the</span>
<span id="L3125"><span class="lineNum">    3125</span>                 :             :         // chainstate changes.</span>
<span id="L3126"><span class="lineNum">    3126</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(node.chainman-&gt;GetMutex());</span></span>
<span id="L3127"><span class="lineNum">    3127</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         chainstate = &amp;node.chainman-&gt;ActiveChainstate();</span></span>
<span id="L3128"><span class="lineNum">    3128</span>                 :             :         // In case there is any issue with a block being read from disk we need</span>
<span id="L3129"><span class="lineNum">    3129</span>                 :             :         // to stop here, otherwise the dump could still be created for the wrong</span>
<span id="L3130"><span class="lineNum">    3130</span>                 :             :         // height.</span>
<span id="L3131"><span class="lineNum">    3131</span>                 :             :         // The new tip could also not be the target block if we have a stale</span>
<span id="L3132"><span class="lineNum">    3132</span>                 :             :         // sister block of invalidate_index. This block (or a descendant) would</span>
<span id="L3133"><span class="lineNum">    3133</span>                 :             :         // be activated as the new tip and we would not get to new_tip_index.</span>
<span id="L3134"><span class="lineNum">    3134</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (target_index != chainstate-&gt;m_chain.Tip()) {</span></span>
<span id="L3135"><span class="lineNum">    3135</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             LogWarning(&quot;dumptxoutset failed to roll back to requested height, reverting to tip.\n&quot;);</span></span>
<span id="L3136"><span class="lineNum">    3136</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Could not roll back to requested height.&quot;);</span></span>
<span id="L3137"><span class="lineNum">    3137</span>                 :             :         } else {</span>
<span id="L3138"><span class="lineNum">    3138</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::tie(cursor, stats, tip) = PrepareUTXOSnapshot(*chainstate, node.rpc_interruption_point);</span></span>
<span id="L3139"><span class="lineNum">    3139</span>                 :             :         }</span>
<span id="L3140"><span class="lineNum">    3140</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L3141"><span class="lineNum">    3141</span>                 :             : </span>
<span id="L3142"><span class="lineNum">    3142</span>                 :<span class="tlaUNC">           0 :     UniValue result = WriteUTXOSnapshot(*chainstate,</span></span>
<span id="L3143"><span class="lineNum">    3143</span>                 :             :                                         cursor.get(),</span>
<span id="L3144"><span class="lineNum">    3144</span>                 :             :                                         &amp;stats,</span>
<span id="L3145"><span class="lineNum">    3145</span>                 :             :                                         tip,</span>
<span id="L3146"><span class="lineNum">    3146</span>                 :             :                                         std::move(afile),</span>
<span id="L3147"><span class="lineNum">    3147</span>                 :             :                                         path,</span>
<span id="L3148"><span class="lineNum">    3148</span>                 :             :                                         temppath,</span>
<span id="L3149"><span class="lineNum">    3149</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                         node.rpc_interruption_point);</span></span>
<span id="L3150"><span class="lineNum">    3150</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     fs::rename(temppath, path);</span></span>
<span id="L3151"><span class="lineNum">    3151</span>                 :             : </span>
<span id="L3152"><span class="lineNum">    3152</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;path&quot;, path.utf8string());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3153"><span class="lineNum">    3153</span>                 :<span class="tlaUNC">           0 :     return result;</span></span>
<span id="L3154"><span class="lineNum">    3154</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L3155"><span class="lineNum">    3155</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         630 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 189 times"> + </span><span class="tlaGBC" title="Branch 7 was taken 63 times"> + </span><span class="tlaGBC" title="Branch 8 was taken 63 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 9 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not taken"> - </span>]
<span id="L3156"><span class="lineNum">    3156</span>   [<span class="tlaGBC" title="Branch 0 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         819 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 63 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 63 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 63 times"> + </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaUNC" title="Branch 20 was not taken"> - </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaUNC" title="Branch 22 was not taken"> - </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not taken"> - </span>]
<span id="L3157"><span class="lineNum">    3157</span>                 :             : </span>
<span id="L3158"><span class="lineNum">    3158</span>                 :             : std::tuple&lt;std::unique_ptr&lt;CCoinsViewCursor&gt;, CCoinsStats, const CBlockIndex*&gt;</span>
<span id="L3159"><span class="lineNum">    3159</span>                 :<span class="tlaUNC">           0 : PrepareUTXOSnapshot(</span></span>
<span id="L3160"><span class="lineNum">    3160</span>                 :             :     Chainstate&amp; chainstate,</span>
<span id="L3161"><span class="lineNum">    3161</span>                 :             :     const std::function&lt;void()&gt;&amp; interruption_point)</span>
<span id="L3162"><span class="lineNum">    3162</span>                 :             : {</span>
<span id="L3163"><span class="lineNum">    3163</span>                 :<span class="tlaUNC">           0 :     std::unique_ptr&lt;CCoinsViewCursor&gt; pcursor;</span></span>
<span id="L3164"><span class="lineNum">    3164</span>                 :<span class="tlaUNC">           0 :     std::optional&lt;CCoinsStats&gt; maybe_stats;</span></span>
<span id="L3165"><span class="lineNum">    3165</span>                 :<span class="tlaUNC">           0 :     const CBlockIndex* tip;</span></span>
<span id="L3166"><span class="lineNum">    3166</span>                 :             : </span>
<span id="L3167"><span class="lineNum">    3167</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L3168"><span class="lineNum">    3168</span>                 :             :         // We need to lock cs_main to ensure that the coinsdb isn't written to</span>
<span id="L3169"><span class="lineNum">    3169</span>                 :             :         // between (i) flushing coins cache to disk (coinsdb), (ii) getting stats</span>
<span id="L3170"><span class="lineNum">    3170</span>                 :             :         // based upon the coinsdb, and (iii) constructing a cursor to the</span>
<span id="L3171"><span class="lineNum">    3171</span>                 :             :         // coinsdb for use in WriteUTXOSnapshot.</span>
<span id="L3172"><span class="lineNum">    3172</span>                 :             :         //</span>
<span id="L3173"><span class="lineNum">    3173</span>                 :             :         // Cursors returned by leveldb iterate over snapshots, so the contents</span>
<span id="L3174"><span class="lineNum">    3174</span>                 :             :         // of the pcursor will not be affected by simultaneous writes during</span>
<span id="L3175"><span class="lineNum">    3175</span>                 :             :         // use below this block.</span>
<span id="L3176"><span class="lineNum">    3176</span>                 :             :         //</span>
<span id="L3177"><span class="lineNum">    3177</span>                 :             :         // See discussion here:</span>
<span id="L3178"><span class="lineNum">    3178</span>                 :             :         //   https://github.com/bitcoin/bitcoin/pull/15606#discussion_r274479369</span>
<span id="L3179"><span class="lineNum">    3179</span>                 :             :         //</span>
<span id="L3180"><span class="lineNum">    3180</span>                 :<span class="tlaUNC">           0 :         AssertLockHeld(::cs_main);</span></span>
<span id="L3181"><span class="lineNum">    3181</span>                 :             : </span>
<span id="L3182"><span class="lineNum">    3182</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         chainstate.ForceFlushStateToDisk();</span></span>
<span id="L3183"><span class="lineNum">    3183</span>                 :             : </span>
<span id="L3184"><span class="lineNum">    3184</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         maybe_stats = GetUTXOStats(&amp;chainstate.CoinsDB(), chainstate.m_blockman, CoinStatsHashType::HASH_SERIALIZED, interruption_point);</span></span>
<span id="L3185"><span class="lineNum">    3185</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!maybe_stats) {</span></span>
<span id="L3186"><span class="lineNum">    3186</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INTERNAL_ERROR, &quot;Unable to read UTXO set&quot;);</span></span>
<span id="L3187"><span class="lineNum">    3187</span>                 :             :         }</span>
<span id="L3188"><span class="lineNum">    3188</span>                 :             : </span>
<span id="L3189"><span class="lineNum">    3189</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pcursor = chainstate.CoinsDB().Cursor();</span></span>
<span id="L3190"><span class="lineNum">    3190</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         tip = CHECK_NONFATAL(chainstate.m_blockman.LookupBlockIndex(maybe_stats-&gt;hashBlock));</span></span>
<span id="L3191"><span class="lineNum">    3191</span>                 :             :     }</span>
<span id="L3192"><span class="lineNum">    3192</span>                 :             : </span>
<span id="L3193"><span class="lineNum">    3193</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     return {std::move(pcursor), *CHECK_NONFATAL(maybe_stats), tip};</span></span>
<span id="L3194"><span class="lineNum">    3194</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L3195"><span class="lineNum">    3195</span>                 :             : </span>
<span id="L3196"><span class="lineNum">    3196</span>                 :<span class="tlaUNC">           0 : UniValue WriteUTXOSnapshot(</span></span>
<span id="L3197"><span class="lineNum">    3197</span>                 :             :     Chainstate&amp; chainstate,</span>
<span id="L3198"><span class="lineNum">    3198</span>                 :             :     CCoinsViewCursor* pcursor,</span>
<span id="L3199"><span class="lineNum">    3199</span>                 :             :     CCoinsStats* maybe_stats,</span>
<span id="L3200"><span class="lineNum">    3200</span>                 :             :     const CBlockIndex* tip,</span>
<span id="L3201"><span class="lineNum">    3201</span>                 :             :     AutoFile&amp;&amp; afile,</span>
<span id="L3202"><span class="lineNum">    3202</span>                 :             :     const fs::path&amp; path,</span>
<span id="L3203"><span class="lineNum">    3203</span>                 :             :     const fs::path&amp; temppath,</span>
<span id="L3204"><span class="lineNum">    3204</span>                 :             :     const std::function&lt;void()&gt;&amp; interruption_point)</span>
<span id="L3205"><span class="lineNum">    3205</span>                 :             : {</span>
<span id="L3206"><span class="lineNum">    3206</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     LOG_TIME_SECONDS(strprintf(&quot;writing UTXO snapshot at height %s (%s) to file %s (via %s)&quot;,</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L3207"><span class="lineNum">    3207</span>                 :             :         tip-&gt;nHeight, tip-&gt;GetBlockHash().ToString(),</span>
<span id="L3208"><span class="lineNum">    3208</span>                 :             :         fs::PathToString(path), fs::PathToString(temppath)));</span>
<span id="L3209"><span class="lineNum">    3209</span>                 :             : </span>
<span id="L3210"><span class="lineNum">    3210</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     SnapshotMetadata metadata{chainstate.m_chainman.GetParams().MessageStart(), tip-&gt;GetBlockHash(), maybe_stats-&gt;coins_count};</span></span>
<span id="L3211"><span class="lineNum">    3211</span>                 :             : </span>
<span id="L3212"><span class="lineNum">    3212</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     afile &lt;&lt; metadata;</span></span>
<span id="L3213"><span class="lineNum">    3213</span>                 :             : </span>
<span id="L3214"><span class="lineNum">    3214</span>                 :<span class="tlaUNC">           0 :     COutPoint key;</span></span>
<span id="L3215"><span class="lineNum">    3215</span>                 :<span class="tlaUNC">           0 :     Txid last_hash;</span></span>
<span id="L3216"><span class="lineNum">    3216</span>                 :<span class="tlaUNC">           0 :     Coin coin;</span></span>
<span id="L3217"><span class="lineNum">    3217</span>                 :<span class="tlaUNC">           0 :     unsigned int iter{0};</span></span>
<span id="L3218"><span class="lineNum">    3218</span>                 :<span class="tlaUNC">           0 :     size_t written_coins_count{0};</span></span>
<span id="L3219"><span class="lineNum">    3219</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;std::pair&lt;uint32_t, Coin&gt;&gt; coins;</span></span>
<span id="L3220"><span class="lineNum">    3220</span>                 :             : </span>
<span id="L3221"><span class="lineNum">    3221</span>                 :             :     // To reduce space the serialization format of the snapshot avoids</span>
<span id="L3222"><span class="lineNum">    3222</span>                 :             :     // duplication of tx hashes. The code takes advantage of the guarantee by</span>
<span id="L3223"><span class="lineNum">    3223</span>                 :             :     // leveldb that keys are lexicographically sorted.</span>
<span id="L3224"><span class="lineNum">    3224</span>                 :             :     // In the coins vector we collect all coins that belong to a certain tx hash</span>
<span id="L3225"><span class="lineNum">    3225</span>                 :             :     // (key.hash) and when we have them all (key.hash != last_hash) we write</span>
<span id="L3226"><span class="lineNum">    3226</span>                 :             :     // them to file using the below lambda function.</span>
<span id="L3227"><span class="lineNum">    3227</span>                 :             :     // See also https://github.com/bitcoin/bitcoin/issues/25675</span>
<span id="L3228"><span class="lineNum">    3228</span>                 :<span class="tlaUNC">           0 :     auto write_coins_to_file = [&amp;](AutoFile&amp; afile, const Txid&amp; last_hash, const std::vector&lt;std::pair&lt;uint32_t, Coin&gt;&gt;&amp; coins, size_t&amp; written_coins_count) {</span></span>
<span id="L3229"><span class="lineNum">    3229</span>                 :<span class="tlaUNC">           0 :         afile &lt;&lt; last_hash;</span></span>
<span id="L3230"><span class="lineNum">    3230</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         WriteCompactSize(afile, coins.size());</span></span>
<span id="L3231"><span class="lineNum">    3231</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const auto&amp; [n, coin] : coins) {</span></span>
<span id="L3232"><span class="lineNum">    3232</span>                 :<span class="tlaUNC">           0 :             WriteCompactSize(afile, n);</span></span>
<span id="L3233"><span class="lineNum">    3233</span>                 :<span class="tlaUNC">           0 :             afile &lt;&lt; coin;</span></span>
<span id="L3234"><span class="lineNum">    3234</span>                 :<span class="tlaUNC">           0 :             ++written_coins_count;</span></span>
<span id="L3235"><span class="lineNum">    3235</span>                 :             :         }</span>
<span id="L3236"><span class="lineNum">    3236</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L3237"><span class="lineNum">    3237</span>                 :             : </span>
<span id="L3238"><span class="lineNum">    3238</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     pcursor-&gt;GetKey(key);</span></span>
<span id="L3239"><span class="lineNum">    3239</span>                 :<span class="tlaUNC">           0 :     last_hash = key.hash;</span></span>
<span id="L3240"><span class="lineNum">    3240</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     while (pcursor-&gt;Valid()) {</span></span>
<span id="L3241"><span class="lineNum">    3241</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (iter % 5000 == 0) interruption_point();</span></span>
<span id="L3242"><span class="lineNum">    3242</span>                 :<span class="tlaUNC">           0 :         ++iter;</span></span>
<span id="L3243"><span class="lineNum">    3243</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (pcursor-&gt;GetKey(key) &amp;&amp; pcursor-&gt;GetValue(coin)) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3244"><span class="lineNum">    3244</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (key.hash != last_hash) {</span></span>
<span id="L3245"><span class="lineNum">    3245</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 write_coins_to_file(afile, last_hash, coins, written_coins_count);</span></span>
<span id="L3246"><span class="lineNum">    3246</span>                 :<span class="tlaUNC">           0 :                 last_hash = key.hash;</span></span>
<span id="L3247"><span class="lineNum">    3247</span>                 :<span class="tlaUNC">           0 :                 coins.clear();</span></span>
<span id="L3248"><span class="lineNum">    3248</span>                 :             :             }</span>
<span id="L3249"><span class="lineNum">    3249</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             coins.emplace_back(key.n, coin);</span></span>
<span id="L3250"><span class="lineNum">    3250</span>                 :             :         }</span>
<span id="L3251"><span class="lineNum">    3251</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pcursor-&gt;Next();</span></span>
<span id="L3252"><span class="lineNum">    3252</span>                 :             :     }</span>
<span id="L3253"><span class="lineNum">    3253</span>                 :             : </span>
<span id="L3254"><span class="lineNum">    3254</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!coins.empty()) {</span></span>
<span id="L3255"><span class="lineNum">    3255</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         write_coins_to_file(afile, last_hash, coins, written_coins_count);</span></span>
<span id="L3256"><span class="lineNum">    3256</span>                 :             :     }</span>
<span id="L3257"><span class="lineNum">    3257</span>                 :             : </span>
<span id="L3258"><span class="lineNum">    3258</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CHECK_NONFATAL(written_coins_count == maybe_stats-&gt;coins_count);</span></span>
<span id="L3259"><span class="lineNum">    3259</span>                 :             : </span>
<span id="L3260"><span class="lineNum">    3260</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (afile.fclose() != 0) {</span></span>
<span id="L3261"><span class="lineNum">    3261</span>                 :<span class="tlaUNC">           0 :         throw std::ios_base::failure(</span></span>
<span id="L3262"><span class="lineNum">    3262</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             strprintf(&quot;Error closing %s: %s&quot;, fs::PathToString(temppath), SysErrorString(errno)));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3263"><span class="lineNum">    3263</span>                 :             :     }</span>
<span id="L3264"><span class="lineNum">    3264</span>                 :             : </span>
<span id="L3265"><span class="lineNum">    3265</span>                 :<span class="tlaUNC">           0 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L3266"><span class="lineNum">    3266</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;coins_written&quot;, written_coins_count);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3267"><span class="lineNum">    3267</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;base_hash&quot;, tip-&gt;GetBlockHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3268"><span class="lineNum">    3268</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;base_height&quot;, tip-&gt;nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3269"><span class="lineNum">    3269</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;path&quot;, path.utf8string());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3270"><span class="lineNum">    3270</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;txoutset_hash&quot;, maybe_stats-&gt;hashSerialized.ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3271"><span class="lineNum">    3271</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;nchaintx&quot;, tip-&gt;m_chain_tx_count);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3272"><span class="lineNum">    3272</span>                 :<span class="tlaUNC">           0 :     return result;</span></span>
<span id="L3273"><span class="lineNum">    3273</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L3274"><span class="lineNum">    3274</span>                 :             : </span>
<span id="L3275"><span class="lineNum">    3275</span>                 :<span class="tlaUNC">           0 : UniValue CreateUTXOSnapshot(</span></span>
<span id="L3276"><span class="lineNum">    3276</span>                 :             :     node::NodeContext&amp; node,</span>
<span id="L3277"><span class="lineNum">    3277</span>                 :             :     Chainstate&amp; chainstate,</span>
<span id="L3278"><span class="lineNum">    3278</span>                 :             :     AutoFile&amp;&amp; afile,</span>
<span id="L3279"><span class="lineNum">    3279</span>                 :             :     const fs::path&amp; path,</span>
<span id="L3280"><span class="lineNum">    3280</span>                 :             :     const fs::path&amp; tmppath)</span>
<span id="L3281"><span class="lineNum">    3281</span>                 :             : {</span>
<span id="L3282"><span class="lineNum">    3282</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     auto [cursor, stats, tip]{WITH_LOCK(::cs_main, return PrepareUTXOSnapshot(chainstate, node.rpc_interruption_point))};</span></span>
<span id="L3283"><span class="lineNum">    3283</span>                 :<span class="tlaUNC">           0 :     return WriteUTXOSnapshot(chainstate,</span></span>
<span id="L3284"><span class="lineNum">    3284</span>                 :             :                              cursor.get(),</span>
<span id="L3285"><span class="lineNum">    3285</span>                 :             :                              &amp;stats,</span>
<span id="L3286"><span class="lineNum">    3286</span>                 :             :                              tip,</span>
<span id="L3287"><span class="lineNum">    3287</span>                 :             :                              std::move(afile),</span>
<span id="L3288"><span class="lineNum">    3288</span>                 :             :                              path,</span>
<span id="L3289"><span class="lineNum">    3289</span>                 :             :                              tmppath,</span>
<span id="L3290"><span class="lineNum">    3290</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                              node.rpc_interruption_point);</span></span>
<span id="L3291"><span class="lineNum">    3291</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L3292"><span class="lineNum">    3292</span>                 :             : </span>
<span id="L3293"><span class="lineNum">    3293</span>                 :<span class="tlaGNC">          62 : static RPCHelpMan loadtxoutset()</span></span>
<span id="L3294"><span class="lineNum">    3294</span>                 :             : {</span>
<span id="L3295"><span class="lineNum">    3295</span>                 :<span class="tlaGNC">          62 :     return RPCHelpMan{</span></span>
<span id="L3296"><span class="lineNum">    3296</span>                 :<span class="tlaGNC">          62 :         &quot;loadtxoutset&quot;,</span></span>
<span id="L3297"><span class="lineNum">    3297</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         124 :         &quot;Load the serialized UTXO set from a file.\n&quot;</span></span>
<span id="L3298"><span class="lineNum">    3298</span>                 :             :         &quot;Once this snapshot is loaded, its contents will be &quot;</span>
<span id="L3299"><span class="lineNum">    3299</span>                 :             :         &quot;deserialized into a second chainstate data structure, which is then used to sync to &quot;</span>
<span id="L3300"><span class="lineNum">    3300</span>                 :             :         &quot;the network's tip. &quot;</span>
<span id="L3301"><span class="lineNum">    3301</span>                 :             :         &quot;Meanwhile, the original chainstate will complete the initial block download process in &quot;</span>
<span id="L3302"><span class="lineNum">    3302</span>                 :             :         &quot;the background, eventually validating up to the block that the snapshot is based upon.\n\n&quot;</span>
<span id="L3303"><span class="lineNum">    3303</span>                 :             : </span>
<span id="L3304"><span class="lineNum">    3304</span>                 :             :         &quot;The result is a usable bitcoind instance that is current with the network tip in a &quot;</span>
<span id="L3305"><span class="lineNum">    3305</span>                 :             :         &quot;matter of minutes rather than hours. UTXO snapshot are typically obtained from &quot;</span>
<span id="L3306"><span class="lineNum">    3306</span>                 :             :         &quot;third-party sources (HTTP, torrent, etc.) which is reasonable since their &quot;</span>
<span id="L3307"><span class="lineNum">    3307</span>                 :             :         &quot;contents are always checked by hash.\n\n&quot;</span>
<span id="L3308"><span class="lineNum">    3308</span>                 :             : </span>
<span id="L3309"><span class="lineNum">    3309</span>                 :             :         &quot;You can find more information on this process in the `assumeutxo` design &quot;</span>
<span id="L3310"><span class="lineNum">    3310</span>                 :             :         &quot;document (&lt;https://github.com/bitcoin/bitcoin/blob/master/doc/design/assumeutxo.md&gt;).&quot;,</span>
<span id="L3311"><span class="lineNum">    3311</span>                 :             :         {</span>
<span id="L3312"><span class="lineNum">    3312</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         124 :             {&quot;path&quot;,</span></span>
<span id="L3313"><span class="lineNum">    3313</span>                 :             :                 RPCArg::Type::STR,</span>
<span id="L3314"><span class="lineNum">    3314</span>                 :<span class="tlaGNC">          62 :                 RPCArg::Optional::NO,</span></span>
<span id="L3315"><span class="lineNum">    3315</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         124 :                 &quot;path to the snapshot file. If relative, will be prefixed by datadir.&quot;},</span></span>
<span id="L3316"><span class="lineNum">    3316</span>                 :             :         },</span>
<span id="L3317"><span class="lineNum">    3317</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         124 :         RPCResult{</span></span>
<span id="L3318"><span class="lineNum">    3318</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span></span>
<span id="L3319"><span class="lineNum">    3319</span>                 :             :                 {</span>
<span id="L3320"><span class="lineNum">    3320</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :                     {RPCResult::Type::NUM, &quot;coins_loaded&quot;, &quot;the number of coins loaded from the snapshot&quot;},</span></span>
<span id="L3321"><span class="lineNum">    3321</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :                     {RPCResult::Type::STR_HEX, &quot;tip_hash&quot;, &quot;the hash of the base of the snapshot&quot;},</span></span>
<span id="L3322"><span class="lineNum">    3322</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :                     {RPCResult::Type::NUM, &quot;base_height&quot;, &quot;the height of the base of the snapshot&quot;},</span></span>
<span id="L3323"><span class="lineNum">    3323</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         124 :                     {RPCResult::Type::STR, &quot;path&quot;, &quot;the absolute path that the snapshot was loaded from&quot;},</span></span>
<span id="L3324"><span class="lineNum">    3324</span>                 :             :                 }</span>
<span id="L3325"><span class="lineNum">    3325</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         558 :         },</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 248 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3326"><span class="lineNum">    3326</span>                 :<span class="tlaGNC">          62 :         RPCExamples{</span></span>
<span id="L3327"><span class="lineNum">    3327</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         124 :             HelpExampleCli(&quot;-rpcclienttimeout=0 loadtxoutset&quot;, &quot;utxo.dat&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3328"><span class="lineNum">    3328</span>         [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          62 :         },</span></span>
<span id="L3329"><span class="lineNum">    3329</span>                 :<span class="tlaGNC">          62 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L3330"><span class="lineNum">    3330</span>                 :             : {</span>
<span id="L3331"><span class="lineNum">    3331</span>                 :<span class="tlaUNC">           0 :     NodeContext&amp; node = EnsureAnyNodeContext(request.context);</span></span>
<span id="L3332"><span class="lineNum">    3332</span>                 :<span class="tlaUNC">           0 :     ChainstateManager&amp; chainman = EnsureChainman(node);</span></span>
<span id="L3333"><span class="lineNum">    3333</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const fs::path path{AbsPathForConfigVal(EnsureArgsman(node), fs::u8path(self.Arg&lt;std::string&gt;(&quot;path&quot;)))};</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3334"><span class="lineNum">    3334</span>                 :             : </span>
<span id="L3335"><span class="lineNum">    3335</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     FILE* file{fsbridge::fopen(path, &quot;rb&quot;)};</span></span>
<span id="L3336"><span class="lineNum">    3336</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     AutoFile afile{file};</span></span>
<span id="L3337"><span class="lineNum">    3337</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (afile.IsNull()) {</span></span>
<span id="L3338"><span class="lineNum">    3338</span>                 :<span class="tlaUNC">           0 :         throw JSONRPCError(</span></span>
<span id="L3339"><span class="lineNum">    3339</span>                 :             :             RPC_INVALID_PARAMETER,</span>
<span id="L3340"><span class="lineNum">    3340</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             &quot;Couldn't open file &quot; + path.utf8string() + &quot; for reading.&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3341"><span class="lineNum">    3341</span>                 :             :     }</span>
<span id="L3342"><span class="lineNum">    3342</span>                 :             : </span>
<span id="L3343"><span class="lineNum">    3343</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     SnapshotMetadata metadata{chainman.GetParams().MessageStart()};</span></span>
<span id="L3344"><span class="lineNum">    3344</span>                 :<span class="tlaUNC">           0 :     try {</span></span>
<span id="L3345"><span class="lineNum">    3345</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         afile &gt;&gt; metadata;</span></span>
<span id="L3346"><span class="lineNum">    3346</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaUNC">           0 :     } catch (const std::ios_base::failure&amp; e) {</span></span>
<span id="L3347"><span class="lineNum">    3347</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_DESERIALIZATION_ERROR, strprintf(&quot;Unable to parse metadata: %s&quot;, e.what()));</span></span>
<span id="L3348"><span class="lineNum">    3348</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L3349"><span class="lineNum">    3349</span>                 :             : </span>
<span id="L3350"><span class="lineNum">    3350</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     auto activation_result{chainman.ActivateSnapshot(afile, metadata, false)};</span></span>
<span id="L3351"><span class="lineNum">    3351</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!activation_result) {</span></span>
<span id="L3352"><span class="lineNum">    3352</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INTERNAL_ERROR, strprintf(&quot;Unable to load UTXO snapshot: %s. (%s)&quot;, util::ErrorString(activation_result).original, path.utf8string()));</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3353"><span class="lineNum">    3353</span>                 :             :     }</span>
<span id="L3354"><span class="lineNum">    3354</span>                 :             : </span>
<span id="L3355"><span class="lineNum">    3355</span>                 :             :     // Because we can't provide historical blocks during tip or background sync.</span>
<span id="L3356"><span class="lineNum">    3356</span>                 :             :     // Update local services to reflect we are a limited peer until we are fully sync.</span>
<span id="L3357"><span class="lineNum">    3357</span>                 :<span class="tlaUNC">           0 :     node.connman-&gt;RemoveLocalServices(NODE_NETWORK);</span></span>
<span id="L3358"><span class="lineNum">    3358</span>                 :             :     // Setting the limited state is usually redundant because the node can always</span>
<span id="L3359"><span class="lineNum">    3359</span>                 :             :     // provide the last 288 blocks, but it doesn't hurt to set it.</span>
<span id="L3360"><span class="lineNum">    3360</span>                 :<span class="tlaUNC">           0 :     node.connman-&gt;AddLocalServices(NODE_NETWORK_LIMITED);</span></span>
<span id="L3361"><span class="lineNum">    3361</span>                 :             : </span>
<span id="L3362"><span class="lineNum">    3362</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CBlockIndex&amp; snapshot_index{*CHECK_NONFATAL(*activation_result)};</span></span>
<span id="L3363"><span class="lineNum">    3363</span>                 :             : </span>
<span id="L3364"><span class="lineNum">    3364</span>                 :<span class="tlaUNC">           0 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L3365"><span class="lineNum">    3365</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;coins_loaded&quot;, metadata.m_coins_count);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3366"><span class="lineNum">    3366</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;tip_hash&quot;, snapshot_index.GetBlockHash().ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3367"><span class="lineNum">    3367</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;base_height&quot;, snapshot_index.nHeight);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L3368"><span class="lineNum">    3368</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     result.pushKV(&quot;path&quot;, fs::PathToString(path));</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3369"><span class="lineNum">    3369</span>                 :<span class="tlaUNC">           0 :     return result;</span></span>
<span id="L3370"><span class="lineNum">    3370</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L3371"><span class="lineNum">    3371</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         310 :     };</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 62 times"> + </span><span class="tlaGBC" title="Branch 5 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3372"><span class="lineNum">    3372</span>   [<span class="tlaGBC" title="Branch 0 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         372 : }</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 62 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 62 times"> + </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaUNC" title="Branch 10 was not taken"> - </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span>]
<span id="L3373"><span class="lineNum">    3373</span>                 :             : </span>
<span id="L3374"><span class="lineNum">    3374</span>                 :             : const std::vector&lt;RPCResult&gt; RPCHelpForChainstate{</span>
<span id="L3375"><span class="lineNum">    3375</span>                 :             :     {RPCResult::Type::NUM, &quot;blocks&quot;, &quot;number of blocks in this chainstate&quot;},</span>
<span id="L3376"><span class="lineNum">    3376</span>                 :             :     {RPCResult::Type::STR_HEX, &quot;bestblockhash&quot;, &quot;blockhash of the tip&quot;},</span>
<span id="L3377"><span class="lineNum">    3377</span>                 :             :     {RPCResult::Type::STR_HEX, &quot;bits&quot;, &quot;nBits: compact representation of the block difficulty target&quot;},</span>
<span id="L3378"><span class="lineNum">    3378</span>                 :             :     {RPCResult::Type::STR_HEX, &quot;target&quot;, &quot;The difficulty target&quot;},</span>
<span id="L3379"><span class="lineNum">    3379</span>                 :             :     {RPCResult::Type::NUM, &quot;difficulty&quot;, &quot;difficulty of the tip&quot;},</span>
<span id="L3380"><span class="lineNum">    3380</span>                 :             :     {RPCResult::Type::NUM, &quot;verificationprogress&quot;, &quot;progress towards the network tip&quot;},</span>
<span id="L3381"><span class="lineNum">    3381</span>                 :             :     {RPCResult::Type::STR_HEX, &quot;snapshot_blockhash&quot;, /*optional=*/true, &quot;the base block of the snapshot this chainstate is based on, if any&quot;},</span>
<span id="L3382"><span class="lineNum">    3382</span>                 :             :     {RPCResult::Type::NUM, &quot;coins_db_cache_bytes&quot;, &quot;size of the coinsdb cache&quot;},</span>
<span id="L3383"><span class="lineNum">    3383</span>                 :             :     {RPCResult::Type::NUM, &quot;coins_tip_cache_bytes&quot;, &quot;size of the coinstip cache&quot;},</span>
<span id="L3384"><span class="lineNum">    3384</span>                 :             :     {RPCResult::Type::BOOL, &quot;validated&quot;, &quot;whether the chainstate is fully validated. True if all blocks in the chainstate were validated, false if the chain is based on a snapshot and the snapshot has not yet been validated.&quot;},</span>
<span id="L3385"><span class="lineNum">    3385</span>                 :             : };</span>
<span id="L3386"><span class="lineNum">    3386</span>                 :             : </span>
<span id="L3387"><span class="lineNum">    3387</span>                 :<span class="tlaGNC">          84 : static RPCHelpMan getchainstates()</span></span>
<span id="L3388"><span class="lineNum">    3388</span>                 :             : {</span>
<span id="L3389"><span class="lineNum">    3389</span>                 :<span class="tlaGNC">          84 : return RPCHelpMan{</span></span>
<span id="L3390"><span class="lineNum">    3390</span>                 :<span class="tlaGNC">          84 :         &quot;getchainstates&quot;,</span></span>
<span id="L3391"><span class="lineNum">    3391</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         168 :         &quot;Return information about chainstates.\n&quot;,</span></span>
<span id="L3392"><span class="lineNum">    3392</span>                 :             :         {},</span>
<span id="L3393"><span class="lineNum">    3393</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         168 :         RPCResult{</span></span>
<span id="L3394"><span class="lineNum">    3394</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">         168 :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L3395"><span class="lineNum">    3395</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         168 :                 {RPCResult::Type::NUM, &quot;headers&quot;, &quot;the number of headers seen so far&quot;},</span></span>
<span id="L3396"><span class="lineNum">    3396</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         168 :                 {RPCResult::Type::ARR, &quot;chainstates&quot;, &quot;list of the chainstates ordered by work, with the most-work (active) chainstate last&quot;, {{RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, RPCHelpForChainstate},}},</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3397"><span class="lineNum">    3397</span>                 :             :             }</span>
<span id="L3398"><span class="lineNum">    3398</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         672 :         },</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 168 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 9 was taken 84 times"> + </span><span class="tlaGBC" title="Branch 10 was taken 84 times"> + </span><span class="tlaGBC" title="Branch 11 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 12 was not taken"> - </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not taken"> - </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span>]
<span id="L3399"><span class="lineNum">    3399</span>                 :<span class="tlaGNC">          84 :         RPCExamples{</span></span>
<span id="L3400"><span class="lineNum">    3400</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         168 :             HelpExampleCli(&quot;getchainstates&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3401"><span class="lineNum">    3401</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         336 :     + HelpExampleRpc(&quot;getchainstates&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3402"><span class="lineNum">    3402</span>         [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          84 :         },</span></span>
<span id="L3403"><span class="lineNum">    3403</span>                 :<span class="tlaGNC">          84 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L3404"><span class="lineNum">    3404</span>                 :             : {</span>
<span id="L3405"><span class="lineNum">    3405</span>                 :<span class="tlaGNC">           2 :     LOCK(cs_main);</span></span>
<span id="L3406"><span class="lineNum">    3406</span>                 :<span class="tlaGNC">           2 :     UniValue obj(UniValue::VOBJ);</span></span>
<span id="L3407"><span class="lineNum">    3407</span>                 :             : </span>
<span id="L3408"><span class="lineNum">    3408</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :     ChainstateManager&amp; chainman = EnsureAnyChainman(request.context);</span></span>
<span id="L3409"><span class="lineNum">    3409</span>                 :             : </span>
<span id="L3410"><span class="lineNum">    3410</span>                 :<span class="tlaGNC">           4 :     auto make_chain_data = [&amp;](const Chainstate&amp; cs, bool validated) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {</span></span>
<span id="L3411"><span class="lineNum">    3411</span>                 :<span class="tlaGNC">           2 :         AssertLockHeld(::cs_main);</span></span>
<span id="L3412"><span class="lineNum">    3412</span>                 :<span class="tlaGNC">           2 :         UniValue data(UniValue::VOBJ);</span></span>
<span id="L3413"><span class="lineNum">    3413</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           6 :         if (!cs.m_chain.Tip()) {</span></span>
<span id="L3414"><span class="lineNum">    3414</span>                 :             :             return data;</span>
<span id="L3415"><span class="lineNum">    3415</span>                 :             :         }</span>
<span id="L3416"><span class="lineNum">    3416</span>                 :<span class="tlaGNC">           2 :         const CChain&amp; chain = cs.m_chain;</span></span>
<span id="L3417"><span class="lineNum">    3417</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :         const CBlockIndex* tip = chain.Tip();</span></span>
<span id="L3418"><span class="lineNum">    3418</span>                 :             : </span>
<span id="L3419"><span class="lineNum">    3419</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;blocks&quot;,                (int)chain.Height());</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3420"><span class="lineNum">    3420</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;bestblockhash&quot;,         tip-&gt;GetBlockHash().GetHex());</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3421"><span class="lineNum">    3421</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;bits&quot;, strprintf(&quot;%08x&quot;, tip-&gt;nBits));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3422"><span class="lineNum">    3422</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;target&quot;, GetTarget(*tip, chainman.GetConsensus().powLimit).GetHex());</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 2 times"> + </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not taken"> - </span>]
<span id="L3423"><span class="lineNum">    3423</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;difficulty&quot;, GetDifficulty(*tip));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3424"><span class="lineNum">    3424</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;verificationprogress&quot;, chainman.GuessVerificationProgress(tip));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3425"><span class="lineNum">    3425</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;coins_db_cache_bytes&quot;,  cs.m_coinsdb_cache_size_bytes);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3426"><span class="lineNum">    3426</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :         data.pushKV(&quot;coins_tip_cache_bytes&quot;, cs.m_coinstip_cache_size_bytes);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3427"><span class="lineNum">    3427</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">           2 :         if (cs.m_from_snapshot_blockhash) {</span></span>
<span id="L3428"><span class="lineNum">    3428</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             data.pushKV(&quot;snapshot_blockhash&quot;, cs.m_from_snapshot_blockhash-&gt;ToString());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L3429"><span class="lineNum">    3429</span>                 :             :         }</span>
<span id="L3430"><span class="lineNum">    3430</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           2 :         data.pushKV(&quot;validated&quot;, validated);</span></span>
<span class="lineNum">        </span>          <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L3431"><span class="lineNum">    3431</span>                 :<span class="tlaGNC">           2 :         return data;</span></span>
<span id="L3432"><span class="lineNum">    3432</span>                 :<span class="tlaUNC">           0 :     };</span></span>
<span id="L3433"><span class="lineNum">    3433</span>                 :             : </span>
<span id="L3434"><span class="lineNum">    3434</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           4 :     obj.pushKV(&quot;headers&quot;, chainman.m_best_header ? chainman.m_best_header-&gt;nHeight : -1);</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3435"><span class="lineNum">    3435</span>                 :             : </span>
<span id="L3436"><span class="lineNum">    3436</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           2 :     const auto&amp; chainstates = chainman.GetAll();</span></span>
<span id="L3437"><span class="lineNum">    3437</span>                 :<span class="tlaGNC">           2 :     UniValue obj_chainstates{UniValue::VARR};</span></span>
<span id="L3438"><span class="lineNum">    3438</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span>]:<span class="tlaGNC">           4 :     for (Chainstate* cs : chainstates) {</span></span>
<span id="L3439"><span class="lineNum">    3439</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">           2 :       obj_chainstates.push_back(make_chain_data(*cs, !cs-&gt;m_from_snapshot_blockhash || chainstates.size() == 1));</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3440"><span class="lineNum">    3440</span>                 :             :     }</span>
<span id="L3441"><span class="lineNum">    3441</span>   [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">           4 :     obj.pushKV(&quot;chainstates&quot;, std::move(obj_chainstates));</span></span>
<span id="L3442"><span class="lineNum">    3442</span>                 :<span class="tlaGNC">           4 :     return obj;</span></span>
<span id="L3443"><span class="lineNum">    3443</span>         [<span class="tlaGBC" title="Branch 0 was taken 2 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">           4 : }</span></span>
<span id="L3444"><span class="lineNum">    3444</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span>]:<span class="tlaGNC">         336 :     };</span></span>
<span id="L3445"><span class="lineNum">    3445</span>   [<span class="tlaGBC" title="Branch 0 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaGBC" title="Branch 2 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         252 : }</span></span>
<span class="lineNum">        </span>    <span class="tlaGBC" title="Branch 4 was taken 84 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L3446"><span class="lineNum">    3446</span>                 :             : </span>
<span id="L3447"><span class="lineNum">    3447</span>                 :             : </span>
<span id="L3448"><span class="lineNum">    3448</span>                 :<span class="tlaGNC">          27 : void RegisterBlockchainRPCCommands(CRPCTable&amp; t)</span></span>
<span id="L3449"><span class="lineNum">    3449</span>                 :             : {</span>
<span id="L3450"><span class="lineNum">    3450</span>                 :<span class="tlaGNC">          27 :     static const CRPCCommand commands[]{</span></span>
<span id="L3451"><span class="lineNum">    3451</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockchaininfo},</span></span>
<span id="L3452"><span class="lineNum">    3452</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getchaintxstats},</span></span>
<span id="L3453"><span class="lineNum">    3453</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockstats},</span></span>
<span id="L3454"><span class="lineNum">    3454</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getbestblockhash},</span></span>
<span id="L3455"><span class="lineNum">    3455</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockcount},</span></span>
<span id="L3456"><span class="lineNum">    3456</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblock},</span></span>
<span id="L3457"><span class="lineNum">    3457</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockfrompeer},</span></span>
<span id="L3458"><span class="lineNum">    3458</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockhash},</span></span>
<span id="L3459"><span class="lineNum">    3459</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockheader},</span></span>
<span id="L3460"><span class="lineNum">    3460</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getchaintips},</span></span>
<span id="L3461"><span class="lineNum">    3461</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getdifficulty},</span></span>
<span id="L3462"><span class="lineNum">    3462</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getdeploymentinfo},</span></span>
<span id="L3463"><span class="lineNum">    3463</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;gettxout},</span></span>
<span id="L3464"><span class="lineNum">    3464</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;gettxoutsetinfo},</span></span>
<span id="L3465"><span class="lineNum">    3465</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;pruneblockchain},</span></span>
<span id="L3466"><span class="lineNum">    3466</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;verifychain},</span></span>
<span id="L3467"><span class="lineNum">    3467</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;preciousblock},</span></span>
<span id="L3468"><span class="lineNum">    3468</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;scantxoutset},</span></span>
<span id="L3469"><span class="lineNum">    3469</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;scanblocks},</span></span>
<span id="L3470"><span class="lineNum">    3470</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getdescriptoractivity},</span></span>
<span id="L3471"><span class="lineNum">    3471</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getblockfilter},</span></span>
<span id="L3472"><span class="lineNum">    3472</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;dumptxoutset},</span></span>
<span id="L3473"><span class="lineNum">    3473</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;loadtxoutset},</span></span>
<span id="L3474"><span class="lineNum">    3474</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;getchainstates},</span></span>
<span id="L3475"><span class="lineNum">    3475</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;hidden&quot;, &amp;invalidateblock},</span></span>
<span id="L3476"><span class="lineNum">    3476</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;hidden&quot;, &amp;reconsiderblock},</span></span>
<span id="L3477"><span class="lineNum">    3477</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;waitfornewblock},</span></span>
<span id="L3478"><span class="lineNum">    3478</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;waitforblock},</span></span>
<span id="L3479"><span class="lineNum">    3479</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;blockchain&quot;, &amp;waitforblockheight},</span></span>
<span id="L3480"><span class="lineNum">    3480</span>         [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaGNC">          50 :         {&quot;hidden&quot;, &amp;syncwithvalidationinterfacequeue},</span></span>
<span id="L3481"><span class="lineNum">    3481</span>   [<span class="tlaGBC" title="Branch 0 was taken 25 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 2 times"> + </span><span class="tlaGBC" title="Branch 2 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaGNC">         777 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 4 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaGBC" title="Branch 6 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span><span class="tlaGBC" title="Branch 8 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not taken"> - </span><span class="tlaGBC" title="Branch 10 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 11 was not taken"> - </span><span class="tlaGBC" title="Branch 12 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 14 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 15 was not taken"> - </span><span class="tlaGBC" title="Branch 16 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 17 was not taken"> - </span><span class="tlaGBC" title="Branch 18 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not taken"> - </span><span class="tlaGBC" title="Branch 20 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 21 was not taken"> - </span><span class="tlaGBC" title="Branch 22 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 24 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 25 was not taken"> - </span><span class="tlaGBC" title="Branch 26 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 27 was not taken"> - </span><span class="tlaGBC" title="Branch 28 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not taken"> - </span><span class="tlaGBC" title="Branch 30 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 31 was not taken"> - </span><span class="tlaGBC" title="Branch 32 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 34 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 35 was not taken"> - </span><span class="tlaGBC" title="Branch 36 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 37 was not taken"> - </span><span class="tlaGBC" title="Branch 38 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not taken"> - </span><span class="tlaGBC" title="Branch 40 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 41 was not taken"> - </span><span class="tlaGBC" title="Branch 42 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 43 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 44 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 45 was not taken"> - </span><span class="tlaGBC" title="Branch 46 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 47 was not taken"> - </span><span class="tlaGBC" title="Branch 48 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not taken"> - </span><span class="tlaGBC" title="Branch 50 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 51 was not taken"> - </span><span class="tlaGBC" title="Branch 52 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 53 was not taken"> - </span> 
<span class="lineNum">        </span> <span class="tlaGBC" title="Branch 54 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 55 was not taken"> - </span><span class="tlaGBC" title="Branch 56 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 57 was not taken"> - </span><span class="tlaGBC" title="Branch 58 was taken 25 times"> + </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 59 was not taken"> - </span><span class="tlaGBC" title="Branch 60 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 61 was not taken"> - </span><span class="tlaGBC" title="Branch 62 was taken 25 times"> + </span><span class="tlaUNC" title="Branch 63 was not taken"> - </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 64 was not taken"> - </span><span class="tlaUNC" title="Branch 65 was not taken"> - </span>]
<span id="L3482"><span class="lineNum">    3482</span>         [<span class="tlaGBC" title="Branch 0 was taken 810 times"> + </span><span class="tlaGBC" title="Branch 1 was taken 27 times"> + </span>]:<span class="tlaGNC">         837 :     for (const auto&amp; c : commands) {</span></span>
<span id="L3483"><span class="lineNum">    3483</span>                 :<span class="tlaGNC">         810 :         t.appendCommand(c.name, &amp;c);</span></span>
<span id="L3484"><span class="lineNum">    3484</span>                 :             :     }</span>
<span id="L3485"><span class="lineNum">    3485</span>                 :<span class="tlaGNC">          27 : }</span></span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
