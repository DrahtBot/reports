<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - fuzz_coverage.info - src/wallet/rpc/backup.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../../../index.html" title="Click to go to top-level">top level</a> - <a href="index.html" title="Click to go to directory src/wallet/rpc">src/wallet/rpc</a> - backup.cpp<span style="font-size: 80%;"> (source / <a href="backup.cpp.func-c.html" title="Click to go to function table">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">fuzz_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryLo">0.0&nbsp;%</td>
            <td class="headerCovTableEntry">1173</td>
            <td class="headerCovTableEntry">0</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2024-12-02 12:23:29</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryLo">0.0&nbsp;%</td>
            <td class="headerCovTableEntry">38</td>
            <td class="headerCovTableEntry">0</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntryLo">0.0&nbsp;%</td>
            <td class="headerCovTableEntry">3951</td>
            <td class="headerCovTableEntry">0</td>
          </tr>
                  <tr><td><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">             Branch data     Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>                 :             : // Copyright (c) 2009-2022 The Bitcoin Core developers</span>
<span id="L2"><span class="lineNum">       2</span>                 :             : // Distributed under the MIT software license, see the accompanying</span>
<span id="L3"><span class="lineNum">       3</span>                 :             : // file COPYING or http://www.opensource.org/licenses/mit-license.php.</span>
<span id="L4"><span class="lineNum">       4</span>                 :             : </span>
<span id="L5"><span class="lineNum">       5</span>                 :             : #include &lt;bitcoin-build-config.h&gt; // IWYU pragma: keep</span>
<span id="L6"><span class="lineNum">       6</span>                 :             : </span>
<span id="L7"><span class="lineNum">       7</span>                 :             : #include &lt;chain.h&gt;</span>
<span id="L8"><span class="lineNum">       8</span>                 :             : #include &lt;clientversion.h&gt;</span>
<span id="L9"><span class="lineNum">       9</span>                 :             : #include &lt;core_io.h&gt;</span>
<span id="L10"><span class="lineNum">      10</span>                 :             : #include &lt;hash.h&gt;</span>
<span id="L11"><span class="lineNum">      11</span>                 :             : #include &lt;interfaces/chain.h&gt;</span>
<span id="L12"><span class="lineNum">      12</span>                 :             : #include &lt;key_io.h&gt;</span>
<span id="L13"><span class="lineNum">      13</span>                 :             : #include &lt;merkleblock.h&gt;</span>
<span id="L14"><span class="lineNum">      14</span>                 :             : #include &lt;rpc/util.h&gt;</span>
<span id="L15"><span class="lineNum">      15</span>                 :             : #include &lt;script/descriptor.h&gt;</span>
<span id="L16"><span class="lineNum">      16</span>                 :             : #include &lt;script/script.h&gt;</span>
<span id="L17"><span class="lineNum">      17</span>                 :             : #include &lt;script/solver.h&gt;</span>
<span id="L18"><span class="lineNum">      18</span>                 :             : #include &lt;sync.h&gt;</span>
<span id="L19"><span class="lineNum">      19</span>                 :             : #include &lt;uint256.h&gt;</span>
<span id="L20"><span class="lineNum">      20</span>                 :             : #include &lt;util/bip32.h&gt;</span>
<span id="L21"><span class="lineNum">      21</span>                 :             : #include &lt;util/fs.h&gt;</span>
<span id="L22"><span class="lineNum">      22</span>                 :             : #include &lt;util/time.h&gt;</span>
<span id="L23"><span class="lineNum">      23</span>                 :             : #include &lt;util/translation.h&gt;</span>
<span id="L24"><span class="lineNum">      24</span>                 :             : #include &lt;wallet/rpc/util.h&gt;</span>
<span id="L25"><span class="lineNum">      25</span>                 :             : #include &lt;wallet/wallet.h&gt;</span>
<span id="L26"><span class="lineNum">      26</span>                 :             : </span>
<span id="L27"><span class="lineNum">      27</span>                 :             : #include &lt;cstdint&gt;</span>
<span id="L28"><span class="lineNum">      28</span>                 :             : #include &lt;fstream&gt;</span>
<span id="L29"><span class="lineNum">      29</span>                 :             : #include &lt;tuple&gt;</span>
<span id="L30"><span class="lineNum">      30</span>                 :             : #include &lt;string&gt;</span>
<span id="L31"><span class="lineNum">      31</span>                 :             : </span>
<span id="L32"><span class="lineNum">      32</span>                 :             : #include &lt;univalue.h&gt;</span>
<span id="L33"><span class="lineNum">      33</span>                 :             : </span>
<span id="L34"><span class="lineNum">      34</span>                 :             : </span>
<span id="L35"><span class="lineNum">      35</span>                 :             : </span>
<span id="L36"><span class="lineNum">      36</span>                 :             : using interfaces::FoundBlock;</span>
<span id="L37"><span class="lineNum">      37</span>                 :             : using util::SplitString;</span>
<span id="L38"><span class="lineNum">      38</span>                 :             : </span>
<span id="L39"><span class="lineNum">      39</span>                 :             : namespace wallet {</span>
<span id="L40"><span class="lineNum">      40</span>                 :<span class="tlaUNC tlaBgUNC">           0 : std::string static EncodeDumpString(const std::string &amp;str) {</span></span>
<span id="L41"><span class="lineNum">      41</span>                 :<span class="tlaUNC">           0 :     std::stringstream ret;</span></span>
<span id="L42"><span class="lineNum">      42</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const unsigned char c : str) {</span></span>
<span id="L43"><span class="lineNum">      43</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (c &lt;= 32 || c &gt;= 128 || c == '%') {</span></span>
<span id="L44"><span class="lineNum">      44</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             ret &lt;&lt; '%' &lt;&lt; HexStr({&amp;c, 1});</span></span>
<span id="L45"><span class="lineNum">      45</span>                 :             :         } else {</span>
<span id="L46"><span class="lineNum">      46</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             ret &lt;&lt; c;</span></span>
<span id="L47"><span class="lineNum">      47</span>                 :             :         }</span>
<span id="L48"><span class="lineNum">      48</span>                 :             :     }</span>
<span id="L49"><span class="lineNum">      49</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     return ret.str();</span></span>
<span id="L50"><span class="lineNum">      50</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L51"><span class="lineNum">      51</span>                 :             : </span>
<span id="L52"><span class="lineNum">      52</span>                 :<span class="tlaUNC">           0 : static std::string DecodeDumpString(const std::string &amp;str) {</span></span>
<span id="L53"><span class="lineNum">      53</span>                 :<span class="tlaUNC">           0 :     std::stringstream ret;</span></span>
<span id="L54"><span class="lineNum">      54</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (unsigned int pos = 0; pos &lt; str.length(); pos++) {</span></span>
<span id="L55"><span class="lineNum">      55</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         unsigned char c = str[pos];</span></span>
<span id="L56"><span class="lineNum">      56</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (c == '%' &amp;&amp; pos+2 &lt; str.length()) {</span></span>
<span id="L57"><span class="lineNum">      57</span>                 :<span class="tlaUNC">           0 :             c = (((str[pos+1]&gt;&gt;6)*9+((str[pos+1]-'0')&amp;15)) &lt;&lt; 4) |</span></span>
<span id="L58"><span class="lineNum">      58</span>                 :<span class="tlaUNC">           0 :                 ((str[pos+2]&gt;&gt;6)*9+((str[pos+2]-'0')&amp;15));</span></span>
<span id="L59"><span class="lineNum">      59</span>                 :<span class="tlaUNC">           0 :             pos += 2;</span></span>
<span id="L60"><span class="lineNum">      60</span>                 :             :         }</span>
<span id="L61"><span class="lineNum">      61</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ret &lt;&lt; c;</span></span>
<span id="L62"><span class="lineNum">      62</span>                 :             :     }</span>
<span id="L63"><span class="lineNum">      63</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     return ret.str();</span></span>
<span id="L64"><span class="lineNum">      64</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L65"><span class="lineNum">      65</span>                 :             : </span>
<span id="L66"><span class="lineNum">      66</span>                 :<span class="tlaUNC">           0 : static bool GetWalletAddressesForKey(const LegacyScriptPubKeyMan* spk_man, const CWallet&amp; wallet, const CKeyID&amp; keyid, std::string&amp; strAddr, std::string&amp; strLabel) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet)</span></span>
<span id="L67"><span class="lineNum">      67</span>                 :             : {</span>
<span id="L68"><span class="lineNum">      68</span>                 :<span class="tlaUNC">           0 :     bool fLabelFound = false;</span></span>
<span id="L69"><span class="lineNum">      69</span>                 :<span class="tlaUNC">           0 :     CKey key;</span></span>
<span id="L70"><span class="lineNum">      70</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     spk_man-&gt;GetKey(keyid, key);</span></span>
<span id="L71"><span class="lineNum">      71</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     for (const auto&amp; dest : GetAllDestinationsForKey(key.GetPubKey())) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L72"><span class="lineNum">      72</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto* address_book_entry = wallet.FindAddressBookEntry(dest);</span></span>
<span id="L73"><span class="lineNum">      73</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (address_book_entry) {</span></span>
<span id="L74"><span class="lineNum">      74</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!strAddr.empty()) {</span></span>
<span id="L75"><span class="lineNum">      75</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 strAddr += &quot;,&quot;;</span></span>
<span id="L76"><span class="lineNum">      76</span>                 :             :             }</span>
<span id="L77"><span class="lineNum">      77</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             strAddr += EncodeDestination(dest);</span></span>
<span id="L78"><span class="lineNum">      78</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             strLabel = EncodeDumpString(address_book_entry-&gt;GetLabel());</span></span>
<span id="L79"><span class="lineNum">      79</span>                 :<span class="tlaUNC">           0 :             fLabelFound = true;</span></span>
<span id="L80"><span class="lineNum">      80</span>                 :             :         }</span>
<span id="L81"><span class="lineNum">      81</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L82"><span class="lineNum">      82</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!fLabelFound) {</span></span>
<span id="L83"><span class="lineNum">      83</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         strAddr = EncodeDestination(GetDestinationForKey(key.GetPubKey(), wallet.m_default_address_type));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L84"><span class="lineNum">      84</span>                 :             :     }</span>
<span id="L85"><span class="lineNum">      85</span>                 :<span class="tlaUNC">           0 :     return fLabelFound;</span></span>
<span id="L86"><span class="lineNum">      86</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L87"><span class="lineNum">      87</span>                 :             : </span>
<span id="L88"><span class="lineNum">      88</span>                 :             : static const int64_t TIMESTAMP_MIN = 0;</span>
<span id="L89"><span class="lineNum">      89</span>                 :             : </span>
<span id="L90"><span class="lineNum">      90</span>                 :<span class="tlaUNC">           0 : static void RescanWallet(CWallet&amp; wallet, const WalletRescanReserver&amp; reserver, int64_t time_begin = TIMESTAMP_MIN, bool update = true)</span></span>
<span id="L91"><span class="lineNum">      91</span>                 :             : {</span>
<span id="L92"><span class="lineNum">      92</span>                 :<span class="tlaUNC">           0 :     int64_t scanned_time = wallet.RescanFromTime(time_begin, reserver, update);</span></span>
<span id="L93"><span class="lineNum">      93</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (wallet.IsAbortingRescan()) {</span></span>
<span id="L94"><span class="lineNum">      94</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_MISC_ERROR, &quot;Rescan aborted by user.&quot;);</span></span>
<span id="L95"><span class="lineNum">      95</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } else if (scanned_time &gt; time_begin) {</span></span>
<span id="L96"><span class="lineNum">      96</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Rescan was unable to fully rescan the blockchain. Some transactions may be missing.&quot;);</span></span>
<span id="L97"><span class="lineNum">      97</span>                 :             :     }</span>
<span id="L98"><span class="lineNum">      98</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L99"><span class="lineNum">      99</span>                 :             : </span>
<span id="L100"><span class="lineNum">     100</span>                 :<span class="tlaUNC">           0 : static void EnsureBlockDataFromTime(const CWallet&amp; wallet, int64_t timestamp)</span></span>
<span id="L101"><span class="lineNum">     101</span>                 :             : {</span>
<span id="L102"><span class="lineNum">     102</span>                 :<span class="tlaUNC">           0 :     auto&amp; chain{wallet.chain()};</span></span>
<span id="L103"><span class="lineNum">     103</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!chain.havePruned()) {</span></span>
<span id="L104"><span class="lineNum">     104</span>                 :             :         return;</span>
<span id="L105"><span class="lineNum">     105</span>                 :             :     }</span>
<span id="L106"><span class="lineNum">     106</span>                 :             : </span>
<span id="L107"><span class="lineNum">     107</span>                 :<span class="tlaUNC">           0 :     int height{0};</span></span>
<span id="L108"><span class="lineNum">     108</span>                 :<span class="tlaUNC">           0 :     const bool found{chain.findFirstBlockWithTimeAndHeight(timestamp - TIMESTAMP_WINDOW, 0, FoundBlock().height(height))};</span></span>
<span id="L109"><span class="lineNum">     109</span>                 :             : </span>
<span id="L110"><span class="lineNum">     110</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     uint256 tip_hash{WITH_LOCK(wallet.cs_wallet, return wallet.GetLastBlockHash())};</span></span>
<span id="L111"><span class="lineNum">     111</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (found &amp;&amp; !chain.hasBlocks(tip_hash, height)) {</span></span>
<span id="L112"><span class="lineNum">     112</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, strprintf(&quot;Pruned blocks from height %d required to import keys. Use RPC call getblockchaininfo to determine your pruned height.&quot;, height));</span></span>
<span id="L113"><span class="lineNum">     113</span>                 :             :     }</span>
<span id="L114"><span class="lineNum">     114</span>                 :             : }</span>
<span id="L115"><span class="lineNum">     115</span>                 :             : </span>
<span id="L116"><span class="lineNum">     116</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importprivkey()</span></span>
<span id="L117"><span class="lineNum">     117</span>                 :             : {</span>
<span id="L118"><span class="lineNum">     118</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importprivkey&quot;,</span></span>
<span id="L119"><span class="lineNum">     119</span>                 :             :                 &quot;\nAdds a private key (as returned by dumpprivkey) to your wallet. Requires a new wallet backup.\n&quot;</span>
<span id="L120"><span class="lineNum">     120</span>                 :             :                 &quot;Hint: use importmulti to import more than one private key.\n&quot;</span>
<span id="L121"><span class="lineNum">     121</span>                 :             :             &quot;\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\n&quot;</span>
<span id="L122"><span class="lineNum">     122</span>                 :             :             &quot;may report that the imported key exists but related transactions are still missing, leading to temporarily incorrect/bogus balances and unspent outputs until rescan completes.\n&quot;</span>
<span id="L123"><span class="lineNum">     123</span>                 :             :             &quot;The rescan parameter can be set to false if the key was never used to create transactions. If it is set to false,\n&quot;</span>
<span id="L124"><span class="lineNum">     124</span>                 :             :             &quot;but the key was used to create transactions, rescanblockchain needs to be called with the appropriate block range.\n&quot;</span>
<span id="L125"><span class="lineNum">     125</span>                 :             :             &quot;Note: Use \&quot;getwalletinfo\&quot; to query the scanning progress.\n&quot;</span>
<span id="L126"><span class="lineNum">     126</span>                 :             :             &quot;Note: This command is only compatible with legacy wallets. Use \&quot;importdescriptors\&quot; with \&quot;combo(X)\&quot; for descriptor wallets.\n&quot;,</span>
<span id="L127"><span class="lineNum">     127</span>                 :             :                 {</span>
<span id="L128"><span class="lineNum">     128</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;privkey&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The private key (see dumpprivkey)&quot;},</span></span>
<span id="L129"><span class="lineNum">     129</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;label&quot;, RPCArg::Type::STR, RPCArg::DefaultHint{&quot;current label if address exists, otherwise \&quot;\&quot;&quot;}, &quot;An optional label&quot;},</span></span>
<span id="L130"><span class="lineNum">     130</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;rescan&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Scan the chain and mempool for wallet transactions.&quot;},</span></span>
<span id="L131"><span class="lineNum">     131</span>                 :             :                 },</span>
<span id="L132"><span class="lineNum">     132</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L133"><span class="lineNum">     133</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L134"><span class="lineNum">     134</span>                 :             :             &quot;\nDump a private key\n&quot;</span>
<span id="L135"><span class="lineNum">     135</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;dumpprivkey&quot;, &quot;\&quot;myaddress\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L136"><span class="lineNum">     136</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport the private key with rescan\n&quot;</span></span>
<span id="L137"><span class="lineNum">     137</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importprivkey&quot;, &quot;\&quot;mykey\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L138"><span class="lineNum">     138</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport using a label and without rescan\n&quot;</span></span>
<span id="L139"><span class="lineNum">     139</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importprivkey&quot;, &quot;\&quot;mykey\&quot; \&quot;testing\&quot; false&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L140"><span class="lineNum">     140</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport using default blank label and without rescan\n&quot;</span></span>
<span id="L141"><span class="lineNum">     141</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importprivkey&quot;, &quot;\&quot;mykey\&quot; \&quot;\&quot; false&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L142"><span class="lineNum">     142</span>                 :<span class="tlaUNC">           0 :             &quot;\nAs a JSON-RPC call\n&quot;</span></span>
<span id="L143"><span class="lineNum">     143</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;importprivkey&quot;, &quot;\&quot;mykey\&quot;, \&quot;testing\&quot;, false&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L144"><span class="lineNum">     144</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L145"><span class="lineNum">     145</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L146"><span class="lineNum">     146</span>                 :             : {</span>
<span id="L147"><span class="lineNum">     147</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L148"><span class="lineNum">     148</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L149"><span class="lineNum">     149</span>                 :             : </span>
<span id="L150"><span class="lineNum">     150</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (pwallet-&gt;IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {</span></span>
<span id="L151"><span class="lineNum">     151</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Cannot import private keys to a wallet with private keys disabled&quot;);</span></span>
<span id="L152"><span class="lineNum">     152</span>                 :             :     }</span>
<span id="L153"><span class="lineNum">     153</span>                 :             : </span>
<span id="L154"><span class="lineNum">     154</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureLegacyScriptPubKeyMan(*pwallet, true);</span></span>
<span id="L155"><span class="lineNum">     155</span>                 :             : </span>
<span id="L156"><span class="lineNum">     156</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L157"><span class="lineNum">     157</span>                 :<span class="tlaUNC">           0 :     bool fRescan = true;</span></span>
<span id="L158"><span class="lineNum">     158</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L159"><span class="lineNum">     159</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L160"><span class="lineNum">     160</span>                 :             : </span>
<span id="L161"><span class="lineNum">     161</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         EnsureWalletIsUnlocked(*pwallet);</span></span>
<span id="L162"><span class="lineNum">     162</span>                 :             : </span>
<span id="L163"><span class="lineNum">     163</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         std::string strSecret = request.params[0].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L164"><span class="lineNum">     164</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const std::string strLabel{LabelFromValue(request.params[1])};</span></span>
<span id="L165"><span class="lineNum">     165</span>                 :             : </span>
<span id="L166"><span class="lineNum">     166</span>                 :             :         // Whether to perform rescan after import</span>
<span id="L167"><span class="lineNum">     167</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!request.params[2].isNull())</span></span>
<span id="L168"><span class="lineNum">     168</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             fRescan = request.params[2].get_bool();</span></span>
<span id="L169"><span class="lineNum">     169</span>                 :             : </span>
<span id="L170"><span class="lineNum">     170</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (fRescan &amp;&amp; pwallet-&gt;chain().havePruned()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L171"><span class="lineNum">     171</span>                 :             :             // Exit early and print an error.</span>
<span id="L172"><span class="lineNum">     172</span>                 :             :             // If a block is pruned after this check, we will import the key(s),</span>
<span id="L173"><span class="lineNum">     173</span>                 :             :             // but fail the rescan with a generic error.</span>
<span id="L174"><span class="lineNum">     174</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Rescan is disabled when blocks are pruned&quot;);</span></span>
<span id="L175"><span class="lineNum">     175</span>                 :             :         }</span>
<span id="L176"><span class="lineNum">     176</span>                 :             : </span>
<span id="L177"><span class="lineNum">     177</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (fRescan &amp;&amp; !reserver.reserve()) {</span></span>
<span id="L178"><span class="lineNum">     178</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L179"><span class="lineNum">     179</span>                 :             :         }</span>
<span id="L180"><span class="lineNum">     180</span>                 :             : </span>
<span id="L181"><span class="lineNum">     181</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKey key = DecodeSecret(strSecret);</span></span>
<span id="L182"><span class="lineNum">     182</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (!key.IsValid()) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid private key encoding&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L183"><span class="lineNum">     183</span>                 :             : </span>
<span id="L184"><span class="lineNum">     184</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CPubKey pubkey = key.GetPubKey();</span></span>
<span id="L185"><span class="lineNum">     185</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(key.VerifyPubKey(pubkey));</span></span>
<span id="L186"><span class="lineNum">     186</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKeyID vchAddress = pubkey.GetID();</span></span>
<span id="L187"><span class="lineNum">     187</span>                 :<span class="tlaUNC">           0 :         {</span></span>
<span id="L188"><span class="lineNum">     188</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             pwallet-&gt;MarkDirty();</span></span>
<span id="L189"><span class="lineNum">     189</span>                 :             : </span>
<span id="L190"><span class="lineNum">     190</span>                 :             :             // We don't know which corresponding address will be used;</span>
<span id="L191"><span class="lineNum">     191</span>                 :             :             // label all new addresses, and label existing addresses if a</span>
<span id="L192"><span class="lineNum">     192</span>                 :             :             // label was passed.</span>
<span id="L193"><span class="lineNum">     193</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const auto&amp; dest : GetAllDestinationsForKey(pubkey)) {</span></span>
<span id="L194"><span class="lineNum">     194</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 if (!request.params[1].isNull() || !pwallet-&gt;FindAddressBookEntry(dest)) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L195"><span class="lineNum">     195</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     pwallet-&gt;SetAddressBook(dest, strLabel, AddressPurpose::RECEIVE);</span></span>
<span id="L196"><span class="lineNum">     196</span>                 :             :                 }</span>
<span id="L197"><span class="lineNum">     197</span>                 :<span class="tlaUNC">           0 :             }</span></span>
<span id="L198"><span class="lineNum">     198</span>                 :             : </span>
<span id="L199"><span class="lineNum">     199</span>                 :             :             // Use timestamp of 1 to scan the whole chain</span>
<span id="L200"><span class="lineNum">     200</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (!pwallet-&gt;ImportPrivKeys({{vchAddress, key}}, 1)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L201"><span class="lineNum">     201</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding key to wallet&quot;);</span></span>
<span id="L202"><span class="lineNum">     202</span>                 :             :             }</span>
<span id="L203"><span class="lineNum">     203</span>                 :             : </span>
<span id="L204"><span class="lineNum">     204</span>                 :             :             // Add the wpkh script for this key if possible</span>
<span id="L205"><span class="lineNum">     205</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (pubkey.IsCompressed()) {</span></span>
<span id="L206"><span class="lineNum">     206</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 pwallet-&gt;ImportScripts({GetScriptForDestination(WitnessV0KeyHash(vchAddress))}, /*timestamp=*/0);</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L207"><span class="lineNum">     207</span>                 :             :             }</span>
<span id="L208"><span class="lineNum">     208</span>                 :             :         }</span>
<span id="L209"><span class="lineNum">     209</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L210"><span class="lineNum">     210</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan) {</span></span>
<span id="L211"><span class="lineNum">     211</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         RescanWallet(*pwallet, reserver);</span></span>
<span id="L212"><span class="lineNum">     212</span>                 :             :     }</span>
<span id="L213"><span class="lineNum">     213</span>                 :             : </span>
<span id="L214"><span class="lineNum">     214</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L215"><span class="lineNum">     215</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : },</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L216"><span class="lineNum">     216</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not executed"> # </span>]
<span id="L217"><span class="lineNum">     217</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L218"><span class="lineNum">     218</span>                 :             : </span>
<span id="L219"><span class="lineNum">     219</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importaddress()</span></span>
<span id="L220"><span class="lineNum">     220</span>                 :             : {</span>
<span id="L221"><span class="lineNum">     221</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importaddress&quot;,</span></span>
<span id="L222"><span class="lineNum">     222</span>                 :             :             &quot;\nAdds an address or script (in hex) that can be watched as if it were in your wallet but cannot be used to spend. Requires a new wallet backup.\n&quot;</span>
<span id="L223"><span class="lineNum">     223</span>                 :             :             &quot;\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\n&quot;</span>
<span id="L224"><span class="lineNum">     224</span>                 :             :             &quot;may report that the imported address exists but related transactions are still missing, leading to temporarily incorrect/bogus balances and unspent outputs until rescan completes.\n&quot;</span>
<span id="L225"><span class="lineNum">     225</span>                 :             :             &quot;The rescan parameter can be set to false if the key was never used to create transactions. If it is set to false,\n&quot;</span>
<span id="L226"><span class="lineNum">     226</span>                 :             :             &quot;but the key was used to create transactions, rescanblockchain needs to be called with the appropriate block range.\n&quot;</span>
<span id="L227"><span class="lineNum">     227</span>                 :             :             &quot;If you have the full public key, you should call importpubkey instead of this.\n&quot;</span>
<span id="L228"><span class="lineNum">     228</span>                 :             :             &quot;Hint: use importmulti to import more than one address.\n&quot;</span>
<span id="L229"><span class="lineNum">     229</span>                 :             :             &quot;\nNote: If you import a non-standard raw script in hex form, outputs sending to it will be treated\n&quot;</span>
<span id="L230"><span class="lineNum">     230</span>                 :             :             &quot;as change, and not show up in many RPCs.\n&quot;</span>
<span id="L231"><span class="lineNum">     231</span>                 :             :             &quot;Note: Use \&quot;getwalletinfo\&quot; to query the scanning progress.\n&quot;</span>
<span id="L232"><span class="lineNum">     232</span>                 :             :             &quot;Note: This command is only compatible with legacy wallets. Use \&quot;importdescriptors\&quot; for descriptor wallets.\n&quot;,</span>
<span id="L233"><span class="lineNum">     233</span>                 :             :                 {</span>
<span id="L234"><span class="lineNum">     234</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;address&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The Bitcoin address (or hex-encoded script)&quot;},</span></span>
<span id="L235"><span class="lineNum">     235</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;label&quot;, RPCArg::Type::STR, RPCArg::Default{&quot;&quot;}, &quot;An optional label&quot;},</span></span>
<span id="L236"><span class="lineNum">     236</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;rescan&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Scan the chain and mempool for wallet transactions.&quot;},</span></span>
<span id="L237"><span class="lineNum">     237</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;p2sh&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Add the P2SH version of the script as well&quot;},</span></span>
<span id="L238"><span class="lineNum">     238</span>                 :             :                 },</span>
<span id="L239"><span class="lineNum">     239</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L240"><span class="lineNum">     240</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L241"><span class="lineNum">     241</span>                 :             :             &quot;\nImport an address with rescan\n&quot;</span>
<span id="L242"><span class="lineNum">     242</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importaddress&quot;, &quot;\&quot;myaddress\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L243"><span class="lineNum">     243</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport using a label without rescan\n&quot;</span></span>
<span id="L244"><span class="lineNum">     244</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importaddress&quot;, &quot;\&quot;myaddress\&quot; \&quot;testing\&quot; false&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L245"><span class="lineNum">     245</span>                 :<span class="tlaUNC">           0 :             &quot;\nAs a JSON-RPC call\n&quot;</span></span>
<span id="L246"><span class="lineNum">     246</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;importaddress&quot;, &quot;\&quot;myaddress\&quot;, \&quot;testing\&quot;, false&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L247"><span class="lineNum">     247</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L248"><span class="lineNum">     248</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L249"><span class="lineNum">     249</span>                 :             : {</span>
<span id="L250"><span class="lineNum">     250</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L251"><span class="lineNum">     251</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L252"><span class="lineNum">     252</span>                 :             : </span>
<span id="L253"><span class="lineNum">     253</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureLegacyScriptPubKeyMan(*pwallet, true);</span></span>
<span id="L254"><span class="lineNum">     254</span>                 :             : </span>
<span id="L255"><span class="lineNum">     255</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::string strLabel{LabelFromValue(request.params[1])};</span></span>
<span id="L256"><span class="lineNum">     256</span>                 :             : </span>
<span id="L257"><span class="lineNum">     257</span>                 :             :     // Whether to perform rescan after import</span>
<span id="L258"><span class="lineNum">     258</span>                 :<span class="tlaUNC">           0 :     bool fRescan = true;</span></span>
<span id="L259"><span class="lineNum">     259</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!request.params[2].isNull())</span></span>
<span id="L260"><span class="lineNum">     260</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         fRescan = request.params[2].get_bool();</span></span>
<span id="L261"><span class="lineNum">     261</span>                 :             : </span>
<span id="L262"><span class="lineNum">     262</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; pwallet-&gt;chain().havePruned()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L263"><span class="lineNum">     263</span>                 :             :         // Exit early and print an error.</span>
<span id="L264"><span class="lineNum">     264</span>                 :             :         // If a block is pruned after this check, we will import the key(s),</span>
<span id="L265"><span class="lineNum">     265</span>                 :             :         // but fail the rescan with a generic error.</span>
<span id="L266"><span class="lineNum">     266</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Rescan is disabled when blocks are pruned&quot;);</span></span>
<span id="L267"><span class="lineNum">     267</span>                 :             :     }</span>
<span id="L268"><span class="lineNum">     268</span>                 :             : </span>
<span id="L269"><span class="lineNum">     269</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L270"><span class="lineNum">     270</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; !reserver.reserve()) {</span></span>
<span id="L271"><span class="lineNum">     271</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L272"><span class="lineNum">     272</span>                 :             :     }</span>
<span id="L273"><span class="lineNum">     273</span>                 :             : </span>
<span id="L274"><span class="lineNum">     274</span>                 :             :     // Whether to import a p2sh version, too</span>
<span id="L275"><span class="lineNum">     275</span>                 :<span class="tlaUNC">           0 :     bool fP2SH = false;</span></span>
<span id="L276"><span class="lineNum">     276</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!request.params[3].isNull())</span></span>
<span id="L277"><span class="lineNum">     277</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         fP2SH = request.params[3].get_bool();</span></span>
<span id="L278"><span class="lineNum">     278</span>                 :             : </span>
<span id="L279"><span class="lineNum">     279</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L280"><span class="lineNum">     280</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L281"><span class="lineNum">     281</span>                 :             : </span>
<span id="L282"><span class="lineNum">     282</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         CTxDestination dest = DecodeDestination(request.params[0].get_str());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L283"><span class="lineNum">     283</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (IsValidDestination(dest)) {</span></span>
<span id="L284"><span class="lineNum">     284</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (fP2SH) {</span></span>
<span id="L285"><span class="lineNum">     285</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Cannot use the p2sh flag with an address - use a script instead&quot;);</span></span>
<span id="L286"><span class="lineNum">     286</span>                 :             :             }</span>
<span id="L287"><span class="lineNum">     287</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (OutputTypeFromDestination(dest) == OutputType::BECH32M) {</span></span>
<span id="L288"><span class="lineNum">     288</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Bech32m addresses cannot be imported into legacy wallets&quot;);</span></span>
<span id="L289"><span class="lineNum">     289</span>                 :             :             }</span>
<span id="L290"><span class="lineNum">     290</span>                 :             : </span>
<span id="L291"><span class="lineNum">     291</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             pwallet-&gt;MarkDirty();</span></span>
<span id="L292"><span class="lineNum">     292</span>                 :             : </span>
<span id="L293"><span class="lineNum">     293</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             pwallet-&gt;ImportScriptPubKeys(strLabel, {GetScriptForDestination(dest)}, /*have_solving_data=*/false, /*apply_label=*/true, /*timestamp=*/1);</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L294"><span class="lineNum">     294</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         } else if (IsHex(request.params[0].get_str())) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L295"><span class="lineNum">     295</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             std::vector&lt;unsigned char&gt; data(ParseHex(request.params[0].get_str()));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L296"><span class="lineNum">     296</span>                 :<span class="tlaUNC">           0 :             CScript redeem_script(data.begin(), data.end());</span></span>
<span id="L297"><span class="lineNum">     297</span>                 :             : </span>
<span id="L298"><span class="lineNum">     298</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::set&lt;CScript&gt; scripts = {redeem_script};</span></span>
<span id="L299"><span class="lineNum">     299</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             pwallet-&gt;ImportScripts(scripts, /*timestamp=*/0);</span></span>
<span id="L300"><span class="lineNum">     300</span>                 :             : </span>
<span id="L301"><span class="lineNum">     301</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (fP2SH) {</span></span>
<span id="L302"><span class="lineNum">     302</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 scripts.insert(GetScriptForDestination(ScriptHash(redeem_script)));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L303"><span class="lineNum">     303</span>                 :             :             }</span>
<span id="L304"><span class="lineNum">     304</span>                 :             : </span>
<span id="L305"><span class="lineNum">     305</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             pwallet-&gt;ImportScriptPubKeys(strLabel, scripts, /*have_solving_data=*/false, /*apply_label=*/true, /*timestamp=*/1);</span></span>
<span id="L306"><span class="lineNum">     306</span>                 :<span class="tlaUNC">           0 :         } else {</span></span>
<span id="L307"><span class="lineNum">     307</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid Bitcoin address or script&quot;);</span></span>
<span id="L308"><span class="lineNum">     308</span>                 :             :         }</span>
<span id="L309"><span class="lineNum">     309</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L310"><span class="lineNum">     310</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan)</span></span>
<span id="L311"><span class="lineNum">     311</span>                 :             :     {</span>
<span id="L312"><span class="lineNum">     312</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         RescanWallet(*pwallet, reserver);</span></span>
<span id="L313"><span class="lineNum">     313</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ResubmitWalletTransactions(/*relay=*/false, /*force=*/true);</span></span>
<span id="L314"><span class="lineNum">     314</span>                 :             :     }</span>
<span id="L315"><span class="lineNum">     315</span>                 :             : </span>
<span id="L316"><span class="lineNum">     316</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L317"><span class="lineNum">     317</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L318"><span class="lineNum">     318</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span>]
<span id="L319"><span class="lineNum">     319</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L320"><span class="lineNum">     320</span>                 :             : </span>
<span id="L321"><span class="lineNum">     321</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importprunedfunds()</span></span>
<span id="L322"><span class="lineNum">     322</span>                 :             : {</span>
<span id="L323"><span class="lineNum">     323</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importprunedfunds&quot;,</span></span>
<span id="L324"><span class="lineNum">     324</span>                 :             :                 &quot;\nImports funds without rescan. Corresponding address or script must previously be included in wallet. Aimed towards pruned wallets. The end-user is responsible to import additional transactions that subsequently spend the imported outputs or rescan after the point in the blockchain the transaction is included.\n&quot;,</span>
<span id="L325"><span class="lineNum">     325</span>                 :             :                 {</span>
<span id="L326"><span class="lineNum">     326</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;rawtransaction&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;A raw transaction in hex funding an already-existing address in wallet&quot;},</span></span>
<span id="L327"><span class="lineNum">     327</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;txoutproof&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The hex output from gettxoutproof that contains the transaction&quot;},</span></span>
<span id="L328"><span class="lineNum">     328</span>                 :             :                 },</span>
<span id="L329"><span class="lineNum">     329</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L330"><span class="lineNum">     330</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 RPCExamples{&quot;&quot;},</span></span>
<span id="L331"><span class="lineNum">     331</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L332"><span class="lineNum">     332</span>                 :             : {</span>
<span id="L333"><span class="lineNum">     333</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L334"><span class="lineNum">     334</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L335"><span class="lineNum">     335</span>                 :             : </span>
<span id="L336"><span class="lineNum">     336</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CMutableTransaction tx;</span></span>
<span id="L337"><span class="lineNum">     337</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (!DecodeHexTx(tx, request.params[0].get_str())) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L338"><span class="lineNum">     338</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_DESERIALIZATION_ERROR, &quot;TX decode failed. Make sure the tx has at least one input.&quot;);</span></span>
<span id="L339"><span class="lineNum">     339</span>                 :             :     }</span>
<span id="L340"><span class="lineNum">     340</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     uint256 hashTx = tx.GetHash();</span></span>
<span id="L341"><span class="lineNum">     341</span>                 :             : </span>
<span id="L342"><span class="lineNum">     342</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     DataStream ssMB{ParseHexV(request.params[1], &quot;proof&quot;)};</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L343"><span class="lineNum">     343</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CMerkleBlock merkleBlock;</span></span>
<span id="L344"><span class="lineNum">     344</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     ssMB &gt;&gt; merkleBlock;</span></span>
<span id="L345"><span class="lineNum">     345</span>                 :             : </span>
<span id="L346"><span class="lineNum">     346</span>                 :             :     //Search partial merkle tree in proof for our transaction and index in valid block</span>
<span id="L347"><span class="lineNum">     347</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;uint256&gt; vMatch;</span></span>
<span id="L348"><span class="lineNum">     348</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;unsigned int&gt; vIndex;</span></span>
<span id="L349"><span class="lineNum">     349</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (merkleBlock.txn.ExtractMatches(vMatch, vIndex) != merkleBlock.header.hashMerkleRoot) {</span></span>
<span id="L350"><span class="lineNum">     350</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Something wrong with merkleblock&quot;);</span></span>
<span id="L351"><span class="lineNum">     351</span>                 :             :     }</span>
<span id="L352"><span class="lineNum">     352</span>                 :             : </span>
<span id="L353"><span class="lineNum">     353</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L354"><span class="lineNum">     354</span>                 :<span class="tlaUNC">           0 :     int height;</span></span>
<span id="L355"><span class="lineNum">     355</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (!pwallet-&gt;chain().findAncestorByHash(pwallet-&gt;GetLastBlockHash(), merkleBlock.header.GetHash(), FoundBlock().height(height))) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L356"><span class="lineNum">     356</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Block not found in chain&quot;);</span></span>
<span id="L357"><span class="lineNum">     357</span>                 :             :     }</span>
<span id="L358"><span class="lineNum">     358</span>                 :             : </span>
<span id="L359"><span class="lineNum">     359</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;uint256&gt;::const_iterator it;</span></span>
<span id="L360"><span class="lineNum">     360</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if ((it = std::find(vMatch.begin(), vMatch.end(), hashTx)) == vMatch.end()) {</span></span>
<span id="L361"><span class="lineNum">     361</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Transaction given doesn't exist in proof&quot;);</span></span>
<span id="L362"><span class="lineNum">     362</span>                 :             :     }</span>
<span id="L363"><span class="lineNum">     363</span>                 :             : </span>
<span id="L364"><span class="lineNum">     364</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     unsigned int txnIndex = vIndex[it - vMatch.begin()];</span></span>
<span id="L365"><span class="lineNum">     365</span>                 :             : </span>
<span id="L366"><span class="lineNum">     366</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CTransactionRef tx_ref = MakeTransactionRef(tx);</span></span>
<span id="L367"><span class="lineNum">     367</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (pwallet-&gt;IsMine(*tx_ref)) {</span></span>
<span id="L368"><span class="lineNum">     368</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;AddToWallet(std::move(tx_ref), TxStateConfirmed{merkleBlock.header.GetHash(), height, static_cast&lt;int&gt;(txnIndex)});</span></span>
<span id="L369"><span class="lineNum">     369</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return UniValue::VNULL;</span></span>
<span id="L370"><span class="lineNum">     370</span>                 :             :     }</span>
<span id="L371"><span class="lineNum">     371</span>                 :             : </span>
<span id="L372"><span class="lineNum">     372</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;No addresses in wallet correspond to included transaction&quot;);</span></span>
<span id="L373"><span class="lineNum">     373</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L374"><span class="lineNum">     374</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 19 was not executed"> # </span>]
<span id="L375"><span class="lineNum">     375</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L376"><span class="lineNum">     376</span>                 :             : </span>
<span id="L377"><span class="lineNum">     377</span>                 :<span class="tlaUNC">           0 : RPCHelpMan removeprunedfunds()</span></span>
<span id="L378"><span class="lineNum">     378</span>                 :             : {</span>
<span id="L379"><span class="lineNum">     379</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;removeprunedfunds&quot;,</span></span>
<span id="L380"><span class="lineNum">     380</span>                 :             :                 &quot;\nDeletes the specified transaction from the wallet. Meant for use with pruned wallets and as a companion to importprunedfunds. This will affect wallet balances.\n&quot;,</span>
<span id="L381"><span class="lineNum">     381</span>                 :             :                 {</span>
<span id="L382"><span class="lineNum">     382</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;txid&quot;, RPCArg::Type::STR_HEX, RPCArg::Optional::NO, &quot;The hex-encoded id of the transaction you are deleting&quot;},</span></span>
<span id="L383"><span class="lineNum">     383</span>                 :             :                 },</span>
<span id="L384"><span class="lineNum">     384</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L385"><span class="lineNum">     385</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L386"><span class="lineNum">     386</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;removeprunedfunds&quot;, &quot;\&quot;a8d0c0184dde994a09ec054286f1ce581bebf46446a512166eae7628734ea0a5\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L387"><span class="lineNum">     387</span>                 :<span class="tlaUNC">           0 :             &quot;\nAs a JSON-RPC call\n&quot;</span></span>
<span id="L388"><span class="lineNum">     388</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;removeprunedfunds&quot;, &quot;\&quot;a8d0c0184dde994a09ec054286f1ce581bebf46446a512166eae7628734ea0a5\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L389"><span class="lineNum">     389</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L390"><span class="lineNum">     390</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L391"><span class="lineNum">     391</span>                 :             : {</span>
<span id="L392"><span class="lineNum">     392</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L393"><span class="lineNum">     393</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L394"><span class="lineNum">     394</span>                 :             : </span>
<span id="L395"><span class="lineNum">     395</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L396"><span class="lineNum">     396</span>                 :             : </span>
<span id="L397"><span class="lineNum">     397</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     uint256 hash(ParseHashV(request.params[0], &quot;txid&quot;));</span></span>
<span id="L398"><span class="lineNum">     398</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;uint256&gt; vHash;</span></span>
<span id="L399"><span class="lineNum">     399</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     vHash.push_back(hash);</span></span>
<span id="L400"><span class="lineNum">     400</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (auto res = pwallet-&gt;RemoveTxs(vHash); !res) {</span></span>
<span id="L401"><span class="lineNum">     401</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, util::ErrorString(res).original);</span></span>
<span id="L402"><span class="lineNum">     402</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L403"><span class="lineNum">     403</span>                 :             : </span>
<span id="L404"><span class="lineNum">     404</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L405"><span class="lineNum">     405</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L406"><span class="lineNum">     406</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L407"><span class="lineNum">     407</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : }</span></span>
<span id="L408"><span class="lineNum">     408</span>                 :             : </span>
<span id="L409"><span class="lineNum">     409</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importpubkey()</span></span>
<span id="L410"><span class="lineNum">     410</span>                 :             : {</span>
<span id="L411"><span class="lineNum">     411</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importpubkey&quot;,</span></span>
<span id="L412"><span class="lineNum">     412</span>                 :             :                 &quot;\nAdds a public key (in hex) that can be watched as if it were in your wallet but cannot be used to spend. Requires a new wallet backup.\n&quot;</span>
<span id="L413"><span class="lineNum">     413</span>                 :             :                 &quot;Hint: use importmulti to import more than one public key.\n&quot;</span>
<span id="L414"><span class="lineNum">     414</span>                 :             :             &quot;\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\n&quot;</span>
<span id="L415"><span class="lineNum">     415</span>                 :             :             &quot;may report that the imported pubkey exists but related transactions are still missing, leading to temporarily incorrect/bogus balances and unspent outputs until rescan completes.\n&quot;</span>
<span id="L416"><span class="lineNum">     416</span>                 :             :             &quot;The rescan parameter can be set to false if the key was never used to create transactions. If it is set to false,\n&quot;</span>
<span id="L417"><span class="lineNum">     417</span>                 :             :             &quot;but the key was used to create transactions, rescanblockchain needs to be called with the appropriate block range.\n&quot;</span>
<span id="L418"><span class="lineNum">     418</span>                 :             :             &quot;Note: Use \&quot;getwalletinfo\&quot; to query the scanning progress.\n&quot;</span>
<span id="L419"><span class="lineNum">     419</span>                 :             :             &quot;Note: This command is only compatible with legacy wallets. Use \&quot;importdescriptors\&quot; with \&quot;combo(X)\&quot; for descriptor wallets.\n&quot;,</span>
<span id="L420"><span class="lineNum">     420</span>                 :             :                 {</span>
<span id="L421"><span class="lineNum">     421</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;pubkey&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The hex-encoded public key&quot;},</span></span>
<span id="L422"><span class="lineNum">     422</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;label&quot;, RPCArg::Type::STR, RPCArg::Default{&quot;&quot;}, &quot;An optional label&quot;},</span></span>
<span id="L423"><span class="lineNum">     423</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;rescan&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Scan the chain and mempool for wallet transactions.&quot;},</span></span>
<span id="L424"><span class="lineNum">     424</span>                 :             :                 },</span>
<span id="L425"><span class="lineNum">     425</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L426"><span class="lineNum">     426</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L427"><span class="lineNum">     427</span>                 :             :             &quot;\nImport a public key with rescan\n&quot;</span>
<span id="L428"><span class="lineNum">     428</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importpubkey&quot;, &quot;\&quot;mypubkey\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L429"><span class="lineNum">     429</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport using a label without rescan\n&quot;</span></span>
<span id="L430"><span class="lineNum">     430</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importpubkey&quot;, &quot;\&quot;mypubkey\&quot; \&quot;testing\&quot; false&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L431"><span class="lineNum">     431</span>                 :<span class="tlaUNC">           0 :             &quot;\nAs a JSON-RPC call\n&quot;</span></span>
<span id="L432"><span class="lineNum">     432</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;importpubkey&quot;, &quot;\&quot;mypubkey\&quot;, \&quot;testing\&quot;, false&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L433"><span class="lineNum">     433</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L434"><span class="lineNum">     434</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L435"><span class="lineNum">     435</span>                 :             : {</span>
<span id="L436"><span class="lineNum">     436</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L437"><span class="lineNum">     437</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L438"><span class="lineNum">     438</span>                 :             : </span>
<span id="L439"><span class="lineNum">     439</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureLegacyScriptPubKeyMan(*pwallet, true);</span></span>
<span id="L440"><span class="lineNum">     440</span>                 :             : </span>
<span id="L441"><span class="lineNum">     441</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::string strLabel{LabelFromValue(request.params[1])};</span></span>
<span id="L442"><span class="lineNum">     442</span>                 :             : </span>
<span id="L443"><span class="lineNum">     443</span>                 :             :     // Whether to perform rescan after import</span>
<span id="L444"><span class="lineNum">     444</span>                 :<span class="tlaUNC">           0 :     bool fRescan = true;</span></span>
<span id="L445"><span class="lineNum">     445</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!request.params[2].isNull())</span></span>
<span id="L446"><span class="lineNum">     446</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         fRescan = request.params[2].get_bool();</span></span>
<span id="L447"><span class="lineNum">     447</span>                 :             : </span>
<span id="L448"><span class="lineNum">     448</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; pwallet-&gt;chain().havePruned()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L449"><span class="lineNum">     449</span>                 :             :         // Exit early and print an error.</span>
<span id="L450"><span class="lineNum">     450</span>                 :             :         // If a block is pruned after this check, we will import the key(s),</span>
<span id="L451"><span class="lineNum">     451</span>                 :             :         // but fail the rescan with a generic error.</span>
<span id="L452"><span class="lineNum">     452</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Rescan is disabled when blocks are pruned&quot;);</span></span>
<span id="L453"><span class="lineNum">     453</span>                 :             :     }</span>
<span id="L454"><span class="lineNum">     454</span>                 :             : </span>
<span id="L455"><span class="lineNum">     455</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L456"><span class="lineNum">     456</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; !reserver.reserve()) {</span></span>
<span id="L457"><span class="lineNum">     457</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L458"><span class="lineNum">     458</span>                 :             :     }</span>
<span id="L459"><span class="lineNum">     459</span>                 :             : </span>
<span id="L460"><span class="lineNum">     460</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     CPubKey pubKey = HexToPubKey(request.params[0].get_str());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L461"><span class="lineNum">     461</span>                 :             : </span>
<span id="L462"><span class="lineNum">     462</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L463"><span class="lineNum">     463</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L464"><span class="lineNum">     464</span>                 :             : </span>
<span id="L465"><span class="lineNum">     465</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::set&lt;CScript&gt; script_pub_keys;</span></span>
<span id="L466"><span class="lineNum">     466</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const auto&amp; dest : GetAllDestinationsForKey(pubKey)) {</span></span>
<span id="L467"><span class="lineNum">     467</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             script_pub_keys.insert(GetScriptForDestination(dest));</span></span>
<span id="L468"><span class="lineNum">     468</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L469"><span class="lineNum">     469</span>                 :             : </span>
<span id="L470"><span class="lineNum">     470</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;MarkDirty();</span></span>
<span id="L471"><span class="lineNum">     471</span>                 :             : </span>
<span id="L472"><span class="lineNum">     472</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ImportScriptPubKeys(strLabel, script_pub_keys, /*have_solving_data=*/true, /*apply_label=*/true, /*timestamp=*/1);</span></span>
<span id="L473"><span class="lineNum">     473</span>                 :             : </span>
<span id="L474"><span class="lineNum">     474</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         pwallet-&gt;ImportPubKeys({{pubKey.GetID(), false}}, {{pubKey.GetID(), pubKey}} , /*key_origins=*/{}, /*add_keypool=*/false, /*timestamp=*/1);</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L475"><span class="lineNum">     475</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L476"><span class="lineNum">     476</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan)</span></span>
<span id="L477"><span class="lineNum">     477</span>                 :             :     {</span>
<span id="L478"><span class="lineNum">     478</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         RescanWallet(*pwallet, reserver);</span></span>
<span id="L479"><span class="lineNum">     479</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ResubmitWalletTransactions(/*relay=*/false, /*force=*/true);</span></span>
<span id="L480"><span class="lineNum">     480</span>                 :             :     }</span>
<span id="L481"><span class="lineNum">     481</span>                 :             : </span>
<span id="L482"><span class="lineNum">     482</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L483"><span class="lineNum">     483</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L484"><span class="lineNum">     484</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not executed"> # </span>]
<span id="L485"><span class="lineNum">     485</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L486"><span class="lineNum">     486</span>                 :             : </span>
<span id="L487"><span class="lineNum">     487</span>                 :             : </span>
<span id="L488"><span class="lineNum">     488</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importwallet()</span></span>
<span id="L489"><span class="lineNum">     489</span>                 :             : {</span>
<span id="L490"><span class="lineNum">     490</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importwallet&quot;,</span></span>
<span id="L491"><span class="lineNum">     491</span>                 :             :                 &quot;\nImports keys from a wallet dump file (see dumpwallet). Requires a new wallet backup to include imported keys.\n&quot;</span>
<span id="L492"><span class="lineNum">     492</span>                 :             :                 &quot;Note: Blockchain and Mempool will be rescanned after a successful import. Use \&quot;getwalletinfo\&quot; to query the scanning progress.\n&quot;</span>
<span id="L493"><span class="lineNum">     493</span>                 :             :                 &quot;Note: This command is only compatible with legacy wallets.\n&quot;,</span>
<span id="L494"><span class="lineNum">     494</span>                 :             :                 {</span>
<span id="L495"><span class="lineNum">     495</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;filename&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The wallet file&quot;},</span></span>
<span id="L496"><span class="lineNum">     496</span>                 :             :                 },</span>
<span id="L497"><span class="lineNum">     497</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L498"><span class="lineNum">     498</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L499"><span class="lineNum">     499</span>                 :             :             &quot;\nDump the wallet\n&quot;</span>
<span id="L500"><span class="lineNum">     500</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;dumpwallet&quot;, &quot;\&quot;test\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L501"><span class="lineNum">     501</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport the wallet\n&quot;</span></span>
<span id="L502"><span class="lineNum">     502</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importwallet&quot;, &quot;\&quot;test\&quot;&quot;) +</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L503"><span class="lineNum">     503</span>                 :<span class="tlaUNC">           0 :             &quot;\nImport using the json rpc call\n&quot;</span></span>
<span id="L504"><span class="lineNum">     504</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;importwallet&quot;, &quot;\&quot;test\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L505"><span class="lineNum">     505</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L506"><span class="lineNum">     506</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L507"><span class="lineNum">     507</span>                 :             : {</span>
<span id="L508"><span class="lineNum">     508</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L509"><span class="lineNum">     509</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L510"><span class="lineNum">     510</span>                 :             : </span>
<span id="L511"><span class="lineNum">     511</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureLegacyScriptPubKeyMan(*pwallet, true);</span></span>
<span id="L512"><span class="lineNum">     512</span>                 :             : </span>
<span id="L513"><span class="lineNum">     513</span>                 :<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L514"><span class="lineNum">     514</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!reserver.reserve()) {</span></span>
<span id="L515"><span class="lineNum">     515</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L516"><span class="lineNum">     516</span>                 :             :     }</span>
<span id="L517"><span class="lineNum">     517</span>                 :             : </span>
<span id="L518"><span class="lineNum">     518</span>                 :<span class="tlaUNC">           0 :     int64_t nTimeBegin = 0;</span></span>
<span id="L519"><span class="lineNum">     519</span>                 :<span class="tlaUNC">           0 :     bool fGood = true;</span></span>
<span id="L520"><span class="lineNum">     520</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L521"><span class="lineNum">     521</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L522"><span class="lineNum">     522</span>                 :             : </span>
<span id="L523"><span class="lineNum">     523</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         EnsureWalletIsUnlocked(*pwallet);</span></span>
<span id="L524"><span class="lineNum">     524</span>                 :             : </span>
<span id="L525"><span class="lineNum">     525</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::ifstream file;</span></span>
<span id="L526"><span class="lineNum">     526</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         file.open(fs::u8path(request.params[0].get_str()), std::ios::in | std::ios::ate);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L527"><span class="lineNum">     527</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!file.is_open()) {</span></span>
<span id="L528"><span class="lineNum">     528</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Cannot open wallet dump file&quot;);</span></span>
<span id="L529"><span class="lineNum">     529</span>                 :             :         }</span>
<span id="L530"><span class="lineNum">     530</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(pwallet-&gt;chain().findBlock(pwallet-&gt;GetLastBlockHash(), FoundBlock().time(nTimeBegin)));</span></span>
<span id="L531"><span class="lineNum">     531</span>                 :             : </span>
<span id="L532"><span class="lineNum">     532</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         int64_t nFilesize = std::max((int64_t)1, (int64_t)file.tellg());</span></span>
<span id="L533"><span class="lineNum">     533</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         file.seekg(0, file.beg);</span></span>
<span id="L534"><span class="lineNum">     534</span>                 :             : </span>
<span id="L535"><span class="lineNum">     535</span>                 :             :         // Use uiInterface.ShowProgress instead of pwallet.ShowProgress because pwallet.ShowProgress has a cancel button tied to AbortRescan which</span>
<span id="L536"><span class="lineNum">     536</span>                 :             :         // we don't want for this progress bar showing the import progress. uiInterface.ShowProgress does not have a cancel button.</span>
<span id="L537"><span class="lineNum">     537</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         pwallet-&gt;chain().showProgress(strprintf(&quot;%s %s&quot;, pwallet-&gt;GetDisplayName(), _(&quot;Importing&quot;).translated), 0, false); // show progress dialog in GUI</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L538"><span class="lineNum">     538</span>                 :<span class="tlaUNC">           0 :         std::vector&lt;std::tuple&lt;CKey, int64_t, bool, std::string&gt;&gt; keys;</span></span>
<span id="L539"><span class="lineNum">     539</span>                 :<span class="tlaUNC">           0 :         std::vector&lt;std::pair&lt;CScript, int64_t&gt;&gt; scripts;</span></span>
<span id="L540"><span class="lineNum">     540</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         while (file.good()) {</span></span>
<span id="L541"><span class="lineNum">     541</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             pwallet-&gt;chain().showProgress(&quot;&quot;, std::max(1, std::min(50, (int)(((double)file.tellg() / (double)nFilesize) * 100))), false);</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L542"><span class="lineNum">     542</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::string line;</span></span>
<span id="L543"><span class="lineNum">     543</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::getline(file, line);</span></span>
<span id="L544"><span class="lineNum">     544</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (line.empty() || line[0] == '#')</span></span>
<span id="L545"><span class="lineNum">     545</span>                 :<span class="tlaUNC">           0 :                 continue;</span></span>
<span id="L546"><span class="lineNum">     546</span>                 :             : </span>
<span id="L547"><span class="lineNum">     547</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::vector&lt;std::string&gt; vstr = SplitString(line, ' ');</span></span>
<span id="L548"><span class="lineNum">     548</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (vstr.size() &lt; 2)</span></span>
<span id="L549"><span class="lineNum">     549</span>                 :<span class="tlaUNC">           0 :                 continue;</span></span>
<span id="L550"><span class="lineNum">     550</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CKey key = DecodeSecret(vstr[0]);</span></span>
<span id="L551"><span class="lineNum">     551</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (key.IsValid()) {</span></span>
<span id="L552"><span class="lineNum">     552</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 int64_t nTime = ParseISO8601DateTime(vstr[1]);</span></span>
<span id="L553"><span class="lineNum">     553</span>                 :<span class="tlaUNC">           0 :                 std::string strLabel;</span></span>
<span id="L554"><span class="lineNum">     554</span>                 :<span class="tlaUNC">           0 :                 bool fLabel = true;</span></span>
<span id="L555"><span class="lineNum">     555</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 for (unsigned int nStr = 2; nStr &lt; vstr.size(); nStr++) {</span></span>
<span id="L556"><span class="lineNum">     556</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (vstr[nStr].front() == '#')</span></span>
<span id="L557"><span class="lineNum">     557</span>                 :             :                         break;</span>
<span id="L558"><span class="lineNum">     558</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (vstr[nStr] == &quot;change=1&quot;)</span></span>
<span id="L559"><span class="lineNum">     559</span>                 :<span class="tlaUNC">           0 :                         fLabel = false;</span></span>
<span id="L560"><span class="lineNum">     560</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (vstr[nStr] == &quot;reserve=1&quot;)</span></span>
<span id="L561"><span class="lineNum">     561</span>                 :<span class="tlaUNC">           0 :                         fLabel = false;</span></span>
<span id="L562"><span class="lineNum">     562</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     if (vstr[nStr].substr(0,6) == &quot;label=&quot;) {</span></span>
<span id="L563"><span class="lineNum">     563</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         strLabel = DecodeDumpString(vstr[nStr].substr(6));</span></span>
<span id="L564"><span class="lineNum">     564</span>                 :<span class="tlaUNC">           0 :                         fLabel = true;</span></span>
<span id="L565"><span class="lineNum">     565</span>                 :             :                     }</span>
<span id="L566"><span class="lineNum">     566</span>                 :             :                 }</span>
<span id="L567"><span class="lineNum">     567</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 nTimeBegin = std::min(nTimeBegin, nTime);</span></span>
<span id="L568"><span class="lineNum">     568</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 keys.emplace_back(key, nTime, fLabel, strLabel);</span></span>
<span id="L569"><span class="lineNum">     569</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             } else if(IsHex(vstr[0])) {</span></span>
<span id="L570"><span class="lineNum">     570</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 std::vector&lt;unsigned char&gt; vData(ParseHex(vstr[0]));</span></span>
<span id="L571"><span class="lineNum">     571</span>                 :<span class="tlaUNC">           0 :                 CScript script = CScript(vData.begin(), vData.end());</span></span>
<span id="L572"><span class="lineNum">     572</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 int64_t birth_time = ParseISO8601DateTime(vstr[1]);</span></span>
<span id="L573"><span class="lineNum">     573</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (birth_time &gt; 0) nTimeBegin = std::min(nTimeBegin, birth_time);</span></span>
<span id="L574"><span class="lineNum">     574</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 scripts.emplace_back(script, birth_time);</span></span>
<span id="L575"><span class="lineNum">     575</span>                 :<span class="tlaUNC">           0 :             }</span></span>
<span id="L576"><span class="lineNum">     576</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L577"><span class="lineNum">     577</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         file.close();</span></span>
<span id="L578"><span class="lineNum">     578</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         EnsureBlockDataFromTime(*pwallet, nTimeBegin);</span></span>
<span id="L579"><span class="lineNum">     579</span>                 :             :         // We now know whether we are importing private keys, so we can error if private keys are disabled</span>
<span id="L580"><span class="lineNum">     580</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (keys.size() &gt; 0 &amp;&amp; pwallet-&gt;IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L581"><span class="lineNum">     581</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             pwallet-&gt;chain().showProgress(&quot;&quot;, 100, false); // hide progress dialog in GUI</span></span>
<span id="L582"><span class="lineNum">     582</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Importing wallets is disabled when private keys are disabled&quot;);</span></span>
<span id="L583"><span class="lineNum">     583</span>                 :             :         }</span>
<span id="L584"><span class="lineNum">     584</span>                 :<span class="tlaUNC">           0 :         double total = (double)(keys.size() + scripts.size());</span></span>
<span id="L585"><span class="lineNum">     585</span>                 :<span class="tlaUNC">           0 :         double progress = 0;</span></span>
<span id="L586"><span class="lineNum">     586</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const auto&amp; key_tuple : keys) {</span></span>
<span id="L587"><span class="lineNum">     587</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             pwallet-&gt;chain().showProgress(&quot;&quot;, std::max(50, std::min(75, (int)((progress / total) * 100) + 50)), false);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L588"><span class="lineNum">     588</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const CKey&amp; key = std::get&lt;0&gt;(key_tuple);</span></span>
<span id="L589"><span class="lineNum">     589</span>                 :<span class="tlaUNC">           0 :             int64_t time = std::get&lt;1&gt;(key_tuple);</span></span>
<span id="L590"><span class="lineNum">     590</span>                 :<span class="tlaUNC">           0 :             bool has_label = std::get&lt;2&gt;(key_tuple);</span></span>
<span id="L591"><span class="lineNum">     591</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::string label = std::get&lt;3&gt;(key_tuple);</span></span>
<span id="L592"><span class="lineNum">     592</span>                 :             : </span>
<span id="L593"><span class="lineNum">     593</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CPubKey pubkey = key.GetPubKey();</span></span>
<span id="L594"><span class="lineNum">     594</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CHECK_NONFATAL(key.VerifyPubKey(pubkey));</span></span>
<span id="L595"><span class="lineNum">     595</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CKeyID keyid = pubkey.GetID();</span></span>
<span id="L596"><span class="lineNum">     596</span>                 :             : </span>
<span id="L597"><span class="lineNum">     597</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             pwallet-&gt;WalletLogPrintf(&quot;Importing %s...\n&quot;, EncodeDestination(PKHash(keyid)));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L598"><span class="lineNum">     598</span>                 :             : </span>
<span id="L599"><span class="lineNum">     599</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (!pwallet-&gt;ImportPrivKeys({{keyid, key}}, time)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L600"><span class="lineNum">     600</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 pwallet-&gt;WalletLogPrintf(&quot;Error importing key for %s\n&quot;, EncodeDestination(PKHash(keyid)));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L601"><span class="lineNum">     601</span>                 :<span class="tlaUNC">           0 :                 fGood = false;</span></span>
<span id="L602"><span class="lineNum">     602</span>                 :<span class="tlaUNC">           0 :                 continue;</span></span>
<span id="L603"><span class="lineNum">     603</span>                 :             :             }</span>
<span id="L604"><span class="lineNum">     604</span>                 :             : </span>
<span id="L605"><span class="lineNum">     605</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (has_label)</span></span>
<span id="L606"><span class="lineNum">     606</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 pwallet-&gt;SetAddressBook(PKHash(keyid), label, AddressPurpose::RECEIVE);</span></span>
<span id="L607"><span class="lineNum">     607</span>                 :<span class="tlaUNC">           0 :             progress++;</span></span>
<span id="L608"><span class="lineNum">     608</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L609"><span class="lineNum">     609</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const auto&amp; script_pair : scripts) {</span></span>
<span id="L610"><span class="lineNum">     610</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             pwallet-&gt;chain().showProgress(&quot;&quot;, std::max(50, std::min(75, (int)((progress / total) * 100) + 50)), false);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L611"><span class="lineNum">     611</span>                 :<span class="tlaUNC">           0 :             const CScript&amp; script = script_pair.first;</span></span>
<span id="L612"><span class="lineNum">     612</span>                 :<span class="tlaUNC">           0 :             int64_t time = script_pair.second;</span></span>
<span id="L613"><span class="lineNum">     613</span>                 :             : </span>
<span id="L614"><span class="lineNum">     614</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (!pwallet-&gt;ImportScripts({script}, time)) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L615"><span class="lineNum">     615</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 pwallet-&gt;WalletLogPrintf(&quot;Error importing script %s\n&quot;, HexStr(script));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L616"><span class="lineNum">     616</span>                 :<span class="tlaUNC">           0 :                 fGood = false;</span></span>
<span id="L617"><span class="lineNum">     617</span>                 :<span class="tlaUNC">           0 :                 continue;</span></span>
<span id="L618"><span class="lineNum">     618</span>                 :             :             }</span>
<span id="L619"><span class="lineNum">     619</span>                 :             : </span>
<span id="L620"><span class="lineNum">     620</span>                 :<span class="tlaUNC">           0 :             progress++;</span></span>
<span id="L621"><span class="lineNum">     621</span>                 :             :         }</span>
<span id="L622"><span class="lineNum">     622</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;chain().showProgress(&quot;&quot;, 100, false); // hide progress dialog in GUI</span></span>
<span id="L623"><span class="lineNum">     623</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L624"><span class="lineNum">     624</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     pwallet-&gt;chain().showProgress(&quot;&quot;, 100, false); // hide progress dialog in GUI</span></span>
<span id="L625"><span class="lineNum">     625</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     RescanWallet(*pwallet, reserver, nTimeBegin, /*update=*/false);</span></span>
<span id="L626"><span class="lineNum">     626</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     pwallet-&gt;MarkDirty();</span></span>
<span id="L627"><span class="lineNum">     627</span>                 :             : </span>
<span id="L628"><span class="lineNum">     628</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!fGood)</span></span>
<span id="L629"><span class="lineNum">     629</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding some keys/scripts to wallet&quot;);</span></span>
<span id="L630"><span class="lineNum">     630</span>                 :             : </span>
<span id="L631"><span class="lineNum">     631</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L632"><span class="lineNum">     632</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : },</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L633"><span class="lineNum">     633</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L634"><span class="lineNum">     634</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : }</span></span>
<span id="L635"><span class="lineNum">     635</span>                 :             : </span>
<span id="L636"><span class="lineNum">     636</span>                 :<span class="tlaUNC">           0 : RPCHelpMan dumpprivkey()</span></span>
<span id="L637"><span class="lineNum">     637</span>                 :             : {</span>
<span id="L638"><span class="lineNum">     638</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;dumpprivkey&quot;,</span></span>
<span id="L639"><span class="lineNum">     639</span>                 :             :                 &quot;\nReveals the private key corresponding to 'address'.\n&quot;</span>
<span id="L640"><span class="lineNum">     640</span>                 :             :                 &quot;Then the importprivkey can be used with this output\n&quot;</span>
<span id="L641"><span class="lineNum">     641</span>                 :             :                 &quot;Note: This command is only compatible with legacy wallets.\n&quot;,</span>
<span id="L642"><span class="lineNum">     642</span>                 :             :                 {</span>
<span id="L643"><span class="lineNum">     643</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;address&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The bitcoin address for the private key&quot;},</span></span>
<span id="L644"><span class="lineNum">     644</span>                 :             :                 },</span>
<span id="L645"><span class="lineNum">     645</span>                 :<span class="tlaUNC">           0 :                 RPCResult{</span></span>
<span id="L646"><span class="lineNum">     646</span>                 :             :                     RPCResult::Type::STR, &quot;key&quot;, &quot;The private key&quot;</span>
<span id="L647"><span class="lineNum">     647</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 },</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L648"><span class="lineNum">     648</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L649"><span class="lineNum">     649</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;dumpprivkey&quot;, &quot;\&quot;myaddress\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L650"><span class="lineNum">     650</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;importprivkey&quot;, &quot;\&quot;mykey\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L651"><span class="lineNum">     651</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;dumpprivkey&quot;, &quot;\&quot;myaddress\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L652"><span class="lineNum">     652</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L653"><span class="lineNum">     653</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L654"><span class="lineNum">     654</span>                 :             : {</span>
<span id="L655"><span class="lineNum">     655</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::shared_ptr&lt;const CWallet&gt; pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L656"><span class="lineNum">     656</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L657"><span class="lineNum">     657</span>                 :             : </span>
<span id="L658"><span class="lineNum">     658</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const LegacyScriptPubKeyMan&amp; spk_man = EnsureConstLegacyScriptPubKeyMan(*pwallet);</span></span>
<span id="L659"><span class="lineNum">     659</span>                 :             : </span>
<span id="L660"><span class="lineNum">     660</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK2(pwallet-&gt;cs_wallet, spk_man.cs_KeyStore);</span></span>
<span id="L661"><span class="lineNum">     661</span>                 :             : </span>
<span id="L662"><span class="lineNum">     662</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureWalletIsUnlocked(*pwallet);</span></span>
<span id="L663"><span class="lineNum">     663</span>                 :             : </span>
<span id="L664"><span class="lineNum">     664</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     std::string strAddress = request.params[0].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L665"><span class="lineNum">     665</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CTxDestination dest = DecodeDestination(strAddress);</span></span>
<span id="L666"><span class="lineNum">     666</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!IsValidDestination(dest)) {</span></span>
<span id="L667"><span class="lineNum">     667</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid Bitcoin address&quot;);</span></span>
<span id="L668"><span class="lineNum">     668</span>                 :             :     }</span>
<span id="L669"><span class="lineNum">     669</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     auto keyid = GetKeyForDestination(spk_man, dest);</span></span>
<span id="L670"><span class="lineNum">     670</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (keyid.IsNull()) {</span></span>
<span id="L671"><span class="lineNum">     671</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_TYPE_ERROR, &quot;Address does not refer to a key&quot;);</span></span>
<span id="L672"><span class="lineNum">     672</span>                 :             :     }</span>
<span id="L673"><span class="lineNum">     673</span>                 :<span class="tlaUNC">           0 :     CKey vchSecret;</span></span>
<span id="L674"><span class="lineNum">     674</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!spk_man.GetKey(keyid, vchSecret)) {</span></span>
<span id="L675"><span class="lineNum">     675</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Private key for address &quot; + strAddress + &quot; is not known&quot;);</span></span>
<span id="L676"><span class="lineNum">     676</span>                 :             :     }</span>
<span id="L677"><span class="lineNum">     677</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     return EncodeSecret(vchSecret);</span></span>
<span id="L678"><span class="lineNum">     678</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L679"><span class="lineNum">     679</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L680"><span class="lineNum">     680</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : }</span></span>
<span id="L681"><span class="lineNum">     681</span>                 :             : </span>
<span id="L682"><span class="lineNum">     682</span>                 :             : </span>
<span id="L683"><span class="lineNum">     683</span>                 :<span class="tlaUNC">           0 : RPCHelpMan dumpwallet()</span></span>
<span id="L684"><span class="lineNum">     684</span>                 :             : {</span>
<span id="L685"><span class="lineNum">     685</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;dumpwallet&quot;,</span></span>
<span id="L686"><span class="lineNum">     686</span>                 :             :                 &quot;\nDumps all wallet keys in a human-readable format to a server-side file. This does not allow overwriting existing files.\n&quot;</span>
<span id="L687"><span class="lineNum">     687</span>                 :             :                 &quot;Imported scripts are included in the dumpfile, but corresponding BIP173 addresses, etc. may not be added automatically by importwallet.\n&quot;</span>
<span id="L688"><span class="lineNum">     688</span>                 :             :                 &quot;Note that if your wallet contains keys which are not derived from your HD seed (e.g. imported keys), these are not covered by\n&quot;</span>
<span id="L689"><span class="lineNum">     689</span>                 :             :                 &quot;only backing up the seed itself, and must be backed up too (e.g. ensure you back up the whole dumpfile).\n&quot;</span>
<span id="L690"><span class="lineNum">     690</span>                 :             :                 &quot;Note: This command is only compatible with legacy wallets.\n&quot;,</span>
<span id="L691"><span class="lineNum">     691</span>                 :             :                 {</span>
<span id="L692"><span class="lineNum">     692</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;filename&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The filename with path (absolute path recommended)&quot;},</span></span>
<span id="L693"><span class="lineNum">     693</span>                 :             :                 },</span>
<span id="L694"><span class="lineNum">     694</span>                 :<span class="tlaUNC">           0 :                 RPCResult{</span></span>
<span id="L695"><span class="lineNum">     695</span>                 :             :                     RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L696"><span class="lineNum">     696</span>                 :             :                     {</span>
<span id="L697"><span class="lineNum">     697</span>                 :             :                         {RPCResult::Type::STR, &quot;filename&quot;, &quot;The filename with full absolute path&quot;},</span>
<span id="L698"><span class="lineNum">     698</span>                 :             :                     }</span>
<span id="L699"><span class="lineNum">     699</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 },</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span>]
<span id="L700"><span class="lineNum">     700</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L701"><span class="lineNum">     701</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;dumpwallet&quot;, &quot;\&quot;test\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L702"><span class="lineNum">     702</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;dumpwallet&quot;, &quot;\&quot;test\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L703"><span class="lineNum">     703</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L704"><span class="lineNum">     704</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L705"><span class="lineNum">     705</span>                 :             : {</span>
<span id="L706"><span class="lineNum">     706</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::shared_ptr&lt;const CWallet&gt; pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L707"><span class="lineNum">     707</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L708"><span class="lineNum">     708</span>                 :             : </span>
<span id="L709"><span class="lineNum">     709</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const CWallet&amp; wallet = *pwallet;</span></span>
<span id="L710"><span class="lineNum">     710</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const LegacyScriptPubKeyMan&amp; spk_man = EnsureConstLegacyScriptPubKeyMan(wallet);</span></span>
<span id="L711"><span class="lineNum">     711</span>                 :             : </span>
<span id="L712"><span class="lineNum">     712</span>                 :             :     // Make sure the results are valid at least up to the most recent block</span>
<span id="L713"><span class="lineNum">     713</span>                 :             :     // the user could have gotten from another RPC command prior to now</span>
<span id="L714"><span class="lineNum">     714</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     wallet.BlockUntilSyncedToCurrentChain();</span></span>
<span id="L715"><span class="lineNum">     715</span>                 :             : </span>
<span id="L716"><span class="lineNum">     716</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(wallet.cs_wallet);</span></span>
<span id="L717"><span class="lineNum">     717</span>                 :             : </span>
<span id="L718"><span class="lineNum">     718</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureWalletIsUnlocked(wallet);</span></span>
<span id="L719"><span class="lineNum">     719</span>                 :             : </span>
<span id="L720"><span class="lineNum">     720</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     fs::path filepath = fs::u8path(request.params[0].get_str());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L721"><span class="lineNum">     721</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     filepath = fs::absolute(filepath);</span></span>
<span id="L722"><span class="lineNum">     722</span>                 :             : </span>
<span id="L723"><span class="lineNum">     723</span>                 :             :     /* Prevent arbitrary files from being overwritten. There have been reports</span>
<span id="L724"><span class="lineNum">     724</span>                 :             :      * that users have overwritten wallet files this way:</span>
<span id="L725"><span class="lineNum">     725</span>                 :             :      * https://github.com/bitcoin/bitcoin/issues/9934</span>
<span id="L726"><span class="lineNum">     726</span>                 :             :      * It may also avoid other security issues.</span>
<span id="L727"><span class="lineNum">     727</span>                 :             :      */</span>
<span id="L728"><span class="lineNum">     728</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fs::exists(filepath)) {</span></span>
<span id="L729"><span class="lineNum">     729</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, filepath.utf8string() + &quot; already exists. If you are sure this is what you want, move it out of the way first&quot;);</span></span>
<span id="L730"><span class="lineNum">     730</span>                 :             :     }</span>
<span id="L731"><span class="lineNum">     731</span>                 :             : </span>
<span id="L732"><span class="lineNum">     732</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     std::ofstream file;</span></span>
<span id="L733"><span class="lineNum">     733</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file.open(filepath);</span></span>
<span id="L734"><span class="lineNum">     734</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!file.is_open())</span></span>
<span id="L735"><span class="lineNum">     735</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Cannot open wallet dump file&quot;);</span></span>
<span id="L736"><span class="lineNum">     736</span>                 :             : </span>
<span id="L737"><span class="lineNum">     737</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     std::map&lt;CKeyID, int64_t&gt; mapKeyBirth;</span></span>
<span id="L738"><span class="lineNum">     738</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     wallet.GetKeyBirthTimes(mapKeyBirth);</span></span>
<span id="L739"><span class="lineNum">     739</span>                 :             : </span>
<span id="L740"><span class="lineNum">     740</span>                 :<span class="tlaUNC">           0 :     int64_t block_time = 0;</span></span>
<span id="L741"><span class="lineNum">     741</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CHECK_NONFATAL(wallet.chain().findBlock(wallet.GetLastBlockHash(), FoundBlock().time(block_time)));</span></span>
<span id="L742"><span class="lineNum">     742</span>                 :             : </span>
<span id="L743"><span class="lineNum">     743</span>                 :             :     // Note: To avoid a lock order issue, access to cs_main must be locked before cs_KeyStore.</span>
<span id="L744"><span class="lineNum">     744</span>                 :             :     // So we do the two things in this function that lock cs_main first: GetKeyBirthTimes, and findBlock.</span>
<span id="L745"><span class="lineNum">     745</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(spk_man.cs_KeyStore);</span></span>
<span id="L746"><span class="lineNum">     746</span>                 :             : </span>
<span id="L747"><span class="lineNum">     747</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::map&lt;CKeyID, int64_t&gt;&amp; mapKeyPool = spk_man.GetAllReserveKeys();</span></span>
<span id="L748"><span class="lineNum">     748</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     std::set&lt;CScriptID&gt; scripts = spk_man.GetCScripts();</span></span>
<span id="L749"><span class="lineNum">     749</span>                 :             : </span>
<span id="L750"><span class="lineNum">     750</span>                 :             :     // sort time/key pairs</span>
<span id="L751"><span class="lineNum">     751</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;std::pair&lt;int64_t, CKeyID&gt; &gt; vKeyBirth;</span></span>
<span id="L752"><span class="lineNum">     752</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     vKeyBirth.reserve(mapKeyBirth.size());</span></span>
<span id="L753"><span class="lineNum">     753</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const auto&amp; entry : mapKeyBirth) {</span></span>
<span id="L754"><span class="lineNum">     754</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         vKeyBirth.emplace_back(entry.second, entry.first);</span></span>
<span id="L755"><span class="lineNum">     755</span>                 :             :     }</span>
<span id="L756"><span class="lineNum">     756</span>                 :<span class="tlaUNC">           0 :     mapKeyBirth.clear();</span></span>
<span id="L757"><span class="lineNum">     757</span>                 :<span class="tlaUNC">           0 :     std::sort(vKeyBirth.begin(), vKeyBirth.end());</span></span>
<span id="L758"><span class="lineNum">     758</span>                 :             : </span>
<span id="L759"><span class="lineNum">     759</span>                 :             :     // produce output</span>
<span id="L760"><span class="lineNum">     760</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; strprintf(&quot;# Wallet dump created by %s %s\n&quot;, CLIENT_NAME, FormatFullVersion());</span></span>
<span id="L761"><span class="lineNum">     761</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     file &lt;&lt; strprintf(&quot;# * Created on %s\n&quot;, FormatISO8601DateTime(GetTime()));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L762"><span class="lineNum">     762</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; strprintf(&quot;# * Best block at time of backup was %i (%s),\n&quot;, wallet.GetLastBlockHeight(), wallet.GetLastBlockHash().ToString());</span></span>
<span id="L763"><span class="lineNum">     763</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; strprintf(&quot;#   mined on %s\n&quot;, FormatISO8601DateTime(block_time));</span></span>
<span id="L764"><span class="lineNum">     764</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; &quot;\n&quot;;</span></span>
<span id="L765"><span class="lineNum">     765</span>                 :             : </span>
<span id="L766"><span class="lineNum">     766</span>                 :             :     // add the base58check encoded extended master if the wallet uses HD</span>
<span id="L767"><span class="lineNum">     767</span>                 :<span class="tlaUNC">           0 :     CKeyID seed_id = spk_man.GetHDChain().seed_id;</span></span>
<span id="L768"><span class="lineNum">     768</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!seed_id.IsNull())</span></span>
<span id="L769"><span class="lineNum">     769</span>                 :             :     {</span>
<span id="L770"><span class="lineNum">     770</span>                 :<span class="tlaUNC">           0 :         CKey seed;</span></span>
<span id="L771"><span class="lineNum">     771</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (spk_man.GetKey(seed_id, seed)) {</span></span>
<span id="L772"><span class="lineNum">     772</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CExtKey masterKey;</span></span>
<span id="L773"><span class="lineNum">     773</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             masterKey.SetSeed(seed);</span></span>
<span id="L774"><span class="lineNum">     774</span>                 :             : </span>
<span id="L775"><span class="lineNum">     775</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             file &lt;&lt; &quot;# extended private masterkey: &quot; &lt;&lt; EncodeExtKey(masterKey) &lt;&lt; &quot;\n\n&quot;;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L776"><span class="lineNum">     776</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L777"><span class="lineNum">     777</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L778"><span class="lineNum">     778</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (std::vector&lt;std::pair&lt;int64_t, CKeyID&gt; &gt;::const_iterator it = vKeyBirth.begin(); it != vKeyBirth.end(); it++) {</span></span>
<span id="L779"><span class="lineNum">     779</span>                 :<span class="tlaUNC">           0 :         const CKeyID &amp;keyid = it-&gt;second;</span></span>
<span id="L780"><span class="lineNum">     780</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string strTime = FormatISO8601DateTime(it-&gt;first);</span></span>
<span id="L781"><span class="lineNum">     781</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string strAddr;</span></span>
<span id="L782"><span class="lineNum">     782</span>                 :<span class="tlaUNC">           0 :         std::string strLabel;</span></span>
<span id="L783"><span class="lineNum">     783</span>                 :<span class="tlaUNC">           0 :         CKey key;</span></span>
<span id="L784"><span class="lineNum">     784</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (spk_man.GetKey(keyid, key)) {</span></span>
<span id="L785"><span class="lineNum">     785</span>                 :<span class="tlaUNC">           0 :             CKeyMetadata metadata;</span></span>
<span id="L786"><span class="lineNum">     786</span>                 :<span class="tlaUNC">           0 :             const auto it{spk_man.mapKeyMetadata.find(keyid)};</span></span>
<span id="L787"><span class="lineNum">     787</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (it != spk_man.mapKeyMetadata.end()) metadata = it-&gt;second;</span></span>
<span id="L788"><span class="lineNum">     788</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             file &lt;&lt; strprintf(&quot;%s %s &quot;, EncodeSecret(key), strTime);</span></span>
<span id="L789"><span class="lineNum">     789</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (GetWalletAddressesForKey(&amp;spk_man, wallet, keyid, strAddr, strLabel)) {</span></span>
<span id="L790"><span class="lineNum">     790</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 file &lt;&lt; strprintf(&quot;label=%s&quot;, strLabel);</span></span>
<span id="L791"><span class="lineNum">     791</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             } else if (keyid == seed_id) {</span></span>
<span id="L792"><span class="lineNum">     792</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 file &lt;&lt; &quot;hdseed=1&quot;;</span></span>
<span id="L793"><span class="lineNum">     793</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             } else if (mapKeyPool.count(keyid)) {</span></span>
<span id="L794"><span class="lineNum">     794</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 file &lt;&lt; &quot;reserve=1&quot;;</span></span>
<span id="L795"><span class="lineNum">     795</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             } else if (metadata.hdKeypath == &quot;s&quot;) {</span></span>
<span id="L796"><span class="lineNum">     796</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 file &lt;&lt; &quot;inactivehdseed=1&quot;;</span></span>
<span id="L797"><span class="lineNum">     797</span>                 :             :             } else {</span>
<span id="L798"><span class="lineNum">     798</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 file &lt;&lt; &quot;change=1&quot;;</span></span>
<span id="L799"><span class="lineNum">     799</span>                 :             :             }</span>
<span id="L800"><span class="lineNum">     800</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             file &lt;&lt; strprintf(&quot; # addr=%s%s\n&quot;, strAddr, (metadata.has_key_origin ? &quot; hdkeypath=&quot;+WriteHDKeypath(metadata.key_origin.path, /*apostrophe=*/true) : &quot;&quot;));</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L801"><span class="lineNum">     801</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L802"><span class="lineNum">     802</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L803"><span class="lineNum">     803</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; &quot;\n&quot;;</span></span>
<span id="L804"><span class="lineNum">     804</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const CScriptID &amp;scriptid : scripts) {</span></span>
<span id="L805"><span class="lineNum">     805</span>                 :<span class="tlaUNC">           0 :         CScript script;</span></span>
<span id="L806"><span class="lineNum">     806</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string create_time = &quot;0&quot;;</span></span>
<span id="L807"><span class="lineNum">     807</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string address = EncodeDestination(ScriptHash(scriptid));</span></span>
<span id="L808"><span class="lineNum">     808</span>                 :             :         // get birth times for scripts with metadata</span>
<span id="L809"><span class="lineNum">     809</span>                 :<span class="tlaUNC">           0 :         auto it = spk_man.m_script_metadata.find(scriptid);</span></span>
<span id="L810"><span class="lineNum">     810</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (it != spk_man.m_script_metadata.end()) {</span></span>
<span id="L811"><span class="lineNum">     811</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             create_time = FormatISO8601DateTime(it-&gt;second.nCreateTime);</span></span>
<span id="L812"><span class="lineNum">     812</span>                 :             :         }</span>
<span id="L813"><span class="lineNum">     813</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if(spk_man.GetCScript(scriptid, script)) {</span></span>
<span id="L814"><span class="lineNum">     814</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             file &lt;&lt; strprintf(&quot;%s %s script=1&quot;, HexStr(script), create_time);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L815"><span class="lineNum">     815</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             file &lt;&lt; strprintf(&quot; # addr=%s\n&quot;, address);</span></span>
<span id="L816"><span class="lineNum">     816</span>                 :             :         }</span>
<span id="L817"><span class="lineNum">     817</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L818"><span class="lineNum">     818</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; &quot;\n&quot;;</span></span>
<span id="L819"><span class="lineNum">     819</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file &lt;&lt; &quot;# End of dump\n&quot;;</span></span>
<span id="L820"><span class="lineNum">     820</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     file.close();</span></span>
<span id="L821"><span class="lineNum">     821</span>                 :             : </span>
<span id="L822"><span class="lineNum">     822</span>                 :<span class="tlaUNC">           0 :     UniValue reply(UniValue::VOBJ);</span></span>
<span id="L823"><span class="lineNum">     823</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     reply.pushKV(&quot;filename&quot;, filepath.utf8string());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L824"><span class="lineNum">     824</span>                 :             : </span>
<span id="L825"><span class="lineNum">     825</span>                 :<span class="tlaUNC">           0 :     return reply;</span></span>
<span id="L826"><span class="lineNum">     826</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L827"><span class="lineNum">     827</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L828"><span class="lineNum">     828</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L829"><span class="lineNum">     829</span>                 :             : </span>
<span id="L830"><span class="lineNum">     830</span>                 :             : struct ImportData</span>
<span id="L831"><span class="lineNum">     831</span>                 :             : {</span>
<span id="L832"><span class="lineNum">     832</span>                 :             :     // Input data</span>
<span id="L833"><span class="lineNum">     833</span>                 :             :     std::unique_ptr&lt;CScript&gt; redeemscript; //!&lt; Provided redeemScript; will be moved to `import_scripts` if relevant.</span>
<span id="L834"><span class="lineNum">     834</span>                 :             :     std::unique_ptr&lt;CScript&gt; witnessscript; //!&lt; Provided witnessScript; will be moved to `import_scripts` if relevant.</span>
<span id="L835"><span class="lineNum">     835</span>                 :             : </span>
<span id="L836"><span class="lineNum">     836</span>                 :             :     // Output data</span>
<span id="L837"><span class="lineNum">     837</span>                 :             :     std::set&lt;CScript&gt; import_scripts;</span>
<span id="L838"><span class="lineNum">     838</span>                 :             :     std::map&lt;CKeyID, bool&gt; used_keys; //!&lt; Import these private keys if available (the value indicates whether if the key is required for solvability)</span>
<span id="L839"><span class="lineNum">     839</span>                 :             :     std::map&lt;CKeyID, std::pair&lt;CPubKey, KeyOriginInfo&gt;&gt; key_origins;</span>
<span id="L840"><span class="lineNum">     840</span>                 :             : };</span>
<span id="L841"><span class="lineNum">     841</span>                 :             : </span>
<span id="L842"><span class="lineNum">     842</span>                 :             : enum class ScriptContext</span>
<span id="L843"><span class="lineNum">     843</span>                 :             : {</span>
<span id="L844"><span class="lineNum">     844</span>                 :             :     TOP, //!&lt; Top-level scriptPubKey</span>
<span id="L845"><span class="lineNum">     845</span>                 :             :     P2SH, //!&lt; P2SH redeemScript</span>
<span id="L846"><span class="lineNum">     846</span>                 :             :     WITNESS_V0, //!&lt; P2WSH witnessScript</span>
<span id="L847"><span class="lineNum">     847</span>                 :             : };</span>
<span id="L848"><span class="lineNum">     848</span>                 :             : </span>
<span id="L849"><span class="lineNum">     849</span>                 :             : // Analyse the provided scriptPubKey, determining which keys and which redeem scripts from the ImportData struct are needed to spend it, and mark them as used.</span>
<span id="L850"><span class="lineNum">     850</span>                 :             : // Returns an error string, or the empty string for success.</span>
<span id="L851"><span class="lineNum">     851</span>                 :             : // NOLINTNEXTLINE(misc-no-recursion)</span>
<span id="L852"><span class="lineNum">     852</span>                 :<span class="tlaUNC">           0 : static std::string RecurseImportData(const CScript&amp; script, ImportData&amp; import_data, const ScriptContext script_ctx)</span></span>
<span id="L853"><span class="lineNum">     853</span>                 :             : {</span>
<span id="L854"><span class="lineNum">     854</span>                 :             :     // Use Solver to obtain script type and parsed pubkeys or hashes:</span>
<span id="L855"><span class="lineNum">     855</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;std::vector&lt;unsigned char&gt;&gt; solverdata;</span></span>
<span id="L856"><span class="lineNum">     856</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     TxoutType script_type = Solver(script, solverdata);</span></span>
<span id="L857"><span class="lineNum">     857</span>                 :             : </span>
<span id="L858"><span class="lineNum">     858</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     switch (script_type) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 8 was not executed"> # </span>]
<span id="L859"><span class="lineNum">     859</span>                 :<span class="tlaUNC">           0 :     case TxoutType::PUBKEY: {</span></span>
<span id="L860"><span class="lineNum">     860</span>                 :<span class="tlaUNC">           0 :         CPubKey pubkey(solverdata[0]);</span></span>
<span id="L861"><span class="lineNum">     861</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.used_keys.emplace(pubkey.GetID(), false);</span></span>
<span id="L862"><span class="lineNum">     862</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;&quot;;</span></span>
<span id="L863"><span class="lineNum">     863</span>                 :             :     }</span>
<span id="L864"><span class="lineNum">     864</span>                 :<span class="tlaUNC">           0 :     case TxoutType::PUBKEYHASH: {</span></span>
<span id="L865"><span class="lineNum">     865</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKeyID id = CKeyID(uint160(solverdata[0]));</span></span>
<span id="L866"><span class="lineNum">     866</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.used_keys[id] = true;</span></span>
<span id="L867"><span class="lineNum">     867</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;&quot;;</span></span>
<span id="L868"><span class="lineNum">     868</span>                 :             :     }</span>
<span id="L869"><span class="lineNum">     869</span>                 :<span class="tlaUNC">           0 :     case TxoutType::SCRIPTHASH: {</span></span>
<span id="L870"><span class="lineNum">     870</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::P2SH) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Trying to nest P2SH inside another P2SH&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L871"><span class="lineNum">     871</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Trying to nest P2SH inside a P2WSH&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L872"><span class="lineNum">     872</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(script_ctx == ScriptContext::TOP);</span></span>
<span id="L873"><span class="lineNum">     873</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CScriptID id = CScriptID(uint160(solverdata[0]));</span></span>
<span id="L874"><span class="lineNum">     874</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto subscript = std::move(import_data.redeemscript); // Remove redeemscript from import_data to check for superfluous script later.</span></span>
<span id="L875"><span class="lineNum">     875</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!subscript) return &quot;missing redeemscript&quot;;</span></span>
<span id="L876"><span class="lineNum">     876</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (CScriptID(*subscript) != id) return &quot;redeemScript does not match the scriptPubKey&quot;;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L877"><span class="lineNum">     877</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.import_scripts.emplace(*subscript);</span></span>
<span id="L878"><span class="lineNum">     878</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return RecurseImportData(*subscript, import_data, ScriptContext::P2SH);</span></span>
<span id="L879"><span class="lineNum">     879</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L880"><span class="lineNum">     880</span>                 :             :     case TxoutType::MULTISIG: {</span>
<span id="L881"><span class="lineNum">     881</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (size_t i = 1; i + 1&lt; solverdata.size(); ++i) {</span></span>
<span id="L882"><span class="lineNum">     882</span>                 :<span class="tlaUNC">           0 :             CPubKey pubkey(solverdata[i]);</span></span>
<span id="L883"><span class="lineNum">     883</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             import_data.used_keys.emplace(pubkey.GetID(), false);</span></span>
<span id="L884"><span class="lineNum">     884</span>                 :             :         }</span>
<span id="L885"><span class="lineNum">     885</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;&quot;;</span></span>
<span id="L886"><span class="lineNum">     886</span>                 :             :     }</span>
<span id="L887"><span class="lineNum">     887</span>                 :<span class="tlaUNC">           0 :     case TxoutType::WITNESS_V0_SCRIPTHASH: {</span></span>
<span id="L888"><span class="lineNum">     888</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Trying to nest P2WSH inside another P2WSH&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L889"><span class="lineNum">     889</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CScriptID id{RIPEMD160(solverdata[0])};</span></span>
<span id="L890"><span class="lineNum">     890</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto subscript = std::move(import_data.witnessscript); // Remove redeemscript from import_data to check for superfluous script later.</span></span>
<span id="L891"><span class="lineNum">     891</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!subscript) return &quot;missing witnessscript&quot;;</span></span>
<span id="L892"><span class="lineNum">     892</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (CScriptID(*subscript) != id) return &quot;witnessScript does not match the scriptPubKey or redeemScript&quot;;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L893"><span class="lineNum">     893</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::TOP) {</span></span>
<span id="L894"><span class="lineNum">     894</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             import_data.import_scripts.emplace(script); // Special rule for IsMine: native P2WSH requires the TOP script imported (see script/ismine.cpp)</span></span>
<span id="L895"><span class="lineNum">     895</span>                 :             :         }</span>
<span id="L896"><span class="lineNum">     896</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.import_scripts.emplace(*subscript);</span></span>
<span id="L897"><span class="lineNum">     897</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return RecurseImportData(*subscript, import_data, ScriptContext::WITNESS_V0);</span></span>
<span id="L898"><span class="lineNum">     898</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L899"><span class="lineNum">     899</span>                 :<span class="tlaUNC">           0 :     case TxoutType::WITNESS_V0_KEYHASH: {</span></span>
<span id="L900"><span class="lineNum">     900</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::WITNESS_V0) throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Trying to nest P2WPKH inside P2WSH&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L901"><span class="lineNum">     901</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKeyID id = CKeyID(uint160(solverdata[0]));</span></span>
<span id="L902"><span class="lineNum">     902</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.used_keys[id] = true;</span></span>
<span id="L903"><span class="lineNum">     903</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (script_ctx == ScriptContext::TOP) {</span></span>
<span id="L904"><span class="lineNum">     904</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             import_data.import_scripts.emplace(script); // Special rule for IsMine: native P2WPKH requires the TOP script imported (see script/ismine.cpp)</span></span>
<span id="L905"><span class="lineNum">     905</span>                 :             :         }</span>
<span id="L906"><span class="lineNum">     906</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;&quot;;</span></span>
<span id="L907"><span class="lineNum">     907</span>                 :             :     }</span>
<span id="L908"><span class="lineNum">     908</span>                 :<span class="tlaUNC">           0 :     case TxoutType::NULL_DATA:</span></span>
<span id="L909"><span class="lineNum">     909</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;unspendable script&quot;;</span></span>
<span id="L910"><span class="lineNum">     910</span>                 :<span class="tlaUNC">           0 :     case TxoutType::NONSTANDARD:</span></span>
<span id="L911"><span class="lineNum">     911</span>                 :<span class="tlaUNC">           0 :     case TxoutType::WITNESS_UNKNOWN:</span></span>
<span id="L912"><span class="lineNum">     912</span>                 :<span class="tlaUNC">           0 :     case TxoutType::WITNESS_V1_TAPROOT:</span></span>
<span id="L913"><span class="lineNum">     913</span>                 :<span class="tlaUNC">           0 :     case TxoutType::ANCHOR:</span></span>
<span id="L914"><span class="lineNum">     914</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         return &quot;unrecognized script&quot;;</span></span>
<span id="L915"><span class="lineNum">     915</span>                 :             :     } // no default case, so the compiler can warn about missing cases</span>
<span id="L916"><span class="lineNum">     916</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     NONFATAL_UNREACHABLE();</span></span>
<span id="L917"><span class="lineNum">     917</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L918"><span class="lineNum">     918</span>                 :             : </span>
<span id="L919"><span class="lineNum">     919</span>                 :<span class="tlaUNC">           0 : static UniValue ProcessImportLegacy(ImportData&amp; import_data, std::map&lt;CKeyID, CPubKey&gt;&amp; pubkey_map, std::map&lt;CKeyID, CKey&gt;&amp; privkey_map, std::set&lt;CScript&gt;&amp; script_pub_keys, bool&amp; have_solving_data, const UniValue&amp; data, std::vector&lt;std::pair&lt;CKeyID, bool&gt;&gt;&amp; ordered_pubkeys)</span></span>
<span id="L920"><span class="lineNum">     920</span>                 :             : {</span>
<span id="L921"><span class="lineNum">     921</span>                 :<span class="tlaUNC">           0 :     UniValue warnings(UniValue::VARR);</span></span>
<span id="L922"><span class="lineNum">     922</span>                 :             : </span>
<span id="L923"><span class="lineNum">     923</span>                 :             :     // First ensure scriptPubKey has either a script or JSON with &quot;address&quot; string</span>
<span id="L924"><span class="lineNum">     924</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const UniValue&amp; scriptPubKey = data[&quot;scriptPubKey&quot;];</span></span>
<span id="L925"><span class="lineNum">     925</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     bool isScript = scriptPubKey.getType() == UniValue::VSTR;</span></span>
<span id="L926"><span class="lineNum">     926</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (!isScript &amp;&amp; !(scriptPubKey.getType() == UniValue::VOBJ &amp;&amp; scriptPubKey.exists(&quot;address&quot;))) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L927"><span class="lineNum">     927</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;scriptPubKey must be string with script or JSON with address string&quot;);</span></span>
<span id="L928"><span class="lineNum">     928</span>                 :             :     }</span>
<span id="L929"><span class="lineNum">     929</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const std::string&amp; output = isScript ? scriptPubKey.get_str() : scriptPubKey[&quot;address&quot;].get_str();</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L930"><span class="lineNum">     930</span>                 :             : </span>
<span id="L931"><span class="lineNum">     931</span>                 :             :     // Optional fields.</span>
<span id="L932"><span class="lineNum">     932</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const std::string&amp; strRedeemScript = data.exists(&quot;redeemscript&quot;) ? data[&quot;redeemscript&quot;].get_str() : &quot;&quot;;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L933"><span class="lineNum">     933</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const std::string&amp; witness_script_hex = data.exists(&quot;witnessscript&quot;) ? data[&quot;witnessscript&quot;].get_str() : &quot;&quot;;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L934"><span class="lineNum">     934</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const UniValue&amp; pubKeys = data.exists(&quot;pubkeys&quot;) ? data[&quot;pubkeys&quot;].get_array() : UniValue();</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L935"><span class="lineNum">     935</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const UniValue&amp; keys = data.exists(&quot;keys&quot;) ? data[&quot;keys&quot;].get_array() : UniValue();</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L936"><span class="lineNum">     936</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const bool internal = data.exists(&quot;internal&quot;) ? data[&quot;internal&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L937"><span class="lineNum">     937</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const bool watchOnly = data.exists(&quot;watchonly&quot;) ? data[&quot;watchonly&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L938"><span class="lineNum">     938</span>                 :             : </span>
<span id="L939"><span class="lineNum">     939</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (data.exists(&quot;range&quot;)) {</span></span>
<span id="L940"><span class="lineNum">     940</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Range should not be specified for a non-descriptor import&quot;);</span></span>
<span id="L941"><span class="lineNum">     941</span>                 :             :     }</span>
<span id="L942"><span class="lineNum">     942</span>                 :             : </span>
<span id="L943"><span class="lineNum">     943</span>                 :             :     // Generate the script and destination for the scriptPubKey provided</span>
<span id="L944"><span class="lineNum">     944</span>                 :<span class="tlaUNC">           0 :     CScript script;</span></span>
<span id="L945"><span class="lineNum">     945</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!isScript) {</span></span>
<span id="L946"><span class="lineNum">     946</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CTxDestination dest = DecodeDestination(output);</span></span>
<span id="L947"><span class="lineNum">     947</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!IsValidDestination(dest)) {</span></span>
<span id="L948"><span class="lineNum">     948</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid address \&quot;&quot; + output + &quot;\&quot;&quot;);</span></span>
<span id="L949"><span class="lineNum">     949</span>                 :             :         }</span>
<span id="L950"><span class="lineNum">     950</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (OutputTypeFromDestination(dest) == OutputType::BECH32M) {</span></span>
<span id="L951"><span class="lineNum">     951</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Bech32m addresses cannot be imported into legacy wallets&quot;);</span></span>
<span id="L952"><span class="lineNum">     952</span>                 :             :         }</span>
<span id="L953"><span class="lineNum">     953</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         script = GetScriptForDestination(dest);</span></span>
<span id="L954"><span class="lineNum">     954</span>                 :<span class="tlaUNC">           0 :     } else {</span></span>
<span id="L955"><span class="lineNum">     955</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!IsHex(output)) {</span></span>
<span id="L956"><span class="lineNum">     956</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid scriptPubKey \&quot;&quot; + output + &quot;\&quot;&quot;);</span></span>
<span id="L957"><span class="lineNum">     957</span>                 :             :         }</span>
<span id="L958"><span class="lineNum">     958</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::vector&lt;unsigned char&gt; vData(ParseHex(output));</span></span>
<span id="L959"><span class="lineNum">     959</span>                 :<span class="tlaUNC">           0 :         script = CScript(vData.begin(), vData.end());</span></span>
<span id="L960"><span class="lineNum">     960</span>                 :<span class="tlaUNC">           0 :         CTxDestination dest;</span></span>
<span id="L961"><span class="lineNum">     961</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (!ExtractDestination(script, dest) &amp;&amp; !internal) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L962"><span class="lineNum">     962</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Internal must be set to true for nonstandard scriptPubKey imports.&quot;);</span></span>
<span id="L963"><span class="lineNum">     963</span>                 :             :         }</span>
<span id="L964"><span class="lineNum">     964</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L965"><span class="lineNum">     965</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     script_pub_keys.emplace(script);</span></span>
<span id="L966"><span class="lineNum">     966</span>                 :             : </span>
<span id="L967"><span class="lineNum">     967</span>                 :             :     // Parse all arguments</span>
<span id="L968"><span class="lineNum">     968</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (strRedeemScript.size()) {</span></span>
<span id="L969"><span class="lineNum">     969</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!IsHex(strRedeemScript)) {</span></span>
<span id="L970"><span class="lineNum">     970</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid redeem script \&quot;&quot; + strRedeemScript + &quot;\&quot;: must be hex string&quot;);</span></span>
<span id="L971"><span class="lineNum">     971</span>                 :             :         }</span>
<span id="L972"><span class="lineNum">     972</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto parsed_redeemscript = ParseHex(strRedeemScript);</span></span>
<span id="L973"><span class="lineNum">     973</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.redeemscript = std::make_unique&lt;CScript&gt;(parsed_redeemscript.begin(), parsed_redeemscript.end());</span></span>
<span id="L974"><span class="lineNum">     974</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L975"><span class="lineNum">     975</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (witness_script_hex.size()) {</span></span>
<span id="L976"><span class="lineNum">     976</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!IsHex(witness_script_hex)) {</span></span>
<span id="L977"><span class="lineNum">     977</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid witness script \&quot;&quot; + witness_script_hex + &quot;\&quot;: must be hex string&quot;);</span></span>
<span id="L978"><span class="lineNum">     978</span>                 :             :         }</span>
<span id="L979"><span class="lineNum">     979</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto parsed_witnessscript = ParseHex(witness_script_hex);</span></span>
<span id="L980"><span class="lineNum">     980</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         import_data.witnessscript = std::make_unique&lt;CScript&gt;(parsed_witnessscript.begin(), parsed_witnessscript.end());</span></span>
<span id="L981"><span class="lineNum">     981</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L982"><span class="lineNum">     982</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (size_t i = 0; i &lt; pubKeys.size(); ++i) {</span></span>
<span id="L983"><span class="lineNum">     983</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         CPubKey pubkey = HexToPubKey(pubKeys[i].get_str());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L984"><span class="lineNum">     984</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pubkey_map.emplace(pubkey.GetID(), pubkey);</span></span>
<span id="L985"><span class="lineNum">     985</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         ordered_pubkeys.emplace_back(pubkey.GetID(), internal);</span></span>
<span id="L986"><span class="lineNum">     986</span>                 :             :     }</span>
<span id="L987"><span class="lineNum">     987</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (size_t i = 0; i &lt; keys.size(); ++i) {</span></span>
<span id="L988"><span class="lineNum">     988</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto&amp; str = keys[i].get_str();</span></span>
<span id="L989"><span class="lineNum">     989</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKey key = DecodeSecret(str);</span></span>
<span id="L990"><span class="lineNum">     990</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!key.IsValid()) {</span></span>
<span id="L991"><span class="lineNum">     991</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid private key encoding&quot;);</span></span>
<span id="L992"><span class="lineNum">     992</span>                 :             :         }</span>
<span id="L993"><span class="lineNum">     993</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CPubKey pubkey = key.GetPubKey();</span></span>
<span id="L994"><span class="lineNum">     994</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKeyID id = pubkey.GetID();</span></span>
<span id="L995"><span class="lineNum">     995</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (pubkey_map.count(id)) {</span></span>
<span id="L996"><span class="lineNum">     996</span>                 :<span class="tlaUNC">           0 :             pubkey_map.erase(id);</span></span>
<span id="L997"><span class="lineNum">     997</span>                 :             :         }</span>
<span id="L998"><span class="lineNum">     998</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         privkey_map.emplace(id, key);</span></span>
<span id="L999"><span class="lineNum">     999</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1000"><span class="lineNum">    1000</span>                 :             : </span>
<span id="L1001"><span class="lineNum">    1001</span>                 :             : </span>
<span id="L1002"><span class="lineNum">    1002</span>                 :             :     // Verify and process input data</span>
<span id="L1003"><span class="lineNum">    1003</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     have_solving_data = import_data.redeemscript || import_data.witnessscript || pubkey_map.size() || privkey_map.size();</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1004"><span class="lineNum">    1004</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (have_solving_data) {</span></span>
<span id="L1005"><span class="lineNum">    1005</span>                 :             :         // Match up data in import_data with the scriptPubKey in script.</span>
<span id="L1006"><span class="lineNum">    1006</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto error = RecurseImportData(script, import_data, ScriptContext::TOP);</span></span>
<span id="L1007"><span class="lineNum">    1007</span>                 :             : </span>
<span id="L1008"><span class="lineNum">    1008</span>                 :             :         // Verify whether the watchonly option corresponds to the availability of private keys.</span>
<span id="L1009"><span class="lineNum">    1009</span>                 :<span class="tlaUNC">           0 :         bool spendable = std::all_of(import_data.used_keys.begin(), import_data.used_keys.end(), [&amp;](const std::pair&lt;CKeyID, bool&gt;&amp; used_key){ return privkey_map.count(used_key.first) &gt; 0; });</span></span>
<span id="L1010"><span class="lineNum">    1010</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!watchOnly &amp;&amp; !spendable) {</span></span>
<span id="L1011"><span class="lineNum">    1011</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             warnings.push_back(&quot;Some private keys are missing, outputs will be considered watchonly. If this is intentional, specify the watchonly flag.&quot;);</span></span>
<span id="L1012"><span class="lineNum">    1012</span>                 :             :         }</span>
<span id="L1013"><span class="lineNum">    1013</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (watchOnly &amp;&amp; spendable) {</span></span>
<span id="L1014"><span class="lineNum">    1014</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             warnings.push_back(&quot;All private keys are provided, outputs will be considered spendable. If this is intentional, do not specify the watchonly flag.&quot;);</span></span>
<span id="L1015"><span class="lineNum">    1015</span>                 :             :         }</span>
<span id="L1016"><span class="lineNum">    1016</span>                 :             : </span>
<span id="L1017"><span class="lineNum">    1017</span>                 :             :         // Check that all required keys for solvability are provided.</span>
<span id="L1018"><span class="lineNum">    1018</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (error.empty()) {</span></span>
<span id="L1019"><span class="lineNum">    1019</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const auto&amp; require_key : import_data.used_keys) {</span></span>
<span id="L1020"><span class="lineNum">    1020</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!require_key.second) continue; // Not a required key</span></span>
<span id="L1021"><span class="lineNum">    1021</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (pubkey_map.count(require_key.first) == 0 &amp;&amp; privkey_map.count(require_key.first) == 0) {</span></span>
<span id="L1022"><span class="lineNum">    1022</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     error = &quot;some required keys are missing&quot;;</span></span>
<span id="L1023"><span class="lineNum">    1023</span>                 :             :                 }</span>
<span id="L1024"><span class="lineNum">    1024</span>                 :             :             }</span>
<span id="L1025"><span class="lineNum">    1025</span>                 :             :         }</span>
<span id="L1026"><span class="lineNum">    1026</span>                 :             : </span>
<span id="L1027"><span class="lineNum">    1027</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!error.empty()) {</span></span>
<span id="L1028"><span class="lineNum">    1028</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             warnings.push_back(&quot;Importing as non-solvable: &quot; + error + &quot;. If this is intentional, don't provide any keys, pubkeys, witnessscript, or redeemscript.&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1029"><span class="lineNum">    1029</span>                 :<span class="tlaUNC">           0 :             import_data = ImportData();</span></span>
<span id="L1030"><span class="lineNum">    1030</span>                 :<span class="tlaUNC">           0 :             pubkey_map.clear();</span></span>
<span id="L1031"><span class="lineNum">    1031</span>                 :<span class="tlaUNC">           0 :             privkey_map.clear();</span></span>
<span id="L1032"><span class="lineNum">    1032</span>                 :<span class="tlaUNC">           0 :             have_solving_data = false;</span></span>
<span id="L1033"><span class="lineNum">    1033</span>                 :             :         } else {</span>
<span id="L1034"><span class="lineNum">    1034</span>                 :             :             // RecurseImportData() removes any relevant redeemscript/witnessscript from import_data, so we can use that to discover if a superfluous one was provided.</span>
<span id="L1035"><span class="lineNum">    1035</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (import_data.redeemscript) warnings.push_back(&quot;Ignoring redeemscript as this is not a P2SH script.&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1036"><span class="lineNum">    1036</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (import_data.witnessscript) warnings.push_back(&quot;Ignoring witnessscript as this is not a (P2SH-)P2WSH script.&quot;);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1037"><span class="lineNum">    1037</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (auto it = privkey_map.begin(); it != privkey_map.end(); ) {</span></span>
<span id="L1038"><span class="lineNum">    1038</span>                 :<span class="tlaUNC">           0 :                 auto oldit = it++;</span></span>
<span id="L1039"><span class="lineNum">    1039</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (import_data.used_keys.count(oldit-&gt;first) == 0) {</span></span>
<span id="L1040"><span class="lineNum">    1040</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     warnings.push_back(&quot;Ignoring irrelevant private key.&quot;);</span></span>
<span id="L1041"><span class="lineNum">    1041</span>                 :<span class="tlaUNC">           0 :                     privkey_map.erase(oldit);</span></span>
<span id="L1042"><span class="lineNum">    1042</span>                 :             :                 }</span>
<span id="L1043"><span class="lineNum">    1043</span>                 :             :             }</span>
<span id="L1044"><span class="lineNum">    1044</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (auto it = pubkey_map.begin(); it != pubkey_map.end(); ) {</span></span>
<span id="L1045"><span class="lineNum">    1045</span>                 :<span class="tlaUNC">           0 :                 auto oldit = it++;</span></span>
<span id="L1046"><span class="lineNum">    1046</span>                 :<span class="tlaUNC">           0 :                 auto key_data_it = import_data.used_keys.find(oldit-&gt;first);</span></span>
<span id="L1047"><span class="lineNum">    1047</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (key_data_it == import_data.used_keys.end() || !key_data_it-&gt;second) {</span></span>
<span id="L1048"><span class="lineNum">    1048</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     warnings.push_back(&quot;Ignoring public key \&quot;&quot; + HexStr(oldit-&gt;first) + &quot;\&quot; as it doesn't appear inside P2PKH or P2WPKH.&quot;);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1049"><span class="lineNum">    1049</span>                 :<span class="tlaUNC">           0 :                     pubkey_map.erase(oldit);</span></span>
<span id="L1050"><span class="lineNum">    1050</span>                 :             :                 }</span>
<span id="L1051"><span class="lineNum">    1051</span>                 :             :             }</span>
<span id="L1052"><span class="lineNum">    1052</span>                 :             :         }</span>
<span id="L1053"><span class="lineNum">    1053</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1054"><span class="lineNum">    1054</span>                 :             : </span>
<span id="L1055"><span class="lineNum">    1055</span>                 :<span class="tlaUNC">           0 :     return warnings;</span></span>
<span id="L1056"><span class="lineNum">    1056</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L1057"><span class="lineNum">    1057</span>                 :             : </span>
<span id="L1058"><span class="lineNum">    1058</span>                 :<span class="tlaUNC">           0 : static UniValue ProcessImportDescriptor(ImportData&amp; import_data, std::map&lt;CKeyID, CPubKey&gt;&amp; pubkey_map, std::map&lt;CKeyID, CKey&gt;&amp; privkey_map, std::set&lt;CScript&gt;&amp; script_pub_keys, bool&amp; have_solving_data, const UniValue&amp; data, std::vector&lt;std::pair&lt;CKeyID, bool&gt;&gt;&amp; ordered_pubkeys)</span></span>
<span id="L1059"><span class="lineNum">    1059</span>                 :             : {</span>
<span id="L1060"><span class="lineNum">    1060</span>                 :<span class="tlaUNC">           0 :     UniValue warnings(UniValue::VARR);</span></span>
<span id="L1061"><span class="lineNum">    1061</span>                 :             : </span>
<span id="L1062"><span class="lineNum">    1062</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const std::string&amp; descriptor = data[&quot;desc&quot;].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1063"><span class="lineNum">    1063</span>                 :<span class="tlaUNC">           0 :     FlatSigningProvider keys;</span></span>
<span id="L1064"><span class="lineNum">    1064</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     std::string error;</span></span>
<span id="L1065"><span class="lineNum">    1065</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     auto parsed_descs = Parse(descriptor, keys, error, /* require_checksum = */ true);</span></span>
<span id="L1066"><span class="lineNum">    1066</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (parsed_descs.empty()) {</span></span>
<span id="L1067"><span class="lineNum">    1067</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, error);</span></span>
<span id="L1068"><span class="lineNum">    1068</span>                 :             :     }</span>
<span id="L1069"><span class="lineNum">    1069</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (parsed_descs.at(0)-&gt;GetOutputType() == OutputType::BECH32M) {</span></span>
<span id="L1070"><span class="lineNum">    1070</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Bech32m descriptors cannot be imported into legacy wallets&quot;);</span></span>
<span id="L1071"><span class="lineNum">    1071</span>                 :             :     }</span>
<span id="L1072"><span class="lineNum">    1072</span>                 :             : </span>
<span id="L1073"><span class="lineNum">    1073</span>                 :<span class="tlaUNC">           0 :     std::optional&lt;bool&gt; internal;</span></span>
<span id="L1074"><span class="lineNum">    1074</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (data.exists(&quot;internal&quot;)) {</span></span>
<span id="L1075"><span class="lineNum">    1075</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (parsed_descs.size() &gt; 1) {</span></span>
<span id="L1076"><span class="lineNum">    1076</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Cannot have multipath descriptor while also specifying \'internal\'&quot;);</span></span>
<span id="L1077"><span class="lineNum">    1077</span>                 :             :         }</span>
<span id="L1078"><span class="lineNum">    1078</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         internal = data[&quot;internal&quot;].get_bool();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1079"><span class="lineNum">    1079</span>                 :             :     }</span>
<span id="L1080"><span class="lineNum">    1080</span>                 :             : </span>
<span id="L1081"><span class="lineNum">    1081</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     have_solving_data = parsed_descs.at(0)-&gt;IsSolvable();</span></span>
<span id="L1082"><span class="lineNum">    1082</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const bool watch_only = data.exists(&quot;watchonly&quot;) ? data[&quot;watchonly&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1083"><span class="lineNum">    1083</span>                 :             : </span>
<span id="L1084"><span class="lineNum">    1084</span>                 :<span class="tlaUNC">           0 :     int64_t range_start = 0, range_end = 0;</span></span>
<span id="L1085"><span class="lineNum">    1085</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     if (!parsed_descs.at(0)-&gt;IsRange() &amp;&amp; data.exists(&quot;range&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L1086"><span class="lineNum">    1086</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Range should not be specified for an un-ranged descriptor&quot;);</span></span>
<span id="L1087"><span class="lineNum">    1087</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     } else if (parsed_descs.at(0)-&gt;IsRange()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1088"><span class="lineNum">    1088</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!data.exists(&quot;range&quot;)) {</span></span>
<span id="L1089"><span class="lineNum">    1089</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Descriptor is ranged, please specify the range&quot;);</span></span>
<span id="L1090"><span class="lineNum">    1090</span>                 :             :         }</span>
<span id="L1091"><span class="lineNum">    1091</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         std::tie(range_start, range_end) = ParseDescriptorRange(data[&quot;range&quot;]);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1092"><span class="lineNum">    1092</span>                 :             :     }</span>
<span id="L1093"><span class="lineNum">    1093</span>                 :             : </span>
<span id="L1094"><span class="lineNum">    1094</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const UniValue&amp; priv_keys = data.exists(&quot;keys&quot;) ? data[&quot;keys&quot;].get_array() : UniValue();</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L1095"><span class="lineNum">    1095</span>                 :             : </span>
<span id="L1096"><span class="lineNum">    1096</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (size_t j = 0; j &lt; parsed_descs.size(); ++j) {</span></span>
<span id="L1097"><span class="lineNum">    1097</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto&amp; parsed_desc = parsed_descs.at(j);</span></span>
<span id="L1098"><span class="lineNum">    1098</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         bool desc_internal = internal.has_value() &amp;&amp; internal.value();</span></span>
<span id="L1099"><span class="lineNum">    1099</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (parsed_descs.size() == 2) {</span></span>
<span id="L1100"><span class="lineNum">    1100</span>                 :<span class="tlaUNC">           0 :             desc_internal = j == 1;</span></span>
<span id="L1101"><span class="lineNum">    1101</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (parsed_descs.size() &gt; 2) {</span></span>
<span id="L1102"><span class="lineNum">    1102</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             CHECK_NONFATAL(!desc_internal);</span></span>
<span id="L1103"><span class="lineNum">    1103</span>                 :             :         }</span>
<span id="L1104"><span class="lineNum">    1104</span>                 :             :         // Expand all descriptors to get public keys and scripts, and private keys if available.</span>
<span id="L1105"><span class="lineNum">    1105</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (int i = range_start; i &lt;= range_end; ++i) {</span></span>
<span id="L1106"><span class="lineNum">    1106</span>                 :<span class="tlaUNC">           0 :             FlatSigningProvider out_keys;</span></span>
<span id="L1107"><span class="lineNum">    1107</span>                 :<span class="tlaUNC">           0 :             std::vector&lt;CScript&gt; scripts_temp;</span></span>
<span id="L1108"><span class="lineNum">    1108</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             parsed_desc-&gt;Expand(i, keys, scripts_temp, out_keys);</span></span>
<span id="L1109"><span class="lineNum">    1109</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::copy(scripts_temp.begin(), scripts_temp.end(), std::inserter(script_pub_keys, script_pub_keys.end()));</span></span>
<span id="L1110"><span class="lineNum">    1110</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const auto&amp; key_pair : out_keys.pubkeys) {</span></span>
<span id="L1111"><span class="lineNum">    1111</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 ordered_pubkeys.emplace_back(key_pair.first, desc_internal);</span></span>
<span id="L1112"><span class="lineNum">    1112</span>                 :             :             }</span>
<span id="L1113"><span class="lineNum">    1113</span>                 :             : </span>
<span id="L1114"><span class="lineNum">    1114</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const auto&amp; x : out_keys.scripts) {</span></span>
<span id="L1115"><span class="lineNum">    1115</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 import_data.import_scripts.emplace(x.second);</span></span>
<span id="L1116"><span class="lineNum">    1116</span>                 :             :             }</span>
<span id="L1117"><span class="lineNum">    1117</span>                 :             : </span>
<span id="L1118"><span class="lineNum">    1118</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             parsed_desc-&gt;ExpandPrivate(i, keys, out_keys);</span></span>
<span id="L1119"><span class="lineNum">    1119</span>                 :             : </span>
<span id="L1120"><span class="lineNum">    1120</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::copy(out_keys.pubkeys.begin(), out_keys.pubkeys.end(), std::inserter(pubkey_map, pubkey_map.end()));</span></span>
<span id="L1121"><span class="lineNum">    1121</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::copy(out_keys.keys.begin(), out_keys.keys.end(), std::inserter(privkey_map, privkey_map.end()));</span></span>
<span id="L1122"><span class="lineNum">    1122</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             import_data.key_origins.insert(out_keys.origins.begin(), out_keys.origins.end());</span></span>
<span id="L1123"><span class="lineNum">    1123</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1124"><span class="lineNum">    1124</span>                 :             :     }</span>
<span id="L1125"><span class="lineNum">    1125</span>                 :             : </span>
<span id="L1126"><span class="lineNum">    1126</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (size_t i = 0; i &lt; priv_keys.size(); ++i) {</span></span>
<span id="L1127"><span class="lineNum">    1127</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto&amp; str = priv_keys[i].get_str();</span></span>
<span id="L1128"><span class="lineNum">    1128</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKey key = DecodeSecret(str);</span></span>
<span id="L1129"><span class="lineNum">    1129</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!key.IsValid()) {</span></span>
<span id="L1130"><span class="lineNum">    1130</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Invalid private key encoding&quot;);</span></span>
<span id="L1131"><span class="lineNum">    1131</span>                 :             :         }</span>
<span id="L1132"><span class="lineNum">    1132</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CPubKey pubkey = key.GetPubKey();</span></span>
<span id="L1133"><span class="lineNum">    1133</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CKeyID id = pubkey.GetID();</span></span>
<span id="L1134"><span class="lineNum">    1134</span>                 :             : </span>
<span id="L1135"><span class="lineNum">    1135</span>                 :             :         // Check if this private key corresponds to a public key from the descriptor</span>
<span id="L1136"><span class="lineNum">    1136</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!pubkey_map.count(id)) {</span></span>
<span id="L1137"><span class="lineNum">    1137</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             warnings.push_back(&quot;Ignoring irrelevant private key.&quot;);</span></span>
<span id="L1138"><span class="lineNum">    1138</span>                 :             :         } else {</span>
<span id="L1139"><span class="lineNum">    1139</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             privkey_map.emplace(id, key);</span></span>
<span id="L1140"><span class="lineNum">    1140</span>                 :             :         }</span>
<span id="L1141"><span class="lineNum">    1141</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1142"><span class="lineNum">    1142</span>                 :             : </span>
<span id="L1143"><span class="lineNum">    1143</span>                 :             :     // Check if all the public keys have corresponding private keys in the import for spendability.</span>
<span id="L1144"><span class="lineNum">    1144</span>                 :             :     // This does not take into account threshold multisigs which could be spendable without all keys.</span>
<span id="L1145"><span class="lineNum">    1145</span>                 :             :     // Thus, threshold multisigs without all keys will be considered not spendable here, even if they are,</span>
<span id="L1146"><span class="lineNum">    1146</span>                 :             :     // perhaps triggering a false warning message. This is consistent with the current wallet IsMine check.</span>
<span id="L1147"><span class="lineNum">    1147</span>                 :<span class="tlaUNC">           0 :     bool spendable = std::all_of(pubkey_map.begin(), pubkey_map.end(),</span></span>
<span id="L1148"><span class="lineNum">    1148</span>                 :<span class="tlaUNC">           0 :         [&amp;](const std::pair&lt;CKeyID, CPubKey&gt;&amp; used_key) {</span></span>
<span id="L1149"><span class="lineNum">    1149</span>                 :<span class="tlaUNC">           0 :             return privkey_map.count(used_key.first) &gt; 0;</span></span>
<span id="L1150"><span class="lineNum">    1150</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         }) &amp;&amp; std::all_of(import_data.key_origins.begin(), import_data.key_origins.end(),</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1151"><span class="lineNum">    1151</span>                 :<span class="tlaUNC">           0 :         [&amp;](const std::pair&lt;CKeyID, std::pair&lt;CPubKey, KeyOriginInfo&gt;&gt;&amp; entry) {</span></span>
<span id="L1152"><span class="lineNum">    1152</span>                 :<span class="tlaUNC">           0 :             return privkey_map.count(entry.first) &gt; 0;</span></span>
<span id="L1153"><span class="lineNum">    1153</span>                 :<span class="tlaUNC">           0 :         });</span></span>
<span id="L1154"><span class="lineNum">    1154</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!watch_only &amp;&amp; !spendable) {</span></span>
<span id="L1155"><span class="lineNum">    1155</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         warnings.push_back(&quot;Some private keys are missing, outputs will be considered watchonly. If this is intentional, specify the watchonly flag.&quot;);</span></span>
<span id="L1156"><span class="lineNum">    1156</span>                 :             :     }</span>
<span id="L1157"><span class="lineNum">    1157</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (watch_only &amp;&amp; spendable) {</span></span>
<span id="L1158"><span class="lineNum">    1158</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         warnings.push_back(&quot;All private keys are provided, outputs will be considered spendable. If this is intentional, do not specify the watchonly flag.&quot;);</span></span>
<span id="L1159"><span class="lineNum">    1159</span>                 :             :     }</span>
<span id="L1160"><span class="lineNum">    1160</span>                 :             : </span>
<span id="L1161"><span class="lineNum">    1161</span>                 :<span class="tlaUNC">           0 :     return warnings;</span></span>
<span id="L1162"><span class="lineNum">    1162</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L1163"><span class="lineNum">    1163</span>                 :             : </span>
<span id="L1164"><span class="lineNum">    1164</span>                 :<span class="tlaUNC">           0 : static UniValue ProcessImport(CWallet&amp; wallet, const UniValue&amp; data, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet)</span></span>
<span id="L1165"><span class="lineNum">    1165</span>                 :             : {</span>
<span id="L1166"><span class="lineNum">    1166</span>                 :<span class="tlaUNC">           0 :     UniValue warnings(UniValue::VARR);</span></span>
<span id="L1167"><span class="lineNum">    1167</span>                 :<span class="tlaUNC">           0 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L1168"><span class="lineNum">    1168</span>                 :             : </span>
<span id="L1169"><span class="lineNum">    1169</span>                 :<span class="tlaUNC">           0 :     try {</span></span>
<span id="L1170"><span class="lineNum">    1170</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const bool internal = data.exists(&quot;internal&quot;) ? data[&quot;internal&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1171"><span class="lineNum">    1171</span>                 :             :         // Internal addresses should not have a label</span>
<span id="L1172"><span class="lineNum">    1172</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (internal &amp;&amp; data.exists(&quot;label&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1173"><span class="lineNum">    1173</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Internal addresses should not have a label&quot;);</span></span>
<span id="L1174"><span class="lineNum">    1174</span>                 :             :         }</span>
<span id="L1175"><span class="lineNum">    1175</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const std::string label{LabelFromValue(data[&quot;label&quot;])};</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1176"><span class="lineNum">    1176</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const bool add_keypool = data.exists(&quot;keypool&quot;) ? data[&quot;keypool&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1177"><span class="lineNum">    1177</span>                 :             : </span>
<span id="L1178"><span class="lineNum">    1178</span>                 :             :         // Add to keypool only works with privkeys disabled</span>
<span id="L1179"><span class="lineNum">    1179</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (add_keypool &amp;&amp; !wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1180"><span class="lineNum">    1180</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Keys can only be imported to the keypool when private keys are disabled&quot;);</span></span>
<span id="L1181"><span class="lineNum">    1181</span>                 :             :         }</span>
<span id="L1182"><span class="lineNum">    1182</span>                 :             : </span>
<span id="L1183"><span class="lineNum">    1183</span>                 :<span class="tlaUNC">           0 :         ImportData import_data;</span></span>
<span id="L1184"><span class="lineNum">    1184</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::map&lt;CKeyID, CPubKey&gt; pubkey_map;</span></span>
<span id="L1185"><span class="lineNum">    1185</span>                 :<span class="tlaUNC">           0 :         std::map&lt;CKeyID, CKey&gt; privkey_map;</span></span>
<span id="L1186"><span class="lineNum">    1186</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::set&lt;CScript&gt; script_pub_keys;</span></span>
<span id="L1187"><span class="lineNum">    1187</span>                 :<span class="tlaUNC">           0 :         std::vector&lt;std::pair&lt;CKeyID, bool&gt;&gt; ordered_pubkeys;</span></span>
<span id="L1188"><span class="lineNum">    1188</span>                 :<span class="tlaUNC">           0 :         bool have_solving_data;</span></span>
<span id="L1189"><span class="lineNum">    1189</span>                 :             : </span>
<span id="L1190"><span class="lineNum">    1190</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (data.exists(&quot;scriptPubKey&quot;) &amp;&amp; data.exists(&quot;desc&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1191"><span class="lineNum">    1191</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Both a descriptor and a scriptPubKey should not be provided.&quot;);</span></span>
<span id="L1192"><span class="lineNum">    1192</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (data.exists(&quot;scriptPubKey&quot;)) {</span></span>
<span id="L1193"><span class="lineNum">    1193</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             warnings = ProcessImportLegacy(import_data, pubkey_map, privkey_map, script_pub_keys, have_solving_data, data, ordered_pubkeys);</span></span>
<span id="L1194"><span class="lineNum">    1194</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (data.exists(&quot;desc&quot;)) {</span></span>
<span id="L1195"><span class="lineNum">    1195</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             warnings = ProcessImportDescriptor(import_data, pubkey_map, privkey_map, script_pub_keys, have_solving_data, data, ordered_pubkeys);</span></span>
<span id="L1196"><span class="lineNum">    1196</span>                 :             :         } else {</span>
<span id="L1197"><span class="lineNum">    1197</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Either a descriptor or scriptPubKey must be provided.&quot;);</span></span>
<span id="L1198"><span class="lineNum">    1198</span>                 :             :         }</span>
<span id="L1199"><span class="lineNum">    1199</span>                 :             : </span>
<span id="L1200"><span class="lineNum">    1200</span>                 :             :         // If private keys are disabled, abort if private keys are being imported</span>
<span id="L1201"><span class="lineNum">    1201</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &amp;&amp; !privkey_map.empty()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1202"><span class="lineNum">    1202</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Cannot import private keys to a wallet with private keys disabled&quot;);</span></span>
<span id="L1203"><span class="lineNum">    1203</span>                 :             :         }</span>
<span id="L1204"><span class="lineNum">    1204</span>                 :             : </span>
<span id="L1205"><span class="lineNum">    1205</span>                 :             :         // Check whether we have any work to do</span>
<span id="L1206"><span class="lineNum">    1206</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const CScript&amp; script : script_pub_keys) {</span></span>
<span id="L1207"><span class="lineNum">    1207</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (wallet.IsMine(script) &amp; ISMINE_SPENDABLE) {</span></span>
<span id="L1208"><span class="lineNum">    1208</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_WALLET_ERROR, &quot;The wallet already contains the private key for this address or script (\&quot;&quot; + HexStr(script) + &quot;\&quot;)&quot;);</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1209"><span class="lineNum">    1209</span>                 :             :             }</span>
<span id="L1210"><span class="lineNum">    1210</span>                 :             :         }</span>
<span id="L1211"><span class="lineNum">    1211</span>                 :             : </span>
<span id="L1212"><span class="lineNum">    1212</span>                 :             :         // All good, time to import</span>
<span id="L1213"><span class="lineNum">    1213</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         wallet.MarkDirty();</span></span>
<span id="L1214"><span class="lineNum">    1214</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (!wallet.ImportScripts(import_data.import_scripts, timestamp)) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1215"><span class="lineNum">    1215</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding script to wallet&quot;);</span></span>
<span id="L1216"><span class="lineNum">    1216</span>                 :             :         }</span>
<span id="L1217"><span class="lineNum">    1217</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!wallet.ImportPrivKeys(privkey_map, timestamp)) {</span></span>
<span id="L1218"><span class="lineNum">    1218</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding key to wallet&quot;);</span></span>
<span id="L1219"><span class="lineNum">    1219</span>                 :             :         }</span>
<span id="L1220"><span class="lineNum">    1220</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!wallet.ImportPubKeys(ordered_pubkeys, pubkey_map, import_data.key_origins, add_keypool, timestamp)) {</span></span>
<span id="L1221"><span class="lineNum">    1221</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding address to wallet&quot;);</span></span>
<span id="L1222"><span class="lineNum">    1222</span>                 :             :         }</span>
<span id="L1223"><span class="lineNum">    1223</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!wallet.ImportScriptPubKeys(label, script_pub_keys, have_solving_data, !internal, timestamp)) {</span></span>
<span id="L1224"><span class="lineNum">    1224</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error adding address to wallet&quot;);</span></span>
<span id="L1225"><span class="lineNum">    1225</span>                 :             :         }</span>
<span id="L1226"><span class="lineNum">    1226</span>                 :             : </span>
<span id="L1227"><span class="lineNum">    1227</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;success&quot;, UniValue(true));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1228"><span class="lineNum">    1228</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } catch (const UniValue&amp; e) {</span></span>
<span id="L1229"><span class="lineNum">    1229</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;success&quot;, UniValue(false));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1230"><span class="lineNum">    1230</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;error&quot;, e);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1231"><span class="lineNum">    1231</span>                 :<span class="tlaUNC">           0 :     } catch (...) {</span></span>
<span id="L1232"><span class="lineNum">    1232</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;success&quot;, UniValue(false));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1233"><span class="lineNum">    1233</span>                 :             : </span>
<span id="L1234"><span class="lineNum">    1234</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;error&quot;, JSONRPCError(RPC_MISC_ERROR, &quot;Missing required fields&quot;));</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span><span class="tlaUNC" title="Branch 6 was not taken"> - </span><span class="tlaUNC" title="Branch 7 was not taken"> - </span>]
<span id="L1235"><span class="lineNum">    1235</span>         [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L1236"><span class="lineNum">    1236</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     PushWarnings(warnings, result);</span></span>
<span id="L1237"><span class="lineNum">    1237</span>                 :<span class="tlaUNC">           0 :     return result;</span></span>
<span id="L1238"><span class="lineNum">    1238</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L1239"><span class="lineNum">    1239</span>                 :             : </span>
<span id="L1240"><span class="lineNum">    1240</span>                 :<span class="tlaUNC">           0 : static int64_t GetImportTimestamp(const UniValue&amp; data, int64_t now)</span></span>
<span id="L1241"><span class="lineNum">    1241</span>                 :             : {</span>
<span id="L1242"><span class="lineNum">    1242</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (data.exists(&quot;timestamp&quot;)) {</span></span>
<span id="L1243"><span class="lineNum">    1243</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const UniValue&amp; timestamp = data[&quot;timestamp&quot;];</span></span>
<span id="L1244"><span class="lineNum">    1244</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (timestamp.isNum()) {</span></span>
<span id="L1245"><span class="lineNum">    1245</span>                 :<span class="tlaUNC">           0 :             return timestamp.getInt&lt;int64_t&gt;();</span></span>
<span id="L1246"><span class="lineNum">    1246</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         } else if (timestamp.isStr() &amp;&amp; timestamp.get_str() == &quot;now&quot;) {</span></span>
<span id="L1247"><span class="lineNum">    1247</span>                 :             :             return now;</span>
<span id="L1248"><span class="lineNum">    1248</span>                 :             :         }</span>
<span id="L1249"><span class="lineNum">    1249</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_TYPE_ERROR, strprintf(&quot;Expected number or \&quot;now\&quot; timestamp value for key. got type %s&quot;, uvTypeName(timestamp.type())));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1250"><span class="lineNum">    1250</span>                 :             :     }</span>
<span id="L1251"><span class="lineNum">    1251</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     throw JSONRPCError(RPC_TYPE_ERROR, &quot;Missing required timestamp field for key&quot;);</span></span>
<span id="L1252"><span class="lineNum">    1252</span>                 :             : }</span>
<span id="L1253"><span class="lineNum">    1253</span>                 :             : </span>
<span id="L1254"><span class="lineNum">    1254</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importmulti()</span></span>
<span id="L1255"><span class="lineNum">    1255</span>                 :             : {</span>
<span id="L1256"><span class="lineNum">    1256</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importmulti&quot;,</span></span>
<span id="L1257"><span class="lineNum">    1257</span>                 :             :                 &quot;\nImport addresses/scripts (with private or public keys, redeem script (P2SH)), optionally rescanning the blockchain from the earliest creation time of the imported scripts. Requires a new wallet backup.\n&quot;</span>
<span id="L1258"><span class="lineNum">    1258</span>                 :             :                 &quot;If an address/script is imported without all of the private keys required to spend from that address, it will be watchonly. The 'watchonly' option must be set to true in this case or a warning will be returned.\n&quot;</span>
<span id="L1259"><span class="lineNum">    1259</span>                 :             :                 &quot;Conversely, if all the private keys are provided and the address/script is spendable, the watchonly option must be set to false, or a warning will be returned.\n&quot;</span>
<span id="L1260"><span class="lineNum">    1260</span>                 :             :             &quot;\nNote: This call can take over an hour to complete if rescan is true, during that time, other rpc calls\n&quot;</span>
<span id="L1261"><span class="lineNum">    1261</span>                 :             :             &quot;may report that the imported keys, addresses or scripts exist but related transactions are still missing.\n&quot;</span>
<span id="L1262"><span class="lineNum">    1262</span>                 :             :             &quot;The rescan parameter can be set to false if the key was never used to create transactions. If it is set to false,\n&quot;</span>
<span id="L1263"><span class="lineNum">    1263</span>                 :             :             &quot;but the key was used to create transactions, rescanblockchain needs to be called with the appropriate block range.\n&quot;</span>
<span id="L1264"><span class="lineNum">    1264</span>                 :             :             &quot;Note: Use \&quot;getwalletinfo\&quot; to query the scanning progress.\n&quot;</span>
<span id="L1265"><span class="lineNum">    1265</span>                 :             :             &quot;Note: This command is only compatible with legacy wallets. Use \&quot;importdescriptors\&quot; for descriptor wallets.\n&quot;,</span>
<span id="L1266"><span class="lineNum">    1266</span>                 :             :                 {</span>
<span id="L1267"><span class="lineNum">    1267</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;requests&quot;, RPCArg::Type::ARR, RPCArg::Optional::NO, &quot;Data to be imported&quot;,</span></span>
<span id="L1268"><span class="lineNum">    1268</span>                 :             :                         {</span>
<span id="L1269"><span class="lineNum">    1269</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                             {&quot;&quot;, RPCArg::Type::OBJ, RPCArg::Optional::OMITTED, &quot;&quot;,</span></span>
<span id="L1270"><span class="lineNum">    1270</span>                 :             :                                 {</span>
<span id="L1271"><span class="lineNum">    1271</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;desc&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;Descriptor to import. If using descriptor, do not also provide address/scriptPubKey, scripts, or pubkeys&quot;},</span></span>
<span id="L1272"><span class="lineNum">    1272</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;scriptPubKey&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;Type of scriptPubKey (string for script, json for address). Should not be provided if using a descriptor&quot;,</span></span>
<span id="L1273"><span class="lineNum">    1273</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                         RPCArgOptions{.type_str={&quot;\&quot;&lt;script&gt;\&quot; | { \&quot;address\&quot;:\&quot;&lt;address&gt;\&quot; }&quot;, &quot;string / json&quot;}}</span></span>
<span id="L1274"><span class="lineNum">    1274</span>                 :             :                                     },</span>
<span id="L1275"><span class="lineNum">    1275</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;timestamp&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;Creation time of the key expressed in &quot; + UNIX_EPOCH_TIME + &quot;,\n&quot;</span></span>
<span id="L1276"><span class="lineNum">    1276</span>                 :             :                                         &quot;or the string \&quot;now\&quot; to substitute the current synced blockchain time. The timestamp of the oldest\n&quot;</span>
<span id="L1277"><span class="lineNum">    1277</span>                 :             :                                         &quot;key will determine how far back blockchain rescans need to begin for missing wallet transactions.\n&quot;</span>
<span id="L1278"><span class="lineNum">    1278</span>                 :             :                                         &quot;\&quot;now\&quot; can be specified to bypass scanning, for keys which are known to never have been used, and\n&quot;</span>
<span id="L1279"><span class="lineNum">    1279</span>                 :             :                                         &quot;0 can be specified to scan the entire blockchain. Blocks up to 2 hours before the earliest key\n&quot;</span>
<span id="L1280"><span class="lineNum">    1280</span>                 :<span class="tlaUNC">           0 :                                         &quot;creation time of all keys being imported by the importmulti call will be scanned.&quot;,</span></span>
<span id="L1281"><span class="lineNum">    1281</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                         RPCArgOptions{.type_str={&quot;timestamp | \&quot;now\&quot;&quot;, &quot;integer / string&quot;}}</span></span>
<span id="L1282"><span class="lineNum">    1282</span>                 :             :                                     },</span>
<span id="L1283"><span class="lineNum">    1283</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;redeemscript&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;Allowed only if the scriptPubKey is a P2SH or P2SH-P2WSH address/scriptPubKey&quot;},</span></span>
<span id="L1284"><span class="lineNum">    1284</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;witnessscript&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;Allowed only if the scriptPubKey is a P2SH-P2WSH or P2WSH address/scriptPubKey&quot;},</span></span>
<span id="L1285"><span class="lineNum">    1285</span>                 :<span class="tlaUNC">           0 :                                     {&quot;pubkeys&quot;, RPCArg::Type::ARR, RPCArg::Default{UniValue::VARR}, &quot;Array of strings giving pubkeys to import. They must occur in P2PKH or P2WPKH scripts. They are not required when the private key is also provided (see the \&quot;keys\&quot; argument).&quot;,</span></span>
<span id="L1286"><span class="lineNum">    1286</span>                 :             :                                         {</span>
<span id="L1287"><span class="lineNum">    1287</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                             {&quot;pubKey&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;&quot;},</span></span>
<span id="L1288"><span class="lineNum">    1288</span>                 :             :                                         }</span>
<span id="L1289"><span class="lineNum">    1289</span>                 :             :                                     },</span>
<span id="L1290"><span class="lineNum">    1290</span>                 :<span class="tlaUNC">           0 :                                     {&quot;keys&quot;, RPCArg::Type::ARR, RPCArg::Default{UniValue::VARR}, &quot;Array of strings giving private keys to import. The corresponding public keys must occur in the output or redeemscript.&quot;,</span></span>
<span id="L1291"><span class="lineNum">    1291</span>                 :             :                                         {</span>
<span id="L1292"><span class="lineNum">    1292</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                             {&quot;key&quot;, RPCArg::Type::STR, RPCArg::Optional::OMITTED, &quot;&quot;},</span></span>
<span id="L1293"><span class="lineNum">    1293</span>                 :             :                                         }</span>
<span id="L1294"><span class="lineNum">    1294</span>                 :             :                                     },</span>
<span id="L1295"><span class="lineNum">    1295</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;range&quot;, RPCArg::Type::RANGE, RPCArg::Optional::OMITTED, &quot;If a ranged descriptor is used, this specifies the end or the range (in the form [begin,end]) to import&quot;},</span></span>
<span id="L1296"><span class="lineNum">    1296</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;internal&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Stating whether matching outputs should be treated as not incoming payments (also known as change)&quot;},</span></span>
<span id="L1297"><span class="lineNum">    1297</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;watchonly&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Stating whether matching outputs should be considered watchonly.&quot;},</span></span>
<span id="L1298"><span class="lineNum">    1298</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;label&quot;, RPCArg::Type::STR, RPCArg::Default{&quot;&quot;}, &quot;Label to assign to the address, only allowed with internal=false&quot;},</span></span>
<span id="L1299"><span class="lineNum">    1299</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;keypool&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Stating whether imported public keys should be added to the keypool for when users request new addresses. Only allowed when wallet private keys are disabled&quot;},</span></span>
<span id="L1300"><span class="lineNum">    1300</span>                 :             :                                 },</span>
<span id="L1301"><span class="lineNum">    1301</span>                 :             :                             },</span>
<span id="L1302"><span class="lineNum">    1302</span>                 :             :                         },</span>
<span id="L1303"><span class="lineNum">    1303</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         RPCArgOptions{.oneline_description=&quot;requests&quot;}},</span></span>
<span id="L1304"><span class="lineNum">    1304</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;options&quot;, RPCArg::Type::OBJ_NAMED_PARAMS, RPCArg::Optional::OMITTED, &quot;&quot;,</span></span>
<span id="L1305"><span class="lineNum">    1305</span>                 :             :                         {</span>
<span id="L1306"><span class="lineNum">    1306</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                             {&quot;rescan&quot;, RPCArg::Type::BOOL, RPCArg::Default{true}, &quot;Scan the chain and mempool for wallet transactions after all imports.&quot;},</span></span>
<span id="L1307"><span class="lineNum">    1307</span>                 :             :                         },</span>
<span id="L1308"><span class="lineNum">    1308</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         RPCArgOptions{.oneline_description=&quot;options&quot;}},</span></span>
<span id="L1309"><span class="lineNum">    1309</span>                 :             :                 },</span>
<span id="L1310"><span class="lineNum">    1310</span>                 :<span class="tlaUNC">           0 :                 RPCResult{</span></span>
<span id="L1311"><span class="lineNum">    1311</span>                 :             :                     RPCResult::Type::ARR, &quot;&quot;, &quot;Response is an array with the same size as the input that has the execution result&quot;,</span>
<span id="L1312"><span class="lineNum">    1312</span>                 :             :                     {</span>
<span id="L1313"><span class="lineNum">    1313</span>                 :             :                         {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L1314"><span class="lineNum">    1314</span>                 :             :                         {</span>
<span id="L1315"><span class="lineNum">    1315</span>                 :             :                             {RPCResult::Type::BOOL, &quot;success&quot;, &quot;&quot;},</span>
<span id="L1316"><span class="lineNum">    1316</span>                 :             :                             {RPCResult::Type::ARR, &quot;warnings&quot;, /*optional=*/true, &quot;&quot;,</span>
<span id="L1317"><span class="lineNum">    1317</span>                 :             :                             {</span>
<span id="L1318"><span class="lineNum">    1318</span>                 :             :                                 {RPCResult::Type::STR, &quot;&quot;, &quot;&quot;},</span>
<span id="L1319"><span class="lineNum">    1319</span>                 :             :                             }},</span>
<span id="L1320"><span class="lineNum">    1320</span>                 :             :                             {RPCResult::Type::OBJ, &quot;error&quot;, /*optional=*/true, &quot;&quot;,</span>
<span id="L1321"><span class="lineNum">    1321</span>                 :             :                             {</span>
<span id="L1322"><span class="lineNum">    1322</span>                 :             :                                 {RPCResult::Type::ELISION, &quot;&quot;, &quot;JSONRPC error&quot;},</span>
<span id="L1323"><span class="lineNum">    1323</span>                 :             :                             }},</span>
<span id="L1324"><span class="lineNum">    1324</span>                 :             :                         }},</span>
<span id="L1325"><span class="lineNum">    1325</span>                 :             :                     }</span>
<span id="L1326"><span class="lineNum">    1326</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 },</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span><span class="tlaUNC" title="Branch 58 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 59 was not executed"> # </span>]
<span id="L1327"><span class="lineNum">    1327</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L1328"><span class="lineNum">    1328</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;importmulti&quot;, &quot;'[{ \&quot;scriptPubKey\&quot;: { \&quot;address\&quot;: \&quot;&lt;my address&gt;\&quot; }, \&quot;timestamp\&quot;:1455191478 }, &quot;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1329"><span class="lineNum">    1329</span>                 :<span class="tlaUNC">           0 :                                           &quot;{ \&quot;scriptPubKey\&quot;: { \&quot;address\&quot;: \&quot;&lt;my 2nd address&gt;\&quot; }, \&quot;label\&quot;: \&quot;example 2\&quot;, \&quot;timestamp\&quot;: 1455191480 }]'&quot;) +</span></span>
<span id="L1330"><span class="lineNum">    1330</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;importmulti&quot;, &quot;'[{ \&quot;scriptPubKey\&quot;: { \&quot;address\&quot;: \&quot;&lt;my address&gt;\&quot; }, \&quot;timestamp\&quot;:1455191478 }]' '{ \&quot;rescan\&quot;: false}'&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1331"><span class="lineNum">    1331</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L1332"><span class="lineNum">    1332</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; mainRequest) -&gt; UniValue</span></span>
<span id="L1333"><span class="lineNum">    1333</span>                 :             : {</span>
<span id="L1334"><span class="lineNum">    1334</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(mainRequest);</span></span>
<span id="L1335"><span class="lineNum">    1335</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L1336"><span class="lineNum">    1336</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CWallet&amp; wallet{*pwallet};</span></span>
<span id="L1337"><span class="lineNum">    1337</span>                 :             : </span>
<span id="L1338"><span class="lineNum">    1338</span>                 :             :     // Make sure the results are valid at least up to the most recent block</span>
<span id="L1339"><span class="lineNum">    1339</span>                 :             :     // the user could have gotten from another RPC command prior to now</span>
<span id="L1340"><span class="lineNum">    1340</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     wallet.BlockUntilSyncedToCurrentChain();</span></span>
<span id="L1341"><span class="lineNum">    1341</span>                 :             : </span>
<span id="L1342"><span class="lineNum">    1342</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     EnsureLegacyScriptPubKeyMan(*pwallet, true);</span></span>
<span id="L1343"><span class="lineNum">    1343</span>                 :             : </span>
<span id="L1344"><span class="lineNum">    1344</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const UniValue&amp; requests = mainRequest.params[0];</span></span>
<span id="L1345"><span class="lineNum">    1345</span>                 :             : </span>
<span id="L1346"><span class="lineNum">    1346</span>                 :             :     //Default options</span>
<span id="L1347"><span class="lineNum">    1347</span>                 :<span class="tlaUNC">           0 :     bool fRescan = true;</span></span>
<span id="L1348"><span class="lineNum">    1348</span>                 :             : </span>
<span id="L1349"><span class="lineNum">    1349</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!mainRequest.params[1].isNull()) {</span></span>
<span id="L1350"><span class="lineNum">    1350</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const UniValue&amp; options = mainRequest.params[1];</span></span>
<span id="L1351"><span class="lineNum">    1351</span>                 :             : </span>
<span id="L1352"><span class="lineNum">    1352</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (options.exists(&quot;rescan&quot;)) {</span></span>
<span id="L1353"><span class="lineNum">    1353</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             fRescan = options[&quot;rescan&quot;].get_bool();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1354"><span class="lineNum">    1354</span>                 :             :         }</span>
<span id="L1355"><span class="lineNum">    1355</span>                 :             :     }</span>
<span id="L1356"><span class="lineNum">    1356</span>                 :             : </span>
<span id="L1357"><span class="lineNum">    1357</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L1358"><span class="lineNum">    1358</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; !reserver.reserve()) {</span></span>
<span id="L1359"><span class="lineNum">    1359</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L1360"><span class="lineNum">    1360</span>                 :             :     }</span>
<span id="L1361"><span class="lineNum">    1361</span>                 :             : </span>
<span id="L1362"><span class="lineNum">    1362</span>                 :<span class="tlaUNC">           0 :     int64_t now = 0;</span></span>
<span id="L1363"><span class="lineNum">    1363</span>                 :<span class="tlaUNC">           0 :     bool fRunScan = false;</span></span>
<span id="L1364"><span class="lineNum">    1364</span>                 :<span class="tlaUNC">           0 :     int64_t nLowestTimestamp = 0;</span></span>
<span id="L1365"><span class="lineNum">    1365</span>                 :<span class="tlaUNC">           0 :     UniValue response(UniValue::VARR);</span></span>
<span id="L1366"><span class="lineNum">    1366</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L1367"><span class="lineNum">    1367</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L1368"><span class="lineNum">    1368</span>                 :             : </span>
<span id="L1369"><span class="lineNum">    1369</span>                 :             :         // Check all requests are watchonly</span>
<span id="L1370"><span class="lineNum">    1370</span>                 :<span class="tlaUNC">           0 :         bool is_watchonly{true};</span></span>
<span id="L1371"><span class="lineNum">    1371</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (size_t i = 0; i &lt; requests.size(); ++i) {</span></span>
<span id="L1372"><span class="lineNum">    1372</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const UniValue&amp; request = requests[i];</span></span>
<span id="L1373"><span class="lineNum">    1373</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (!request.exists(&quot;watchonly&quot;) || !request[&quot;watchonly&quot;].get_bool()) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 19 was not executed"> # </span>]
<span id="L1374"><span class="lineNum">    1374</span>                 :             :                 is_watchonly = false;</span>
<span id="L1375"><span class="lineNum">    1375</span>                 :             :                 break;</span>
<span id="L1376"><span class="lineNum">    1376</span>                 :             :             }</span>
<span id="L1377"><span class="lineNum">    1377</span>                 :             :         }</span>
<span id="L1378"><span class="lineNum">    1378</span>                 :             :         // Wallet does not need to be unlocked if all requests are watchonly</span>
<span id="L1379"><span class="lineNum">    1379</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!is_watchonly) EnsureWalletIsUnlocked(wallet);</span></span>
<span id="L1380"><span class="lineNum">    1380</span>                 :             : </span>
<span id="L1381"><span class="lineNum">    1381</span>                 :             :         // Verify all timestamps are present before importing any keys.</span>
<span id="L1382"><span class="lineNum">    1382</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(pwallet-&gt;chain().findBlock(pwallet-&gt;GetLastBlockHash(), FoundBlock().time(nLowestTimestamp).mtpTime(now)));</span></span>
<span id="L1383"><span class="lineNum">    1383</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const UniValue&amp; data : requests.getValues()) {</span></span>
<span id="L1384"><span class="lineNum">    1384</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             GetImportTimestamp(data, now);</span></span>
<span id="L1385"><span class="lineNum">    1385</span>                 :             :         }</span>
<span id="L1386"><span class="lineNum">    1386</span>                 :             : </span>
<span id="L1387"><span class="lineNum">    1387</span>                 :<span class="tlaUNC">           0 :         const int64_t minimumTimestamp = 1;</span></span>
<span id="L1388"><span class="lineNum">    1388</span>                 :             : </span>
<span id="L1389"><span class="lineNum">    1389</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const UniValue&amp; data : requests.getValues()) {</span></span>
<span id="L1390"><span class="lineNum">    1390</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const int64_t timestamp = std::max(GetImportTimestamp(data, now), minimumTimestamp);</span></span>
<span id="L1391"><span class="lineNum">    1391</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const UniValue result = ProcessImport(*pwallet, data, timestamp);</span></span>
<span id="L1392"><span class="lineNum">    1392</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.push_back(result);</span></span>
<span id="L1393"><span class="lineNum">    1393</span>                 :             : </span>
<span id="L1394"><span class="lineNum">    1394</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!fRescan) {</span></span>
<span id="L1395"><span class="lineNum">    1395</span>                 :<span class="tlaUNC">           0 :                 continue;</span></span>
<span id="L1396"><span class="lineNum">    1396</span>                 :             :             }</span>
<span id="L1397"><span class="lineNum">    1397</span>                 :             : </span>
<span id="L1398"><span class="lineNum">    1398</span>                 :             :             // If at least one request was successful then allow rescan.</span>
<span id="L1399"><span class="lineNum">    1399</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (result[&quot;success&quot;].get_bool()) {</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1400"><span class="lineNum">    1400</span>                 :<span class="tlaUNC">           0 :                 fRunScan = true;</span></span>
<span id="L1401"><span class="lineNum">    1401</span>                 :             :             }</span>
<span id="L1402"><span class="lineNum">    1402</span>                 :             : </span>
<span id="L1403"><span class="lineNum">    1403</span>                 :             :             // Get the lowest timestamp.</span>
<span id="L1404"><span class="lineNum">    1404</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (timestamp &lt; nLowestTimestamp) {</span></span>
<span id="L1405"><span class="lineNum">    1405</span>                 :<span class="tlaUNC">           0 :                 nLowestTimestamp = timestamp;</span></span>
<span id="L1406"><span class="lineNum">    1406</span>                 :             :             }</span>
<span id="L1407"><span class="lineNum">    1407</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1408"><span class="lineNum">    1408</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1409"><span class="lineNum">    1409</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (fRescan &amp;&amp; fRunScan &amp;&amp; requests.size()) {</span></span>
<span id="L1410"><span class="lineNum">    1410</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         int64_t scannedTime = pwallet-&gt;RescanFromTime(nLowestTimestamp, reserver, /*update=*/true);</span></span>
<span id="L1411"><span class="lineNum">    1411</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ResubmitWalletTransactions(/*relay=*/false, /*force=*/true);</span></span>
<span id="L1412"><span class="lineNum">    1412</span>                 :             : </span>
<span id="L1413"><span class="lineNum">    1413</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (pwallet-&gt;IsAbortingRescan()) {</span></span>
<span id="L1414"><span class="lineNum">    1414</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Rescan aborted by user.&quot;);</span></span>
<span id="L1415"><span class="lineNum">    1415</span>                 :             :         }</span>
<span id="L1416"><span class="lineNum">    1416</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (scannedTime &gt; nLowestTimestamp) {</span></span>
<span id="L1417"><span class="lineNum">    1417</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::vector&lt;UniValue&gt; results = response.getValues();</span></span>
<span id="L1418"><span class="lineNum">    1418</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.clear();</span></span>
<span id="L1419"><span class="lineNum">    1419</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.setArray();</span></span>
<span id="L1420"><span class="lineNum">    1420</span>                 :<span class="tlaUNC">           0 :             size_t i = 0;</span></span>
<span id="L1421"><span class="lineNum">    1421</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const UniValue&amp; request : requests.getValues()) {</span></span>
<span id="L1422"><span class="lineNum">    1422</span>                 :             :                 // If key creation date is within the successfully scanned</span>
<span id="L1423"><span class="lineNum">    1423</span>                 :             :                 // range, or if the import result already has an error set, let</span>
<span id="L1424"><span class="lineNum">    1424</span>                 :             :                 // the result stand unmodified. Otherwise replace the result</span>
<span id="L1425"><span class="lineNum">    1425</span>                 :             :                 // with an error message.</span>
<span id="L1426"><span class="lineNum">    1426</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 if (scannedTime &lt;= GetImportTimestamp(request, now) || results.at(i).exists(&quot;error&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L1427"><span class="lineNum">    1427</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     response.push_back(results.at(i));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1428"><span class="lineNum">    1428</span>                 :             :                 } else {</span>
<span id="L1429"><span class="lineNum">    1429</span>                 :<span class="tlaUNC">           0 :                     UniValue result = UniValue(UniValue::VOBJ);</span></span>
<span id="L1430"><span class="lineNum">    1430</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     result.pushKV(&quot;success&quot;, UniValue(false));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1431"><span class="lineNum">    1431</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     result.pushKV(</span></span>
<span id="L1432"><span class="lineNum">    1432</span>                 :             :                         &quot;error&quot;,</span>
<span id="L1433"><span class="lineNum">    1433</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         JSONRPCError(</span></span>
<span id="L1434"><span class="lineNum">    1434</span>                 :             :                             RPC_MISC_ERROR,</span>
<span id="L1435"><span class="lineNum">    1435</span>                 :<span class="tlaUNC">           0 :                             strprintf(&quot;Rescan failed for key with creation timestamp %d. There was an error reading a &quot;</span></span>
<span id="L1436"><span class="lineNum">    1436</span>                 :             :                                       &quot;block from time %d, which is after or within %d seconds of key creation, and &quot;</span>
<span id="L1437"><span class="lineNum">    1437</span>                 :             :                                       &quot;could contain transactions pertaining to the key. As a result, transactions &quot;</span>
<span id="L1438"><span class="lineNum">    1438</span>                 :             :                                       &quot;and coins using this key may not appear in the wallet. This error could be &quot;</span>
<span id="L1439"><span class="lineNum">    1439</span>                 :             :                                       &quot;caused by pruning or data corruption (see bitcoind log for details) and could &quot;</span>
<span id="L1440"><span class="lineNum">    1440</span>                 :             :                                       &quot;be dealt with by downloading and rescanning the relevant blocks (see -reindex &quot;</span>
<span id="L1441"><span class="lineNum">    1441</span>                 :             :                                       &quot;option and rescanblockchain RPC).&quot;,</span>
<span id="L1442"><span class="lineNum">    1442</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                 GetImportTimestamp(request, now), scannedTime - TIMESTAMP_WINDOW - 1, TIMESTAMP_WINDOW)));</span></span>
<span id="L1443"><span class="lineNum">    1443</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     response.push_back(std::move(result));</span></span>
<span id="L1444"><span class="lineNum">    1444</span>                 :<span class="tlaUNC">           0 :                 }</span></span>
<span id="L1445"><span class="lineNum">    1445</span>                 :<span class="tlaUNC">           0 :                 ++i;</span></span>
<span id="L1446"><span class="lineNum">    1446</span>                 :             :             }</span>
<span id="L1447"><span class="lineNum">    1447</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1448"><span class="lineNum">    1448</span>                 :             :     }</span>
<span id="L1449"><span class="lineNum">    1449</span>                 :             : </span>
<span id="L1450"><span class="lineNum">    1450</span>                 :<span class="tlaUNC">           0 :     return response;</span></span>
<span id="L1451"><span class="lineNum">    1451</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L1452"><span class="lineNum">    1452</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span><span class="tlaUNC" title="Branch 58 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 59 was not executed"> # </span><span class="tlaUNC" title="Branch 60 was not executed"> # </span><span class="tlaUNC" title="Branch 61 was not executed"> # </span><span class="tlaUNC" title="Branch 62 was not executed"> # </span><span class="tlaUNC" title="Branch 63 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 64 was not executed"> # </span><span class="tlaUNC" title="Branch 65 was not executed"> # </span><span class="tlaUNC" title="Branch 66 was not executed"> # </span><span class="tlaUNC" title="Branch 67 was not executed"> # </span><span class="tlaUNC" title="Branch 68 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 69 was not executed"> # </span><span class="tlaUNC" title="Branch 70 was not executed"> # </span><span class="tlaUNC" title="Branch 71 was not executed"> # </span><span class="tlaUNC" title="Branch 72 was not executed"> # </span><span class="tlaUNC" title="Branch 73 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 74 was not executed"> # </span><span class="tlaUNC" title="Branch 75 was not executed"> # </span><span class="tlaUNC" title="Branch 76 was not executed"> # </span><span class="tlaUNC" title="Branch 77 was not executed"> # </span><span class="tlaUNC" title="Branch 78 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 79 was not executed"> # </span><span class="tlaUNC" title="Branch 80 was not executed"> # </span><span class="tlaUNC" title="Branch 81 was not executed"> # </span><span class="tlaUNC" title="Branch 82 was not executed"> # </span><span class="tlaUNC" title="Branch 83 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 84 was not executed"> # </span><span class="tlaUNC" title="Branch 85 was not executed"> # </span><span class="tlaUNC" title="Branch 86 was not executed"> # </span><span class="tlaUNC" title="Branch 87 was not executed"> # </span><span class="tlaUNC" title="Branch 88 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 89 was not executed"> # </span><span class="tlaUNC" title="Branch 90 was not executed"> # </span><span class="tlaUNC" title="Branch 91 was not executed"> # </span><span class="tlaUNC" title="Branch 92 was not executed"> # </span><span class="tlaUNC" title="Branch 93 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 94 was not executed"> # </span><span class="tlaUNC" title="Branch 95 was not executed"> # </span><span class="tlaUNC" title="Branch 96 was not executed"> # </span><span class="tlaUNC" title="Branch 97 was not executed"> # </span><span class="tlaUNC" title="Branch 98 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 99 was not executed"> # </span><span class="tlaUNC" title="Branch 100 was not executed"> # </span><span class="tlaUNC" title="Branch 101 was not executed"> # </span><span class="tlaUNC" title="Branch 102 was not executed"> # </span><span class="tlaUNC" title="Branch 103 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 104 was not executed"> # </span><span class="tlaUNC" title="Branch 105 was not executed"> # </span><span class="tlaUNC" title="Branch 106 was not executed"> # </span><span class="tlaUNC" title="Branch 107 was not executed"> # </span><span class="tlaUNC" title="Branch 108 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 109 was not executed"> # </span><span class="tlaUNC" title="Branch 110 was not executed"> # </span><span class="tlaUNC" title="Branch 111 was not executed"> # </span><span class="tlaUNC" title="Branch 112 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 113 was not executed"> # </span>]
<span id="L1453"><span class="lineNum">    1453</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span>]
<span id="L1454"><span class="lineNum">    1454</span>                 :             : </span>
<span id="L1455"><span class="lineNum">    1455</span>                 :<span class="tlaUNC">           0 : static UniValue ProcessDescriptorImport(CWallet&amp; wallet, const UniValue&amp; data, const int64_t timestamp) EXCLUSIVE_LOCKS_REQUIRED(wallet.cs_wallet)</span></span>
<span id="L1456"><span class="lineNum">    1456</span>                 :             : {</span>
<span id="L1457"><span class="lineNum">    1457</span>                 :<span class="tlaUNC">           0 :     UniValue warnings(UniValue::VARR);</span></span>
<span id="L1458"><span class="lineNum">    1458</span>                 :<span class="tlaUNC">           0 :     UniValue result(UniValue::VOBJ);</span></span>
<span id="L1459"><span class="lineNum">    1459</span>                 :             : </span>
<span id="L1460"><span class="lineNum">    1460</span>                 :<span class="tlaUNC">           0 :     try {</span></span>
<span id="L1461"><span class="lineNum">    1461</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!data.exists(&quot;desc&quot;)) {</span></span>
<span id="L1462"><span class="lineNum">    1462</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Descriptor not found.&quot;);</span></span>
<span id="L1463"><span class="lineNum">    1463</span>                 :             :         }</span>
<span id="L1464"><span class="lineNum">    1464</span>                 :             : </span>
<span id="L1465"><span class="lineNum">    1465</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const std::string&amp; descriptor = data[&quot;desc&quot;].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1466"><span class="lineNum">    1466</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const bool active = data.exists(&quot;active&quot;) ? data[&quot;active&quot;].get_bool() : false;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1467"><span class="lineNum">    1467</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         const std::string label{LabelFromValue(data[&quot;label&quot;])};</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1468"><span class="lineNum">    1468</span>                 :             : </span>
<span id="L1469"><span class="lineNum">    1469</span>                 :             :         // Parse descriptor string</span>
<span id="L1470"><span class="lineNum">    1470</span>                 :<span class="tlaUNC">           0 :         FlatSigningProvider keys;</span></span>
<span id="L1471"><span class="lineNum">    1471</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string error;</span></span>
<span id="L1472"><span class="lineNum">    1472</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         auto parsed_descs = Parse(descriptor, keys, error, /* require_checksum = */ true);</span></span>
<span id="L1473"><span class="lineNum">    1473</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (parsed_descs.empty()) {</span></span>
<span id="L1474"><span class="lineNum">    1474</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, error);</span></span>
<span id="L1475"><span class="lineNum">    1475</span>                 :             :         }</span>
<span id="L1476"><span class="lineNum">    1476</span>                 :<span class="tlaUNC">           0 :         std::optional&lt;bool&gt; internal;</span></span>
<span id="L1477"><span class="lineNum">    1477</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (data.exists(&quot;internal&quot;)) {</span></span>
<span id="L1478"><span class="lineNum">    1478</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (parsed_descs.size() &gt; 1) {</span></span>
<span id="L1479"><span class="lineNum">    1479</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, &quot;Cannot have multipath descriptor while also specifying \'internal\'&quot;);</span></span>
<span id="L1480"><span class="lineNum">    1480</span>                 :             :             }</span>
<span id="L1481"><span class="lineNum">    1481</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             internal = data[&quot;internal&quot;].get_bool();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1482"><span class="lineNum">    1482</span>                 :             :         }</span>
<span id="L1483"><span class="lineNum">    1483</span>                 :             : </span>
<span id="L1484"><span class="lineNum">    1484</span>                 :             :         // Range check</span>
<span id="L1485"><span class="lineNum">    1485</span>                 :<span class="tlaUNC">           0 :         int64_t range_start = 0, range_end = 1, next_index = 0;</span></span>
<span id="L1486"><span class="lineNum">    1486</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (!parsed_descs.at(0)-&gt;IsRange() &amp;&amp; data.exists(&quot;range&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L1487"><span class="lineNum">    1487</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Range should not be specified for an un-ranged descriptor&quot;);</span></span>
<span id="L1488"><span class="lineNum">    1488</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         } else if (parsed_descs.at(0)-&gt;IsRange()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1489"><span class="lineNum">    1489</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (data.exists(&quot;range&quot;)) {</span></span>
<span id="L1490"><span class="lineNum">    1490</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 auto range = ParseDescriptorRange(data[&quot;range&quot;]);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1491"><span class="lineNum">    1491</span>                 :<span class="tlaUNC">           0 :                 range_start = range.first;</span></span>
<span id="L1492"><span class="lineNum">    1492</span>                 :<span class="tlaUNC">           0 :                 range_end = range.second + 1; // Specified range end is inclusive, but we need range end as exclusive</span></span>
<span id="L1493"><span class="lineNum">    1493</span>                 :             :             } else {</span>
<span id="L1494"><span class="lineNum">    1494</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 warnings.push_back(&quot;Range not given, using default keypool range&quot;);</span></span>
<span id="L1495"><span class="lineNum">    1495</span>                 :<span class="tlaUNC">           0 :                 range_start = 0;</span></span>
<span id="L1496"><span class="lineNum">    1496</span>                 :<span class="tlaUNC">           0 :                 range_end = wallet.m_keypool_size;</span></span>
<span id="L1497"><span class="lineNum">    1497</span>                 :             :             }</span>
<span id="L1498"><span class="lineNum">    1498</span>                 :<span class="tlaUNC">           0 :             next_index = range_start;</span></span>
<span id="L1499"><span class="lineNum">    1499</span>                 :             : </span>
<span id="L1500"><span class="lineNum">    1500</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (data.exists(&quot;next_index&quot;)) {</span></span>
<span id="L1501"><span class="lineNum">    1501</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 next_index = data[&quot;next_index&quot;].getInt&lt;int64_t&gt;();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1502"><span class="lineNum">    1502</span>                 :             :                 // bound checks</span>
<span id="L1503"><span class="lineNum">    1503</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (next_index &lt; range_start || next_index &gt;= range_end) {</span></span>
<span id="L1504"><span class="lineNum">    1504</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;next_index is out of range&quot;);</span></span>
<span id="L1505"><span class="lineNum">    1505</span>                 :             :                 }</span>
<span id="L1506"><span class="lineNum">    1506</span>                 :             :             }</span>
<span id="L1507"><span class="lineNum">    1507</span>                 :             :         }</span>
<span id="L1508"><span class="lineNum">    1508</span>                 :             : </span>
<span id="L1509"><span class="lineNum">    1509</span>                 :             :         // Active descriptors must be ranged</span>
<span id="L1510"><span class="lineNum">    1510</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (active &amp;&amp; !parsed_descs.at(0)-&gt;IsRange()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1511"><span class="lineNum">    1511</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Active descriptors must be ranged&quot;);</span></span>
<span id="L1512"><span class="lineNum">    1512</span>                 :             :         }</span>
<span id="L1513"><span class="lineNum">    1513</span>                 :             : </span>
<span id="L1514"><span class="lineNum">    1514</span>                 :             :         // Multipath descriptors should not have a label</span>
<span id="L1515"><span class="lineNum">    1515</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (parsed_descs.size() &gt; 1 &amp;&amp; data.exists(&quot;label&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1516"><span class="lineNum">    1516</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Multipath descriptors should not have a label&quot;);</span></span>
<span id="L1517"><span class="lineNum">    1517</span>                 :             :         }</span>
<span id="L1518"><span class="lineNum">    1518</span>                 :             : </span>
<span id="L1519"><span class="lineNum">    1519</span>                 :             :         // Ranged descriptors should not have a label</span>
<span id="L1520"><span class="lineNum">    1520</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (data.exists(&quot;range&quot;) &amp;&amp; data.exists(&quot;label&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1521"><span class="lineNum">    1521</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Ranged descriptors should not have a label&quot;);</span></span>
<span id="L1522"><span class="lineNum">    1522</span>                 :             :         }</span>
<span id="L1523"><span class="lineNum">    1523</span>                 :             : </span>
<span id="L1524"><span class="lineNum">    1524</span>                 :             :         // Internal addresses should not have a label either</span>
<span id="L1525"><span class="lineNum">    1525</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (internal &amp;&amp; data.exists(&quot;label&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1526"><span class="lineNum">    1526</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_INVALID_PARAMETER, &quot;Internal addresses should not have a label&quot;);</span></span>
<span id="L1527"><span class="lineNum">    1527</span>                 :             :         }</span>
<span id="L1528"><span class="lineNum">    1528</span>                 :             : </span>
<span id="L1529"><span class="lineNum">    1529</span>                 :             :         // Combo descriptor check</span>
<span id="L1530"><span class="lineNum">    1530</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (active &amp;&amp; !parsed_descs.at(0)-&gt;IsSingleType()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1531"><span class="lineNum">    1531</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Combo descriptors cannot be set to active&quot;);</span></span>
<span id="L1532"><span class="lineNum">    1532</span>                 :             :         }</span>
<span id="L1533"><span class="lineNum">    1533</span>                 :             : </span>
<span id="L1534"><span class="lineNum">    1534</span>                 :             :         // If the wallet disabled private keys, abort if private keys exist</span>
<span id="L1535"><span class="lineNum">    1535</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         if (wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS) &amp;&amp; !keys.keys.empty()) {</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1536"><span class="lineNum">    1536</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Cannot import private keys to a wallet with private keys disabled&quot;);</span></span>
<span id="L1537"><span class="lineNum">    1537</span>                 :             :         }</span>
<span id="L1538"><span class="lineNum">    1538</span>                 :             : </span>
<span id="L1539"><span class="lineNum">    1539</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (size_t j = 0; j &lt; parsed_descs.size(); ++j) {</span></span>
<span id="L1540"><span class="lineNum">    1540</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             auto parsed_desc = std::move(parsed_descs[j]);</span></span>
<span id="L1541"><span class="lineNum">    1541</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             bool desc_internal = internal.has_value() &amp;&amp; internal.value();</span></span>
<span id="L1542"><span class="lineNum">    1542</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (parsed_descs.size() == 2) {</span></span>
<span id="L1543"><span class="lineNum">    1543</span>                 :<span class="tlaUNC">           0 :                 desc_internal = j == 1;</span></span>
<span id="L1544"><span class="lineNum">    1544</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             } else if (parsed_descs.size() &gt; 2) {</span></span>
<span id="L1545"><span class="lineNum">    1545</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 CHECK_NONFATAL(!desc_internal);</span></span>
<span id="L1546"><span class="lineNum">    1546</span>                 :             :             }</span>
<span id="L1547"><span class="lineNum">    1547</span>                 :             :             // Need to ExpandPrivate to check if private keys are available for all pubkeys</span>
<span id="L1548"><span class="lineNum">    1548</span>                 :<span class="tlaUNC">           0 :             FlatSigningProvider expand_keys;</span></span>
<span id="L1549"><span class="lineNum">    1549</span>                 :<span class="tlaUNC">           0 :             std::vector&lt;CScript&gt; scripts;</span></span>
<span id="L1550"><span class="lineNum">    1550</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!parsed_desc-&gt;Expand(0, keys, scripts, expand_keys)) {</span></span>
<span id="L1551"><span class="lineNum">    1551</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_WALLET_ERROR, &quot;Cannot expand descriptor. Probably because of hardened derivations without private keys provided&quot;);</span></span>
<span id="L1552"><span class="lineNum">    1552</span>                 :             :             }</span>
<span id="L1553"><span class="lineNum">    1553</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             parsed_desc-&gt;ExpandPrivate(0, keys, expand_keys);</span></span>
<span id="L1554"><span class="lineNum">    1554</span>                 :             : </span>
<span id="L1555"><span class="lineNum">    1555</span>                 :             :             // Check if all private keys are provided</span>
<span id="L1556"><span class="lineNum">    1556</span>                 :<span class="tlaUNC">           0 :             bool have_all_privkeys = !expand_keys.keys.empty();</span></span>
<span id="L1557"><span class="lineNum">    1557</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (const auto&amp; entry : expand_keys.origins) {</span></span>
<span id="L1558"><span class="lineNum">    1558</span>                 :<span class="tlaUNC">           0 :                 const CKeyID&amp; key_id = entry.first;</span></span>
<span id="L1559"><span class="lineNum">    1559</span>                 :<span class="tlaUNC">           0 :                 CKey key;</span></span>
<span id="L1560"><span class="lineNum">    1560</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!expand_keys.GetKey(key_id, key)) {</span></span>
<span id="L1561"><span class="lineNum">    1561</span>                 :<span class="tlaUNC">           0 :                     have_all_privkeys = false;</span></span>
<span id="L1562"><span class="lineNum">    1562</span>                 :<span class="tlaUNC">           0 :                     break;</span></span>
<span id="L1563"><span class="lineNum">    1563</span>                 :             :                 }</span>
<span id="L1564"><span class="lineNum">    1564</span>                 :<span class="tlaUNC">           0 :             }</span></span>
<span id="L1565"><span class="lineNum">    1565</span>                 :             : </span>
<span id="L1566"><span class="lineNum">    1566</span>                 :             :             // If private keys are enabled, check some things.</span>
<span id="L1567"><span class="lineNum">    1567</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (!wallet.IsWalletFlagSet(WALLET_FLAG_DISABLE_PRIVATE_KEYS)) {</span></span>
<span id="L1568"><span class="lineNum">    1568</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                if (keys.keys.empty()) {</span></span>
<span id="L1569"><span class="lineNum">    1569</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_WALLET_ERROR, &quot;Cannot import descriptor without private keys to a wallet with private keys enabled&quot;);</span></span>
<span id="L1570"><span class="lineNum">    1570</span>                 :             :                }</span>
<span id="L1571"><span class="lineNum">    1571</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                if (!have_all_privkeys) {</span></span>
<span id="L1572"><span class="lineNum">    1572</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                    warnings.push_back(&quot;Not all private keys provided. Some wallet functionality may return unexpected errors&quot;);</span></span>
<span id="L1573"><span class="lineNum">    1573</span>                 :             :                }</span>
<span id="L1574"><span class="lineNum">    1574</span>                 :             :             }</span>
<span id="L1575"><span class="lineNum">    1575</span>                 :             : </span>
<span id="L1576"><span class="lineNum">    1576</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             WalletDescriptor w_desc(std::move(parsed_desc), timestamp, range_start, range_end, next_index);</span></span>
<span id="L1577"><span class="lineNum">    1577</span>                 :             : </span>
<span id="L1578"><span class="lineNum">    1578</span>                 :             :             // Check if the wallet already contains the descriptor</span>
<span id="L1579"><span class="lineNum">    1579</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             auto existing_spk_manager = wallet.GetDescriptorScriptPubKeyMan(w_desc);</span></span>
<span id="L1580"><span class="lineNum">    1580</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (existing_spk_manager) {</span></span>
<span id="L1581"><span class="lineNum">    1581</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!existing_spk_manager-&gt;CanUpdateToWalletDescriptor(w_desc, error)) {</span></span>
<span id="L1582"><span class="lineNum">    1582</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     throw JSONRPCError(RPC_INVALID_PARAMETER, error);</span></span>
<span id="L1583"><span class="lineNum">    1583</span>                 :             :                 }</span>
<span id="L1584"><span class="lineNum">    1584</span>                 :             :             }</span>
<span id="L1585"><span class="lineNum">    1585</span>                 :             : </span>
<span id="L1586"><span class="lineNum">    1586</span>                 :             :             // Add descriptor to the wallet</span>
<span id="L1587"><span class="lineNum">    1587</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             auto spk_manager = wallet.AddWalletDescriptor(w_desc, keys, label, desc_internal);</span></span>
<span id="L1588"><span class="lineNum">    1588</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (spk_manager == nullptr) {</span></span>
<span id="L1589"><span class="lineNum">    1589</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 throw JSONRPCError(RPC_WALLET_ERROR, strprintf(&quot;Could not add descriptor '%s'&quot;, descriptor));</span></span>
<span id="L1590"><span class="lineNum">    1590</span>                 :             :             }</span>
<span id="L1591"><span class="lineNum">    1591</span>                 :             : </span>
<span id="L1592"><span class="lineNum">    1592</span>                 :             :             // Set descriptor as active if necessary</span>
<span id="L1593"><span class="lineNum">    1593</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (active) {</span></span>
<span id="L1594"><span class="lineNum">    1594</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (!w_desc.descriptor-&gt;GetOutputType()) {</span></span>
<span id="L1595"><span class="lineNum">    1595</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     warnings.push_back(&quot;Unknown output type, cannot set descriptor to active.&quot;);</span></span>
<span id="L1596"><span class="lineNum">    1596</span>                 :             :                 } else {</span>
<span id="L1597"><span class="lineNum">    1597</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     wallet.AddActiveScriptPubKeyMan(spk_manager-&gt;GetID(), *w_desc.descriptor-&gt;GetOutputType(), desc_internal);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1598"><span class="lineNum">    1598</span>                 :             :                 }</span>
<span id="L1599"><span class="lineNum">    1599</span>                 :             :             } else {</span>
<span id="L1600"><span class="lineNum">    1600</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 if (w_desc.descriptor-&gt;GetOutputType()) {</span></span>
<span id="L1601"><span class="lineNum">    1601</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     wallet.DeactivateScriptPubKeyMan(spk_manager-&gt;GetID(), *w_desc.descriptor-&gt;GetOutputType(), desc_internal);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1602"><span class="lineNum">    1602</span>                 :             :                 }</span>
<span id="L1603"><span class="lineNum">    1603</span>                 :             :             }</span>
<span id="L1604"><span class="lineNum">    1604</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1605"><span class="lineNum">    1605</span>                 :             : </span>
<span id="L1606"><span class="lineNum">    1606</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;success&quot;, UniValue(true));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1607"><span class="lineNum">    1607</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     } catch (const UniValue&amp; e) {</span></span>
<span id="L1608"><span class="lineNum">    1608</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;success&quot;, UniValue(false));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1609"><span class="lineNum">    1609</span>   [<span class="tlaUNC" title="Branch 0 was not taken"> - </span><span class="tlaUNC" title="Branch 1 was not taken"> - </span><span class="tlaUNC" title="Branch 2 was not taken"> - </span><span class="tlaUNC" title="Branch 3 was not taken"> - </span> :<span class="tlaUNC">           0 :         result.pushKV(&quot;error&quot;, e);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not taken"> - </span><span class="tlaUNC" title="Branch 5 was not taken"> - </span>]
<span id="L1610"><span class="lineNum">    1610</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1611"><span class="lineNum">    1611</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     PushWarnings(warnings, result);</span></span>
<span id="L1612"><span class="lineNum">    1612</span>                 :<span class="tlaUNC">           0 :     return result;</span></span>
<span id="L1613"><span class="lineNum">    1613</span>                 :<span class="tlaUNC">           0 : }</span></span>
<span id="L1614"><span class="lineNum">    1614</span>                 :             : </span>
<span id="L1615"><span class="lineNum">    1615</span>                 :<span class="tlaUNC">           0 : RPCHelpMan importdescriptors()</span></span>
<span id="L1616"><span class="lineNum">    1616</span>                 :             : {</span>
<span id="L1617"><span class="lineNum">    1617</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;importdescriptors&quot;,</span></span>
<span id="L1618"><span class="lineNum">    1618</span>                 :             :                 &quot;\nImport descriptors. This will trigger a rescan of the blockchain based on the earliest timestamp of all descriptors being imported. Requires a new wallet backup.\n&quot;</span>
<span id="L1619"><span class="lineNum">    1619</span>                 :             :             &quot;When importing descriptors with multipath key expressions, if the multipath specifier contains exactly two elements, the descriptor produced from the second elements will be imported as an internal descriptor.\n&quot;</span>
<span id="L1620"><span class="lineNum">    1620</span>                 :             :             &quot;\nNote: This call can take over an hour to complete if using an early timestamp; during that time, other rpc calls\n&quot;</span>
<span id="L1621"><span class="lineNum">    1621</span>                 :             :             &quot;may report that the imported keys, addresses or scripts exist but related transactions are still missing.\n&quot;</span>
<span id="L1622"><span class="lineNum">    1622</span>                 :             :             &quot;The rescan is significantly faster if block filters are available (using startup option \&quot;-blockfilterindex=1\&quot;).\n&quot;,</span>
<span id="L1623"><span class="lineNum">    1623</span>                 :             :                 {</span>
<span id="L1624"><span class="lineNum">    1624</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;requests&quot;, RPCArg::Type::ARR, RPCArg::Optional::NO, &quot;Data to be imported&quot;,</span></span>
<span id="L1625"><span class="lineNum">    1625</span>                 :             :                         {</span>
<span id="L1626"><span class="lineNum">    1626</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                             {&quot;&quot;, RPCArg::Type::OBJ, RPCArg::Optional::OMITTED, &quot;&quot;,</span></span>
<span id="L1627"><span class="lineNum">    1627</span>                 :             :                                 {</span>
<span id="L1628"><span class="lineNum">    1628</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;desc&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;Descriptor to import.&quot;},</span></span>
<span id="L1629"><span class="lineNum">    1629</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;active&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Set this descriptor to be the active descriptor for the corresponding output type/externality&quot;},</span></span>
<span id="L1630"><span class="lineNum">    1630</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;range&quot;, RPCArg::Type::RANGE, RPCArg::Optional::OMITTED, &quot;If a ranged descriptor is used, this specifies the end or the range (in the form [begin,end]) to import&quot;},</span></span>
<span id="L1631"><span class="lineNum">    1631</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;next_index&quot;, RPCArg::Type::NUM, RPCArg::Optional::OMITTED, &quot;If a ranged descriptor is set to active, this specifies the next index to generate addresses from&quot;},</span></span>
<span id="L1632"><span class="lineNum">    1632</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;timestamp&quot;, RPCArg::Type::NUM, RPCArg::Optional::NO, &quot;Time from which to start rescanning the blockchain for this descriptor, in &quot; + UNIX_EPOCH_TIME + &quot;\n&quot;</span></span>
<span id="L1633"><span class="lineNum">    1633</span>                 :             :                                         &quot;Use the string \&quot;now\&quot; to substitute the current synced blockchain time.\n&quot;</span>
<span id="L1634"><span class="lineNum">    1634</span>                 :             :                                         &quot;\&quot;now\&quot; can be specified to bypass scanning, for outputs which are known to never have been used, and\n&quot;</span>
<span id="L1635"><span class="lineNum">    1635</span>                 :             :                                         &quot;0 can be specified to scan the entire blockchain. Blocks up to 2 hours before the earliest timestamp\n&quot;</span>
<span id="L1636"><span class="lineNum">    1636</span>                 :<span class="tlaUNC">           0 :                                         &quot;of all descriptors being imported will be scanned as well as the mempool.&quot;,</span></span>
<span id="L1637"><span class="lineNum">    1637</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                         RPCArgOptions{.type_str={&quot;timestamp | \&quot;now\&quot;&quot;, &quot;integer / string&quot;}}</span></span>
<span id="L1638"><span class="lineNum">    1638</span>                 :             :                                     },</span>
<span id="L1639"><span class="lineNum">    1639</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;internal&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Whether matching outputs should be treated as not incoming payments (e.g. change)&quot;},</span></span>
<span id="L1640"><span class="lineNum">    1640</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                     {&quot;label&quot;, RPCArg::Type::STR, RPCArg::Default{&quot;&quot;}, &quot;Label to assign to the address, only allowed with internal=false. Disabled for ranged descriptors&quot;},</span></span>
<span id="L1641"><span class="lineNum">    1641</span>                 :             :                                 },</span>
<span id="L1642"><span class="lineNum">    1642</span>                 :             :                             },</span>
<span id="L1643"><span class="lineNum">    1643</span>                 :             :                         },</span>
<span id="L1644"><span class="lineNum">    1644</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         RPCArgOptions{.oneline_description=&quot;requests&quot;}},</span></span>
<span id="L1645"><span class="lineNum">    1645</span>                 :             :                 },</span>
<span id="L1646"><span class="lineNum">    1646</span>                 :<span class="tlaUNC">           0 :                 RPCResult{</span></span>
<span id="L1647"><span class="lineNum">    1647</span>                 :             :                     RPCResult::Type::ARR, &quot;&quot;, &quot;Response is an array with the same size as the input that has the execution result&quot;,</span>
<span id="L1648"><span class="lineNum">    1648</span>                 :             :                     {</span>
<span id="L1649"><span class="lineNum">    1649</span>                 :             :                         {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L1650"><span class="lineNum">    1650</span>                 :             :                         {</span>
<span id="L1651"><span class="lineNum">    1651</span>                 :             :                             {RPCResult::Type::BOOL, &quot;success&quot;, &quot;&quot;},</span>
<span id="L1652"><span class="lineNum">    1652</span>                 :             :                             {RPCResult::Type::ARR, &quot;warnings&quot;, /*optional=*/true, &quot;&quot;,</span>
<span id="L1653"><span class="lineNum">    1653</span>                 :             :                             {</span>
<span id="L1654"><span class="lineNum">    1654</span>                 :             :                                 {RPCResult::Type::STR, &quot;&quot;, &quot;&quot;},</span>
<span id="L1655"><span class="lineNum">    1655</span>                 :             :                             }},</span>
<span id="L1656"><span class="lineNum">    1656</span>                 :             :                             {RPCResult::Type::OBJ, &quot;error&quot;, /*optional=*/true, &quot;&quot;,</span>
<span id="L1657"><span class="lineNum">    1657</span>                 :             :                             {</span>
<span id="L1658"><span class="lineNum">    1658</span>                 :             :                                 {RPCResult::Type::ELISION, &quot;&quot;, &quot;JSONRPC error&quot;},</span>
<span id="L1659"><span class="lineNum">    1659</span>                 :             :                             }},</span>
<span id="L1660"><span class="lineNum">    1660</span>                 :             :                         }},</span>
<span id="L1661"><span class="lineNum">    1661</span>                 :             :                     }</span>
<span id="L1662"><span class="lineNum">    1662</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 },</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span><span class="tlaUNC" title="Branch 58 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 59 was not executed"> # </span>]
<span id="L1663"><span class="lineNum">    1663</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L1664"><span class="lineNum">    1664</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;importdescriptors&quot;, &quot;'[{ \&quot;desc\&quot;: \&quot;&lt;my descriptor&gt;\&quot;, \&quot;timestamp\&quot;:1455191478, \&quot;internal\&quot;: true }, &quot;</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1665"><span class="lineNum">    1665</span>                 :<span class="tlaUNC">           0 :                                           &quot;{ \&quot;desc\&quot;: \&quot;&lt;my descriptor 2&gt;\&quot;, \&quot;label\&quot;: \&quot;example 2\&quot;, \&quot;timestamp\&quot;: 1455191480 }]'&quot;) +</span></span>
<span id="L1666"><span class="lineNum">    1666</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;importdescriptors&quot;, &quot;'[{ \&quot;desc\&quot;: \&quot;&lt;my descriptor&gt;\&quot;, \&quot;timestamp\&quot;:1455191478, \&quot;active\&quot;: true, \&quot;range\&quot;: [0,100], \&quot;label\&quot;: \&quot;&lt;my bech32 wallet&gt;\&quot; }]'&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1667"><span class="lineNum">    1667</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L1668"><span class="lineNum">    1668</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; main_request) -&gt; UniValue</span></span>
<span id="L1669"><span class="lineNum">    1669</span>                 :             : {</span>
<span id="L1670"><span class="lineNum">    1670</span>                 :<span class="tlaUNC">           0 :     std::shared_ptr&lt;CWallet&gt; const pwallet = GetWalletForJSONRPCRequest(main_request);</span></span>
<span id="L1671"><span class="lineNum">    1671</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L1672"><span class="lineNum">    1672</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     CWallet&amp; wallet{*pwallet};</span></span>
<span id="L1673"><span class="lineNum">    1673</span>                 :             : </span>
<span id="L1674"><span class="lineNum">    1674</span>                 :             :     // Make sure the results are valid at least up to the most recent block</span>
<span id="L1675"><span class="lineNum">    1675</span>                 :             :     // the user could have gotten from another RPC command prior to now</span>
<span id="L1676"><span class="lineNum">    1676</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     wallet.BlockUntilSyncedToCurrentChain();</span></span>
<span id="L1677"><span class="lineNum">    1677</span>                 :             : </span>
<span id="L1678"><span class="lineNum">    1678</span>                 :             :     //  Make sure wallet is a descriptor wallet</span>
<span id="L1679"><span class="lineNum">    1679</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet-&gt;IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {</span></span>
<span id="L1680"><span class="lineNum">    1680</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;importdescriptors is not available for non-descriptor wallets&quot;);</span></span>
<span id="L1681"><span class="lineNum">    1681</span>                 :             :     }</span>
<span id="L1682"><span class="lineNum">    1682</span>                 :             : </span>
<span id="L1683"><span class="lineNum">    1683</span>                 :<span class="tlaUNC">           0 :     WalletRescanReserver reserver(*pwallet);</span></span>
<span id="L1684"><span class="lineNum">    1684</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!reserver.reserve(/*with_passphrase=*/true)) {</span></span>
<span id="L1685"><span class="lineNum">    1685</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Wallet is currently rescanning. Abort existing rescan or wait.&quot;);</span></span>
<span id="L1686"><span class="lineNum">    1686</span>                 :             :     }</span>
<span id="L1687"><span class="lineNum">    1687</span>                 :             : </span>
<span id="L1688"><span class="lineNum">    1688</span>                 :             :     // Ensure that the wallet is not locked for the remainder of this RPC, as</span>
<span id="L1689"><span class="lineNum">    1689</span>                 :             :     // the passphrase is used to top up the keypool.</span>
<span id="L1690"><span class="lineNum">    1690</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(pwallet-&gt;m_relock_mutex);</span></span>
<span id="L1691"><span class="lineNum">    1691</span>                 :             : </span>
<span id="L1692"><span class="lineNum">    1692</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const UniValue&amp; requests = main_request.params[0];</span></span>
<span id="L1693"><span class="lineNum">    1693</span>                 :<span class="tlaUNC">           0 :     const int64_t minimum_timestamp = 1;</span></span>
<span id="L1694"><span class="lineNum">    1694</span>                 :<span class="tlaUNC">           0 :     int64_t now = 0;</span></span>
<span id="L1695"><span class="lineNum">    1695</span>                 :<span class="tlaUNC">           0 :     int64_t lowest_timestamp = 0;</span></span>
<span id="L1696"><span class="lineNum">    1696</span>                 :<span class="tlaUNC">           0 :     bool rescan = false;</span></span>
<span id="L1697"><span class="lineNum">    1697</span>                 :<span class="tlaUNC">           0 :     UniValue response(UniValue::VARR);</span></span>
<span id="L1698"><span class="lineNum">    1698</span>                 :<span class="tlaUNC">           0 :     {</span></span>
<span id="L1699"><span class="lineNum">    1699</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L1700"><span class="lineNum">    1700</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         EnsureWalletIsUnlocked(*pwallet);</span></span>
<span id="L1701"><span class="lineNum">    1701</span>                 :             : </span>
<span id="L1702"><span class="lineNum">    1702</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         CHECK_NONFATAL(pwallet-&gt;chain().findBlock(pwallet-&gt;GetLastBlockHash(), FoundBlock().time(lowest_timestamp).mtpTime(now)));</span></span>
<span id="L1703"><span class="lineNum">    1703</span>                 :             : </span>
<span id="L1704"><span class="lineNum">    1704</span>                 :             :         // Get all timestamps and extract the lowest timestamp</span>
<span id="L1705"><span class="lineNum">    1705</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         for (const UniValue&amp; request : requests.getValues()) {</span></span>
<span id="L1706"><span class="lineNum">    1706</span>                 :             :             // This throws an error if &quot;timestamp&quot; doesn't exist</span>
<span id="L1707"><span class="lineNum">    1707</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const int64_t timestamp = std::max(GetImportTimestamp(request, now), minimum_timestamp);</span></span>
<span id="L1708"><span class="lineNum">    1708</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             const UniValue result = ProcessDescriptorImport(*pwallet, request, timestamp);</span></span>
<span id="L1709"><span class="lineNum">    1709</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.push_back(result);</span></span>
<span id="L1710"><span class="lineNum">    1710</span>                 :             : </span>
<span id="L1711"><span class="lineNum">    1711</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             if (lowest_timestamp &gt; timestamp ) {</span></span>
<span id="L1712"><span class="lineNum">    1712</span>                 :<span class="tlaUNC">           0 :                 lowest_timestamp = timestamp;</span></span>
<span id="L1713"><span class="lineNum">    1713</span>                 :             :             }</span>
<span id="L1714"><span class="lineNum">    1714</span>                 :             : </span>
<span id="L1715"><span class="lineNum">    1715</span>                 :             :             // If we know the chain tip, and at least one request was successful then allow rescan</span>
<span id="L1716"><span class="lineNum">    1716</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             if (!rescan &amp;&amp; result[&quot;success&quot;].get_bool()) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L1717"><span class="lineNum">    1717</span>                 :<span class="tlaUNC">           0 :                 rescan = true;</span></span>
<span id="L1718"><span class="lineNum">    1718</span>                 :             :             }</span>
<span id="L1719"><span class="lineNum">    1719</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1720"><span class="lineNum">    1720</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ConnectScriptPubKeyManNotifiers();</span></span>
<span id="L1721"><span class="lineNum">    1721</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1722"><span class="lineNum">    1722</span>                 :             : </span>
<span id="L1723"><span class="lineNum">    1723</span>                 :             :     // Rescan the blockchain using the lowest timestamp</span>
<span id="L1724"><span class="lineNum">    1724</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (rescan) {</span></span>
<span id="L1725"><span class="lineNum">    1725</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         int64_t scanned_time = pwallet-&gt;RescanFromTime(lowest_timestamp, reserver, /*update=*/true);</span></span>
<span id="L1726"><span class="lineNum">    1726</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         pwallet-&gt;ResubmitWalletTransactions(/*relay=*/false, /*force=*/true);</span></span>
<span id="L1727"><span class="lineNum">    1727</span>                 :             : </span>
<span id="L1728"><span class="lineNum">    1728</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (pwallet-&gt;IsAbortingRescan()) {</span></span>
<span id="L1729"><span class="lineNum">    1729</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_MISC_ERROR, &quot;Rescan aborted by user.&quot;);</span></span>
<span id="L1730"><span class="lineNum">    1730</span>                 :             :         }</span>
<span id="L1731"><span class="lineNum">    1731</span>                 :             : </span>
<span id="L1732"><span class="lineNum">    1732</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (scanned_time &gt; lowest_timestamp) {</span></span>
<span id="L1733"><span class="lineNum">    1733</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             std::vector&lt;UniValue&gt; results = response.getValues();</span></span>
<span id="L1734"><span class="lineNum">    1734</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.clear();</span></span>
<span id="L1735"><span class="lineNum">    1735</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             response.setArray();</span></span>
<span id="L1736"><span class="lineNum">    1736</span>                 :             : </span>
<span id="L1737"><span class="lineNum">    1737</span>                 :             :             // Compose the response</span>
<span id="L1738"><span class="lineNum">    1738</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             for (unsigned int i = 0; i &lt; requests.size(); ++i) {</span></span>
<span id="L1739"><span class="lineNum">    1739</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 const UniValue&amp; request = requests.getValues().at(i);</span></span>
<span id="L1740"><span class="lineNum">    1740</span>                 :             : </span>
<span id="L1741"><span class="lineNum">    1741</span>                 :             :                 // If the descriptor timestamp is within the successfully scanned</span>
<span id="L1742"><span class="lineNum">    1742</span>                 :             :                 // range, or if the import result already has an error set, let</span>
<span id="L1743"><span class="lineNum">    1743</span>                 :             :                 // the result stand unmodified. Otherwise replace the result</span>
<span id="L1744"><span class="lineNum">    1744</span>                 :             :                 // with an error message.</span>
<span id="L1745"><span class="lineNum">    1745</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 if (scanned_time &lt;= GetImportTimestamp(request, now) || results.at(i).exists(&quot;error&quot;)) {</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1746"><span class="lineNum">    1746</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     response.push_back(results.at(i));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1747"><span class="lineNum">    1747</span>                 :             :                 } else {</span>
<span id="L1748"><span class="lineNum">    1748</span>                 :<span class="tlaUNC">           0 :                     UniValue result = UniValue(UniValue::VOBJ);</span></span>
<span id="L1749"><span class="lineNum">    1749</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     result.pushKV(&quot;success&quot;, UniValue(false));</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1750"><span class="lineNum">    1750</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     result.pushKV(</span></span>
<span id="L1751"><span class="lineNum">    1751</span>                 :             :                         &quot;error&quot;,</span>
<span id="L1752"><span class="lineNum">    1752</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                         JSONRPCError(</span></span>
<span id="L1753"><span class="lineNum">    1753</span>                 :             :                             RPC_MISC_ERROR,</span>
<span id="L1754"><span class="lineNum">    1754</span>                 :<span class="tlaUNC">           0 :                             strprintf(&quot;Rescan failed for descriptor with timestamp %d. There was an error reading a &quot;</span></span>
<span id="L1755"><span class="lineNum">    1755</span>                 :             :                                       &quot;block from time %d, which is after or within %d seconds of key creation, and &quot;</span>
<span id="L1756"><span class="lineNum">    1756</span>                 :             :                                       &quot;could contain transactions pertaining to the desc. As a result, transactions &quot;</span>
<span id="L1757"><span class="lineNum">    1757</span>                 :             :                                       &quot;and coins using this desc may not appear in the wallet. This error could be &quot;</span>
<span id="L1758"><span class="lineNum">    1758</span>                 :             :                                       &quot;caused by pruning or data corruption (see bitcoind log for details) and could &quot;</span>
<span id="L1759"><span class="lineNum">    1759</span>                 :             :                                       &quot;be dealt with by downloading and rescanning the relevant blocks (see -reindex &quot;</span>
<span id="L1760"><span class="lineNum">    1760</span>                 :             :                                       &quot;option and rescanblockchain RPC).&quot;,</span>
<span id="L1761"><span class="lineNum">    1761</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :                                 GetImportTimestamp(request, now), scanned_time - TIMESTAMP_WINDOW - 1, TIMESTAMP_WINDOW)));</span></span>
<span id="L1762"><span class="lineNum">    1762</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     response.push_back(std::move(result));</span></span>
<span id="L1763"><span class="lineNum">    1763</span>                 :<span class="tlaUNC">           0 :                 }</span></span>
<span id="L1764"><span class="lineNum">    1764</span>                 :             :             }</span>
<span id="L1765"><span class="lineNum">    1765</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1766"><span class="lineNum">    1766</span>                 :             :     }</span>
<span id="L1767"><span class="lineNum">    1767</span>                 :             : </span>
<span id="L1768"><span class="lineNum">    1768</span>                 :<span class="tlaUNC">           0 :     return response;</span></span>
<span id="L1769"><span class="lineNum">    1769</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L1770"><span class="lineNum">    1770</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span><span class="tlaUNC" title="Branch 58 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 59 was not executed"> # </span>]
<span id="L1771"><span class="lineNum">    1771</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span>]
<span id="L1772"><span class="lineNum">    1772</span>                 :             : </span>
<span id="L1773"><span class="lineNum">    1773</span>                 :<span class="tlaUNC">           0 : RPCHelpMan listdescriptors()</span></span>
<span id="L1774"><span class="lineNum">    1774</span>                 :             : {</span>
<span id="L1775"><span class="lineNum">    1775</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{</span></span>
<span id="L1776"><span class="lineNum">    1776</span>                 :             :         &quot;listdescriptors&quot;,</span>
<span id="L1777"><span class="lineNum">    1777</span>                 :             :         &quot;\nList descriptors imported into a descriptor-enabled wallet.\n&quot;,</span>
<span id="L1778"><span class="lineNum">    1778</span>                 :             :         {</span>
<span id="L1779"><span class="lineNum">    1779</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             {&quot;private&quot;, RPCArg::Type::BOOL, RPCArg::Default{false}, &quot;Show private descriptors.&quot;}</span></span>
<span id="L1780"><span class="lineNum">    1780</span>                 :             :         },</span>
<span id="L1781"><span class="lineNum">    1781</span>                 :<span class="tlaUNC">           0 :         RPCResult{RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span></span>
<span id="L1782"><span class="lineNum">    1782</span>                 :             :             {RPCResult::Type::STR, &quot;wallet_name&quot;, &quot;Name of wallet this operation was performed on&quot;},</span>
<span id="L1783"><span class="lineNum">    1783</span>                 :             :             {RPCResult::Type::ARR, &quot;descriptors&quot;, &quot;Array of descriptor objects (sorted by descriptor string representation)&quot;,</span>
<span id="L1784"><span class="lineNum">    1784</span>                 :             :             {</span>
<span id="L1785"><span class="lineNum">    1785</span>                 :             :                 {RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;, {</span>
<span id="L1786"><span class="lineNum">    1786</span>                 :             :                     {RPCResult::Type::STR, &quot;desc&quot;, &quot;Descriptor string representation&quot;},</span>
<span id="L1787"><span class="lineNum">    1787</span>                 :             :                     {RPCResult::Type::NUM, &quot;timestamp&quot;, &quot;The creation time of the descriptor&quot;},</span>
<span id="L1788"><span class="lineNum">    1788</span>                 :             :                     {RPCResult::Type::BOOL, &quot;active&quot;, &quot;Whether this descriptor is currently used to generate new addresses&quot;},</span>
<span id="L1789"><span class="lineNum">    1789</span>                 :             :                     {RPCResult::Type::BOOL, &quot;internal&quot;, /*optional=*/true, &quot;True if this descriptor is used to generate change addresses. False if this descriptor is used to generate receiving addresses; defined only for active descriptors&quot;},</span>
<span id="L1790"><span class="lineNum">    1790</span>                 :             :                     {RPCResult::Type::ARR_FIXED, &quot;range&quot;, /*optional=*/true, &quot;Defined only for ranged descriptors&quot;, {</span>
<span id="L1791"><span class="lineNum">    1791</span>                 :             :                         {RPCResult::Type::NUM, &quot;&quot;, &quot;Range start inclusive&quot;},</span>
<span id="L1792"><span class="lineNum">    1792</span>                 :             :                         {RPCResult::Type::NUM, &quot;&quot;, &quot;Range end inclusive&quot;},</span>
<span id="L1793"><span class="lineNum">    1793</span>                 :             :                     }},</span>
<span id="L1794"><span class="lineNum">    1794</span>                 :             :                     {RPCResult::Type::NUM, &quot;next&quot;, /*optional=*/true, &quot;Same as next_index field. Kept for compatibility reason.&quot;},</span>
<span id="L1795"><span class="lineNum">    1795</span>                 :             :                     {RPCResult::Type::NUM, &quot;next_index&quot;, /*optional=*/true, &quot;The next index to generate addresses from; defined only for ranged descriptors&quot;},</span>
<span id="L1796"><span class="lineNum">    1796</span>                 :             :                 }},</span>
<span id="L1797"><span class="lineNum">    1797</span>                 :             :             }}</span>
<span id="L1798"><span class="lineNum">    1798</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         }},</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span><span class="tlaUNC" title="Branch 36 was not executed"> # </span><span class="tlaUNC" title="Branch 37 was not executed"> # </span><span class="tlaUNC" title="Branch 38 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 39 was not executed"> # </span><span class="tlaUNC" title="Branch 40 was not executed"> # </span><span class="tlaUNC" title="Branch 41 was not executed"> # </span><span class="tlaUNC" title="Branch 42 was not executed"> # </span><span class="tlaUNC" title="Branch 43 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 44 was not executed"> # </span><span class="tlaUNC" title="Branch 45 was not executed"> # </span><span class="tlaUNC" title="Branch 46 was not executed"> # </span><span class="tlaUNC" title="Branch 47 was not executed"> # </span><span class="tlaUNC" title="Branch 48 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 49 was not executed"> # </span><span class="tlaUNC" title="Branch 50 was not executed"> # </span><span class="tlaUNC" title="Branch 51 was not executed"> # </span><span class="tlaUNC" title="Branch 52 was not executed"> # </span><span class="tlaUNC" title="Branch 53 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 54 was not executed"> # </span><span class="tlaUNC" title="Branch 55 was not executed"> # </span><span class="tlaUNC" title="Branch 56 was not executed"> # </span><span class="tlaUNC" title="Branch 57 was not executed"> # </span><span class="tlaUNC" title="Branch 58 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 59 was not executed"> # </span><span class="tlaUNC" title="Branch 60 was not executed"> # </span><span class="tlaUNC" title="Branch 61 was not executed"> # </span><span class="tlaUNC" title="Branch 62 was not executed"> # </span><span class="tlaUNC" title="Branch 63 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 64 was not executed"> # </span><span class="tlaUNC" title="Branch 65 was not executed"> # </span><span class="tlaUNC" title="Branch 66 was not executed"> # </span><span class="tlaUNC" title="Branch 67 was not executed"> # </span><span class="tlaUNC" title="Branch 68 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 69 was not executed"> # </span><span class="tlaUNC" title="Branch 70 was not executed"> # </span><span class="tlaUNC" title="Branch 71 was not executed"> # </span><span class="tlaUNC" title="Branch 72 was not executed"> # </span><span class="tlaUNC" title="Branch 73 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 74 was not executed"> # </span><span class="tlaUNC" title="Branch 75 was not executed"> # </span><span class="tlaUNC" title="Branch 76 was not executed"> # </span><span class="tlaUNC" title="Branch 77 was not executed"> # </span><span class="tlaUNC" title="Branch 78 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 79 was not executed"> # </span><span class="tlaUNC" title="Branch 80 was not executed"> # </span><span class="tlaUNC" title="Branch 81 was not executed"> # </span><span class="tlaUNC" title="Branch 82 was not executed"> # </span><span class="tlaUNC" title="Branch 83 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 84 was not executed"> # </span><span class="tlaUNC" title="Branch 85 was not executed"> # </span><span class="tlaUNC" title="Branch 86 was not executed"> # </span><span class="tlaUNC" title="Branch 87 was not executed"> # </span><span class="tlaUNC" title="Branch 88 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 89 was not executed"> # </span><span class="tlaUNC" title="Branch 90 was not executed"> # </span><span class="tlaUNC" title="Branch 91 was not executed"> # </span><span class="tlaUNC" title="Branch 92 was not executed"> # </span><span class="tlaUNC" title="Branch 93 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 94 was not executed"> # </span><span class="tlaUNC" title="Branch 95 was not executed"> # </span>]
<span id="L1799"><span class="lineNum">    1799</span>                 :<span class="tlaUNC">           0 :         RPCExamples{</span></span>
<span id="L1800"><span class="lineNum">    1800</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             HelpExampleCli(&quot;listdescriptors&quot;, &quot;&quot;) + HelpExampleRpc(&quot;listdescriptors&quot;, &quot;&quot;)</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 13 was not executed"> # </span>]
<span id="L1801"><span class="lineNum">    1801</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCli(&quot;listdescriptors&quot;, &quot;true&quot;) + HelpExampleRpc(&quot;listdescriptors&quot;, &quot;true&quot;)</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1802"><span class="lineNum">    1802</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         },</span></span>
<span id="L1803"><span class="lineNum">    1803</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1804"><span class="lineNum">    1804</span>                 :             : {</span>
<span id="L1805"><span class="lineNum">    1805</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::shared_ptr&lt;const CWallet&gt; wallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L1806"><span class="lineNum">    1806</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!wallet) return UniValue::VNULL;</span></span>
<span id="L1807"><span class="lineNum">    1807</span>                 :             : </span>
<span id="L1808"><span class="lineNum">    1808</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!wallet-&gt;IsWalletFlagSet(WALLET_FLAG_DESCRIPTORS)) {</span></span>
<span id="L1809"><span class="lineNum">    1809</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;listdescriptors is not available for non-descriptor wallets&quot;);</span></span>
<span id="L1810"><span class="lineNum">    1810</span>                 :             :     }</span>
<span id="L1811"><span class="lineNum">    1811</span>                 :             : </span>
<span id="L1812"><span class="lineNum">    1812</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     const bool priv = !request.params[0].isNull() &amp;&amp; request.params[0].get_bool();</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 9 was not executed"> # </span>]
<span id="L1813"><span class="lineNum">    1813</span>                 :<span class="tlaUNC">           0 :     if (priv) {</span></span>
<span id="L1814"><span class="lineNum">    1814</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         EnsureWalletIsUnlocked(*wallet);</span></span>
<span id="L1815"><span class="lineNum">    1815</span>                 :             :     }</span>
<span id="L1816"><span class="lineNum">    1816</span>                 :             : </span>
<span id="L1817"><span class="lineNum">    1817</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(wallet-&gt;cs_wallet);</span></span>
<span id="L1818"><span class="lineNum">    1818</span>                 :             : </span>
<span id="L1819"><span class="lineNum">    1819</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const auto active_spk_mans = wallet-&gt;GetActiveScriptPubKeyMans();</span></span>
<span id="L1820"><span class="lineNum">    1820</span>                 :             : </span>
<span id="L1821"><span class="lineNum">    1821</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     struct WalletDescInfo {</span></span>
<span id="L1822"><span class="lineNum">    1822</span>                 :             :         std::string descriptor;</span>
<span id="L1823"><span class="lineNum">    1823</span>                 :             :         uint64_t creation_time;</span>
<span id="L1824"><span class="lineNum">    1824</span>                 :             :         bool active;</span>
<span id="L1825"><span class="lineNum">    1825</span>                 :             :         std::optional&lt;bool&gt; internal;</span>
<span id="L1826"><span class="lineNum">    1826</span>                 :             :         std::optional&lt;std::pair&lt;int64_t,int64_t&gt;&gt; range;</span>
<span id="L1827"><span class="lineNum">    1827</span>                 :             :         int64_t next_index;</span>
<span id="L1828"><span class="lineNum">    1828</span>                 :             :     };</span>
<span id="L1829"><span class="lineNum">    1829</span>                 :             : </span>
<span id="L1830"><span class="lineNum">    1830</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;WalletDescInfo&gt; wallet_descriptors;</span></span>
<span id="L1831"><span class="lineNum">    1831</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const auto&amp; spk_man : wallet-&gt;GetAllScriptPubKeyMans()) {</span></span>
<span id="L1832"><span class="lineNum">    1832</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto desc_spk_man = dynamic_cast&lt;DescriptorScriptPubKeyMan*&gt;(spk_man);</span></span>
<span id="L1833"><span class="lineNum">    1833</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!desc_spk_man) {</span></span>
<span id="L1834"><span class="lineNum">    1834</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Unexpected ScriptPubKey manager type.&quot;);</span></span>
<span id="L1835"><span class="lineNum">    1835</span>                 :             :         }</span>
<span id="L1836"><span class="lineNum">    1836</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         LOCK(desc_spk_man-&gt;cs_desc_man);</span></span>
<span id="L1837"><span class="lineNum">    1837</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const auto&amp; wallet_descriptor = desc_spk_man-&gt;GetWalletDescriptor();</span></span>
<span id="L1838"><span class="lineNum">    1838</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         std::string descriptor;</span></span>
<span id="L1839"><span class="lineNum">    1839</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (!desc_spk_man-&gt;GetDescriptorString(descriptor, priv)) {</span></span>
<span id="L1840"><span class="lineNum">    1840</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             throw JSONRPCError(RPC_WALLET_ERROR, &quot;Can't get descriptor string.&quot;);</span></span>
<span id="L1841"><span class="lineNum">    1841</span>                 :             :         }</span>
<span id="L1842"><span class="lineNum">    1842</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         const bool is_range = wallet_descriptor.descriptor-&gt;IsRange();</span></span>
<span id="L1843"><span class="lineNum">    1843</span>                 :<span class="tlaUNC">           0 :         wallet_descriptors.push_back({</span></span>
<span id="L1844"><span class="lineNum">    1844</span>                 :             :             descriptor,</span>
<span id="L1845"><span class="lineNum">    1845</span>                 :<span class="tlaUNC">           0 :             wallet_descriptor.creation_time,</span></span>
<span id="L1846"><span class="lineNum">    1846</span>                 :<span class="tlaUNC">           0 :             active_spk_mans.count(desc_spk_man) != 0,</span></span>
<span id="L1847"><span class="lineNum">    1847</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             wallet-&gt;IsInternalScriptPubKeyMan(desc_spk_man),</span></span>
<span id="L1848"><span class="lineNum">    1848</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             is_range ? std::optional(std::make_pair(wallet_descriptor.range_start, wallet_descriptor.range_end)) : std::nullopt,</span></span>
<span id="L1849"><span class="lineNum">    1849</span>                 :<span class="tlaUNC">           0 :             wallet_descriptor.next_index</span></span>
<span id="L1850"><span class="lineNum">    1850</span>                 :             :         });</span>
<span id="L1851"><span class="lineNum">    1851</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     }</span></span>
<span id="L1852"><span class="lineNum">    1852</span>                 :             : </span>
<span id="L1853"><span class="lineNum">    1853</span>                 :<span class="tlaUNC">           0 :     std::sort(wallet_descriptors.begin(), wallet_descriptors.end(), [](const auto&amp; a, const auto&amp; b) {</span></span>
<span id="L1854"><span class="lineNum">    1854</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         return a.descriptor &lt; b.descriptor;</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not executed"> # </span>]
<span id="L1855"><span class="lineNum">    1855</span>                 :             :     });</span>
<span id="L1856"><span class="lineNum">    1856</span>                 :             : </span>
<span id="L1857"><span class="lineNum">    1857</span>                 :<span class="tlaUNC">           0 :     UniValue descriptors(UniValue::VARR);</span></span>
<span id="L1858"><span class="lineNum">    1858</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     for (const WalletDescInfo&amp; info : wallet_descriptors) {</span></span>
<span id="L1859"><span class="lineNum">    1859</span>                 :<span class="tlaUNC">           0 :         UniValue spk(UniValue::VOBJ);</span></span>
<span id="L1860"><span class="lineNum">    1860</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         spk.pushKV(&quot;desc&quot;, info.descriptor);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1861"><span class="lineNum">    1861</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         spk.pushKV(&quot;timestamp&quot;, info.creation_time);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1862"><span class="lineNum">    1862</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         spk.pushKV(&quot;active&quot;, info.active);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1863"><span class="lineNum">    1863</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (info.internal.has_value()) {</span></span>
<span id="L1864"><span class="lineNum">    1864</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             spk.pushKV(&quot;internal&quot;, info.internal.value());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1865"><span class="lineNum">    1865</span>                 :             :         }</span>
<span id="L1866"><span class="lineNum">    1866</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         if (info.range.has_value()) {</span></span>
<span id="L1867"><span class="lineNum">    1867</span>                 :<span class="tlaUNC">           0 :             UniValue range(UniValue::VARR);</span></span>
<span id="L1868"><span class="lineNum">    1868</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             range.push_back(info.range-&gt;first);</span></span>
<span id="L1869"><span class="lineNum">    1869</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             range.push_back(info.range-&gt;second - 1);</span></span>
<span id="L1870"><span class="lineNum">    1870</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :             spk.pushKV(&quot;range&quot;, std::move(range));</span></span>
<span id="L1871"><span class="lineNum">    1871</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             spk.pushKV(&quot;next&quot;, info.next_index);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1872"><span class="lineNum">    1872</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             spk.pushKV(&quot;next_index&quot;, info.next_index);</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1873"><span class="lineNum">    1873</span>                 :<span class="tlaUNC">           0 :         }</span></span>
<span id="L1874"><span class="lineNum">    1874</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         descriptors.push_back(std::move(spk));</span></span>
<span id="L1875"><span class="lineNum">    1875</span>                 :<span class="tlaUNC">           0 :     }</span></span>
<span id="L1876"><span class="lineNum">    1876</span>                 :             : </span>
<span id="L1877"><span class="lineNum">    1877</span>                 :<span class="tlaUNC">           0 :     UniValue response(UniValue::VOBJ);</span></span>
<span id="L1878"><span class="lineNum">    1878</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     response.pushKV(&quot;wallet_name&quot;, wallet-&gt;GetName());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1879"><span class="lineNum">    1879</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     response.pushKV(&quot;descriptors&quot;, std::move(descriptors));</span></span>
<span id="L1880"><span class="lineNum">    1880</span>                 :             : </span>
<span id="L1881"><span class="lineNum">    1881</span>                 :<span class="tlaUNC">           0 :     return response;</span></span>
<span id="L1882"><span class="lineNum">    1882</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : },</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1883"><span class="lineNum">    1883</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1884"><span class="lineNum">    1884</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span>]
<span id="L1885"><span class="lineNum">    1885</span>                 :             : </span>
<span id="L1886"><span class="lineNum">    1886</span>                 :<span class="tlaUNC">           0 : RPCHelpMan backupwallet()</span></span>
<span id="L1887"><span class="lineNum">    1887</span>                 :             : {</span>
<span id="L1888"><span class="lineNum">    1888</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{&quot;backupwallet&quot;,</span></span>
<span id="L1889"><span class="lineNum">    1889</span>                 :             :                 &quot;\nSafely copies the current wallet file to the specified destination, which can either be a directory or a path with a filename.\n&quot;,</span>
<span id="L1890"><span class="lineNum">    1890</span>                 :             :                 {</span>
<span id="L1891"><span class="lineNum">    1891</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                     {&quot;destination&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The destination directory or file&quot;},</span></span>
<span id="L1892"><span class="lineNum">    1892</span>                 :             :                 },</span>
<span id="L1893"><span class="lineNum">    1893</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                 RPCResult{RPCResult::Type::NONE, &quot;&quot;, &quot;&quot;},</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1894"><span class="lineNum">    1894</span>                 :<span class="tlaUNC">           0 :                 RPCExamples{</span></span>
<span id="L1895"><span class="lineNum">    1895</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :                     HelpExampleCli(&quot;backupwallet&quot;, &quot;\&quot;backup.dat\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1896"><span class="lineNum">    1896</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;backupwallet&quot;, &quot;\&quot;backup.dat\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1897"><span class="lineNum">    1897</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :                 },</span></span>
<span id="L1898"><span class="lineNum">    1898</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1899"><span class="lineNum">    1899</span>                 :             : {</span>
<span id="L1900"><span class="lineNum">    1900</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::shared_ptr&lt;const CWallet&gt; pwallet = GetWalletForJSONRPCRequest(request);</span></span>
<span id="L1901"><span class="lineNum">    1901</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet) return UniValue::VNULL;</span></span>
<span id="L1902"><span class="lineNum">    1902</span>                 :             : </span>
<span id="L1903"><span class="lineNum">    1903</span>                 :             :     // Make sure the results are valid at least up to the most recent block</span>
<span id="L1904"><span class="lineNum">    1904</span>                 :             :     // the user could have gotten from another RPC command prior to now</span>
<span id="L1905"><span class="lineNum">    1905</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     pwallet-&gt;BlockUntilSyncedToCurrentChain();</span></span>
<span id="L1906"><span class="lineNum">    1906</span>                 :             : </span>
<span id="L1907"><span class="lineNum">    1907</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     LOCK(pwallet-&gt;cs_wallet);</span></span>
<span id="L1908"><span class="lineNum">    1908</span>                 :             : </span>
<span id="L1909"><span class="lineNum">    1909</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     std::string strDest = request.params[0].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1910"><span class="lineNum">    1910</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     if (!pwallet-&gt;BackupWallet(strDest)) {</span></span>
<span id="L1911"><span class="lineNum">    1911</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :         throw JSONRPCError(RPC_WALLET_ERROR, &quot;Error: Wallet backup failed!&quot;);</span></span>
<span id="L1912"><span class="lineNum">    1912</span>                 :             :     }</span>
<span id="L1913"><span class="lineNum">    1913</span>                 :             : </span>
<span id="L1914"><span class="lineNum">    1914</span>                 :<span class="tlaUNC">           0 :     return UniValue::VNULL;</span></span>
<span id="L1915"><span class="lineNum">    1915</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 : },</span></span>
<span id="L1916"><span class="lineNum">    1916</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span>]
<span id="L1917"><span class="lineNum">    1917</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 : }</span></span>
<span id="L1918"><span class="lineNum">    1918</span>                 :             : </span>
<span id="L1919"><span class="lineNum">    1919</span>                 :             : </span>
<span id="L1920"><span class="lineNum">    1920</span>                 :<span class="tlaUNC">           0 : RPCHelpMan restorewallet()</span></span>
<span id="L1921"><span class="lineNum">    1921</span>                 :             : {</span>
<span id="L1922"><span class="lineNum">    1922</span>                 :<span class="tlaUNC">           0 :     return RPCHelpMan{</span></span>
<span id="L1923"><span class="lineNum">    1923</span>                 :             :         &quot;restorewallet&quot;,</span>
<span id="L1924"><span class="lineNum">    1924</span>                 :             :         &quot;\nRestores and loads a wallet from backup.\n&quot;</span>
<span id="L1925"><span class="lineNum">    1925</span>                 :             :         &quot;\nThe rescan is significantly faster if a descriptor wallet is restored&quot;</span>
<span id="L1926"><span class="lineNum">    1926</span>                 :             :         &quot;\nand block filters are available (using startup option \&quot;-blockfilterindex=1\&quot;).\n&quot;,</span>
<span id="L1927"><span class="lineNum">    1927</span>                 :             :         {</span>
<span id="L1928"><span class="lineNum">    1928</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             {&quot;wallet_name&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The name that will be applied to the restored wallet&quot;},</span></span>
<span id="L1929"><span class="lineNum">    1929</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             {&quot;backup_file&quot;, RPCArg::Type::STR, RPCArg::Optional::NO, &quot;The backup file that will be used to restore the wallet.&quot;},</span></span>
<span id="L1930"><span class="lineNum">    1930</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :             {&quot;load_on_startup&quot;, RPCArg::Type::BOOL, RPCArg::Optional::OMITTED, &quot;Save wallet name to persistent settings and load on startup. True to add wallet to startup list, false to remove, null to leave unchanged.&quot;},</span></span>
<span id="L1931"><span class="lineNum">    1931</span>                 :             :         },</span>
<span id="L1932"><span class="lineNum">    1932</span>                 :<span class="tlaUNC">           0 :         RPCResult{</span></span>
<span id="L1933"><span class="lineNum">    1933</span>                 :             :             RPCResult::Type::OBJ, &quot;&quot;, &quot;&quot;,</span>
<span id="L1934"><span class="lineNum">    1934</span>                 :             :             {</span>
<span id="L1935"><span class="lineNum">    1935</span>                 :             :                 {RPCResult::Type::STR, &quot;name&quot;, &quot;The wallet name if restored successfully.&quot;},</span>
<span id="L1936"><span class="lineNum">    1936</span>                 :             :                 {RPCResult::Type::ARR, &quot;warnings&quot;, /*optional=*/true, &quot;Warning messages, if any, related to restoring and loading the wallet.&quot;,</span>
<span id="L1937"><span class="lineNum">    1937</span>                 :             :                 {</span>
<span id="L1938"><span class="lineNum">    1938</span>                 :             :                     {RPCResult::Type::STR, &quot;&quot;, &quot;&quot;},</span>
<span id="L1939"><span class="lineNum">    1939</span>                 :             :                 }},</span>
<span id="L1940"><span class="lineNum">    1940</span>                 :             :             }</span>
<span id="L1941"><span class="lineNum">    1941</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :         },</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 33 was not executed"> # </span>]
<span id="L1942"><span class="lineNum">    1942</span>                 :<span class="tlaUNC">           0 :         RPCExamples{</span></span>
<span id="L1943"><span class="lineNum">    1943</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             HelpExampleCli(&quot;restorewallet&quot;, &quot;\&quot;testwallet\&quot; \&quot;home\\backups\\backup-file.bak\&quot;&quot;)</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1944"><span class="lineNum">    1944</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpc(&quot;restorewallet&quot;, &quot;\&quot;testwallet\&quot; \&quot;home\\backups\\backup-file.bak\&quot;&quot;)</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1945"><span class="lineNum">    1945</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleCliNamed(&quot;restorewallet&quot;, {{&quot;wallet_name&quot;, &quot;testwallet&quot;}, {&quot;backup_file&quot;, &quot;home\\backups\\backup-file.bak\&quot;&quot;}, {&quot;load_on_startup&quot;, true}})</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L1946"><span class="lineNum">    1946</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :             + HelpExampleRpcNamed(&quot;restorewallet&quot;, {{&quot;wallet_name&quot;, &quot;testwallet&quot;}, {&quot;backup_file&quot;, &quot;home\\backups\\backup-file.bak\&quot;&quot;}, {&quot;load_on_startup&quot;, true}})</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span>       <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span>]
<span id="L1947"><span class="lineNum">    1947</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :         },</span></span>
<span id="L1948"><span class="lineNum">    1948</span>                 :<span class="tlaUNC">           0 :         [&amp;](const RPCHelpMan&amp; self, const JSONRPCRequest&amp; request) -&gt; UniValue</span></span>
<span id="L1949"><span class="lineNum">    1949</span>                 :             : {</span>
<span id="L1950"><span class="lineNum">    1950</span>                 :             : </span>
<span id="L1951"><span class="lineNum">    1951</span>                 :<span class="tlaUNC">           0 :     WalletContext&amp; context = EnsureWalletContext(request.context);</span></span>
<span id="L1952"><span class="lineNum">    1952</span>                 :             : </span>
<span id="L1953"><span class="lineNum">    1953</span>                 :<span class="tlaUNC">           0 :     auto backup_file = fs::u8path(request.params[1].get_str());</span></span>
<span id="L1954"><span class="lineNum">    1954</span>                 :             : </span>
<span id="L1955"><span class="lineNum">    1955</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     std::string wallet_name = request.params[0].get_str();</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1956"><span class="lineNum">    1956</span>                 :             : </span>
<span id="L1957"><span class="lineNum">    1957</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     std::optional&lt;bool&gt; load_on_start = request.params[2].isNull() ? std::nullopt : std::optional&lt;bool&gt;(request.params[2].get_bool());</span></span>
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span>]
<span id="L1958"><span class="lineNum">    1958</span>                 :             : </span>
<span id="L1959"><span class="lineNum">    1959</span>                 :<span class="tlaUNC">           0 :     DatabaseStatus status;</span></span>
<span id="L1960"><span class="lineNum">    1960</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     bilingual_str error;</span></span>
<span id="L1961"><span class="lineNum">    1961</span>                 :<span class="tlaUNC">           0 :     std::vector&lt;bilingual_str&gt; warnings;</span></span>
<span id="L1962"><span class="lineNum">    1962</span>                 :             : </span>
<span id="L1963"><span class="lineNum">    1963</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     const std::shared_ptr&lt;CWallet&gt; wallet = RestoreWallet(context, backup_file, wallet_name, load_on_start, status, error, warnings);</span></span>
<span id="L1964"><span class="lineNum">    1964</span>                 :             : </span>
<span id="L1965"><span class="lineNum">    1965</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span>]:<span class="tlaUNC">           0 :     HandleWalletError(wallet, status, error);</span></span>
<span id="L1966"><span class="lineNum">    1966</span>                 :             : </span>
<span id="L1967"><span class="lineNum">    1967</span>                 :<span class="tlaUNC">           0 :     UniValue obj(UniValue::VOBJ);</span></span>
<span id="L1968"><span class="lineNum">    1968</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     obj.pushKV(&quot;name&quot;, wallet-&gt;GetName());</span></span>
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span>]
<span id="L1969"><span class="lineNum">    1969</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     PushWarnings(warnings, obj);</span></span>
<span id="L1970"><span class="lineNum">    1970</span>                 :             : </span>
<span id="L1971"><span class="lineNum">    1971</span>         [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span>]:<span class="tlaUNC">           0 :     return obj;</span></span>
<span id="L1972"><span class="lineNum">    1972</span>                 :             : </span>
<span id="L1973"><span class="lineNum">    1973</span>                 :<span class="tlaUNC">           0 : },</span></span>
<span id="L1974"><span class="lineNum">    1974</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 :     };</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span>    <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span> 
<span class="lineNum">        </span>             <span class="tlaUNC" title="Branch 23 was not executed"> # </span>]
<span id="L1975"><span class="lineNum">    1975</span>   [<span class="tlaUNC" title="Branch 0 was not executed"> # </span><span class="tlaUNC" title="Branch 1 was not executed"> # </span><span class="tlaUNC" title="Branch 2 was not executed"> # </span><span class="tlaUNC" title="Branch 3 was not executed"> # </span> :<span class="tlaUNC">           0 : }</span></span>
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 4 was not executed"> # </span><span class="tlaUNC" title="Branch 5 was not executed"> # </span><span class="tlaUNC" title="Branch 6 was not executed"> # </span><span class="tlaUNC" title="Branch 7 was not executed"> # </span><span class="tlaUNC" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 9 was not executed"> # </span><span class="tlaUNC" title="Branch 10 was not executed"> # </span><span class="tlaUNC" title="Branch 11 was not executed"> # </span><span class="tlaUNC" title="Branch 12 was not executed"> # </span><span class="tlaUNC" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 14 was not executed"> # </span><span class="tlaUNC" title="Branch 15 was not executed"> # </span><span class="tlaUNC" title="Branch 16 was not executed"> # </span><span class="tlaUNC" title="Branch 17 was not executed"> # </span><span class="tlaUNC" title="Branch 18 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 19 was not executed"> # </span><span class="tlaUNC" title="Branch 20 was not executed"> # </span><span class="tlaUNC" title="Branch 21 was not executed"> # </span><span class="tlaUNC" title="Branch 22 was not executed"> # </span><span class="tlaUNC" title="Branch 23 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 24 was not executed"> # </span><span class="tlaUNC" title="Branch 25 was not executed"> # </span><span class="tlaUNC" title="Branch 26 was not executed"> # </span><span class="tlaUNC" title="Branch 27 was not executed"> # </span><span class="tlaUNC" title="Branch 28 was not executed"> # </span> 
<span class="lineNum">        </span> <span class="tlaUNC" title="Branch 29 was not executed"> # </span><span class="tlaUNC" title="Branch 30 was not executed"> # </span><span class="tlaUNC" title="Branch 31 was not executed"> # </span><span class="tlaUNC" title="Branch 32 was not executed"> # </span><span class="tlaUNC" title="Branch 33 was not executed"> # </span> 
<span class="lineNum">        </span>          <span class="tlaUNC" title="Branch 34 was not executed"> # </span><span class="tlaUNC" title="Branch 35 was not executed"> # </span>]
<span id="L1976"><span class="lineNum">    1976</span>                 :             : } // namespace wallet</span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../../../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
