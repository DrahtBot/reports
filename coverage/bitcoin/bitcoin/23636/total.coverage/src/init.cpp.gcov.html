<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - total_coverage.info - src/init.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">src</a> - init.cpp<span style="font-size: 80%;"> (source / <a href="init.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">total_coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">841</td>
            <td class="headerCovTableEntry">962</td>
            <td class="headerCovTableEntryMed">87.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2000-01-01 12:00:00</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">29</td>
            <td class="headerCovTableEntry">33</td>
            <td class="headerCovTableEntryMed">87.9 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">1695</td>
            <td class="headerCovTableEntry">3602</td>
            <td class="headerCovTableEntryLo">47.1 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : // Copyright (c) 2009-2010 Satoshi Nakamoto</a>
<a name="2"><span class="lineNum">       2 </span>                :            : // Copyright (c) 2009-2020 The Bitcoin Core developers</a>
<a name="3"><span class="lineNum">       3 </span>                :            : // Distributed under the MIT software license, see the accompanying</a>
<a name="4"><span class="lineNum">       4 </span>                :            : // file COPYING or http://www.opensource.org/licenses/mit-license.php.</a>
<a name="5"><span class="lineNum">       5 </span>                :            : </a>
<a name="6"><span class="lineNum">       6 </span>                :            : #if defined(HAVE_CONFIG_H)</a>
<a name="7"><span class="lineNum">       7 </span>                :            : #include &lt;config/bitcoin-config.h&gt;</a>
<a name="8"><span class="lineNum">       8 </span>                :            : #endif</a>
<a name="9"><span class="lineNum">       9 </span>                :            : </a>
<a name="10"><span class="lineNum">      10 </span>                :            : #include &lt;init.h&gt;</a>
<a name="11"><span class="lineNum">      11 </span>                :            : </a>
<a name="12"><span class="lineNum">      12 </span>                :            : #include &lt;addrman.h&gt;</a>
<a name="13"><span class="lineNum">      13 </span>                :            : #include &lt;banman.h&gt;</a>
<a name="14"><span class="lineNum">      14 </span>                :            : #include &lt;blockfilter.h&gt;</a>
<a name="15"><span class="lineNum">      15 </span>                :            : #include &lt;chain.h&gt;</a>
<a name="16"><span class="lineNum">      16 </span>                :            : #include &lt;chainparams.h&gt;</a>
<a name="17"><span class="lineNum">      17 </span>                :            : #include &lt;compat/sanity.h&gt;</a>
<a name="18"><span class="lineNum">      18 </span>                :            : #include &lt;consensus/amount.h&gt;</a>
<a name="19"><span class="lineNum">      19 </span>                :            : #include &lt;deploymentstatus.h&gt;</a>
<a name="20"><span class="lineNum">      20 </span>                :            : #include &lt;fs.h&gt;</a>
<a name="21"><span class="lineNum">      21 </span>                :            : #include &lt;hash.h&gt;</a>
<a name="22"><span class="lineNum">      22 </span>                :            : #include &lt;httprpc.h&gt;</a>
<a name="23"><span class="lineNum">      23 </span>                :            : #include &lt;httpserver.h&gt;</a>
<a name="24"><span class="lineNum">      24 </span>                :            : #include &lt;index/blockfilterindex.h&gt;</a>
<a name="25"><span class="lineNum">      25 </span>                :            : #include &lt;index/coinstatsindex.h&gt;</a>
<a name="26"><span class="lineNum">      26 </span>                :            : #include &lt;index/txindex.h&gt;</a>
<a name="27"><span class="lineNum">      27 </span>                :            : #include &lt;init/common.h&gt;</a>
<a name="28"><span class="lineNum">      28 </span>                :            : #include &lt;interfaces/chain.h&gt;</a>
<a name="29"><span class="lineNum">      29 </span>                :            : #include &lt;interfaces/init.h&gt;</a>
<a name="30"><span class="lineNum">      30 </span>                :            : #include &lt;interfaces/node.h&gt;</a>
<a name="31"><span class="lineNum">      31 </span>                :            : #include &lt;mapport.h&gt;</a>
<a name="32"><span class="lineNum">      32 </span>                :            : #include &lt;net.h&gt;</a>
<a name="33"><span class="lineNum">      33 </span>                :            : #include &lt;net_permissions.h&gt;</a>
<a name="34"><span class="lineNum">      34 </span>                :            : #include &lt;net_processing.h&gt;</a>
<a name="35"><span class="lineNum">      35 </span>                :            : #include &lt;netbase.h&gt;</a>
<a name="36"><span class="lineNum">      36 </span>                :            : #include &lt;node/blockstorage.h&gt;</a>
<a name="37"><span class="lineNum">      37 </span>                :            : #include &lt;node/context.h&gt;</a>
<a name="38"><span class="lineNum">      38 </span>                :            : #include &lt;node/miner.h&gt;</a>
<a name="39"><span class="lineNum">      39 </span>                :            : #include &lt;node/ui_interface.h&gt;</a>
<a name="40"><span class="lineNum">      40 </span>                :            : #include &lt;policy/feerate.h&gt;</a>
<a name="41"><span class="lineNum">      41 </span>                :            : #include &lt;policy/fees.h&gt;</a>
<a name="42"><span class="lineNum">      42 </span>                :            : #include &lt;policy/policy.h&gt;</a>
<a name="43"><span class="lineNum">      43 </span>                :            : #include &lt;policy/settings.h&gt;</a>
<a name="44"><span class="lineNum">      44 </span>                :            : #include &lt;protocol.h&gt;</a>
<a name="45"><span class="lineNum">      45 </span>                :            : #include &lt;rpc/blockchain.h&gt;</a>
<a name="46"><span class="lineNum">      46 </span>                :            : #include &lt;rpc/register.h&gt;</a>
<a name="47"><span class="lineNum">      47 </span>                :            : #include &lt;rpc/server.h&gt;</a>
<a name="48"><span class="lineNum">      48 </span>                :            : #include &lt;rpc/util.h&gt;</a>
<a name="49"><span class="lineNum">      49 </span>                :            : #include &lt;scheduler.h&gt;</a>
<a name="50"><span class="lineNum">      50 </span>                :            : #include &lt;script/sigcache.h&gt;</a>
<a name="51"><span class="lineNum">      51 </span>                :            : #include &lt;script/standard.h&gt;</a>
<a name="52"><span class="lineNum">      52 </span>                :            : #include &lt;shutdown.h&gt;</a>
<a name="53"><span class="lineNum">      53 </span>                :            : #include &lt;sync.h&gt;</a>
<a name="54"><span class="lineNum">      54 </span>                :            : #include &lt;timedata.h&gt;</a>
<a name="55"><span class="lineNum">      55 </span>                :            : #include &lt;torcontrol.h&gt;</a>
<a name="56"><span class="lineNum">      56 </span>                :            : #include &lt;txdb.h&gt;</a>
<a name="57"><span class="lineNum">      57 </span>                :            : #include &lt;txmempool.h&gt;</a>
<a name="58"><span class="lineNum">      58 </span>                :            : #include &lt;txorphanage.h&gt;</a>
<a name="59"><span class="lineNum">      59 </span>                :            : #include &lt;util/asmap.h&gt;</a>
<a name="60"><span class="lineNum">      60 </span>                :            : #include &lt;util/check.h&gt;</a>
<a name="61"><span class="lineNum">      61 </span>                :            : #include &lt;util/moneystr.h&gt;</a>
<a name="62"><span class="lineNum">      62 </span>                :            : #include &lt;util/strencodings.h&gt;</a>
<a name="63"><span class="lineNum">      63 </span>                :            : #include &lt;util/string.h&gt;</a>
<a name="64"><span class="lineNum">      64 </span>                :            : #include &lt;util/syscall_sandbox.h&gt;</a>
<a name="65"><span class="lineNum">      65 </span>                :            : #include &lt;util/system.h&gt;</a>
<a name="66"><span class="lineNum">      66 </span>                :            : #include &lt;util/thread.h&gt;</a>
<a name="67"><span class="lineNum">      67 </span>                :            : #include &lt;util/threadnames.h&gt;</a>
<a name="68"><span class="lineNum">      68 </span>                :            : #include &lt;util/translation.h&gt;</a>
<a name="69"><span class="lineNum">      69 </span>                :            : #include &lt;validation.h&gt;</a>
<a name="70"><span class="lineNum">      70 </span>                :            : #include &lt;validationinterface.h&gt;</a>
<a name="71"><span class="lineNum">      71 </span>                :            : #include &lt;walletinitinterface.h&gt;</a>
<a name="72"><span class="lineNum">      72 </span>                :            : </a>
<a name="73"><span class="lineNum">      73 </span>                :            : #include &lt;functional&gt;</a>
<a name="74"><span class="lineNum">      74 </span>                :            : #include &lt;set&gt;</a>
<a name="75"><span class="lineNum">      75 </span>                :            : #include &lt;stdint.h&gt;</a>
<a name="76"><span class="lineNum">      76 </span>                :            : #include &lt;stdio.h&gt;</a>
<a name="77"><span class="lineNum">      77 </span>                :            : #include &lt;thread&gt;</a>
<a name="78"><span class="lineNum">      78 </span>                :            : #include &lt;vector&gt;</a>
<a name="79"><span class="lineNum">      79 </span>                :            : </a>
<a name="80"><span class="lineNum">      80 </span>                :            : #ifndef WIN32</a>
<a name="81"><span class="lineNum">      81 </span>                :            : #include &lt;attributes.h&gt;</a>
<a name="82"><span class="lineNum">      82 </span>                :            : #include &lt;cerrno&gt;</a>
<a name="83"><span class="lineNum">      83 </span>                :            : #include &lt;signal.h&gt;</a>
<a name="84"><span class="lineNum">      84 </span>                :            : #include &lt;sys/stat.h&gt;</a>
<a name="85"><span class="lineNum">      85 </span>                :            : #endif</a>
<a name="86"><span class="lineNum">      86 </span>                :            : </a>
<a name="87"><span class="lineNum">      87 </span>                :            : #include &lt;boost/algorithm/string/replace.hpp&gt;</a>
<a name="88"><span class="lineNum">      88 </span>                :            : #include &lt;boost/signals2/signal.hpp&gt;</a>
<a name="89"><span class="lineNum">      89 </span>                :            : </a>
<a name="90"><span class="lineNum">      90 </span>                :            : #if ENABLE_ZMQ</a>
<a name="91"><span class="lineNum">      91 </span>                :            : #include &lt;zmq/zmqabstractnotifier.h&gt;</a>
<a name="92"><span class="lineNum">      92 </span>                :            : #include &lt;zmq/zmqnotificationinterface.h&gt;</a>
<a name="93"><span class="lineNum">      93 </span>                :            : #include &lt;zmq/zmqrpc.h&gt;</a>
<a name="94"><span class="lineNum">      94 </span>                :            : #endif</a>
<a name="95"><span class="lineNum">      95 </span>                :            : </a>
<a name="96"><span class="lineNum">      96 </span>                :            : static const bool DEFAULT_PROXYRANDOMIZE = true;</a>
<a name="97"><span class="lineNum">      97 </span>                :            : static const bool DEFAULT_REST_ENABLE = false;</a>
<a name="98"><span class="lineNum">      98 </span>                :            : </a>
<a name="99"><span class="lineNum">      99 </span>                :            : #ifdef WIN32</a>
<a name="100"><span class="lineNum">     100 </span>                :            : // Win32 LevelDB doesn't use filedescriptors, and the ones used for</a>
<a name="101"><span class="lineNum">     101 </span>                :            : // accessing block files don't count towards the fd_set size limit</a>
<a name="102"><span class="lineNum">     102 </span>                :            : // anyway.</a>
<a name="103"><span class="lineNum">     103 </span>                :            : #define MIN_CORE_FILEDESCRIPTORS 0</a>
<a name="104"><span class="lineNum">     104 </span>                :            : #else</a>
<a name="105"><span class="lineNum">     105 </span>                :            : #define MIN_CORE_FILEDESCRIPTORS 150</a>
<a name="106"><span class="lineNum">     106 </span>                :            : #endif</a>
<a name="107"><span class="lineNum">     107 </span>                :            : </a>
<a name="108"><span class="lineNum">     108 </span>                :            : static const char* DEFAULT_ASMAP_FILENAME=&quot;ip_asn.map&quot;;</a>
<a name="109"><span class="lineNum">     109 </span>                :            : </a>
<a name="110"><span class="lineNum">     110 </span>                :            : /**</a>
<a name="111"><span class="lineNum">     111 </span>                :            :  * The PID file facilities.</a>
<a name="112"><span class="lineNum">     112 </span>                :            :  */</a>
<a name="113"><span class="lineNum">     113 </span>                :            : static const char* BITCOIN_PID_FILENAME = &quot;bitcoind.pid&quot;;</a>
<a name="114"><span class="lineNum">     114 </span>                :            : </a>
<a name="115"><span class="lineNum">     115 </span>                :<span class="lineCov">       1492 : static fs::path GetPidFile(const ArgsManager&amp; args)</span></a>
<a name="116"><span class="lineNum">     116 </span>                :            : {</a>
<a name="117"><span class="lineNum">     117 </span>  [<span class="branchCov" title="Branch 0 was taken 1492 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1492 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2984 :     return AbsPathForConfigVal(fs::PathFromString(args.GetArg(&quot;-pid&quot;, BITCOIN_PID_FILENAME)));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1492 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1492 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="118"><span class="lineNum">     118 </span>                :            : }</a>
<a name="119"><span class="lineNum">     119 </span>                :            : </a>
<a name="120"><span class="lineNum">     120 </span>                :<span class="lineCov">        746 : [[nodiscard]] static bool CreatePidFile(const ArgsManager&amp; args)</span></a>
<a name="121"><span class="lineNum">     121 </span>                :            : {</a>
<a name="122"><span class="lineNum">     122 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     fsbridge::ofstream file{GetPidFile(args)};</span></a>
<a name="123"><span class="lineNum">     123 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     if (file) {</span></a>
<a name="124"><span class="lineNum">     124 </span>                :            : #ifdef WIN32</a>
<a name="125"><span class="lineNum">     125 </span>                :            :         tfm::format(file, &quot;%d\n&quot;, GetCurrentProcessId());</a>
<a name="126"><span class="lineNum">     126 </span>                :            : #else</a>
<a name="127"><span class="lineNum">     127 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :         tfm::format(file, &quot;%d\n&quot;, getpid());</span></a>
<a name="128"><span class="lineNum">     128 </span>                :            : #endif</a>
<a name="129"><span class="lineNum">     129 </span>                :            :         return true;</a>
<a name="130"><span class="lineNum">     130 </span>                :            :     } else {</a>
<a name="131"><span class="lineNum">     131 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        746 :         return InitError(strprintf(_(&quot;Unable to create the PID file '%s': %s&quot;), fs::PathToString(GetPidFile(args)), std::strerror(errno)));</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="132"><span class="lineNum">     132 </span>                :            :     }</a>
<a name="133"><span class="lineNum">     133 </span>                :            : }</a>
<a name="134"><span class="lineNum">     134 </span>                :            : </a>
<a name="135"><span class="lineNum">     135 </span>                :            : //////////////////////////////////////////////////////////////////////////////</a>
<a name="136"><span class="lineNum">     136 </span>                :            : //</a>
<a name="137"><span class="lineNum">     137 </span>                :            : // Shutdown</a>
<a name="138"><span class="lineNum">     138 </span>                :            : //</a>
<a name="139"><span class="lineNum">     139 </span>                :            : </a>
<a name="140"><span class="lineNum">     140 </span>                :            : //</a>
<a name="141"><span class="lineNum">     141 </span>                :            : // Thread management and startup/shutdown:</a>
<a name="142"><span class="lineNum">     142 </span>                :            : //</a>
<a name="143"><span class="lineNum">     143 </span>                :            : // The network-processing threads are all part of a thread group</a>
<a name="144"><span class="lineNum">     144 </span>                :            : // created by AppInit() or the Qt main() function.</a>
<a name="145"><span class="lineNum">     145 </span>                :            : //</a>
<a name="146"><span class="lineNum">     146 </span>                :            : // A clean exit happens when StartShutdown() or the SIGTERM</a>
<a name="147"><span class="lineNum">     147 </span>                :            : // signal handler sets ShutdownRequested(), which makes main thread's</a>
<a name="148"><span class="lineNum">     148 </span>                :            : // WaitForShutdown() interrupts the thread group.</a>
<a name="149"><span class="lineNum">     149 </span>                :            : // And then, WaitForShutdown() makes all other on-going threads</a>
<a name="150"><span class="lineNum">     150 </span>                :            : // in the thread group join the main thread.</a>
<a name="151"><span class="lineNum">     151 </span>                :            : // Shutdown() is then called to clean up database connections, and stop other</a>
<a name="152"><span class="lineNum">     152 </span>                :            : // threads that should only be stopped after the main network-processing</a>
<a name="153"><span class="lineNum">     153 </span>                :            : // threads have exited.</a>
<a name="154"><span class="lineNum">     154 </span>                :            : //</a>
<a name="155"><span class="lineNum">     155 </span>                :            : // Shutdown for Qt is very similar, only it uses a QTimer to detect</a>
<a name="156"><span class="lineNum">     156 </span>                :            : // ShutdownRequested() getting set, and then does the normal Qt</a>
<a name="157"><span class="lineNum">     157 </span>                :            : // shutdown thing.</a>
<a name="158"><span class="lineNum">     158 </span>                :            : //</a>
<a name="159"><span class="lineNum">     159 </span>                :            : </a>
<a name="160"><span class="lineNum">     160 </span>                :<span class="lineCov">        746 : void Interrupt(NodeContext&amp; node)</span></a>
<a name="161"><span class="lineNum">     161 </span>                :            : {</a>
<a name="162"><span class="lineNum">     162 </span>                :<span class="lineCov">        746 :     InterruptHTTPServer();</span></a>
<a name="163"><span class="lineNum">     163 </span>                :<span class="lineCov">        746 :     InterruptHTTPRPC();</span></a>
<a name="164"><span class="lineNum">     164 </span>                :<span class="lineCov">        746 :     InterruptRPC();</span></a>
<a name="165"><span class="lineNum">     165 </span>                :<span class="lineCov">        746 :     InterruptREST();</span></a>
<a name="166"><span class="lineNum">     166 </span>                :<span class="lineCov">        746 :     InterruptTorControl();</span></a>
<a name="167"><span class="lineNum">     167 </span>                :<span class="lineCov">        746 :     InterruptMapPort();</span></a>
<a name="168"><span class="lineNum">     168 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     if (node.connman)</span></a>
<a name="169"><span class="lineNum">     169 </span>                :<span class="lineCov">        709 :         node.connman-&gt;Interrupt();</span></a>
<a name="170"><span class="lineNum">     170 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 737 times"> + </span>]:<span class="lineCov">        746 :     if (g_txindex) {</span></a>
<a name="171"><span class="lineNum">     171 </span>                :<span class="lineCov">          9 :         g_txindex-&gt;Interrupt();</span></a>
<a name="172"><span class="lineNum">     172 </span>                :            :     }</a>
<a name="173"><span class="lineNum">     173 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        753 :     ForEachBlockFilterIndex([](BlockFilterIndex&amp; index) { index.Interrupt(); });</span></a>
<a name="174"><span class="lineNum">     174 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchCov" title="Branch 1 was taken 742 times"> + </span>]:<span class="lineCov">        746 :     if (g_coin_stats_index) {</span></a>
<a name="175"><span class="lineNum">     175 </span>                :<span class="lineCov">          4 :         g_coin_stats_index-&gt;Interrupt();</span></a>
<a name="176"><span class="lineNum">     176 </span>                :            :     }</a>
<a name="177"><span class="lineNum">     177 </span>                :<span class="lineCov">        746 : }</span></a>
<a name="178"><span class="lineNum">     178 </span>                :            : </a>
<a name="179"><span class="lineNum">     179 </span>                :<span class="lineCov">        746 : void Shutdown(NodeContext&amp; node)</span></a>
<a name="180"><span class="lineNum">     180 </span>                :            : {</a>
<a name="181"><span class="lineNum">     181 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     static Mutex g_shutdown_mutex;</span></a>
<a name="182"><span class="lineNum">     182 </span>                :<span class="lineCov">        746 :     TRY_LOCK(g_shutdown_mutex, lock_shutdown);</span></a>
<a name="183"><span class="lineNum">     183 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">       1492 :     if (!lock_shutdown) return;</span></a>
<a name="184"><span class="lineNum">     184 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1492 :     LogPrintf(&quot;%s: In progress...\n&quot;, __func__);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="185"><span class="lineNum">     185 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">       1492 :     Assert(node.args);</span></a>
<a name="186"><span class="lineNum">     186 </span>                :            : </a>
<a name="187"><span class="lineNum">     187 </span>                :            :     /// Note: Shutdown() must be able to handle cases in which initialization failed part of the way,</a>
<a name="188"><span class="lineNum">     188 </span>                :            :     /// for example if the data directory was found to be locked.</a>
<a name="189"><span class="lineNum">     189 </span>                :            :     /// Be sure that anything that writes files or flushes caches only does this if the respective</a>
<a name="190"><span class="lineNum">     190 </span>                :            :     /// module was initialized.</a>
<a name="191"><span class="lineNum">     191 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1492 :     util::ThreadRename(&quot;shutoff&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 709 times"> + </span><span class="branchCov" title="Branch 5 was taken 37 times"> + </span>]
<a name="192"><span class="lineNum">     192 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     if (node.mempool) node.mempool-&gt;AddTransactionsUpdated(1);</span></a>
<a name="193"><span class="lineNum">     193 </span>                :            : </a>
<a name="194"><span class="lineNum">     194 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopHTTPRPC();</span></a>
<a name="195"><span class="lineNum">     195 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopREST();</span></a>
<a name="196"><span class="lineNum">     196 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopRPC();</span></a>
<a name="197"><span class="lineNum">     197 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopHTTPServer();</span></a>
<a name="198"><span class="lineNum">     198 </span>        [<span class="branchCov" title="Branch 0 was taken 729 times"> + </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">       1475 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="199"><span class="lineNum">     199 </span>        [<span class="branchCov" title="Branch 0 was taken 729 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        729 :         client-&gt;flush();</span></a>
<a name="200"><span class="lineNum">     200 </span>                :            :     }</a>
<a name="201"><span class="lineNum">     201 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopMapPort();</span></a>
<a name="202"><span class="lineNum">     202 </span>                :            : </a>
<a name="203"><span class="lineNum">     203 </span>                :            :     // Because these depend on each-other, we make sure that neither can be</a>
<a name="204"><span class="lineNum">     204 </span>                :            :     // using the other before destroying them.</a>
<a name="205"><span class="lineNum">     205 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     if (node.peerman) UnregisterValidationInterface(node.peerman.get());</span></a>
<a name="206"><span class="lineNum">     206 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     if (node.connman) node.connman-&gt;Stop();</span></a>
<a name="207"><span class="lineNum">     207 </span>                :            : </a>
<a name="208"><span class="lineNum">     208 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopTorControl();</span></a>
<a name="209"><span class="lineNum">     209 </span>                :            : </a>
<a name="210"><span class="lineNum">     210 </span>                :            :     // After everything has been shut down, but before things get flushed, stop the</a>
<a name="211"><span class="lineNum">     211 </span>                :            :     // CScheduler/checkqueue, scheduler and load block thread.</a>
<a name="212"><span class="lineNum">     212 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     if (node.scheduler) node.scheduler-&gt;stop();</span></a>
<a name="213"><span class="lineNum">     213 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchCov" title="Branch 3 was taken 13 times"> + </span> :<span class="lineCov">        746 :     if (node.chainman &amp;&amp; node.chainman-&gt;m_load_block.joinable()) node.chainman-&gt;m_load_block.join();</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="214"><span class="lineNum">     214 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     StopScriptCheckWorkerThreads();</span></a>
<a name="215"><span class="lineNum">     215 </span>                :            : </a>
<a name="216"><span class="lineNum">     216 </span>                :            :     // After the threads that potentially access these pointers have been stopped,</a>
<a name="217"><span class="lineNum">     217 </span>                :            :     // destruct and reset all to nullptr.</a>
<a name="218"><span class="lineNum">     218 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.peerman.reset();</span></a>
<a name="219"><span class="lineNum">     219 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.connman.reset();</span></a>
<a name="220"><span class="lineNum">     220 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.banman.reset();</span></a>
<a name="221"><span class="lineNum">     221 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.addrman.reset();</span></a>
<a name="222"><span class="lineNum">     222 </span>                :            : </a>
<a name="223"><span class="lineNum">     223 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1448 :     if (node.mempool &amp;&amp; node.mempool-&gt;IsLoaded() &amp;&amp; node.args-&gt;GetBoolArg(&quot;-persistmempool&quot;, DEFAULT_PERSIST_MEMPOOL)) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchCov" title="Branch 5 was taken 13 times"> + </span><span class="branchCov" title="Branch 6 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 696 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 6 times"> + </span><span class="branchCov" title="Branch 11 was taken 690 times"> + </span><span class="branchCov" title="Branch 12 was taken 696 times"> + </span><span class="branchCov" title="Branch 13 was taken 50 times"> + </span> 
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 14 was taken 690 times"> + </span><span class="branchCov" title="Branch 15 was taken 56 times"> + </span>]
<a name="224"><span class="lineNum">     224 </span>        [<span class="branchCov" title="Branch 0 was taken 690 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        690 :         DumpMempool(*node.mempool);</span></a>
<a name="225"><span class="lineNum">     225 </span>                :            :     }</a>
<a name="226"><span class="lineNum">     226 </span>                :            : </a>
<a name="227"><span class="lineNum">     227 </span>                :            :     // Drop transactions we were still watching, and record fee estimations.</a>
<a name="228"><span class="lineNum">     228 </span>  [<span class="branchCov" title="Branch 0 was taken 703 times"> + </span><span class="branchCov" title="Branch 1 was taken 43 times"> + </span><span class="branchCov" title="Branch 2 was taken 703 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     if (node.fee_estimator) node.fee_estimator-&gt;Flush();</span></a>
<a name="229"><span class="lineNum">     229 </span>                :            : </a>
<a name="230"><span class="lineNum">     230 </span>                :            :     // FlushStateToDisk generates a ChainStateFlushed callback, which we should avoid missing</a>
<a name="231"><span class="lineNum">     231 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     if (node.chainman) {</span></a>
<a name="232"><span class="lineNum">     232 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        709 :         LOCK(cs_main);</span></a>
<a name="233"><span class="lineNum">     233 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchCov" title="Branch 3 was taken 709 times"> + </span> :<span class="lineCov">       2120 :         for (CChainState* chainstate : node.chainman-&gt;GetAll()) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="234"><span class="lineNum">     234 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1404 :             if (chainstate-&gt;CanFlushToDisk()) {</span></a>
<a name="235"><span class="lineNum">     235 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                 chainstate-&gt;ForceFlushStateToDisk();</span></a>
<a name="236"><span class="lineNum">     236 </span>                :            :             }</a>
<a name="237"><span class="lineNum">     237 </span>                :            :         }</a>
<a name="238"><span class="lineNum">     238 </span>                :            :     }</a>
<a name="239"><span class="lineNum">     239 </span>                :            : </a>
<a name="240"><span class="lineNum">     240 </span>                :            :     // After there are no more peers/RPC left to give us new data which may generate</a>
<a name="241"><span class="lineNum">     241 </span>                :            :     // CValidationInterface callbacks, flush them...</a>
<a name="242"><span class="lineNum">     242 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     GetMainSignals().FlushBackgroundCallbacks();</span></a>
<a name="243"><span class="lineNum">     243 </span>                :            : </a>
<a name="244"><span class="lineNum">     244 </span>                :            :     // Stop and delete all indexes only after flushing background callbacks.</a>
<a name="245"><span class="lineNum">     245 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 737 times"> + </span>]:<span class="lineCov">        746 :     if (g_txindex) {</span></a>
<a name="246"><span class="lineNum">     246 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          9 :         g_txindex-&gt;Stop();</span></a>
<a name="247"><span class="lineNum">     247 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          9 :         g_txindex.reset();</span></a>
<a name="248"><span class="lineNum">     248 </span>                :            :     }</a>
<a name="249"><span class="lineNum">     249 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchCov" title="Branch 1 was taken 742 times"> + </span>]:<span class="lineCov">        746 :     if (g_coin_stats_index) {</span></a>
<a name="250"><span class="lineNum">     250 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :         g_coin_stats_index-&gt;Stop();</span></a>
<a name="251"><span class="lineNum">     251 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :         g_coin_stats_index.reset();</span></a>
<a name="252"><span class="lineNum">     252 </span>                :            :     }</a>
<a name="253"><span class="lineNum">     253 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        753 :     ForEachBlockFilterIndex([](BlockFilterIndex&amp; index) { index.Stop(); });</span></a>
<a name="254"><span class="lineNum">     254 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     DestroyAllBlockFilterIndexes();</span></a>
<a name="255"><span class="lineNum">     255 </span>                :            : </a>
<a name="256"><span class="lineNum">     256 </span>                :            :     // Any future callbacks will be dropped. This should absolutely be safe - if</a>
<a name="257"><span class="lineNum">     257 </span>                :            :     // missing a callback results in an unrecoverable situation, unclean shutdown</a>
<a name="258"><span class="lineNum">     258 </span>                :            :     // would too. The only reason to do the above flushes is to let the wallet catch</a>
<a name="259"><span class="lineNum">     259 </span>                :            :     // up with our current chain to avoid any strange pruning edge cases and make</a>
<a name="260"><span class="lineNum">     260 </span>                :            :     // next startup faster by avoiding rescan.</a>
<a name="261"><span class="lineNum">     261 </span>                :            : </a>
<a name="262"><span class="lineNum">     262 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     if (node.chainman) {</span></a>
<a name="263"><span class="lineNum">     263 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        709 :         LOCK(cs_main);</span></a>
<a name="264"><span class="lineNum">     264 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchCov" title="Branch 3 was taken 709 times"> + </span> :<span class="lineCov">       2120 :         for (CChainState* chainstate : node.chainman-&gt;GetAll()) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="265"><span class="lineNum">     265 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1404 :             if (chainstate-&gt;CanFlushToDisk()) {</span></a>
<a name="266"><span class="lineNum">     266 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                 chainstate-&gt;ForceFlushStateToDisk();</span></a>
<a name="267"><span class="lineNum">     267 </span>                :<span class="lineCov">        702 :                 chainstate-&gt;ResetCoinsViews();</span></a>
<a name="268"><span class="lineNum">     268 </span>                :            :             }</a>
<a name="269"><span class="lineNum">     269 </span>                :            :         }</a>
<a name="270"><span class="lineNum">     270 </span>                :            :     }</a>
<a name="271"><span class="lineNum">     271 </span>        [<span class="branchCov" title="Branch 0 was taken 729 times"> + </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">       1475 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="272"><span class="lineNum">     272 </span>        [<span class="branchCov" title="Branch 0 was taken 729 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        729 :         client-&gt;stop();</span></a>
<a name="273"><span class="lineNum">     273 </span>                :            :     }</a>
<a name="274"><span class="lineNum">     274 </span>                :            : </a>
<a name="275"><span class="lineNum">     275 </span>                :            : #if ENABLE_ZMQ</a>
<a name="276"><span class="lineNum">     276 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 740 times"> + </span>]:<span class="lineCov">        746 :     if (g_zmq_notification_interface) {</span></a>
<a name="277"><span class="lineNum">     277 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         UnregisterValidationInterface(g_zmq_notification_interface);</span></a>
<a name="278"><span class="lineNum">     278 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         delete g_zmq_notification_interface;</span></a>
<a name="279"><span class="lineNum">     279 </span>                :<span class="lineCov">          6 :         g_zmq_notification_interface = nullptr;</span></a>
<a name="280"><span class="lineNum">     280 </span>                :            :     }</a>
<a name="281"><span class="lineNum">     281 </span>                :            : #endif</a>
<a name="282"><span class="lineNum">     282 </span>                :            : </a>
<a name="283"><span class="lineNum">     283 </span>                :<span class="lineCov">        746 :     node.chain_clients.clear();</span></a>
<a name="284"><span class="lineNum">     284 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     UnregisterAllValidationInterfaces();</span></a>
<a name="285"><span class="lineNum">     285 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        746 :     GetMainSignals().UnregisterBackgroundSignalScheduler();</span></a>
<a name="286"><span class="lineNum">     286 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     init::UnsetGlobals();</span></a>
<a name="287"><span class="lineNum">     287 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.mempool.reset();</span></a>
<a name="288"><span class="lineNum">     288 </span>        [<span class="branchCov" title="Branch 0 was taken 703 times"> + </span><span class="branchCov" title="Branch 1 was taken 43 times"> + </span>]:<span class="lineCov">        746 :     node.fee_estimator.reset();</span></a>
<a name="289"><span class="lineNum">     289 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">        746 :     node.chainman.reset();</span></a>
<a name="290"><span class="lineNum">     290 </span>        [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        746 :     node.scheduler.reset();</span></a>
<a name="291"><span class="lineNum">     291 </span>                :            : </a>
<a name="292"><span class="lineNum">     292 </span>                :<span class="lineCov">        746 :     try {</span></a>
<a name="293"><span class="lineNum">     293 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 746 times"> + </span>]:<span class="lineCov">       1492 :         if (!fs::remove(GetPidFile(*node.args))) {</span></a>
<a name="294"><span class="lineNum">     294 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        746 :             LogPrintf(&quot;%s: Unable to remove PID file: File does not exist\n&quot;, __func__);</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="295"><span class="lineNum">     295 </span>                :            :         }</a>
<a name="296"><span class="lineNum">     296 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineNoCov">          0 :     } catch (const fs::filesystem_error&amp; e) {</span></a>
<a name="297"><span class="lineNum">     297 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineNoCov">          0 :         LogPrintf(&quot;%s: Unable to remove PID file: %s\n&quot;, __func__, fsbridge::get_filesystem_error_message(e));</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="298"><span class="lineNum">     298 </span>                :            :     }</a>
<a name="299"><span class="lineNum">     299 </span>                :            : </a>
<a name="300"><span class="lineNum">     300 </span>                :<span class="lineCov">        746 :     node.args = nullptr;</span></a>
<a name="301"><span class="lineNum">     301 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1492 :     LogPrintf(&quot;%s: done\n&quot;, __func__);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="302"><span class="lineNum">     302 </span>                :            : }</a>
<a name="303"><span class="lineNum">     303 </span>                :            : </a>
<a name="304"><span class="lineNum">     304 </span>                :            : /**</a>
<a name="305"><span class="lineNum">     305 </span>                :            :  * Signal handlers are very limited in what they are allowed to do.</a>
<a name="306"><span class="lineNum">     306 </span>                :            :  * The execution context the handler is invoked in is not guaranteed,</a>
<a name="307"><span class="lineNum">     307 </span>                :            :  * so we restrict handler operations to just touching variables:</a>
<a name="308"><span class="lineNum">     308 </span>                :            :  */</a>
<a name="309"><span class="lineNum">     309 </span>                :            : #ifndef WIN32</a>
<a name="310"><span class="lineNum">     310 </span>                :<span class="lineNoCov">          0 : static void HandleSIGTERM(int)</span></a>
<a name="311"><span class="lineNum">     311 </span>                :            : {</a>
<a name="312"><span class="lineNum">     312 </span>                :<span class="lineNoCov">          0 :     StartShutdown();</span></a>
<a name="313"><span class="lineNum">     313 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="314"><span class="lineNum">     314 </span>                :            : </a>
<a name="315"><span class="lineNum">     315 </span>                :<span class="lineNoCov">          0 : static void HandleSIGHUP(int)</span></a>
<a name="316"><span class="lineNum">     316 </span>                :            : {</a>
<a name="317"><span class="lineNum">     317 </span>                :<span class="lineNoCov">          0 :     LogInstance().m_reopen_file = true;</span></a>
<a name="318"><span class="lineNum">     318 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="319"><span class="lineNum">     319 </span>                :            : #else</a>
<a name="320"><span class="lineNum">     320 </span>                :            : static BOOL WINAPI consoleCtrlHandler(DWORD dwCtrlType)</a>
<a name="321"><span class="lineNum">     321 </span>                :            : {</a>
<a name="322"><span class="lineNum">     322 </span>                :            :     StartShutdown();</a>
<a name="323"><span class="lineNum">     323 </span>                :            :     Sleep(INFINITE);</a>
<a name="324"><span class="lineNum">     324 </span>                :            :     return true;</a>
<a name="325"><span class="lineNum">     325 </span>                :            : }</a>
<a name="326"><span class="lineNum">     326 </span>                :            : #endif</a>
<a name="327"><span class="lineNum">     327 </span>                :            : </a>
<a name="328"><span class="lineNum">     328 </span>                :            : #ifndef WIN32</a>
<a name="329"><span class="lineNum">     329 </span>                :<span class="lineCov">       2259 : static void registerSignalHandler(int signal, void(*handler)(int))</span></a>
<a name="330"><span class="lineNum">     330 </span>                :            : {</a>
<a name="331"><span class="lineNum">     331 </span>                :<span class="lineCov">       2259 :     struct sigaction sa;</span></a>
<a name="332"><span class="lineNum">     332 </span>                :<span class="lineCov">       2259 :     sa.sa_handler = handler;</span></a>
<a name="333"><span class="lineNum">     333 </span>                :<span class="lineCov">       2259 :     sigemptyset(&amp;sa.sa_mask);</span></a>
<a name="334"><span class="lineNum">     334 </span>                :<span class="lineCov">       2259 :     sa.sa_flags = 0;</span></a>
<a name="335"><span class="lineNum">     335 </span>                :<span class="lineCov">       2259 :     sigaction(signal, &amp;sa, nullptr);</span></a>
<a name="336"><span class="lineNum">     336 </span>                :<span class="lineCov">       2259 : }</span></a>
<a name="337"><span class="lineNum">     337 </span>                :            : #endif</a>
<a name="338"><span class="lineNum">     338 </span>                :            : </a>
<a name="339"><span class="lineNum">     339 </span>                :            : static boost::signals2::connection rpc_notify_block_change_connection;</a>
<a name="340"><span class="lineNum">     340 </span>                :<span class="lineCov">        742 : static void OnRPCStarted()</span></a>
<a name="341"><span class="lineNum">     341 </span>                :            : {</a>
<a name="342"><span class="lineNum">     342 </span>  [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 742 times"> + </span>]:<span class="lineCov">       1484 :     rpc_notify_block_change_connection = uiInterface.NotifyBlockTip_connect(std::bind(RPCNotifyBlockChange, std::placeholders::_2));</span></a>
<a name="343"><span class="lineNum">     343 </span>                :<span class="lineCov">        742 : }</span></a>
<a name="344"><span class="lineNum">     344 </span>                :            : </a>
<a name="345"><span class="lineNum">     345 </span>                :<span class="lineCov">        742 : static void OnRPCStopped()</span></a>
<a name="346"><span class="lineNum">     346 </span>                :            : {</a>
<a name="347"><span class="lineNum">     347 </span>                :<span class="lineCov">        742 :     rpc_notify_block_change_connection.disconnect();</span></a>
<a name="348"><span class="lineNum">     348 </span>                :<span class="lineCov">        742 :     RPCNotifyBlockChange(nullptr);</span></a>
<a name="349"><span class="lineNum">     349 </span>                :<span class="lineCov">        742 :     g_best_block_cv.notify_all();</span></a>
<a name="350"><span class="lineNum">     350 </span>  [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2226 :     LogPrint(BCLog::RPC, &quot;RPC stopped.\n&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="351"><span class="lineNum">     351 </span>                :<span class="lineCov">        742 : }</span></a>
<a name="352"><span class="lineNum">     352 </span>                :            : </a>
<a name="353"><span class="lineNum">     353 </span>                :<span class="lineCov">       1242 : void SetupServerArgs(ArgsManager&amp; argsman)</span></a>
<a name="354"><span class="lineNum">     354 </span>                :            : {</a>
<a name="355"><span class="lineNum">     355 </span>                :<span class="lineCov">       1242 :     SetupHelpOptions(argsman);</span></a>
<a name="356"><span class="lineNum">     356 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2484 :     argsman.AddArg(&quot;-help-debug&quot;, &quot;Print help message with debugging options and exit&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST); // server-only for now</span></a>
<a name="357"><span class="lineNum">     357 </span>                :            : </a>
<a name="358"><span class="lineNum">     358 </span>                :<span class="lineCov">       1242 :     init::AddLoggingArgs(argsman);</span></a>
<a name="359"><span class="lineNum">     359 </span>                :            : </a>
<a name="360"><span class="lineNum">     360 </span>                :<span class="lineCov">       2484 :     const auto defaultBaseParams = CreateBaseChainParams(CBaseChainParams::MAIN);</span></a>
<a name="361"><span class="lineNum">     361 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto testnetBaseParams = CreateBaseChainParams(CBaseChainParams::TESTNET);</span></a>
<a name="362"><span class="lineNum">     362 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto signetBaseParams = CreateBaseChainParams(CBaseChainParams::SIGNET);</span></a>
<a name="363"><span class="lineNum">     363 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto regtestBaseParams = CreateBaseChainParams(CBaseChainParams::REGTEST);</span></a>
<a name="364"><span class="lineNum">     364 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto defaultChainParams = CreateChainParams(argsman, CBaseChainParams::MAIN);</span></a>
<a name="365"><span class="lineNum">     365 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto testnetChainParams = CreateChainParams(argsman, CBaseChainParams::TESTNET);</span></a>
<a name="366"><span class="lineNum">     366 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto signetChainParams = CreateChainParams(argsman, CBaseChainParams::SIGNET);</span></a>
<a name="367"><span class="lineNum">     367 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     const auto regtestChainParams = CreateChainParams(argsman, CBaseChainParams::REGTEST);</span></a>
<a name="368"><span class="lineNum">     368 </span>                :            : </a>
<a name="369"><span class="lineNum">     369 </span>                :            :     // Hidden Options</a>
<a name="370"><span class="lineNum">     370 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     std::vector&lt;std::string&gt; hidden_args = {</span></a>
<a name="371"><span class="lineNum">     371 </span>                :            :         &quot;-dbcrashratio&quot;, &quot;-forcecompactdb&quot;,</a>
<a name="372"><span class="lineNum">     372 </span>                :            :         // GUI args. These will be overwritten by SetupUIArgs for the GUI</a>
<a name="373"><span class="lineNum">     373 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">      12420 :         &quot;-choosedatadir&quot;, &quot;-lang=&lt;lang&gt;&quot;, &quot;-min&quot;, &quot;-resetguisettings&quot;, &quot;-splash&quot;, &quot;-uiplatform&quot;};</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span><span class="branchCov" title="Branch 17 was taken 1242 times"> + </span><span class="branchCov" title="Branch 18 was taken 9936 times"> + </span> 
<span class="lineNum">         </span>      <span class="branchCov" title="Branch 19 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 20 was not taken"> - </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span>]
<a name="374"><span class="lineNum">     374 </span>                :            : </a>
<a name="375"><span class="lineNum">     375 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-version&quot;, &quot;Print version and exit&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="376"><span class="lineNum">     376 </span>                :            : #if HAVE_SYSTEM</a>
<a name="377"><span class="lineNum">     377 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-alertnotify=&lt;cmd&gt;&quot;, &quot;Execute command when a relevant alert is received or we see a really long fork (%s in cmd is replaced by message)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="378"><span class="lineNum">     378 </span>                :            : #endif</a>
<a name="379"><span class="lineNum">     379 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-assumevalid=&lt;hex&gt;&quot;, strprintf(&quot;If this block is in the chain assume that it and its ancestors are valid and potentially skip their script verification (0 to verify all, default: %s, testnet: %s, signet: %s)&quot;, defaultChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex(), testnetChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex(), signetChainParams-&gt;GetConsensus().defaultAssumeValid.GetHex()), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>      <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<a name="380"><span class="lineNum">     380 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blocksdir=&lt;dir&gt;&quot;, &quot;Specify directory to hold blocks subdirectory for *.dat files (default: &lt;datadir&gt;)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="381"><span class="lineNum">     381 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-fastprune&quot;, &quot;Use smaller block files and lower minimum prune height for testing purposes&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="382"><span class="lineNum">     382 </span>                :            : #if HAVE_SYSTEM</a>
<a name="383"><span class="lineNum">     383 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blocknotify=&lt;cmd&gt;&quot;, &quot;Execute command when the best block changes (%s in cmd is replaced by block hash)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="384"><span class="lineNum">     384 </span>                :            : #endif</a>
<a name="385"><span class="lineNum">     385 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blockreconstructionextratxn=&lt;n&gt;&quot;, strprintf(&quot;Extra transactions to keep in memory for compact block reconstructions (default: %u)&quot;, DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="386"><span class="lineNum">     386 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blocksonly&quot;, strprintf(&quot;Whether to reject transactions from network peers. Automatic broadcast and rebroadcast of any transactions from inbound peers is disabled, unless the peer has the 'forcerelay' permission. RPC transactions are not affected. (default: %u)&quot;, DEFAULT_BLOCKSONLY), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="387"><span class="lineNum">     387 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-coinstatsindex&quot;, strprintf(&quot;Maintain coinstats index used by the gettxoutsetinfo RPC (default: %u)&quot;, DEFAULT_COINSTATSINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="388"><span class="lineNum">     388 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-conf=&lt;file&gt;&quot;, strprintf(&quot;Specify path to read-only configuration file. Relative paths will be prefixed by datadir location. (default: %s)&quot;, BITCOIN_CONF_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="389"><span class="lineNum">     389 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-datadir=&lt;dir&gt;&quot;, &quot;Specify data directory&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="390"><span class="lineNum">     390 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-dbbatchsize&quot;, strprintf(&quot;Maximum database write batch size in bytes (default: %u)&quot;, nDefaultDbBatchSize), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="391"><span class="lineNum">     391 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-dbcache=&lt;n&gt;&quot;, strprintf(&quot;Maximum database cache size &lt;n&gt; MiB (%d to %d, default: %d). In addition, unused mempool memory is shared for this cache (see -maxmempool).&quot;, nMinDbCache, nMaxDbCache, nDefaultDbCache), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="392"><span class="lineNum">     392 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-includeconf=&lt;file&gt;&quot;, &quot;Specify additional configuration file, relative to the -datadir path (only useable from configuration file, not command line)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="393"><span class="lineNum">     393 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-loadblock=&lt;file&gt;&quot;, &quot;Imports blocks from external file on startup&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="394"><span class="lineNum">     394 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxmempool=&lt;n&gt;&quot;, strprintf(&quot;Keep the transaction memory pool below &lt;n&gt; megabytes (default: %u)&quot;, DEFAULT_MAX_MEMPOOL_SIZE), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="395"><span class="lineNum">     395 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxorphantx=&lt;n&gt;&quot;, strprintf(&quot;Keep at most &lt;n&gt; unconnectable transactions in memory (default: %u)&quot;, DEFAULT_MAX_ORPHAN_TRANSACTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="396"><span class="lineNum">     396 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-mempoolexpiry=&lt;n&gt;&quot;, strprintf(&quot;Do not keep transactions in the mempool longer than &lt;n&gt; hours (default: %u)&quot;, DEFAULT_MEMPOOL_EXPIRY), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="397"><span class="lineNum">     397 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-minimumchainwork=&lt;hex&gt;&quot;, strprintf(&quot;Minimum work assumed to exist on a valid chain in hex (default: %s, testnet: %s, signet: %s)&quot;, defaultChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex(), testnetChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex(), signetChainParams-&gt;GetConsensus().nMinimumChainWork.GetHex()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>      <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<a name="398"><span class="lineNum">     398 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddArg(&quot;-par=&lt;n&gt;&quot;, strprintf(&quot;Set the number of script verification threads (%u to %d, 0 = auto, &lt;0 = leave that many cores free, default: %d)&quot;,</span></a>
<a name="399"><span class="lineNum">     399 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :         -GetNumCores(), MAX_SCRIPTCHECK_THREADS, DEFAULT_SCRIPTCHECK_THREADS), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="400"><span class="lineNum">     400 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-persistmempool&quot;, strprintf(&quot;Whether to save the mempool on shutdown and load on restart (default: %u)&quot;, DEFAULT_PERSIST_MEMPOOL), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="401"><span class="lineNum">     401 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-pid=&lt;file&gt;&quot;, strprintf(&quot;Specify pid file. Relative paths will be prefixed by a net-specific datadir location. (default: %s)&quot;, BITCOIN_PID_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="402"><span class="lineNum">     402 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddArg(&quot;-prune=&lt;n&gt;&quot;, strprintf(&quot;Reduce storage requirements by enabling pruning (deleting) of old blocks. This allows the pruneblockchain RPC to be called to delete specific blocks, and enables automatic pruning of old blocks if a target size in MiB is provided. This mode is incompatible with -txindex and -coinstatsindex. &quot;</span></a>
<a name="403"><span class="lineNum">     403 </span>                :            :             &quot;Warning: Reverting this setting requires re-downloading the entire blockchain. &quot;</a>
<a name="404"><span class="lineNum">     404 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2484 :             &quot;(default: 0 = disable pruning blocks, 1 = allow manual pruning via RPC, &gt;=%u = automatically prune block files to stay under the specified target size in MiB)&quot;, MIN_DISK_SPACE_FOR_BLOCK_FILES / 1024 / 1024), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<a name="405"><span class="lineNum">     405 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-reindex&quot;, &quot;Rebuild chain state and block index from the blk*.dat files on disk&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="406"><span class="lineNum">     406 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-reindex-chainstate&quot;, &quot;Rebuild chain state from the currently indexed blocks. When in pruning mode or if blocks on disk might be corrupted, use full -reindex instead.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="407"><span class="lineNum">     407 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-settings=&lt;file&gt;&quot;, strprintf(&quot;Specify path to dynamic settings data file. Can be disabled with -nosettings. File is written at runtime and not meant to be edited by users (use %s instead for custom settings). Relative paths will be prefixed by datadir location. (default: %s)&quot;, BITCOIN_CONF_FILENAME, BITCOIN_SETTINGS_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="408"><span class="lineNum">     408 </span>                :            : #if HAVE_SYSTEM</a>
<a name="409"><span class="lineNum">     409 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-startupnotify=&lt;cmd&gt;&quot;, &quot;Execute command on startup.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="410"><span class="lineNum">     410 </span>                :            : #endif</a>
<a name="411"><span class="lineNum">     411 </span>                :            : #ifndef WIN32</a>
<a name="412"><span class="lineNum">     412 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-sysperms&quot;, &quot;Create new files with system default permissions, instead of umask 077 (only effective with disabled wallet functionality)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="413"><span class="lineNum">     413 </span>                :            : #else</a>
<a name="414"><span class="lineNum">     414 </span>                :            :     hidden_args.emplace_back(&quot;-sysperms&quot;);</a>
<a name="415"><span class="lineNum">     415 </span>                :            : #endif</a>
<a name="416"><span class="lineNum">     416 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-txindex&quot;, strprintf(&quot;Maintain a full transaction index, used by the getrawtransaction rpc call (default: %u)&quot;, DEFAULT_TXINDEX), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="417"><span class="lineNum">     417 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddArg(&quot;-blockfilterindex=&lt;type&gt;&quot;,</span></a>
<a name="418"><span class="lineNum">     418 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :                  strprintf(&quot;Maintain an index of compact filters by block (default: %s, values: %s).&quot;, DEFAULT_BLOCKFILTERINDEX, ListBlockFilterTypes()) +</span></a>
<a name="419"><span class="lineNum">     419 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :                  &quot; If &lt;type&gt; is not supplied or if &lt;type&gt; = 1, indexes for all known types are enabled.&quot;,</span></a>
<a name="420"><span class="lineNum">     420 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       3726 :                  ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<a name="421"><span class="lineNum">     421 </span>                :            : </a>
<a name="422"><span class="lineNum">     422 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-addnode=&lt;ip&gt;&quot;, strprintf(&quot;Add a node to connect to and attempt to keep the connection open (see the addnode RPC help for more info). This option can be specified multiple times to add multiple nodes; connections are limited to %u at a time and are counted separately from the -maxconnections limit.&quot;, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="423"><span class="lineNum">     423 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-asmap=&lt;file&gt;&quot;, strprintf(&quot;Specify asn mapping used for bucketing of the peers (default: %s). Relative paths will be prefixed by the net-specific datadir location.&quot;, DEFAULT_ASMAP_FILENAME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="424"><span class="lineNum">     424 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-bantime=&lt;n&gt;&quot;, strprintf(&quot;Default duration (in seconds) of manually configured bans (default: %u)&quot;, DEFAULT_MISBEHAVING_BANTIME), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="425"><span class="lineNum">     425 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-bind=&lt;addr&gt;[:&lt;port&gt;][=onion]&quot;, strprintf(&quot;Bind to given address and always listen on it (default: 0.0.0.0). Use [host]:port notation for IPv6. Append =onion to tag any incoming connections to that address and port as incoming Tor connections (default: 127.0.0.1:%u=onion, testnet: 127.0.0.1:%u=onion, signet: 127.0.0.1:%u=onion, regtest: 127.0.0.1:%u=onion)&quot;, defaultBaseParams-&gt;OnionServiceTargetPort(), testnetBaseParams-&gt;OnionServiceTargetPort(), signetBaseParams-&gt;OnionServiceTargetPort(), regtestBaseParams-&gt;OnionServiceTargetPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="426"><span class="lineNum">     426 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-cjdnsreachable&quot;, &quot;If set then this host is configured for CJDNS (connecting to fc00::/8 addresses would lead us to the CJDNS network) (default: 0)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="427"><span class="lineNum">     427 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-connect=&lt;ip&gt;&quot;, &quot;Connect only to the specified node; -noconnect disables automatic connections (the rules for this peer are the same as for -addnode). This option can be specified multiple times to connect to multiple nodes.&quot;, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="428"><span class="lineNum">     428 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-discover&quot;, &quot;Discover own IP addresses (default: 1 when listening and no -externalip or -proxy)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="429"><span class="lineNum">     429 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-dns&quot;, strprintf(&quot;Allow DNS lookups for -addnode, -seednode and -connect (default: %u)&quot;, DEFAULT_NAME_LOOKUP), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="430"><span class="lineNum">     430 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-dnsseed&quot;, strprintf(&quot;Query for peer addresses via DNS lookup, if low on addresses (default: %u unless -connect used)&quot;, DEFAULT_DNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="431"><span class="lineNum">     431 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-externalip=&lt;ip&gt;&quot;, &quot;Specify your own public address&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="432"><span class="lineNum">     432 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-fixedseeds&quot;, strprintf(&quot;Allow fixed seeds if DNS seeds don't provide peers (default: %u)&quot;, DEFAULT_FIXEDSEEDS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="433"><span class="lineNum">     433 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-forcednsseed&quot;, strprintf(&quot;Always query for peer addresses via DNS lookup (default: %u)&quot;, DEFAULT_FORCEDNSSEED), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="434"><span class="lineNum">     434 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-listen&quot;, &quot;Accept connections from outside (default: 1 if no -proxy or -connect)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="435"><span class="lineNum">     435 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-listenonion&quot;, strprintf(&quot;Automatically create Tor onion service (default: %d)&quot;, DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="436"><span class="lineNum">     436 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxconnections=&lt;n&gt;&quot;, strprintf(&quot;Maintain at most &lt;n&gt; connections to peers (default: %u). This limit does not apply to connections manually added via -addnode or the addnode RPC, which have a separate limit of %u.&quot;, DEFAULT_MAX_PEER_CONNECTIONS, MAX_ADDNODE_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="437"><span class="lineNum">     437 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxreceivebuffer=&lt;n&gt;&quot;, strprintf(&quot;Maximum per-connection receive buffer, &lt;n&gt;*1000 bytes (default: %u)&quot;, DEFAULT_MAXRECEIVEBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="438"><span class="lineNum">     438 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxsendbuffer=&lt;n&gt;&quot;, strprintf(&quot;Maximum per-connection send buffer, &lt;n&gt;*1000 bytes (default: %u)&quot;, DEFAULT_MAXSENDBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="439"><span class="lineNum">     439 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxtimeadjustment&quot;, strprintf(&quot;Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by peers forward or backward by this amount. (default: %u seconds)&quot;, DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="440"><span class="lineNum">     440 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxuploadtarget=&lt;n&gt;&quot;, strprintf(&quot;Tries to keep outbound traffic under the given target per 24h. Limit does not apply to peers with 'download' permission or blocks created within past week. 0 = no limit (default: %s). Optional suffix units [k|K|m|M|g|G|t|T] (default: M). Lowercase is 1000 base while uppercase is 1024 base&quot;, DEFAULT_MAX_UPLOAD_TARGET), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="441"><span class="lineNum">     441 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-onion=&lt;ip:port&gt;&quot;, &quot;Use separate SOCKS5 proxy to reach peers via Tor onion services, set -noonion to disable (default: -proxy)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="442"><span class="lineNum">     442 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-i2psam=&lt;ip:port&gt;&quot;, &quot;I2P SAM proxy to reach I2P peers and accept I2P connections (default: none)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="443"><span class="lineNum">     443 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-i2pacceptincoming&quot;, &quot;If set and -i2psam is also set then incoming I2P connections are accepted via the SAM proxy. If this is not set but -i2psam is set then only outgoing connections will be made to the I2P network. Ignored if -i2psam is not set. Listening for incoming I2P connections is done through the SAM proxy, not by binding to a local address and port (default: 1)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="444"><span class="lineNum">     444 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       3726 :     argsman.AddArg(&quot;-onlynet=&lt;net&gt;&quot;, &quot;Make outgoing connections only through network &lt;net&gt; (&quot; + Join(GetNetworkNames(), &quot;, &quot;) + &quot;). Incoming connections are not affected by this option. This option can be specified multiple times to allow multiple networks. Warning: if it is used with non-onion networks and the -onion or -proxy option is set, then outbound onion connections will still be made; use -noonion or -onion=0 to disable outbound onion connections in this case.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<a name="445"><span class="lineNum">     445 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-peerbloomfilters&quot;, strprintf(&quot;Support filtering of blocks and transaction with bloom filters (default: %u)&quot;, DEFAULT_PEERBLOOMFILTERS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="446"><span class="lineNum">     446 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-peerblockfilters&quot;, strprintf(&quot;Serve compact block filters to peers per BIP 157 (default: %u)&quot;, DEFAULT_PEERBLOCKFILTERS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="447"><span class="lineNum">     447 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-permitbaremultisig&quot;, strprintf(&quot;Relay non-P2SH multisig (default: %u)&quot;, DEFAULT_PERMIT_BAREMULTISIG), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="448"><span class="lineNum">     448 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-port=&lt;port&gt;&quot;, strprintf(&quot;Listen for connections on &lt;port&gt;. Nodes not using the default ports (default: %u, testnet: %u, signet: %u, regtest: %u) are unlikely to get incoming connections. Not relevant for I2P (see doc/i2p.md).&quot;, defaultChainParams-&gt;GetDefaultPort(), testnetChainParams-&gt;GetDefaultPort(), signetChainParams-&gt;GetDefaultPort(), regtestChainParams-&gt;GetDefaultPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="449"><span class="lineNum">     449 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-proxy=&lt;ip:port&gt;&quot;, &quot;Connect through SOCKS5 proxy, set -noproxy to disable (default: disabled)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="450"><span class="lineNum">     450 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-proxyrandomize&quot;, strprintf(&quot;Randomize credentials for every proxy connection. This enables Tor stream isolation (default: %u)&quot;, DEFAULT_PROXYRANDOMIZE), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="451"><span class="lineNum">     451 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-seednode=&lt;ip&gt;&quot;, &quot;Connect to a node to retrieve peer addresses, and disconnect. This option can be specified multiple times to connect to multiple nodes.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="452"><span class="lineNum">     452 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-networkactive&quot;, &quot;Enable all P2P network activity (default: 1). Can be changed by the setnetworkactive RPC command&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="453"><span class="lineNum">     453 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-timeout=&lt;n&gt;&quot;, strprintf(&quot;Specify socket connection timeout in milliseconds. If an initial attempt to connect is unsuccessful after this amount of time, drop it (minimum: 1, default: %d)&quot;, DEFAULT_CONNECT_TIMEOUT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="454"><span class="lineNum">     454 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-peertimeout=&lt;n&gt;&quot;, strprintf(&quot;Specify a p2p connection timeout delay in seconds. After connecting to a peer, wait this amount of time before considering disconnection based on inactivity (minimum: 1, default: %d)&quot;, DEFAULT_PEER_CONNECT_TIMEOUT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="455"><span class="lineNum">     455 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-torcontrol=&lt;ip&gt;:&lt;port&gt;&quot;, strprintf(&quot;Tor control port to use if onion listening enabled (default: %s)&quot;, DEFAULT_TOR_CONTROL), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="456"><span class="lineNum">     456 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-torpassword=&lt;pass&gt;&quot;, &quot;Tor control port password (default: empty)&quot;, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="457"><span class="lineNum">     457 </span>                :            : #ifdef USE_UPNP</a>
<a name="458"><span class="lineNum">     458 </span>                :            : #if USE_UPNP</a>
<a name="459"><span class="lineNum">     459 </span>                :            :     argsman.AddArg(&quot;-upnp&quot;, &quot;Use UPnP to map the listening port (default: 1 when listening and no -proxy)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</a>
<a name="460"><span class="lineNum">     460 </span>                :            : #else</a>
<a name="461"><span class="lineNum">     461 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-upnp&quot;, strprintf(&quot;Use UPnP to map the listening port (default: %u)&quot;, 0), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="462"><span class="lineNum">     462 </span>                :            : #endif</a>
<a name="463"><span class="lineNum">     463 </span>                :            : #else</a>
<a name="464"><span class="lineNum">     464 </span>                :            :     hidden_args.emplace_back(&quot;-upnp&quot;);</a>
<a name="465"><span class="lineNum">     465 </span>                :            : #endif</a>
<a name="466"><span class="lineNum">     466 </span>                :            : #ifdef USE_NATPMP</a>
<a name="467"><span class="lineNum">     467 </span>                :            :     argsman.AddArg(&quot;-natpmp&quot;, strprintf(&quot;Use NAT-PMP to map the listening port (default: %s)&quot;, DEFAULT_NATPMP ? &quot;1 when listening and no -proxy&quot; : &quot;0&quot;), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</a>
<a name="468"><span class="lineNum">     468 </span>                :            : #else</a>
<a name="469"><span class="lineNum">     469 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     hidden_args.emplace_back(&quot;-natpmp&quot;);</span></a>
<a name="470"><span class="lineNum">     470 </span>                :            : #endif // USE_NATPMP</a>
<a name="471"><span class="lineNum">     471 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddArg(&quot;-whitebind=&lt;[permissions@]addr&gt;&quot;, &quot;Bind to the given address and add permission flags to the peers connecting to it. &quot;</span></a>
<a name="472"><span class="lineNum">     472 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       3726 :         &quot;Use [host]:port notation for IPv6. Allowed permissions: &quot; + Join(NET_PERMISSIONS_DOC, &quot;, &quot;) + &quot;. &quot;</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="473"><span class="lineNum">     473 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       3726 :         &quot;Specify multiple permissions separated by commas (default: download,noban,mempool,relay). Can be specified multiple times.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="474"><span class="lineNum">     474 </span>                :            : </a>
<a name="475"><span class="lineNum">     475 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddArg(&quot;-whitelist=&lt;[permissions@]IP address or network&gt;&quot;, &quot;Add permission flags to the peers connecting from the given IP address (e.g. 1.2.3.4) or &quot;</span></a>
<a name="476"><span class="lineNum">     476 </span>                :            :         &quot;CIDR-notated network (e.g. 1.2.3.0/24). Uses the same permissions as &quot;</a>
<a name="477"><span class="lineNum">     477 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :         &quot;-whitebind. Can be specified multiple times.&quot; , ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="478"><span class="lineNum">     478 </span>                :            : </a>
<a name="479"><span class="lineNum">     479 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     g_wallet_init_interface.AddWalletOptions(argsman);</span></a>
<a name="480"><span class="lineNum">     480 </span>                :            : </a>
<a name="481"><span class="lineNum">     481 </span>                :            : #if ENABLE_ZMQ</a>
<a name="482"><span class="lineNum">     482 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubhashblock=&lt;address&gt;&quot;, &quot;Enable publish hash block in &lt;address&gt;&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="483"><span class="lineNum">     483 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubhashtx=&lt;address&gt;&quot;, &quot;Enable publish hash transaction in &lt;address&gt;&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="484"><span class="lineNum">     484 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubrawblock=&lt;address&gt;&quot;, &quot;Enable publish raw block in &lt;address&gt;&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="485"><span class="lineNum">     485 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubrawtx=&lt;address&gt;&quot;, &quot;Enable publish raw transaction in &lt;address&gt;&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="486"><span class="lineNum">     486 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubsequence=&lt;address&gt;&quot;, &quot;Enable publish hash block and tx sequence in &lt;address&gt;&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="487"><span class="lineNum">     487 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubhashblockhwm=&lt;n&gt;&quot;, strprintf(&quot;Set publish hash block outbound message high water mark (default: %d)&quot;, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="488"><span class="lineNum">     488 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubhashtxhwm=&lt;n&gt;&quot;, strprintf(&quot;Set publish hash transaction outbound message high water mark (default: %d)&quot;, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="489"><span class="lineNum">     489 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubrawblockhwm=&lt;n&gt;&quot;, strprintf(&quot;Set publish raw block outbound message high water mark (default: %d)&quot;, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="490"><span class="lineNum">     490 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubrawtxhwm=&lt;n&gt;&quot;, strprintf(&quot;Set publish raw transaction outbound message high water mark (default: %d)&quot;, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="491"><span class="lineNum">     491 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-zmqpubsequencehwm=&lt;n&gt;&quot;, strprintf(&quot;Set publish hash sequence message high water mark (default: %d)&quot;, CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="492"><span class="lineNum">     492 </span>                :            : #else</a>
<a name="493"><span class="lineNum">     493 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubhashblock=&lt;address&gt;&quot;);</a>
<a name="494"><span class="lineNum">     494 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubhashtx=&lt;address&gt;&quot;);</a>
<a name="495"><span class="lineNum">     495 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubrawblock=&lt;address&gt;&quot;);</a>
<a name="496"><span class="lineNum">     496 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubrawtx=&lt;address&gt;&quot;);</a>
<a name="497"><span class="lineNum">     497 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubsequence=&lt;n&gt;&quot;);</a>
<a name="498"><span class="lineNum">     498 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubhashblockhwm=&lt;n&gt;&quot;);</a>
<a name="499"><span class="lineNum">     499 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubhashtxhwm=&lt;n&gt;&quot;);</a>
<a name="500"><span class="lineNum">     500 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubrawblockhwm=&lt;n&gt;&quot;);</a>
<a name="501"><span class="lineNum">     501 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubrawtxhwm=&lt;n&gt;&quot;);</a>
<a name="502"><span class="lineNum">     502 </span>                :            :     hidden_args.emplace_back(&quot;-zmqpubsequencehwm=&lt;n&gt;&quot;);</a>
<a name="503"><span class="lineNum">     503 </span>                :            : #endif</a>
<a name="504"><span class="lineNum">     504 </span>                :            : </a>
<a name="505"><span class="lineNum">     505 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-checkblocks=&lt;n&gt;&quot;, strprintf(&quot;How many blocks to check at startup (default: %u, 0 = all)&quot;, DEFAULT_CHECKBLOCKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="506"><span class="lineNum">     506 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       3726 :     argsman.AddArg(&quot;-checklevel=&lt;n&gt;&quot;, strprintf(&quot;How thorough the block verification of -checkblocks is: %s (0-4, default: %u)&quot;, Join(CHECKLEVEL_DOC, &quot;, &quot;), DEFAULT_CHECKLEVEL), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="507"><span class="lineNum">     507 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-checkblockindex&quot;, strprintf(&quot;Do a consistency check for the block tree, chainstate, and other validation data structures occasionally. (default: %u, regtest: %u)&quot;, defaultChainParams-&gt;DefaultConsistencyChecks(), regtestChainParams-&gt;DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="508"><span class="lineNum">     508 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-checkaddrman=&lt;n&gt;&quot;, strprintf(&quot;Run addrman consistency checks every &lt;n&gt; operations. Use 0 to disable. (default: %u)&quot;, DEFAULT_ADDRMAN_CONSISTENCY_CHECKS), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="509"><span class="lineNum">     509 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-checkmempool=&lt;n&gt;&quot;, strprintf(&quot;Run mempool consistency checks every &lt;n&gt; transactions. Use 0 to disable. (default: %u, regtest: %u)&quot;, defaultChainParams-&gt;DefaultConsistencyChecks(), regtestChainParams-&gt;DefaultConsistencyChecks()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="510"><span class="lineNum">     510 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-checkpoints&quot;, strprintf(&quot;Enable rejection of any forks from the known historical chain until block %s (default: %u)&quot;, defaultChainParams-&gt;Checkpoints().GetHeight(), DEFAULT_CHECKPOINTS_ENABLED), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="511"><span class="lineNum">     511 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-deprecatedrpc=&lt;method&gt;&quot;, &quot;Allows deprecated RPC method(s) to be used&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="512"><span class="lineNum">     512 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-stopafterblockimport&quot;, strprintf(&quot;Stop running after importing blocks from disk (default: %u)&quot;, DEFAULT_STOPAFTERBLOCKIMPORT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="513"><span class="lineNum">     513 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-stopatheight&quot;, strprintf(&quot;Stop running after reaching the given height in the main chain (default: %u)&quot;, DEFAULT_STOPATHEIGHT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="514"><span class="lineNum">     514 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-limitancestorcount=&lt;n&gt;&quot;, strprintf(&quot;Do not accept transactions if number of in-mempool ancestors is &lt;n&gt; or more (default: %u)&quot;, DEFAULT_ANCESTOR_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="515"><span class="lineNum">     515 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-limitancestorsize=&lt;n&gt;&quot;, strprintf(&quot;Do not accept transactions whose size with all in-mempool ancestors exceeds &lt;n&gt; kilobytes (default: %u)&quot;, DEFAULT_ANCESTOR_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="516"><span class="lineNum">     516 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-limitdescendantcount=&lt;n&gt;&quot;, strprintf(&quot;Do not accept transactions if any ancestor would have &lt;n&gt; or more in-mempool descendants (default: %u)&quot;, DEFAULT_DESCENDANT_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="517"><span class="lineNum">     517 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-limitdescendantsize=&lt;n&gt;&quot;, strprintf(&quot;Do not accept transactions if any ancestor would have more than &lt;n&gt; kilobytes of in-mempool descendants (default: %u).&quot;, DEFAULT_DESCENDANT_SIZE_LIMIT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="518"><span class="lineNum">     518 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-addrmantest&quot;, &quot;Allows to test address relay on localhost&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="519"><span class="lineNum">     519 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-capturemessages&quot;, &quot;Capture all P2P messages to disk&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="520"><span class="lineNum">     520 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-mocktime=&lt;n&gt;&quot;, &quot;Replace actual time with &quot; + UNIX_EPOCH_TIME + &quot; (default: 0)&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="521"><span class="lineNum">     521 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxsigcachesize=&lt;n&gt;&quot;, strprintf(&quot;Limit sum of signature cache and script execution cache sizes to &lt;n&gt; MiB (default: %u)&quot;, DEFAULT_MAX_SIG_CACHE_SIZE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="522"><span class="lineNum">     522 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-maxtipage=&lt;n&gt;&quot;, strprintf(&quot;Maximum tip age in seconds to consider node in initial block download (default: %u)&quot;, DEFAULT_MAX_TIP_AGE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="523"><span class="lineNum">     523 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-printpriority&quot;, strprintf(&quot;Log transaction fee rate in &quot; + CURRENCY_UNIT + &quot;/kvB when mining blocks (default: %u)&quot;, DEFAULT_PRINTPRIORITY), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1242 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="524"><span class="lineNum">     524 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-uacomment=&lt;cmt&gt;&quot;, &quot;Append comment to the user agent string&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::DEBUG_TEST);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="525"><span class="lineNum">     525 </span>                :            : </a>
<a name="526"><span class="lineNum">     526 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     SetupChainParamsBaseOptions(argsman);</span></a>
<a name="527"><span class="lineNum">     527 </span>                :            : </a>
<a name="528"><span class="lineNum">     528 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-acceptnonstdtxn&quot;, strprintf(&quot;Relay and mine \&quot;non-standard\&quot; transactions (%sdefault: %u)&quot;, &quot;testnet/regtest only; &quot;, !testnetChainParams-&gt;RequireStandard()), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="529"><span class="lineNum">     529 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-incrementalrelayfee=&lt;amt&gt;&quot;, strprintf(&quot;Fee rate (in %s/kvB) used to define cost of relay, used for mempool limiting and BIP 125 replacement. (default: %s)&quot;, CURRENCY_UNIT, FormatMoney(DEFAULT_INCREMENTAL_RELAY_FEE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="530"><span class="lineNum">     530 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-dustrelayfee=&lt;amt&gt;&quot;, strprintf(&quot;Fee rate (in %s/kvB) used to define dust, the value of an output such that it will cost more than its value in fees at this fee rate to spend it. (default: %s)&quot;, CURRENCY_UNIT, FormatMoney(DUST_RELAY_TX_FEE)), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="531"><span class="lineNum">     531 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-bytespersigop&quot;, strprintf(&quot;Equivalent bytes per sigop in transactions for relay and mining (default: %u)&quot;, DEFAULT_BYTES_PER_SIGOP), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="532"><span class="lineNum">     532 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-datacarrier&quot;, strprintf(&quot;Relay and mine data carrier transactions (default: %u)&quot;, DEFAULT_ACCEPT_DATACARRIER), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="533"><span class="lineNum">     533 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-datacarriersize&quot;, strprintf(&quot;Maximum size of data in data carrier transactions we relay and mine (default: %u)&quot;, MAX_OP_RETURN_RELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="534"><span class="lineNum">     534 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2484 :     argsman.AddArg(&quot;-minrelaytxfee=&lt;amt&gt;&quot;, strprintf(&quot;Fees (in %s/kvB) smaller than this are considered zero fee for relaying, mining and transaction creation (default: %s)&quot;,</span></a>
<a name="535"><span class="lineNum">     535 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :         CURRENCY_UNIT, FormatMoney(DEFAULT_MIN_RELAY_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="536"><span class="lineNum">     536 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-whitelistforcerelay&quot;, strprintf(&quot;Add 'forcerelay' permission to whitelisted inbound peers with default permissions. This will relay transactions even if the transactions were already in the mempool. (default: %d)&quot;, DEFAULT_WHITELISTFORCERELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="537"><span class="lineNum">     537 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-whitelistrelay&quot;, strprintf(&quot;Add 'relay' permission to whitelisted inbound peers with default permissions. This will accept relayed transactions even when not relaying transactions (default: %d)&quot;, DEFAULT_WHITELISTRELAY), ArgsManager::ALLOW_ANY, OptionsCategory::NODE_RELAY);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="538"><span class="lineNum">     538 </span>                :            : </a>
<a name="539"><span class="lineNum">     539 </span>                :            : </a>
<a name="540"><span class="lineNum">     540 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blockmaxweight=&lt;n&gt;&quot;, strprintf(&quot;Set maximum BIP141 block weight (default: %d)&quot;, DEFAULT_BLOCK_MAX_WEIGHT), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="541"><span class="lineNum">     541 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blockmintxfee=&lt;amt&gt;&quot;, strprintf(&quot;Set lowest fee rate (in %s/kvB) for transactions to be included in block creation. (default: %s)&quot;, CURRENCY_UNIT, FormatMoney(DEFAULT_BLOCK_MIN_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="542"><span class="lineNum">     542 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-blockversion=&lt;n&gt;&quot;, &quot;Override block version to test forking scenarios&quot;, ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::BLOCK_CREATION);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="543"><span class="lineNum">     543 </span>                :            : </a>
<a name="544"><span class="lineNum">     544 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rest&quot;, strprintf(&quot;Accept public REST requests (default: %u)&quot;, DEFAULT_REST_ENABLE), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="545"><span class="lineNum">     545 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcallowip=&lt;ip&gt;&quot;, &quot;Allow JSON-RPC connections from specified source. Valid for &lt;ip&gt; are a single IP (e.g. 1.2.3.4), a network/netmask (e.g. 1.2.3.4/255.255.255.0) or a network/CIDR (e.g. 1.2.3.4/24). This option can be specified multiple times&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="546"><span class="lineNum">     546 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcauth=&lt;userpw&gt;&quot;, &quot;Username and HMAC-SHA-256 hashed password for JSON-RPC connections. The field &lt;userpw&gt; comes in the format: &lt;USERNAME&gt;:&lt;SALT&gt;$&lt;HASH&gt;. A canonical python script is included in share/rpcauth. The client then connects normally using the rpcuser=&lt;USERNAME&gt;/rpcpassword=&lt;PASSWORD&gt; pair of arguments. This option can be specified multiple times&quot;, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="547"><span class="lineNum">     547 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcbind=&lt;addr&gt;[:port]&quot;, &quot;Bind to given address to listen for JSON-RPC connections. Do not expose the RPC server to untrusted networks such as the public internet! This option is ignored unless -rpcallowip is also passed. Port is optional and overrides -rpcport. Use [host]:port notation for IPv6. This option can be specified multiple times (default: 127.0.0.1 and ::1 i.e., localhost)&quot;, ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="548"><span class="lineNum">     548 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpccookiefile=&lt;loc&gt;&quot;, &quot;Location of the auth cookie. Relative paths will be prefixed by a net-specific datadir location. (default: data dir)&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="549"><span class="lineNum">     549 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcpassword=&lt;pw&gt;&quot;, &quot;Password for JSON-RPC connections&quot;, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="550"><span class="lineNum">     550 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcport=&lt;port&gt;&quot;, strprintf(&quot;Listen for JSON-RPC connections on &lt;port&gt; (default: %u, testnet: %u, signet: %u, regtest: %u)&quot;, defaultBaseParams-&gt;RPCPort(), testnetBaseParams-&gt;RPCPort(), signetBaseParams-&gt;RPCPort(), regtestBaseParams-&gt;RPCPort()), ArgsManager::ALLOW_ANY | ArgsManager::NETWORK_ONLY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="551"><span class="lineNum">     551 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcserialversion&quot;, strprintf(&quot;Sets the serialization of raw transaction or block hex returned in non-verbose mode, non-segwit(0) or segwit(1) (default: %d)&quot;, DEFAULT_RPC_SERIALIZE_VERSION), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="552"><span class="lineNum">     552 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcservertimeout=&lt;n&gt;&quot;, strprintf(&quot;Timeout during HTTP requests (default: %d)&quot;, DEFAULT_HTTP_SERVER_TIMEOUT), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="553"><span class="lineNum">     553 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcthreads=&lt;n&gt;&quot;, strprintf(&quot;Set the number of threads to service RPC calls (default: %d)&quot;, DEFAULT_HTTP_THREADS), ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="554"><span class="lineNum">     554 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcuser=&lt;user&gt;&quot;, &quot;Username for JSON-RPC connections&quot;, ArgsManager::ALLOW_ANY | ArgsManager::SENSITIVE, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="555"><span class="lineNum">     555 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcwhitelist=&lt;whitelist&gt;&quot;, &quot;Set a whitelist to filter incoming RPC calls for a specific user. The field &lt;whitelist&gt; comes in the format: &lt;USERNAME&gt;:&lt;rpc 1&gt;,&lt;rpc 2&gt;,...,&lt;rpc n&gt;. If multiple whitelists are set for a given user, they are set-intersected. See -rpcwhitelistdefault documentation for information on default whitelist behavior.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="556"><span class="lineNum">     556 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcwhitelistdefault&quot;, &quot;Sets default behavior for rpc whitelisting. Unless rpcwhitelistdefault is set to 0, if any -rpcwhitelist is set, the rpc server acts as if all rpc users are subject to empty-unless-otherwise-specified whitelists. If rpcwhitelistdefault is set to 1 and no -rpcwhitelist is set, rpc server acts as if all rpc users are subject to empty whitelists.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="557"><span class="lineNum">     557 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-rpcworkqueue=&lt;n&gt;&quot;, strprintf(&quot;Set the depth of the work queue to service RPC calls (default: %d)&quot;, DEFAULT_HTTP_WORKQUEUE), ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="558"><span class="lineNum">     558 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-server&quot;, &quot;Accept command line and JSON-RPC commands&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::RPC);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="559"><span class="lineNum">     559 </span>                :            : </a>
<a name="560"><span class="lineNum">     560 </span>                :            : #if HAVE_DECL_FORK</a>
<a name="561"><span class="lineNum">     561 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-daemon&quot;, strprintf(&quot;Run in the background as a daemon and accept commands (default: %d)&quot;, DEFAULT_DAEMON), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="562"><span class="lineNum">     562 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-daemonwait&quot;, strprintf(&quot;Wait for initialization to be finished before exiting. This implies -daemon (default: %d)&quot;, DEFAULT_DAEMONWAIT), ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="563"><span class="lineNum">     563 </span>                :            : #else</a>
<a name="564"><span class="lineNum">     564 </span>                :            :     hidden_args.emplace_back(&quot;-daemon&quot;);</a>
<a name="565"><span class="lineNum">     565 </span>                :            :     hidden_args.emplace_back(&quot;-daemonwait&quot;);</a>
<a name="566"><span class="lineNum">     566 </span>                :            : #endif</a>
<a name="567"><span class="lineNum">     567 </span>                :            : </a>
<a name="568"><span class="lineNum">     568 </span>                :            : #if defined(USE_SYSCALL_SANDBOX)</a>
<a name="569"><span class="lineNum">     569 </span>  [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2484 :     argsman.AddArg(&quot;-sandbox=&lt;mode&gt;&quot;, &quot;Use the experimental syscall sandbox in the specified mode (-sandbox=log-and-abort or -sandbox=abort). Allow only expected syscalls to be used by bitcoind. Note that this is an experimental new feature that may cause bitcoind to exit or crash unexpectedly: use with caution. In the \&quot;log-and-abort\&quot; mode the invocation of an unexpected syscall results in a debug handler being invoked which will log the incident and terminate the program (without executing the unexpected syscall). In the \&quot;abort\&quot; mode the invocation of an unexpected syscall results in the entire process being killed immediately by the kernel without executing the unexpected syscall.&quot;, ArgsManager::ALLOW_ANY, OptionsCategory::OPTIONS);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="570"><span class="lineNum">     570 </span>                :            : #endif // USE_SYSCALL_SANDBOX</a>
<a name="571"><span class="lineNum">     571 </span>                :            : </a>
<a name="572"><span class="lineNum">     572 </span>                :            :     // Add the hidden options</a>
<a name="573"><span class="lineNum">     573 </span>        [<span class="branchCov" title="Branch 0 was taken 1242 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1242 :     argsman.AddHiddenArgs(hidden_args);</span></a>
<a name="574"><span class="lineNum">     574 </span>                :<span class="lineCov">       1242 : }</span></a>
<a name="575"><span class="lineNum">     575 </span>                :            : </a>
<a name="576"><span class="lineNum">     576 </span>                :<span class="lineCov">          1 : std::string LicenseInfo()</span></a>
<a name="577"><span class="lineNum">     577 </span>                :            : {</a>
<a name="578"><span class="lineNum">     578 </span>                :<span class="lineCov">          1 :     const std::string URL_SOURCE_CODE = &quot;&lt;https://github.com/bitcoin/bitcoin&gt;&quot;;</span></a>
<a name="579"><span class="lineNum">     579 </span>                :            : </a>
<a name="580"><span class="lineNum">     580 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          3 :     return CopyrightHolders(strprintf(_(&quot;Copyright (C) %i-%i&quot;).translated, 2009, COPYRIGHT_YEAR) + &quot; &quot;) + &quot;\n&quot; +</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1 time"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="581"><span class="lineNum">     581 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :            &quot;\n&quot; +</span></a>
<a name="582"><span class="lineNum">     582 </span>                :<span class="lineCov">          2 :            strprintf(_(&quot;Please contribute if you find %s useful. &quot;</span></a>
<a name="583"><span class="lineNum">     583 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                        &quot;Visit %s for further information about the software.&quot;).translated,</span></a>
<a name="584"><span class="lineNum">     584 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          3 :                PACKAGE_NAME, &quot;&lt;&quot; PACKAGE_URL &quot;&gt;&quot;) +</span></a>
<a name="585"><span class="lineNum">     585 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :            &quot;\n&quot; +</span></a>
<a name="586"><span class="lineNum">     586 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :            strprintf(_(&quot;The source code is available from %s.&quot;).translated,</span></a>
<a name="587"><span class="lineNum">     587 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          3 :                URL_SOURCE_CODE) +</span></a>
<a name="588"><span class="lineNum">     588 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :            &quot;\n&quot; +</span></a>
<a name="589"><span class="lineNum">     589 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :            &quot;\n&quot; +</span></a>
<a name="590"><span class="lineNum">     590 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          4 :            _(&quot;This is experimental software.&quot;).translated + &quot;\n&quot; +</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="591"><span class="lineNum">     591 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          4 :            strprintf(_(&quot;Distributed under the MIT software license, see the accompanying file %s or %s&quot;).translated, &quot;COPYING&quot;, &quot;&lt;https://opensource.org/licenses/MIT&gt;&quot;) +</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="592"><span class="lineNum">     592 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :            &quot;\n&quot;;</span></a>
<a name="593"><span class="lineNum">     593 </span>                :            : }</a>
<a name="594"><span class="lineNum">     594 </span>                :            : </a>
<a name="595"><span class="lineNum">     595 </span>                :            : static bool fHaveGenesis = false;</a>
<a name="596"><span class="lineNum">     596 </span>                :            : static Mutex g_genesis_wait_mutex;</a>
<a name="597"><span class="lineNum">     597 </span>                :            : static std::condition_variable g_genesis_wait_cv;</a>
<a name="598"><span class="lineNum">     598 </span>                :            : </a>
<a name="599"><span class="lineNum">     599 </span>                :<span class="lineCov">        272 : static void BlockNotifyGenesisWait(const CBlockIndex* pBlockIndex)</span></a>
<a name="600"><span class="lineNum">     600 </span>                :            : {</a>
<a name="601"><span class="lineNum">     601 </span>        [<span class="branchCov" title="Branch 0 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        272 :     if (pBlockIndex != nullptr) {</span></a>
<a name="602"><span class="lineNum">     602 </span>                :<span class="lineCov">        272 :         {</span></a>
<a name="603"><span class="lineNum">     603 </span>                :<span class="lineCov">        272 :             LOCK(g_genesis_wait_mutex);</span></a>
<a name="604"><span class="lineNum">     604 </span>        [<span class="branchCov" title="Branch 0 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        272 :             fHaveGenesis = true;</span></a>
<a name="605"><span class="lineNum">     605 </span>                :            :         }</a>
<a name="606"><span class="lineNum">     606 </span>                :<span class="lineCov">        272 :         g_genesis_wait_cv.notify_all();</span></a>
<a name="607"><span class="lineNum">     607 </span>                :            :     }</a>
<a name="608"><span class="lineNum">     608 </span>                :<span class="lineCov">        272 : }</span></a>
<a name="609"><span class="lineNum">     609 </span>                :            : </a>
<a name="610"><span class="lineNum">     610 </span>                :            : #if HAVE_SYSTEM</a>
<a name="611"><span class="lineNum">     611 </span>                :<span class="lineCov">        693 : static void StartupNotify(const ArgsManager&amp; args)</span></a>
<a name="612"><span class="lineNum">     612 </span>                :            : {</a>
<a name="613"><span class="lineNum">     613 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        693 :     std::string cmd = args.GetArg(&quot;-startupnotify&quot;, &quot;&quot;);</span></a>
<a name="614"><span class="lineNum">     614 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 693 times"> + </span>]:<span class="lineCov">        693 :     if (!cmd.empty()) {</span></a>
<a name="615"><span class="lineNum">     615 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::thread t(runCommand, cmd);</span></a>
<a name="616"><span class="lineNum">     616 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         t.detach(); // thread runs free</span></a>
<a name="617"><span class="lineNum">     617 </span>                :            :     }</a>
<a name="618"><span class="lineNum">     618 </span>                :<span class="lineCov">        693 : }</span></a>
<a name="619"><span class="lineNum">     619 </span>                :            : #endif</a>
<a name="620"><span class="lineNum">     620 </span>                :            : </a>
<a name="621"><span class="lineNum">     621 </span>                :<span class="lineCov">        742 : static bool AppInitServers(NodeContext&amp; node)</span></a>
<a name="622"><span class="lineNum">     622 </span>                :            : {</a>
<a name="623"><span class="lineNum">     623 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 742 times"> + </span>]:<span class="lineCov">       1484 :     const ArgsManager&amp; args = *Assert(node.args);</span></a>
<a name="624"><span class="lineNum">     624 </span>        [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        742 :     RPCServer::OnStarted(&amp;OnRPCStarted);</span></a>
<a name="625"><span class="lineNum">     625 </span>        [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        742 :     RPCServer::OnStopped(&amp;OnRPCStopped);</span></a>
<a name="626"><span class="lineNum">     626 </span>        [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        742 :     if (!InitHTTPServer())</span></a>
<a name="627"><span class="lineNum">     627 </span>                :            :         return false;</a>
<a name="628"><span class="lineNum">     628 </span>                :<span class="lineCov">        742 :     StartRPC();</span></a>
<a name="629"><span class="lineNum">     629 </span>                :<span class="lineCov">        742 :     node.rpc_interruption_point = RpcInterruptionPoint;</span></a>
<a name="630"><span class="lineNum">     630 </span>  [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 739 times"> + </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">        742 :     if (!StartHTTPRPC(&amp;node))</span></a>
<a name="631"><span class="lineNum">     631 </span>                :            :         return false;</a>
<a name="632"><span class="lineNum">     632 </span>  [<span class="branchCov" title="Branch 0 was taken 739 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 738 times"> + </span> :<span class="lineCov">        739 :     if (args.GetBoolArg(&quot;-rest&quot;, DEFAULT_REST_ENABLE)) StartREST(&amp;node);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="633"><span class="lineNum">     633 </span>                :<span class="lineCov">        739 :     StartHTTPServer();</span></a>
<a name="634"><span class="lineNum">     634 </span>                :<span class="lineCov">        739 :     return true;</span></a>
<a name="635"><span class="lineNum">     635 </span>                :            : }</a>
<a name="636"><span class="lineNum">     636 </span>                :            : </a>
<a name="637"><span class="lineNum">     637 </span>                :            : // Parameter interaction based on rules</a>
<a name="638"><span class="lineNum">     638 </span>                :<span class="lineCov">        753 : void InitParameterInteraction(ArgsManager&amp; args)</span></a>
<a name="639"><span class="lineNum">     639 </span>                :            : {</a>
<a name="640"><span class="lineNum">     640 </span>                :            :     // when specifying an explicit binding address, you want to listen on it</a>
<a name="641"><span class="lineNum">     641 </span>                :            :     // even when -connect or -proxy is specified</a>
<a name="642"><span class="lineNum">     642 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 739 times"> + </span><span class="branchCov" title="Branch 3 was taken 14 times"> + </span>]:<span class="lineCov">        753 :     if (args.IsArgSet(&quot;-bind&quot;)) {</span></a>
<a name="643"><span class="lineNum">     643 </span>  [<span class="branchCov" title="Branch 0 was taken 739 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 734 times"> + </span><span class="branchCov" title="Branch 3 was taken 5 times"> + </span>]:<span class="lineCov">        739 :         if (args.SoftSetBoolArg(&quot;-listen&quot;, true))</span></a>
<a name="644"><span class="lineNum">     644 </span>  [<span class="branchCov" title="Branch 0 was taken 734 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 734 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2221 :             LogPrintf(&quot;%s: parameter interaction: -bind set -&gt; setting -listen=1\n&quot;, __func__);</span></a>
<a name="645"><span class="lineNum">     645 </span>                :            :     }</a>
<a name="646"><span class="lineNum">     646 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 751 times"> + </span>]:<span class="lineCov">        753 :     if (args.IsArgSet(&quot;-whitebind&quot;)) {</span></a>
<a name="647"><span class="lineNum">     647 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">          2 :         if (args.SoftSetBoolArg(&quot;-listen&quot;, true))</span></a>
<a name="648"><span class="lineNum">     648 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        755 :             LogPrintf(&quot;%s: parameter interaction: -whitebind set -&gt; setting -listen=1\n&quot;, __func__);</span></a>
<a name="649"><span class="lineNum">     649 </span>                :            :     }</a>
<a name="650"><span class="lineNum">     650 </span>                :            : </a>
<a name="651"><span class="lineNum">     651 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 733 times"> + </span><span class="branchCov" title="Branch 3 was taken 20 times"> + </span>]:<span class="lineCov">        753 :     if (args.IsArgSet(&quot;-connect&quot;)) {</span></a>
<a name="652"><span class="lineNum">     652 </span>                :            :         // when only connecting to trusted nodes, do not seed via DNS, or listen by default</a>
<a name="653"><span class="lineNum">     653 </span>  [<span class="branchCov" title="Branch 0 was taken 733 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 733 times"> + </span>]:<span class="lineCov">        733 :         if (args.SoftSetBoolArg(&quot;-dnsseed&quot;, false))</span></a>
<a name="654"><span class="lineNum">     654 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        733 :             LogPrintf(&quot;%s: parameter interaction: -connect set -&gt; setting -dnsseed=0\n&quot;, __func__);</span></a>
<a name="655"><span class="lineNum">     655 </span>  [<span class="branchCov" title="Branch 0 was taken 733 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchCov" title="Branch 3 was taken 730 times"> + </span>]:<span class="lineCov">        733 :         if (args.SoftSetBoolArg(&quot;-listen&quot;, false))</span></a>
<a name="656"><span class="lineNum">     656 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        759 :             LogPrintf(&quot;%s: parameter interaction: -connect set -&gt; setting -listen=0\n&quot;, __func__);</span></a>
<a name="657"><span class="lineNum">     657 </span>                :            :     }</a>
<a name="658"><span class="lineNum">     658 </span>                :            : </a>
<a name="659"><span class="lineNum">     659 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchCov" title="Branch 3 was taken 746 times"> + </span>]:<span class="lineCov">        753 :     if (args.IsArgSet(&quot;-proxy&quot;)) {</span></a>
<a name="660"><span class="lineNum">     660 </span>                :            :         // to protect privacy, do not listen by default if a default proxy server is specified</a>
<a name="661"><span class="lineNum">     661 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         if (args.SoftSetBoolArg(&quot;-listen&quot;, false))</span></a>
<a name="662"><span class="lineNum">     662 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :             LogPrintf(&quot;%s: parameter interaction: -proxy set -&gt; setting -listen=0\n&quot;, __func__);</span></a>
<a name="663"><span class="lineNum">     663 </span>                :            :         // to protect privacy, do not map ports when a proxy is set. The user may still specify -listen=1</a>
<a name="664"><span class="lineNum">     664 </span>                :            :         // to listen locally, so don't rely on this happening through -listen below.</a>
<a name="665"><span class="lineNum">     665 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         if (args.SoftSetBoolArg(&quot;-upnp&quot;, false))</span></a>
<a name="666"><span class="lineNum">     666 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :             LogPrintf(&quot;%s: parameter interaction: -proxy set -&gt; setting -upnp=0\n&quot;, __func__);</span></a>
<a name="667"><span class="lineNum">     667 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         if (args.SoftSetBoolArg(&quot;-natpmp&quot;, false)) {</span></a>
<a name="668"><span class="lineNum">     668 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :             LogPrintf(&quot;%s: parameter interaction: -proxy set -&gt; setting -natpmp=0\n&quot;, __func__);</span></a>
<a name="669"><span class="lineNum">     669 </span>                :            :         }</a>
<a name="670"><span class="lineNum">     670 </span>                :            :         // to protect privacy, do not discover addresses by default</a>
<a name="671"><span class="lineNum">     671 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         if (args.SoftSetBoolArg(&quot;-discover&quot;, false))</span></a>
<a name="672"><span class="lineNum">     672 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        753 :             LogPrintf(&quot;%s: parameter interaction: -proxy set -&gt; setting -discover=0\n&quot;, __func__);</span></a>
<a name="673"><span class="lineNum">     673 </span>                :            :     }</a>
<a name="674"><span class="lineNum">     674 </span>                :            : </a>
<a name="675"><span class="lineNum">     675 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 13 times"> + </span><span class="branchCov" title="Branch 3 was taken 740 times"> + </span>]:<span class="lineCov">        753 :     if (!args.GetBoolArg(&quot;-listen&quot;, DEFAULT_LISTEN)) {</span></a>
<a name="676"><span class="lineNum">     676 </span>                :            :         // do not map ports or try to retrieve public IP when not listening (pointless)</a>
<a name="677"><span class="lineNum">     677 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 13 times"> + </span>]:<span class="lineCov">         13 :         if (args.SoftSetBoolArg(&quot;-upnp&quot;, false))</span></a>
<a name="678"><span class="lineNum">     678 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         13 :             LogPrintf(&quot;%s: parameter interaction: -listen=0 -&gt; setting -upnp=0\n&quot;, __func__);</span></a>
<a name="679"><span class="lineNum">     679 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 13 times"> + </span>]:<span class="lineCov">         13 :         if (args.SoftSetBoolArg(&quot;-natpmp&quot;, false)) {</span></a>
<a name="680"><span class="lineNum">     680 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         13 :             LogPrintf(&quot;%s: parameter interaction: -listen=0 -&gt; setting -natpmp=0\n&quot;, __func__);</span></a>
<a name="681"><span class="lineNum">     681 </span>                :            :         }</a>
<a name="682"><span class="lineNum">     682 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 13 times"> + </span>]:<span class="lineCov">         13 :         if (args.SoftSetBoolArg(&quot;-discover&quot;, false))</span></a>
<a name="683"><span class="lineNum">     683 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         13 :             LogPrintf(&quot;%s: parameter interaction: -listen=0 -&gt; setting -discover=0\n&quot;, __func__);</span></a>
<a name="684"><span class="lineNum">     684 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 13 times"> + </span>]:<span class="lineCov">         13 :         if (args.SoftSetBoolArg(&quot;-listenonion&quot;, false))</span></a>
<a name="685"><span class="lineNum">     685 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         13 :             LogPrintf(&quot;%s: parameter interaction: -listen=0 -&gt; setting -listenonion=0\n&quot;, __func__);</span></a>
<a name="686"><span class="lineNum">     686 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         13 :         if (args.SoftSetBoolArg(&quot;-i2pacceptincoming&quot;, false)) {</span></a>
<a name="687"><span class="lineNum">     687 </span>  [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 13 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        779 :             LogPrintf(&quot;%s: parameter interaction: -listen=0 -&gt; setting -i2pacceptincoming=0\n&quot;, __func__);</span></a>
<a name="688"><span class="lineNum">     688 </span>                :            :         }</a>
<a name="689"><span class="lineNum">     689 </span>                :            :     }</a>
<a name="690"><span class="lineNum">     690 </span>                :            : </a>
<a name="691"><span class="lineNum">     691 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 753 times"> + </span>]:<span class="lineCov">        753 :     if (args.IsArgSet(&quot;-externalip&quot;)) {</span></a>
<a name="692"><span class="lineNum">     692 </span>                :            :         // if an explicit public IP is specified, do not try to find others</a>
<a name="693"><span class="lineNum">     693 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (args.SoftSetBoolArg(&quot;-discover&quot;, false))</span></a>
<a name="694"><span class="lineNum">     694 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        753 :             LogPrintf(&quot;%s: parameter interaction: -externalip set -&gt; setting -discover=0\n&quot;, __func__);</span></a>
<a name="695"><span class="lineNum">     695 </span>                :            :     }</a>
<a name="696"><span class="lineNum">     696 </span>                :            : </a>
<a name="697"><span class="lineNum">     697 </span>                :            :     // disable whitelistrelay in blocksonly mode</a>
<a name="698"><span class="lineNum">     698 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchCov" title="Branch 3 was taken 747 times"> + </span>]:<span class="lineCov">        753 :     if (args.GetBoolArg(&quot;-blocksonly&quot;, DEFAULT_BLOCKSONLY)) {</span></a>
<a name="699"><span class="lineNum">     699 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          6 :         if (args.SoftSetBoolArg(&quot;-whitelistrelay&quot;, false))</span></a>
<a name="700"><span class="lineNum">     700 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        765 :             LogPrintf(&quot;%s: parameter interaction: -blocksonly=1 -&gt; setting -whitelistrelay=0\n&quot;, __func__);</span></a>
<a name="701"><span class="lineNum">     701 </span>                :            :     }</a>
<a name="702"><span class="lineNum">     702 </span>                :            : </a>
<a name="703"><span class="lineNum">     703 </span>                :            :     // Forcing relay from whitelisted hosts implies we will accept relays from them in the first place.</a>
<a name="704"><span class="lineNum">     704 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchCov" title="Branch 3 was taken 750 times"> + </span>]:<span class="lineCov">        753 :     if (args.GetBoolArg(&quot;-whitelistforcerelay&quot;, DEFAULT_WHITELISTFORCERELAY)) {</span></a>
<a name="705"><span class="lineNum">     705 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          3 :         if (args.SoftSetBoolArg(&quot;-whitelistrelay&quot;, true))</span></a>
<a name="706"><span class="lineNum">     706 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        759 :             LogPrintf(&quot;%s: parameter interaction: -whitelistforcerelay=1 -&gt; setting -whitelistrelay=1\n&quot;, __func__);</span></a>
<a name="707"><span class="lineNum">     707 </span>                :            :     }</a>
<a name="708"><span class="lineNum">     708 </span>                :<span class="lineCov">        753 : }</span></a>
<a name="709"><span class="lineNum">     709 </span>                :            : </a>
<a name="710"><span class="lineNum">     710 </span>                :            : /**</a>
<a name="711"><span class="lineNum">     711 </span>                :            :  * Initialize global loggers.</a>
<a name="712"><span class="lineNum">     712 </span>                :            :  *</a>
<a name="713"><span class="lineNum">     713 </span>                :            :  * Note that this is called very early in the process lifetime, so you should be</a>
<a name="714"><span class="lineNum">     714 </span>                :            :  * careful about what global state you rely on here.</a>
<a name="715"><span class="lineNum">     715 </span>                :            :  */</a>
<a name="716"><span class="lineNum">     716 </span>                :<span class="lineCov">       1218 : void InitLogging(const ArgsManager&amp; args)</span></a>
<a name="717"><span class="lineNum">     717 </span>                :            : {</a>
<a name="718"><span class="lineNum">     718 </span>                :<span class="lineCov">       1218 :     init::SetLoggingOptions(args);</span></a>
<a name="719"><span class="lineNum">     719 </span>                :<span class="lineCov">       1218 :     init::LogPackageVersion();</span></a>
<a name="720"><span class="lineNum">     720 </span>                :<span class="lineCov">       1218 : }</span></a>
<a name="721"><span class="lineNum">     721 </span>                :            : </a>
<a name="722"><span class="lineNum">     722 </span>                :            : namespace { // Variables internal to initialization process only</a>
<a name="723"><span class="lineNum">     723 </span>                :            : </a>
<a name="724"><span class="lineNum">     724 </span>                :            : int nMaxConnections;</a>
<a name="725"><span class="lineNum">     725 </span>                :            : int nUserMaxConnections;</a>
<a name="726"><span class="lineNum">     726 </span>                :            : int nFD;</a>
<a name="727"><span class="lineNum">     727 </span>                :            : ServiceFlags nLocalServices = ServiceFlags(NODE_NETWORK | NODE_NETWORK_LIMITED | NODE_WITNESS);</a>
<a name="728"><span class="lineNum">     728 </span>                :            : int64_t peer_connect_timeout;</a>
<a name="729"><span class="lineNum">     729 </span>                :            : std::set&lt;BlockFilterType&gt; g_enabled_filter_types;</a>
<a name="730"><span class="lineNum">     730 </span>                :            : </a>
<a name="731"><span class="lineNum">     731 </span>                :            : } // namespace</a>
<a name="732"><span class="lineNum">     732 </span>                :            : </a>
<a name="733"><span class="lineNum">     733 </span>                :<span class="lineNoCov">          0 : [[noreturn]] static void new_handler_terminate()</span></a>
<a name="734"><span class="lineNum">     734 </span>                :            : {</a>
<a name="735"><span class="lineNum">     735 </span>                :            :     // Rather than throwing std::bad-alloc if allocation fails, terminate</a>
<a name="736"><span class="lineNum">     736 </span>                :            :     // immediately to (try to) avoid chain corruption.</a>
<a name="737"><span class="lineNum">     737 </span>                :            :     // Since LogPrintf may itself allocate memory, set the handler directly</a>
<a name="738"><span class="lineNum">     738 </span>                :            :     // to terminate first.</a>
<a name="739"><span class="lineNum">     739 </span>                :<span class="lineNoCov">          0 :     std::set_new_handler(std::terminate);</span></a>
<a name="740"><span class="lineNum">     740 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :     LogPrintf(&quot;Error: Out of memory. Terminating.\n&quot;);</span></a>
<a name="741"><span class="lineNum">     741 </span>                :            : </a>
<a name="742"><span class="lineNum">     742 </span>                :            :     // The log was successful, terminate now.</a>
<a name="743"><span class="lineNum">     743 </span>                :<span class="lineNoCov">          0 :     std::terminate();</span></a>
<a name="744"><span class="lineNum">     744 </span>                :            : };</a>
<a name="745"><span class="lineNum">     745 </span>                :            : </a>
<a name="746"><span class="lineNum">     746 </span>                :<span class="lineCov">        753 : bool AppInitBasicSetup(const ArgsManager&amp; args)</span></a>
<a name="747"><span class="lineNum">     747 </span>                :            : {</a>
<a name="748"><span class="lineNum">     748 </span>                :            :     // ********************************************************* Step 1: setup</a>
<a name="749"><span class="lineNum">     749 </span>                :            : #ifdef _MSC_VER</a>
<a name="750"><span class="lineNum">     750 </span>                :            :     // Turn off Microsoft heap dump noise</a>
<a name="751"><span class="lineNum">     751 </span>                :            :     _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);</a>
<a name="752"><span class="lineNum">     752 </span>                :            :     _CrtSetReportFile(_CRT_WARN, CreateFileA(&quot;NUL&quot;, GENERIC_WRITE, 0, nullptr, OPEN_EXISTING, 0, 0));</a>
<a name="753"><span class="lineNum">     753 </span>                :            :     // Disable confusing &quot;helpful&quot; text message on abort, Ctrl-C</a>
<a name="754"><span class="lineNum">     754 </span>                :            :     _set_abort_behavior(0, _WRITE_ABORT_MSG | _CALL_REPORTFAULT);</a>
<a name="755"><span class="lineNum">     755 </span>                :            : #endif</a>
<a name="756"><span class="lineNum">     756 </span>                :            : #ifdef WIN32</a>
<a name="757"><span class="lineNum">     757 </span>                :            :     // Enable heap terminate-on-corruption</a>
<a name="758"><span class="lineNum">     758 </span>                :            :     HeapSetInformation(nullptr, HeapEnableTerminationOnCorruption, nullptr, 0);</a>
<a name="759"><span class="lineNum">     759 </span>                :            : #endif</a>
<a name="760"><span class="lineNum">     760 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 753 times"> + </span>]:<span class="lineCov">        753 :     if (!InitShutdownState()) {</span></a>
<a name="761"><span class="lineNum">     761 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        753 :         return InitError(Untranslated(&quot;Initializing wait-for-shutdown state failed.&quot;));</span></a>
<a name="762"><span class="lineNum">     762 </span>                :            :     }</a>
<a name="763"><span class="lineNum">     763 </span>                :            : </a>
<a name="764"><span class="lineNum">     764 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 753 times"> + </span>]:<span class="lineCov">        753 :     if (!SetupNetworking()) {</span></a>
<a name="765"><span class="lineNum">     765 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        753 :         return InitError(Untranslated(&quot;Initializing networking failed.&quot;));</span></a>
<a name="766"><span class="lineNum">     766 </span>                :            :     }</a>
<a name="767"><span class="lineNum">     767 </span>                :            : </a>
<a name="768"><span class="lineNum">     768 </span>                :            : #ifndef WIN32</a>
<a name="769"><span class="lineNum">     769 </span>  [<span class="branchCov" title="Branch 0 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 753 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        753 :     if (!args.GetBoolArg(&quot;-sysperms&quot;, false)) {</span></a>
<a name="770"><span class="lineNum">     770 </span>                :<span class="lineCov">        753 :         umask(077);</span></a>
<a name="771"><span class="lineNum">     771 </span>                :            :     }</a>
<a name="772"><span class="lineNum">     772 </span>                :            : </a>
<a name="773"><span class="lineNum">     773 </span>                :            :     // Clean shutdown on SIGTERM</a>
<a name="774"><span class="lineNum">     774 </span>                :<span class="lineCov">        753 :     registerSignalHandler(SIGTERM, HandleSIGTERM);</span></a>
<a name="775"><span class="lineNum">     775 </span>                :<span class="lineCov">        753 :     registerSignalHandler(SIGINT, HandleSIGTERM);</span></a>
<a name="776"><span class="lineNum">     776 </span>                :            : </a>
<a name="777"><span class="lineNum">     777 </span>                :            :     // Reopen debug.log on SIGHUP</a>
<a name="778"><span class="lineNum">     778 </span>                :<span class="lineCov">        753 :     registerSignalHandler(SIGHUP, HandleSIGHUP);</span></a>
<a name="779"><span class="lineNum">     779 </span>                :            : </a>
<a name="780"><span class="lineNum">     780 </span>                :            :     // Ignore SIGPIPE, otherwise it will bring the daemon down if the client closes unexpectedly</a>
<a name="781"><span class="lineNum">     781 </span>                :<span class="lineCov">        753 :     signal(SIGPIPE, SIG_IGN);</span></a>
<a name="782"><span class="lineNum">     782 </span>                :            : #else</a>
<a name="783"><span class="lineNum">     783 </span>                :            :     SetConsoleCtrlHandler(consoleCtrlHandler, true);</a>
<a name="784"><span class="lineNum">     784 </span>                :            : #endif</a>
<a name="785"><span class="lineNum">     785 </span>                :            : </a>
<a name="786"><span class="lineNum">     786 </span>                :<span class="lineCov">        753 :     std::set_new_handler(new_handler_terminate);</span></a>
<a name="787"><span class="lineNum">     787 </span>                :            : </a>
<a name="788"><span class="lineNum">     788 </span>                :<span class="lineCov">        753 :     return true;</span></a>
<a name="789"><span class="lineNum">     789 </span>                :            : }</a>
<a name="790"><span class="lineNum">     790 </span>                :            : </a>
<a name="791"><span class="lineNum">     791 </span>                :<span class="lineCov">       1218 : bool AppInitParameterInteraction(const ArgsManager&amp; args)</span></a>
<a name="792"><span class="lineNum">     792 </span>                :            : {</a>
<a name="793"><span class="lineNum">     793 </span>                :<span class="lineCov">       1218 :     const CChainParams&amp; chainparams = Params();</span></a>
<a name="794"><span class="lineNum">     794 </span>                :            :     // ********************************************************* Step 2: parameter interactions</a>
<a name="795"><span class="lineNum">     795 </span>                :            : </a>
<a name="796"><span class="lineNum">     796 </span>                :            :     // also see: InitParameterInteraction()</a>
<a name="797"><span class="lineNum">     797 </span>                :            : </a>
<a name="798"><span class="lineNum">     798 </span>                :            :     // Error if network-specific options (-addnode, -connect, etc) are</a>
<a name="799"><span class="lineNum">     799 </span>                :            :     // specified in default section of config file, but not overridden</a>
<a name="800"><span class="lineNum">     800 </span>                :            :     // on the command line or in this network's section of the config file.</a>
<a name="801"><span class="lineNum">     801 </span>                :<span class="lineCov">       2436 :     std::string network = args.GetChainName();</span></a>
<a name="802"><span class="lineNum">     802 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 1211 times"> + </span>]:<span class="lineCov">       1218 :     if (network == CBaseChainParams::SIGNET) {</span></a>
<a name="803"><span class="lineNum">     803 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         14 :         LogPrintf(&quot;Signet derived magic (message start): %s\n&quot;, HexStr(chainparams.MessageStart()));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="804"><span class="lineNum">     804 </span>                :            :     }</a>
<a name="805"><span class="lineNum">     805 </span>        [<span class="branchCov" title="Branch 0 was taken 1218 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2436 :     bilingual_str errors;</span></a>
<a name="806"><span class="lineNum">     806 </span>  [<span class="branchCov" title="Branch 0 was taken 1218 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 1218 times"> + </span>]:<span class="lineCov">       1219 :     for (const auto&amp; arg : args.GetUnsuitableSectionOnlyArgs()) {</span></a>
<a name="807"><span class="lineNum">     807 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          7 :         errors += strprintf(_(&quot;Config setting for %s only applied on %s network when in [%s] section.&quot;) + Untranslated(&quot;\n&quot;), arg, network, network);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="808"><span class="lineNum">     808 </span>                :            :     }</a>
<a name="809"><span class="lineNum">     809 </span>                :            : </a>
<a name="810"><span class="lineNum">     810 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1217 times"> + </span>]:<span class="lineCov">       1218 :     if (!errors.empty()) {</span></a>
<a name="811"><span class="lineNum">     811 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         return InitError(errors);</span></a>
<a name="812"><span class="lineNum">     812 </span>                :            :     }</a>
<a name="813"><span class="lineNum">     813 </span>                :            : </a>
<a name="814"><span class="lineNum">     814 </span>                :            :     // Warn if unrecognized section name are present in the config file.</a>
<a name="815"><span class="lineNum">     815 </span>        [<span class="branchCov" title="Branch 0 was taken 1217 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       2435 :     bilingual_str warnings;</span></a>
<a name="816"><span class="lineNum">     816 </span>  [<span class="branchCov" title="Branch 0 was taken 1217 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 1217 times"> + </span>]:<span class="lineCov">       1219 :     for (const auto&amp; section : args.GetUnrecognizedSections()) {</span></a>
<a name="817"><span class="lineNum">     817 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         22 :         warnings += strprintf(Untranslated(&quot;%s:%i &quot;) + _(&quot;Section [%s] is not recognized.&quot;) + Untranslated(&quot;\n&quot;), section.m_file, section.m_line, section.m_name);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 2 times"> + </span> 
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 2 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<a name="818"><span class="lineNum">     818 </span>                :            :     }</a>
<a name="819"><span class="lineNum">     819 </span>                :            : </a>
<a name="820"><span class="lineNum">     820 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1216 times"> + </span>]:<span class="lineCov">       1217 :     if (!warnings.empty()) {</span></a>
<a name="821"><span class="lineNum">     821 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         InitWarning(warnings);</span></a>
<a name="822"><span class="lineNum">     822 </span>                :            :     }</a>
<a name="823"><span class="lineNum">     823 </span>                :            : </a>
<a name="824"><span class="lineNum">     824 </span>  [<span class="branchCov" title="Branch 0 was taken 1217 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1217 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1217 :     if (!fs::is_directory(gArgs.GetBlocksDirPath())) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchCov" title="Branch 5 was taken 1216 times"> + </span>]
<a name="825"><span class="lineNum">     825 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          3 :         return InitError(strprintf(_(&quot;Specified blocks directory \&quot;%s\&quot; does not exist.&quot;), args.GetArg(&quot;-blocksdir&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 1 time"> + </span> 
<span class="lineNum">         </span>      <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span>]
<a name="826"><span class="lineNum">     826 </span>                :            :     }</a>
<a name="827"><span class="lineNum">     827 </span>                :            : </a>
<a name="828"><span class="lineNum">     828 </span>                :            :     // parse and validate enabled filter types</a>
<a name="829"><span class="lineNum">     829 </span>  [<span class="branchCov" title="Branch 0 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2433 :     std::string blockfilterindex_value = args.GetArg(&quot;-blockfilterindex&quot;, DEFAULT_BLOCKFILTERINDEX);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="830"><span class="lineNum">     830 </span>  [<span class="branchCov" title="Branch 0 was taken 1211 times"> + </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 1209 times"> + </span>]:<span class="lineCov">       2427 :     if (blockfilterindex_value == &quot;&quot; || blockfilterindex_value == &quot;1&quot;) {</span></a>
<a name="831"><span class="lineNum">     831 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :         g_enabled_filter_types = AllBlockFilterTypes();</span></a>
<a name="832"><span class="lineNum">     832 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1209 times"> + </span>]:<span class="lineCov">       1209 :     } else if (blockfilterindex_value != &quot;0&quot;) {</span></a>
<a name="833"><span class="lineNum">     833 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         const std::vector&lt;std::string&gt; names = args.GetArgs(&quot;-blockfilterindex&quot;);</span></a>
<a name="834"><span class="lineNum">     834 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         for (const auto&amp; name : names) {</span></a>
<a name="835"><span class="lineNum">     835 </span>                :<span class="lineNoCov">          0 :             BlockFilterType filter_type;</span></a>
<a name="836"><span class="lineNum">     836 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (!BlockFilterTypeByName(name, filter_type)) {</span></a>
<a name="837"><span class="lineNum">     837 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                 return InitError(strprintf(_(&quot;Unknown -blockfilterindex value %s.&quot;), name));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="838"><span class="lineNum">     838 </span>                :            :             }</a>
<a name="839"><span class="lineNum">     839 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             g_enabled_filter_types.insert(filter_type);</span></a>
<a name="840"><span class="lineNum">     840 </span>                :            :         }</a>
<a name="841"><span class="lineNum">     841 </span>                :            :     }</a>
<a name="842"><span class="lineNum">     842 </span>                :            : </a>
<a name="843"><span class="lineNum">     843 </span>                :            :     // Signal NODE_COMPACT_FILTERS if peerblockfilters and basic filters index are both enabled.</a>
<a name="844"><span class="lineNum">     844 </span>  [<span class="branchCov" title="Branch 0 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1216 :     if (args.GetBoolArg(&quot;-peerblockfilters&quot;, DEFAULT_PEERBLOCKFILTERS)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchCov" title="Branch 5 was taken 1215 times"> + </span>]
<a name="845"><span class="lineNum">     845 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :         if (g_enabled_filter_types.count(BlockFilterType::BASIC) != 1) {</span></a>
<a name="846"><span class="lineNum">     846 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(_(&quot;Cannot set -peerblockfilters without -blockfilterindex.&quot;));</span></a>
<a name="847"><span class="lineNum">     847 </span>                :            :         }</a>
<a name="848"><span class="lineNum">     848 </span>                :            : </a>
<a name="849"><span class="lineNum">     849 </span>                :<span class="lineCov">          1 :         nLocalServices = ServiceFlags(nLocalServices | NODE_COMPACT_FILTERS);</span></a>
<a name="850"><span class="lineNum">     850 </span>                :            :     }</a>
<a name="851"><span class="lineNum">     851 </span>                :            : </a>
<a name="852"><span class="lineNum">     852 </span>                :            :     // if using block pruning, then disallow txindex and coinstatsindex</a>
<a name="853"><span class="lineNum">     853 </span>  [<span class="branchCov" title="Branch 0 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1216 :     if (args.GetIntArg(&quot;-prune&quot;, 0)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 9 times"> + </span><span class="branchCov" title="Branch 5 was taken 1207 times"> + </span>]
<a name="854"><span class="lineNum">     854 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          9 :         if (args.GetBoolArg(&quot;-txindex&quot;, DEFAULT_TXINDEX))</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 9 times"> + </span>]
<a name="855"><span class="lineNum">     855 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(_(&quot;Prune mode is incompatible with -txindex.&quot;));</span></a>
<a name="856"><span class="lineNum">     856 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          9 :         if (args.GetBoolArg(&quot;-coinstatsindex&quot;, DEFAULT_COINSTATSINDEX))</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 9 times"> + </span>]
<a name="857"><span class="lineNum">     857 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(_(&quot;Prune mode is incompatible with -coinstatsindex.&quot;));</span></a>
<a name="858"><span class="lineNum">     858 </span>                :            :     }</a>
<a name="859"><span class="lineNum">     859 </span>                :            : </a>
<a name="860"><span class="lineNum">     860 </span>                :            :     // If -forcednsseed is set to true, ensure -dnsseed has not been set to false</a>
<a name="861"><span class="lineNum">     861 </span>  [<span class="branchCov" title="Branch 0 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1216 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1220 :     if (args.GetBoolArg(&quot;-forcednsseed&quot;, DEFAULT_FORCEDNSSEED) &amp;&amp; !args.GetBoolArg(&quot;-dnsseed&quot;, DEFAULT_DNSSEED)){</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchCov" title="Branch 5 was taken 1213 times"> + </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 3 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchCov" title="Branch 11 was taken 2 times"> + </span><span class="branchCov" title="Branch 12 was taken 3 times"> + </span><span class="branchCov" title="Branch 13 was taken 1213 times"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 2 times"> + </span><span class="branchCov" title="Branch 15 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<a name="862"><span class="lineNum">     862 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          2 :         return InitError(_(&quot;Cannot set -forcednsseed to true when setting -dnsseed to false.&quot;));</span></a>
<a name="863"><span class="lineNum">     863 </span>                :            :     }</a>
<a name="864"><span class="lineNum">     864 </span>                :            : </a>
<a name="865"><span class="lineNum">     865 </span>                :            :     // -bind and -whitebind can't be set when not listening</a>
<a name="866"><span class="lineNum">     866 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     size_t nUserBind = args.GetArgs(&quot;-bind&quot;).size() + args.GetArgs(&quot;-whitebind&quot;).size();</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 737 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchCov" title="Branch 9 was taken 477 times"> + </span>]
<a name="867"><span class="lineNum">     867 </span>  [<span class="branchCov" title="Branch 0 was taken 737 times"> + </span><span class="branchCov" title="Branch 1 was taken 477 times"> + </span><span class="branchCov" title="Branch 2 was taken 737 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2688 :     if (nUserBind != 0 &amp;&amp; !args.GetBoolArg(&quot;-listen&quot;, DEFAULT_LISTEN)) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 737 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 737 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 737 times"> + </span> 
<span class="lineNum">         </span>      <span class="branchCov" title="Branch 9 was taken 477 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 1214 times"> + </span>]
<a name="868"><span class="lineNum">     868 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(Untranslated(&quot;Cannot set -bind or -whitebind together with -listen=0&quot;));</span></a>
<a name="869"><span class="lineNum">     869 </span>                :            :     }</a>
<a name="870"><span class="lineNum">     870 </span>                :            : </a>
<a name="871"><span class="lineNum">     871 </span>                :            :     // if listen=0, then disallow listenonion=1</a>
<a name="872"><span class="lineNum">     872 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1238 :     if (!args.GetBoolArg(&quot;-listen&quot;, DEFAULT_LISTEN) &amp;&amp; args.GetBoolArg(&quot;-listenonion&quot;, DEFAULT_LISTEN_ONION)) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 12 times"> + </span><span class="branchCov" title="Branch 5 was taken 1202 times"> + </span><span class="branchCov" title="Branch 6 was taken 12 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 12 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 12 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 12 times"> + </span><span class="branchCov" title="Branch 13 was taken 1202 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 14 was not taken"> - </span><span class="branchCov" title="Branch 15 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<a name="873"><span class="lineNum">     873 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(Untranslated(&quot;Cannot set -listen=0 together with -listenonion=1&quot;));</span></a>
<a name="874"><span class="lineNum">     874 </span>                :            :     }</a>
<a name="875"><span class="lineNum">     875 </span>                :            : </a>
<a name="876"><span class="lineNum">     876 </span>                :            :     // Make sure enough file descriptors are available</a>
<a name="877"><span class="lineNum">     877 </span>        [<span class="branchCov" title="Branch 0 was taken 477 times"> + </span><span class="branchCov" title="Branch 1 was taken 737 times"> + </span>]:<span class="lineCov">       1214 :     int nBind = std::max(nUserBind, size_t(1));</span></a>
<a name="878"><span class="lineNum">     878 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     nUserMaxConnections = args.GetIntArg(&quot;-maxconnections&quot;, DEFAULT_MAX_PEER_CONNECTIONS);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="879"><span class="lineNum">     879 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     nMaxConnections = std::max(nUserMaxConnections, 0);</span></a>
<a name="880"><span class="lineNum">     880 </span>                :            : </a>
<a name="881"><span class="lineNum">     881 </span>        [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1214 :     nFD = RaiseFileDescriptorLimit(nMaxConnections + MIN_CORE_FILEDESCRIPTORS + MAX_ADDNODE_CONNECTIONS + nBind + NUM_FDS_MESSAGE_CAPTURE);</span></a>
<a name="882"><span class="lineNum">     882 </span>                :            : </a>
<a name="883"><span class="lineNum">     883 </span>                :            : #ifdef USE_POLL</a>
<a name="884"><span class="lineNum">     884 </span>                :<span class="lineCov">       1214 :     int fd_max = nFD;</span></a>
<a name="885"><span class="lineNum">     885 </span>                :            : #else</a>
<a name="886"><span class="lineNum">     886 </span>                :            :     int fd_max = FD_SETSIZE;</a>
<a name="887"><span class="lineNum">     887 </span>                :            : #endif</a>
<a name="888"><span class="lineNum">     888 </span>                :            :     // Trim requested connection counts, to fit into system limitations</a>
<a name="889"><span class="lineNum">     889 </span>                :            :     // &lt;int&gt; in std::min&lt;int&gt;(...) to work around FreeBSD compilation issue described in #2695</a>
<a name="890"><span class="lineNum">     890 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     nMaxConnections = std::max(std::min&lt;int&gt;(nMaxConnections, fd_max - nBind - MIN_CORE_FILEDESCRIPTORS - MAX_ADDNODE_CONNECTIONS - NUM_FDS_MESSAGE_CAPTURE), 0);</span></a>
<a name="891"><span class="lineNum">     891 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (nFD &lt; MIN_CORE_FILEDESCRIPTORS)</span></a>
<a name="892"><span class="lineNum">     892 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(_(&quot;Not enough file descriptors available.&quot;));</span></a>
<a name="893"><span class="lineNum">     893 </span>        [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1214 :     nMaxConnections = std::min(nFD - MIN_CORE_FILEDESCRIPTORS - MAX_ADDNODE_CONNECTIONS - NUM_FDS_MESSAGE_CAPTURE, nMaxConnections);</span></a>
<a name="894"><span class="lineNum">     894 </span>                :            : </a>
<a name="895"><span class="lineNum">     895 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (nMaxConnections &lt; nUserMaxConnections)</span></a>
<a name="896"><span class="lineNum">     896 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         InitWarning(strprintf(_(&quot;Reducing -maxconnections from %d to %d, because of system limitations.&quot;), nUserMaxConnections, nMaxConnections));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="897"><span class="lineNum">     897 </span>                :            : </a>
<a name="898"><span class="lineNum">     898 </span>                :            :     // ********************************************************* Step 3: parameter-to-internal-flags</a>
<a name="899"><span class="lineNum">     899 </span>        [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1214 :     init::SetLoggingCategories(args);</span></a>
<a name="900"><span class="lineNum">     900 </span>                :            : </a>
<a name="901"><span class="lineNum">     901 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     fCheckBlockIndex = args.GetBoolArg(&quot;-checkblockindex&quot;, chainparams.DefaultConsistencyChecks());</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="902"><span class="lineNum">     902 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     fCheckpointsEnabled = args.GetBoolArg(&quot;-checkpoints&quot;, DEFAULT_CHECKPOINTS_ENABLED);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="903"><span class="lineNum">     903 </span>                :            : </a>
<a name="904"><span class="lineNum">     904 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2428 :     hashAssumeValid = uint256S(args.GetArg(&quot;-assumevalid&quot;, chainparams.GetConsensus().defaultAssumeValid.GetHex()));</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="905"><span class="lineNum">     905 </span>  [<span class="branchCov" title="Branch 0 was taken 25363 times"> + </span><span class="branchCov" title="Branch 1 was taken 779 times"> + </span><span class="branchCov" title="Branch 2 was taken 435 times"> + </span><span class="branchCov" title="Branch 3 was taken 779 times"> + </span>]:<span class="lineCov">      26577 :     if (!hashAssumeValid.IsNull())</span></a>
<a name="906"><span class="lineNum">     906 </span>  [<span class="branchCov" title="Branch 0 was taken 435 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 435 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        870 :         LogPrintf(&quot;Assuming ancestors of block %s have valid signatures.\n&quot;, hashAssumeValid.GetHex());</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 435 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 435 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="907"><span class="lineNum">     907 </span>                :            :     else</a>
<a name="908"><span class="lineNum">     908 </span>  [<span class="branchCov" title="Branch 0 was taken 779 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 779 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2772 :         LogPrintf(&quot;Validating signatures for all blocks.\n&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 779 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="909"><span class="lineNum">     909 </span>                :            : </a>
<a name="910"><span class="lineNum">     910 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     if (args.IsArgSet(&quot;-minimumchainwork&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchCov" title="Branch 5 was taken 1211 times"> + </span>]
<a name="911"><span class="lineNum">     911 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          3 :         const std::string minChainWorkStr = args.GetArg(&quot;-minimumchainwork&quot;, &quot;&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="912"><span class="lineNum">     912 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">          3 :         if (!IsHexNumber(minChainWorkStr)) {</span></a>
<a name="913"><span class="lineNum">     913 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(strprintf(Untranslated(&quot;Invalid non-hex (%s) minimum chain work value specified&quot;), minChainWorkStr));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="914"><span class="lineNum">     914 </span>                :            :         }</a>
<a name="915"><span class="lineNum">     915 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          9 :         nMinimumChainWork = UintToArith256(uint256S(minChainWorkStr));</span></a>
<a name="916"><span class="lineNum">     916 </span>                :            :     } else {</a>
<a name="917"><span class="lineNum">     917 </span>        [<span class="branchCov" title="Branch 0 was taken 1211 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1211 :         nMinimumChainWork = UintToArith256(chainparams.GetConsensus().nMinimumChainWork);</span></a>
<a name="918"><span class="lineNum">     918 </span>                :            :     }</a>
<a name="919"><span class="lineNum">     919 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2428 :     LogPrintf(&quot;Setting nMinimumChainWork=%s\n&quot;, nMinimumChainWork.GetHex());</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="920"><span class="lineNum">     920 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 1214 times"> + </span>]:<span class="lineCov">       2428 :     if (nMinimumChainWork &lt; UintToArith256(chainparams.GetConsensus().nMinimumChainWork)) {</span></a>
<a name="921"><span class="lineNum">     921 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         LogPrintf(&quot;Warning: nMinimumChainWork set below default value of %s\n&quot;, chainparams.GetConsensus().nMinimumChainWork.GetHex());</span></a>
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<a name="922"><span class="lineNum">     922 </span>                :            :     }</a>
<a name="923"><span class="lineNum">     923 </span>                :            : </a>
<a name="924"><span class="lineNum">     924 </span>                :            :     // mempool limits</a>
<a name="925"><span class="lineNum">     925 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     int64_t nMempoolSizeMax = args.GetIntArg(&quot;-maxmempool&quot;, DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="926"><span class="lineNum">     926 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     int64_t nMempoolSizeMin = args.GetIntArg(&quot;-limitdescendantsize&quot;, DEFAULT_DESCENDANT_SIZE_LIMIT) * 1000 * 40;</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="927"><span class="lineNum">     927 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (nMempoolSizeMax &lt; 0 || nMempoolSizeMax &lt; nMempoolSizeMin)</span></a>
<a name="928"><span class="lineNum">     928 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         return InitError(strprintf(_(&quot;-maxmempool must be at least %d MB&quot;), std::ceil(nMempoolSizeMin / 1000000.0)));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="929"><span class="lineNum">     929 </span>                :            :     // incremental relay fee sets the minimum feerate increase necessary for BIP 125 replacement in the mempool</a>
<a name="930"><span class="lineNum">     930 </span>                :            :     // and the amount the mempool min fee increases above the feerate of txs evicted due to mempool limiting.</a>
<a name="931"><span class="lineNum">     931 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     if (args.IsArgSet(&quot;-incrementalrelayfee&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="932"><span class="lineNum">     932 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         if (std::optional&lt;CAmount&gt; inc_relay_fee = ParseMoney(args.GetArg(&quot;-incrementalrelayfee&quot;, &quot;&quot;))) {</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="933"><span class="lineNum">     933 </span>                :<span class="lineNoCov">          0 :             ::incrementalRelayFee = CFeeRate{inc_relay_fee.value()};</span></a>
<a name="934"><span class="lineNum">     934 </span>                :            :         } else {</a>
<a name="935"><span class="lineNum">     935 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(AmountErrMsg(&quot;incrementalrelayfee&quot;, args.GetArg(&quot;-incrementalrelayfee&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>      <span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<a name="936"><span class="lineNum">     936 </span>                :            :         }</a>
<a name="937"><span class="lineNum">     937 </span>                :            :     }</a>
<a name="938"><span class="lineNum">     938 </span>                :            : </a>
<a name="939"><span class="lineNum">     939 </span>                :            :     // block pruning; get the amount of disk space (in MiB) to allot for block &amp; undo files</a>
<a name="940"><span class="lineNum">     940 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     int64_t nPruneArg = args.GetIntArg(&quot;-prune&quot;, 0);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="941"><span class="lineNum">     941 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (nPruneArg &lt; 0) {</span></a>
<a name="942"><span class="lineNum">     942 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(_(&quot;Prune cannot be configured with a negative value.&quot;));</span></a>
<a name="943"><span class="lineNum">     943 </span>                :            :     }</a>
<a name="944"><span class="lineNum">     944 </span>                :<span class="lineCov">       1214 :     nPruneTarget = (uint64_t) nPruneArg * 1024 * 1024;</span></a>
<a name="945"><span class="lineNum">     945 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 1207 times"> + </span>]:<span class="lineCov">       1214 :     if (nPruneArg == 1) {  // manual pruning: -prune=1</span></a>
<a name="946"><span class="lineNum">     946 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         14 :         LogPrintf(&quot;Block pruning enabled.  Use RPC call pruneblockchain(height) to manually prune block and undo files.\n&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="947"><span class="lineNum">     947 </span>                :<span class="lineCov">          7 :         nPruneTarget = std::numeric_limits&lt;uint64_t&gt;::max();</span></a>
<a name="948"><span class="lineNum">     948 </span>                :<span class="lineCov">          7 :         fPruneMode = true;</span></a>
<a name="949"><span class="lineNum">     949 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 1205 times"> + </span>]:<span class="lineCov">       1207 :     } else if (nPruneTarget) {</span></a>
<a name="950"><span class="lineNum">     950 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          2 :         if (nPruneTarget &lt; MIN_DISK_SPACE_FOR_BLOCK_FILES) {</span></a>
<a name="951"><span class="lineNum">     951 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Prune configured below the minimum of %d MiB.  Please use a higher number.&quot;), MIN_DISK_SPACE_FOR_BLOCK_FILES / 1024 / 1024));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="952"><span class="lineNum">     952 </span>                :            :         }</a>
<a name="953"><span class="lineNum">     953 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          4 :         LogPrintf(&quot;Prune configured to target %u MiB on disk for block and undo files.\n&quot;, nPruneTarget / 1024 / 1024);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="954"><span class="lineNum">     954 </span>                :<span class="lineCov">          2 :         fPruneMode = true;</span></a>
<a name="955"><span class="lineNum">     955 </span>                :            :     }</a>
<a name="956"><span class="lineNum">     956 </span>                :            : </a>
<a name="957"><span class="lineNum">     957 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     nConnectTimeout = args.GetIntArg(&quot;-timeout&quot;, DEFAULT_CONNECT_TIMEOUT);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="958"><span class="lineNum">     958 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (nConnectTimeout &lt;= 0) {</span></a>
<a name="959"><span class="lineNum">     959 </span>                :<span class="lineNoCov">          0 :         nConnectTimeout = DEFAULT_CONNECT_TIMEOUT;</span></a>
<a name="960"><span class="lineNum">     960 </span>                :            :     }</a>
<a name="961"><span class="lineNum">     961 </span>                :            : </a>
<a name="962"><span class="lineNum">     962 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     peer_connect_timeout = args.GetIntArg(&quot;-peertimeout&quot;, DEFAULT_PEER_CONNECT_TIMEOUT);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="963"><span class="lineNum">     963 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1214 times"> + </span>]:<span class="lineCov">       1214 :     if (peer_connect_timeout &lt;= 0) {</span></a>
<a name="964"><span class="lineNum">     964 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(Untranslated(&quot;peertimeout cannot be configured with a negative value.&quot;));</span></a>
<a name="965"><span class="lineNum">     965 </span>                :            :     }</a>
<a name="966"><span class="lineNum">     966 </span>                :            : </a>
<a name="967"><span class="lineNum">     967 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     if (args.IsArgSet(&quot;-minrelaytxfee&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 20 times"> + </span><span class="branchCov" title="Branch 5 was taken 1194 times"> + </span>]
<a name="968"><span class="lineNum">     968 </span>  [<span class="branchCov" title="Branch 0 was taken 20 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 20 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         40 :         if (std::optional&lt;CAmount&gt; min_relay_fee = ParseMoney(args.GetArg(&quot;-minrelaytxfee&quot;, &quot;&quot;))) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 20 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 20 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 20 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="969"><span class="lineNum">     969 </span>                :            :             // High fee check is done afterward in CWallet::Create()</a>
<a name="970"><span class="lineNum">     970 </span>                :<span class="lineCov">         20 :             ::minRelayTxFee = CFeeRate{min_relay_fee.value()};</span></a>
<a name="971"><span class="lineNum">     971 </span>                :            :         } else {</a>
<a name="972"><span class="lineNum">     972 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(AmountErrMsg(&quot;minrelaytxfee&quot;, args.GetArg(&quot;-minrelaytxfee&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>      <span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<a name="973"><span class="lineNum">     973 </span>                :            :         }</a>
<a name="974"><span class="lineNum">     974 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1194 times"> + </span>]:<span class="lineCov">       1194 :     } else if (incrementalRelayFee &gt; ::minRelayTxFee) {</span></a>
<a name="975"><span class="lineNum">     975 </span>                :            :         // Allow only setting incrementalRelayFee to control both</a>
<a name="976"><span class="lineNum">     976 </span>                :<span class="lineNoCov">          0 :         ::minRelayTxFee = incrementalRelayFee;</span></a>
<a name="977"><span class="lineNum">     977 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         LogPrintf(&quot;Increasing minrelaytxfee to %s to match incrementalrelayfee\n&quot;,::minRelayTxFee.ToString());</span></a>
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<a name="978"><span class="lineNum">     978 </span>                :            :     }</a>
<a name="979"><span class="lineNum">     979 </span>                :            : </a>
<a name="980"><span class="lineNum">     980 </span>                :            :     // Sanity check argument for min fee for including tx in block</a>
<a name="981"><span class="lineNum">     981 </span>                :            :     // TODO: Harmonize which arguments need sanity checking and where that happens</a>
<a name="982"><span class="lineNum">     982 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     if (args.IsArgSet(&quot;-blockmintxfee&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="983"><span class="lineNum">     983 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         if (!ParseMoney(args.GetArg(&quot;-blockmintxfee&quot;, &quot;&quot;))) {</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="984"><span class="lineNum">     984 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(AmountErrMsg(&quot;blockmintxfee&quot;, args.GetArg(&quot;-blockmintxfee&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>      <span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<a name="985"><span class="lineNum">     985 </span>                :            :         }</a>
<a name="986"><span class="lineNum">     986 </span>                :            :     }</a>
<a name="987"><span class="lineNum">     987 </span>                :            : </a>
<a name="988"><span class="lineNum">     988 </span>                :            :     // Feerate used to define dust.  Shouldn't be changed lightly as old</a>
<a name="989"><span class="lineNum">     989 </span>                :            :     // implementations may inadvertently create non-standard transactions</a>
<a name="990"><span class="lineNum">     990 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     if (args.IsArgSet(&quot;-dustrelayfee&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1214 times"> + </span>]
<a name="991"><span class="lineNum">     991 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         if (std::optional&lt;CAmount&gt; parsed = ParseMoney(args.GetArg(&quot;-dustrelayfee&quot;, &quot;&quot;))) {</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="992"><span class="lineNum">     992 </span>                :<span class="lineNoCov">          0 :             dustRelayFee = CFeeRate{parsed.value()};</span></a>
<a name="993"><span class="lineNum">     993 </span>                :            :         } else {</a>
<a name="994"><span class="lineNum">     994 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(AmountErrMsg(&quot;dustrelayfee&quot;, args.GetArg(&quot;-dustrelayfee&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>      <span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span>]
<a name="995"><span class="lineNum">     995 </span>                :            :         }</a>
<a name="996"><span class="lineNum">     996 </span>                :            :     }</a>
<a name="997"><span class="lineNum">     997 </span>                :            : </a>
<a name="998"><span class="lineNum">     998 </span>  [<span class="branchCov" title="Branch 0 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1214 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1214 :     fRequireStandard = !args.GetBoolArg(&quot;-acceptnonstdtxn&quot;, !chainparams.RequireStandard());</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 428 times"> + </span><span class="branchCov" title="Branch 5 was taken 786 times"> + </span>]
<a name="999"><span class="lineNum">     999 </span>  [<span class="branchCov" title="Branch 0 was taken 428 times"> + </span><span class="branchCov" title="Branch 1 was taken 786 times"> + </span><span class="branchCov" title="Branch 2 was taken 427 times"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">       1214 :     if (!chainparams.IsTestChain() &amp;&amp; !fRequireStandard) {</span></a>
<a name="1000"><span class="lineNum">    1000 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          4 :         return InitError(strprintf(Untranslated(&quot;acceptnonstdtxn is not currently supported for %s chain&quot;), chainparams.NetworkIDString()));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1001"><span class="lineNum">    1001 </span>                :            :     }</a>
<a name="1002"><span class="lineNum">    1002 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     nBytesPerSigOp = args.GetIntArg(&quot;-bytespersigop&quot;, nBytesPerSigOp);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1003"><span class="lineNum">    1003 </span>                :            : </a>
<a name="1004"><span class="lineNum">    1004 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1213 :     if (!g_wallet_init_interface.ParameterInteraction()) return false;</span></a>
<a name="1005"><span class="lineNum">    1005 </span>                :            : </a>
<a name="1006"><span class="lineNum">    1006 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     fIsBareMultisigStd = args.GetBoolArg(&quot;-permitbaremultisig&quot;, DEFAULT_PERMIT_BAREMULTISIG);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1007"><span class="lineNum">    1007 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     fAcceptDatacarrier = args.GetBoolArg(&quot;-datacarrier&quot;, DEFAULT_ACCEPT_DATACARRIER);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1008"><span class="lineNum">    1008 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     nMaxDatacarrierBytes = args.GetIntArg(&quot;-datacarriersize&quot;, nMaxDatacarrierBytes);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1009"><span class="lineNum">    1009 </span>                :            : </a>
<a name="1010"><span class="lineNum">    1010 </span>                :            :     // Option to startup with mocktime set (used for regression testing):</a>
<a name="1011"><span class="lineNum">    1011 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2426 :     SetMockTime(args.GetIntArg(&quot;-mocktime&quot;, 0)); // SetMockTime(0) is a no-op</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1012"><span class="lineNum">    1012 </span>                :            : </a>
<a name="1013"><span class="lineNum">    1013 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     if (args.GetBoolArg(&quot;-peerbloomfilters&quot;, DEFAULT_PEERBLOOMFILTERS))</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchCov" title="Branch 5 was taken 1212 times"> + </span>]
<a name="1014"><span class="lineNum">    1014 </span>                :<span class="lineCov">          1 :         nLocalServices = ServiceFlags(nLocalServices | NODE_BLOOM);</span></a>
<a name="1015"><span class="lineNum">    1015 </span>                :            : </a>
<a name="1016"><span class="lineNum">    1016 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     if (args.GetIntArg(&quot;-rpcserialversion&quot;, DEFAULT_RPC_SERIALIZE_VERSION) &lt; 0)</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1213 times"> + </span>]
<a name="1017"><span class="lineNum">    1017 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1216 :         return InitError(Untranslated(&quot;rpcserialversion must be non-negative.&quot;));</span></a>
<a name="1018"><span class="lineNum">    1018 </span>                :            : </a>
<a name="1019"><span class="lineNum">    1019 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     if (args.GetIntArg(&quot;-rpcserialversion&quot;, DEFAULT_RPC_SERIALIZE_VERSION) &gt; 1)</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1213 times"> + </span>]
<a name="1020"><span class="lineNum">    1020 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return InitError(Untranslated(&quot;Unknown rpcserialversion requested.&quot;));</span></a>
<a name="1021"><span class="lineNum">    1021 </span>                :            : </a>
<a name="1022"><span class="lineNum">    1022 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1213 :     nMaxTipAge = args.GetIntArg(&quot;-maxtipage&quot;, DEFAULT_MAX_TIP_AGE);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1023"><span class="lineNum">    1023 </span>                :            : </a>
<a name="1024"><span class="lineNum">    1024 </span>  [<span class="branchCov" title="Branch 0 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1213 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1240 :     if (args.IsArgSet(&quot;-proxy&quot;) &amp;&amp; args.GetArg(&quot;-proxy&quot;, &quot;&quot;).empty()) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchCov" title="Branch 5 was taken 1206 times"> + </span><span class="branchCov" title="Branch 6 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 7 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 6 times"> + </span><span class="branchCov" title="Branch 13 was taken 1 time"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 7 times"> + </span><span class="branchCov" title="Branch 15 was taken 1206 times"> + </span><span class="branchCov" title="Branch 16 was taken 7 times"> + </span><span class="branchCov" title="Branch 17 was taken 1206 times"> + </span><span class="branchCov" title="Branch 18 was taken 7 times"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 19 was taken 1206 times"> + </span><span class="branchCov" title="Branch 20 was taken 1 time"> + </span><span class="branchCov" title="Branch 21 was taken 1212 times"> + </span><span class="branchNoCov" title="Branch 22 was not taken"> - </span><span class="branchNoCov" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 24 was not taken"> - </span><span class="branchNoCov" title="Branch 25 was not taken"> - </span><span class="branchNoCov" title="Branch 26 was not taken"> - </span><span class="branchNoCov" title="Branch 27 was not taken"> - </span>]
<a name="1025"><span class="lineNum">    1025 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          1 :         return InitError(_(&quot;No proxy server specified. Use -proxy=&lt;ip&gt; or -proxy=&lt;ip:port&gt;.&quot;));</span></a>
<a name="1026"><span class="lineNum">    1026 </span>                :            :     }</a>
<a name="1027"><span class="lineNum">    1027 </span>                :            : </a>
<a name="1028"><span class="lineNum">    1028 </span>                :            : #if defined(USE_SYSCALL_SANDBOX)</a>
<a name="1029"><span class="lineNum">    1029 </span>  [<span class="branchCov" title="Branch 0 was taken 1212 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1212 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1744 :     if (args.IsArgSet(&quot;-sandbox&quot;) &amp;&amp; !args.IsArgNegated(&quot;-sandbox&quot;)) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 532 times"> + </span><span class="branchCov" title="Branch 5 was taken 680 times"> + </span><span class="branchCov" title="Branch 6 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 532 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 532 times"> + </span><span class="branchCov" title="Branch 12 was taken 532 times"> + </span><span class="branchCov" title="Branch 13 was taken 680 times"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 532 times"> + </span><span class="branchCov" title="Branch 15 was taken 680 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<a name="1030"><span class="lineNum">    1030 </span>  [<span class="branchCov" title="Branch 0 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1748 :         const std::string sandbox_arg{args.GetArg(&quot;-sandbox&quot;, &quot;&quot;)};</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1031"><span class="lineNum">    1031 </span>                :<span class="lineCov">        532 :         bool log_syscall_violation_before_terminating{false};</span></a>
<a name="1032"><span class="lineNum">    1032 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 532 times"> + </span>]:<span class="lineCov">        532 :         if (sandbox_arg == &quot;log-and-abort&quot;) {</span></a>
<a name="1033"><span class="lineNum">    1033 </span>                :            :             log_syscall_violation_before_terminating = true;</a>
<a name="1034"><span class="lineNum">    1034 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         } else if (sandbox_arg == &quot;abort&quot;) {</span></a>
<a name="1035"><span class="lineNum">    1035 </span>                :            :             // log_syscall_violation_before_terminating is false by default.</a>
<a name="1036"><span class="lineNum">    1036 </span>                :            :         } else {</a>
<a name="1037"><span class="lineNum">    1037 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(Untranslated(&quot;Unknown syscall sandbox mode (-sandbox=&lt;mode&gt;). Available modes are \&quot;log-and-abort\&quot; and \&quot;abort\&quot;.&quot;));</span></a>
<a name="1038"><span class="lineNum">    1038 </span>                :            :         }</a>
<a name="1039"><span class="lineNum">    1039 </span>                :            :         // execve(...) is not allowed by the syscall sandbox.</a>
<a name="1040"><span class="lineNum">    1040 </span>        [<span class="branchCov" title="Branch 0 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        532 :         const std::vector&lt;std::string&gt; features_using_execve{</span></a>
<a name="1041"><span class="lineNum">    1041 </span>                :            :             &quot;-alertnotify&quot;,</a>
<a name="1042"><span class="lineNum">    1042 </span>                :            :             &quot;-blocknotify&quot;,</a>
<a name="1043"><span class="lineNum">    1043 </span>                :            :             &quot;-signer&quot;,</a>
<a name="1044"><span class="lineNum">    1044 </span>                :            :             &quot;-startupnotify&quot;,</a>
<a name="1045"><span class="lineNum">    1045 </span>                :            :             &quot;-walletnotify&quot;,</a>
<a name="1046"><span class="lineNum">    1046 </span>  [<span class="branchCov" title="Branch 0 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       3724 :         };</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 532 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 532 times"> + </span><span class="branchCov" title="Branch 12 was taken 2660 times"> + </span><span class="branchCov" title="Branch 13 was taken 532 times"> + </span> 
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 14 was not taken"> - </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>]
<a name="1047"><span class="lineNum">    1047 </span>        [<span class="branchCov" title="Branch 0 was taken 2660 times"> + </span><span class="branchCov" title="Branch 1 was taken 532 times"> + </span>]:<span class="lineCov">       3192 :         for (const std::string&amp; feature_using_execve : features_using_execve) {</span></a>
<a name="1048"><span class="lineNum">    1048 </span>  [<span class="branchCov" title="Branch 0 was taken 2660 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2660 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2660 :             if (!args.GetArg(feature_using_execve, &quot;&quot;).empty()) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 2660 times"> + </span>]
<a name="1049"><span class="lineNum">    1049 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 return InitError(Untranslated(strprintf(&quot;The experimental syscall sandbox feature (-sandbox=&lt;mode&gt;) is incompatible with %s (which uses execve).&quot;, feature_using_execve)));</span></a>
<a name="1050"><span class="lineNum">    1050 </span>                :            :             }</a>
<a name="1051"><span class="lineNum">    1051 </span>                :            :         }</a>
<a name="1052"><span class="lineNum">    1052 </span>  [<span class="branchCov" title="Branch 0 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 532 times"> + </span>]:<span class="lineCov">        532 :         if (!SetupSyscallSandbox(log_syscall_violation_before_terminating)) {</span></a>
<a name="1053"><span class="lineNum">    1053 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(Untranslated(&quot;Installation of the syscall sandbox failed.&quot;));</span></a>
<a name="1054"><span class="lineNum">    1054 </span>                :            :         }</a>
<a name="1055"><span class="lineNum">    1055 </span>  [<span class="branchCov" title="Branch 0 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1064 :         LogPrintf(&quot;Experimental syscall sandbox enabled (-sandbox=%s): bitcoind will terminate if an unexpected (not allowlisted) syscall is invoked.\n&quot;, sandbox_arg);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 532 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1056"><span class="lineNum">    1056 </span>                :            :     }</a>
<a name="1057"><span class="lineNum">    1057 </span>                :            : #endif // USE_SYSCALL_SANDBOX</a>
<a name="1058"><span class="lineNum">    1058 </span>                :            : </a>
<a name="1059"><span class="lineNum">    1059 </span>                :            :     return true;</a>
<a name="1060"><span class="lineNum">    1060 </span>                :            : }</a>
<a name="1061"><span class="lineNum">    1061 </span>                :            : </a>
<a name="1062"><span class="lineNum">    1062 </span>                :<span class="lineCov">       1493 : static bool LockDataDirectory(bool probeOnly)</span></a>
<a name="1063"><span class="lineNum">    1063 </span>                :            : {</a>
<a name="1064"><span class="lineNum">    1064 </span>                :            :     // Make sure only a single Bitcoin process is using the data directory.</a>
<a name="1065"><span class="lineNum">    1065 </span>                :<span class="lineCov">       2986 :     fs::path datadir = gArgs.GetDataDirNet();</span></a>
<a name="1066"><span class="lineNum">    1066 </span>  [<span class="branchCov" title="Branch 0 was taken 1493 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 1493 times"> + </span>]:<span class="lineCov">       1493 :     if (!DirIsWritable(datadir)) {</span></a>
<a name="1067"><span class="lineNum">    1067 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         return InitError(strprintf(_(&quot;Cannot write to data directory '%s'; check permissions.&quot;), fs::PathToString(datadir)));</span></a>
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<a name="1068"><span class="lineNum">    1068 </span>                :            :     }</a>
<a name="1069"><span class="lineNum">    1069 </span>  [<span class="branchCov" title="Branch 0 was taken 1493 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1493 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1493 :     if (!LockDirectory(datadir, &quot;.lock&quot;, probeOnly)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchCov" title="Branch 5 was taken 1492 times"> + </span>]
<a name="1070"><span class="lineNum">    1070 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1496 :         return InitError(strprintf(_(&quot;Cannot obtain a lock on data directory %s. %s is probably already running.&quot;), fs::PathToString(datadir), PACKAGE_NAME));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1071"><span class="lineNum">    1071 </span>                :            :     }</a>
<a name="1072"><span class="lineNum">    1072 </span>                :            :     return true;</a>
<a name="1073"><span class="lineNum">    1073 </span>                :            : }</a>
<a name="1074"><span class="lineNum">    1074 </span>                :            : </a>
<a name="1075"><span class="lineNum">    1075 </span>                :<span class="lineCov">        747 : bool AppInitSanityChecks()</span></a>
<a name="1076"><span class="lineNum">    1076 </span>                :            : {</a>
<a name="1077"><span class="lineNum">    1077 </span>                :            :     // ********************************************************* Step 4: sanity checks</a>
<a name="1078"><span class="lineNum">    1078 </span>                :            : </a>
<a name="1079"><span class="lineNum">    1079 </span>                :<span class="lineCov">        747 :     init::SetGlobals();</span></a>
<a name="1080"><span class="lineNum">    1080 </span>                :            : </a>
<a name="1081"><span class="lineNum">    1081 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 747 times"> + </span>]:<span class="lineCov">        747 :     if (!init::SanityChecks()) {</span></a>
<a name="1082"><span class="lineNum">    1082 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        747 :         return InitError(strprintf(_(&quot;Initialization sanity check failed. %s is shutting down.&quot;), PACKAGE_NAME));</span></a>
<a name="1083"><span class="lineNum">    1083 </span>                :            :     }</a>
<a name="1084"><span class="lineNum">    1084 </span>                :            : </a>
<a name="1085"><span class="lineNum">    1085 </span>                :            :     // Probe the data directory lock to give an early error message, if possible</a>
<a name="1086"><span class="lineNum">    1086 </span>                :            :     // We cannot hold the data directory lock here, as the forking for daemon() hasn't yet happened,</a>
<a name="1087"><span class="lineNum">    1087 </span>                :            :     // and a fork will cause weird behavior to it.</a>
<a name="1088"><span class="lineNum">    1088 </span>                :<span class="lineCov">        747 :     return LockDataDirectory(true);</span></a>
<a name="1089"><span class="lineNum">    1089 </span>                :            : }</a>
<a name="1090"><span class="lineNum">    1090 </span>                :            : </a>
<a name="1091"><span class="lineNum">    1091 </span>                :<span class="lineCov">        746 : bool AppInitLockDataDirectory()</span></a>
<a name="1092"><span class="lineNum">    1092 </span>                :            : {</a>
<a name="1093"><span class="lineNum">    1093 </span>                :            :     // After daemonization get the data directory lock again and hold on to it until exit</a>
<a name="1094"><span class="lineNum">    1094 </span>                :            :     // This creates a slight window for a race condition to happen, however this condition is harmless: it</a>
<a name="1095"><span class="lineNum">    1095 </span>                :            :     // will at most make us exit without printing a message to console.</a>
<a name="1096"><span class="lineNum">    1096 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">        746 :     if (!LockDataDirectory(false)) {</span></a>
<a name="1097"><span class="lineNum">    1097 </span>                :            :         // Detailed error printed inside LockDataDirectory</a>
<a name="1098"><span class="lineNum">    1098 </span>                :<span class="lineNoCov">          0 :         return false;</span></a>
<a name="1099"><span class="lineNum">    1099 </span>                :            :     }</a>
<a name="1100"><span class="lineNum">    1100 </span>                :            :     return true;</a>
<a name="1101"><span class="lineNum">    1101 </span>                :            : }</a>
<a name="1102"><span class="lineNum">    1102 </span>                :            : </a>
<a name="1103"><span class="lineNum">    1103 </span>                :<span class="lineCov">        746 : bool AppInitInterfaces(NodeContext&amp; node)</span></a>
<a name="1104"><span class="lineNum">    1104 </span>                :            : {</a>
<a name="1105"><span class="lineNum">    1105 </span>                :<span class="lineCov">        746 :     node.chain = node.init-&gt;makeChain();</span></a>
<a name="1106"><span class="lineNum">    1106 </span>                :<span class="lineCov">        746 :     return true;</span></a>
<a name="1107"><span class="lineNum">    1107 </span>                :            : }</a>
<a name="1108"><span class="lineNum">    1108 </span>                :            : </a>
<a name="1109"><span class="lineNum">    1109 </span>                :<span class="lineCov">        746 : bool AppInitMain(NodeContext&amp; node, interfaces::BlockAndHeaderTipInfo* tip_info)</span></a>
<a name="1110"><span class="lineNum">    1110 </span>                :            : {</a>
<a name="1111"><span class="lineNum">    1111 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">       1492 :     const ArgsManager&amp; args = *Assert(node.args);</span></a>
<a name="1112"><span class="lineNum">    1112 </span>                :<span class="lineCov">        746 :     const CChainParams&amp; chainparams = Params();</span></a>
<a name="1113"><span class="lineNum">    1113 </span>                :            : </a>
<a name="1114"><span class="lineNum">    1114 </span>  [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1492 :     auto opt_max_upload = ParseByteUnits(args.GetArg(&quot;-maxuploadtarget&quot;, DEFAULT_MAX_UPLOAD_TARGET), ByteUnit::M);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 746 times"> + </span>]
<a name="1115"><span class="lineNum">    1115 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 746 times"> + </span>]:<span class="lineCov">        746 :     if (!opt_max_upload) {</span></a>
<a name="1116"><span class="lineNum">    1116 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         return InitError(strprintf(_(&quot;Unable to parse -maxuploadtarget: '%s' (possible integer overflow?)&quot;), args.GetArg(&quot;-maxuploadtarget&quot;, &quot;&quot;)));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="1117"><span class="lineNum">    1117 </span>                :            :     }</a>
<a name="1118"><span class="lineNum">    1118 </span>                :            : </a>
<a name="1119"><span class="lineNum">    1119 </span>                :            :     // ********************************************************* Step 4a: application initialization</a>
<a name="1120"><span class="lineNum">    1120 </span>        [<span class="branchCov" title="Branch 0 was taken 746 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        746 :     if (!CreatePidFile(args)) {</span></a>
<a name="1121"><span class="lineNum">    1121 </span>                :            :         // Detailed error printed inside CreatePidFile().</a>
<a name="1122"><span class="lineNum">    1122 </span>                :            :         return false;</a>
<a name="1123"><span class="lineNum">    1123 </span>                :            :     }</a>
<a name="1124"><span class="lineNum">    1124 </span>        [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        746 :     if (!init::StartLogging(args)) {</span></a>
<a name="1125"><span class="lineNum">    1125 </span>                :            :         // Detailed error printed inside StartLogging().</a>
<a name="1126"><span class="lineNum">    1126 </span>                :            :         return false;</a>
<a name="1127"><span class="lineNum">    1127 </span>                :            :     }</a>
<a name="1128"><span class="lineNum">    1128 </span>                :            : </a>
<a name="1129"><span class="lineNum">    1129 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1488 :     LogPrintf(&quot;Using at most %i automatic connections (%i file descriptors available)\n&quot;, nMaxConnections, nFD);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1130"><span class="lineNum">    1130 </span>                :            : </a>
<a name="1131"><span class="lineNum">    1131 </span>                :            :     // Warn about relative -datadir path.</a>
<a name="1132"><span class="lineNum">    1132 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       4464 :     if (args.IsArgSet(&quot;-datadir&quot;) &amp;&amp; !fs::PathFromString(args.GetArg(&quot;-datadir&quot;, &quot;&quot;)).is_absolute()) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 744 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 11 was not taken"> - </span><span class="branchCov" title="Branch 12 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span><span class="branchCov" title="Branch 16 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span><span class="branchCov" title="Branch 18 was taken 744 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 19 was not taken"> - </span><span class="branchCov" title="Branch 20 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span><span class="branchCov" title="Branch 22 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 23 was not taken"> - </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 24 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 25 was not taken"> - </span><span class="branchNoCov" title="Branch 26 was not taken"> - </span><span class="branchCov" title="Branch 27 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 28 was not taken"> - </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 29 was not taken"> - </span><span class="branchNoCov" title="Branch 30 was not taken"> - </span><span class="branchNoCov" title="Branch 31 was not taken"> - </span><span class="branchNoCov" title="Branch 32 was not taken"> - </span><span class="branchNoCov" title="Branch 33 was not taken"> - </span> 
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 34 was not taken"> - </span><span class="branchNoCov" title="Branch 35 was not taken"> - </span><span class="branchNoCov" title="Branch 36 was not taken"> - </span><span class="branchNoCov" title="Branch 37 was not taken"> - </span>]
<a name="1133"><span class="lineNum">    1133 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         LogPrintf(&quot;Warning: relative datadir option '%s' specified, which will be interpreted relative to the &quot; /* Continued */</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<a name="1134"><span class="lineNum">    1134 </span>                :            :                   &quot;current working directory '%s'. This is fragile, because if bitcoin is started in the future &quot;</a>
<a name="1135"><span class="lineNum">    1135 </span>                :            :                   &quot;from a different location, it will be unable to locate the current data files. There could &quot;</a>
<a name="1136"><span class="lineNum">    1136 </span>                :            :                   &quot;also be data loss if bitcoin is started while in a temporary directory.\n&quot;,</a>
<a name="1137"><span class="lineNum">    1137 </span>                :            :                   args.GetArg(&quot;-datadir&quot;, &quot;&quot;), fs::PathToString(fs::current_path()));</a>
<a name="1138"><span class="lineNum">    1138 </span>                :            :     }</a>
<a name="1139"><span class="lineNum">    1139 </span>                :            : </a>
<a name="1140"><span class="lineNum">    1140 </span>                :<span class="lineCov">        744 :     InitSignatureCache();</span></a>
<a name="1141"><span class="lineNum">    1141 </span>                :<span class="lineCov">        744 :     InitScriptExecutionCache();</span></a>
<a name="1142"><span class="lineNum">    1142 </span>                :            : </a>
<a name="1143"><span class="lineNum">    1143 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 736 times"> + </span><span class="branchCov" title="Branch 3 was taken 8 times"> + </span>]:<span class="lineCov">        744 :     int script_threads = args.GetIntArg(&quot;-par&quot;, DEFAULT_SCRIPTCHECK_THREADS);</span></a>
<a name="1144"><span class="lineNum">    1144 </span>        [<span class="branchCov" title="Branch 0 was taken 736 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>]:<span class="lineCov">        744 :     if (script_threads &lt;= 0) {</span></a>
<a name="1145"><span class="lineNum">    1145 </span>                :            :         // -par=0 means autodetect (number of cores - 1 script threads)</a>
<a name="1146"><span class="lineNum">    1146 </span>                :            :         // -par=-n means &quot;leave n cores free&quot; (number of cores - n - 1 script threads)</a>
<a name="1147"><span class="lineNum">    1147 </span>                :<span class="lineCov">        736 :         script_threads += GetNumCores();</span></a>
<a name="1148"><span class="lineNum">    1148 </span>                :            :     }</a>
<a name="1149"><span class="lineNum">    1149 </span>                :            : </a>
<a name="1150"><span class="lineNum">    1150 </span>                :            :     // Subtract 1 because the main thread counts towards the par threads</a>
<a name="1151"><span class="lineNum">    1151 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 744 times"> + </span>]:<span class="lineCov">        744 :     script_threads = std::max(script_threads - 1, 0);</span></a>
<a name="1152"><span class="lineNum">    1152 </span>                :            : </a>
<a name="1153"><span class="lineNum">    1153 </span>                :            :     // Number of script-checking threads &lt;= MAX_SCRIPTCHECK_THREADS</a>
<a name="1154"><span class="lineNum">    1154 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 744 times"> + </span>]:<span class="lineCov">        744 :     script_threads = std::min(script_threads, MAX_SCRIPTCHECK_THREADS);</span></a>
<a name="1155"><span class="lineNum">    1155 </span>                :            : </a>
<a name="1156"><span class="lineNum">    1156 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1488 :     LogPrintf(&quot;Script verification uses %d additional threads\n&quot;, script_threads);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 736 times"> + </span><span class="branchCov" title="Branch 5 was taken 8 times"> + </span>]
<a name="1157"><span class="lineNum">    1157 </span>        [<span class="branchCov" title="Branch 0 was taken 736 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>]:<span class="lineCov">        744 :     if (script_threads &gt;= 1) {</span></a>
<a name="1158"><span class="lineNum">    1158 </span>                :<span class="lineCov">        736 :         g_parallel_script_checks = true;</span></a>
<a name="1159"><span class="lineNum">    1159 </span>                :<span class="lineCov">        736 :         StartScriptCheckWorkerThreads(script_threads);</span></a>
<a name="1160"><span class="lineNum">    1160 </span>                :            :     }</a>
<a name="1161"><span class="lineNum">    1161 </span>                :            : </a>
<a name="1162"><span class="lineNum">    1162 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 744 times"> + </span>]:<span class="lineCov">        744 :     assert(!node.scheduler);</span></a>
<a name="1163"><span class="lineNum">    1163 </span>                :<span class="lineCov">        744 :     node.scheduler = std::make_unique&lt;CScheduler&gt;();</span></a>
<a name="1164"><span class="lineNum">    1164 </span>                :            : </a>
<a name="1165"><span class="lineNum">    1165 </span>                :            :     // Start the lightweight task scheduler thread</a>
<a name="1166"><span class="lineNum">    1166 </span>                :<span class="lineCov">       1488 :     node.scheduler-&gt;m_service_thread = std::thread(util::TraceThread, &quot;scheduler&quot;, [&amp;] { node.scheduler-&gt;serviceQueue(); });</span></a>
<a name="1167"><span class="lineNum">    1167 </span>                :            : </a>
<a name="1168"><span class="lineNum">    1168 </span>                :            :     // Gather some entropy once per minute.</a>
<a name="1169"><span class="lineNum">    1169 </span>        [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1488 :     node.scheduler-&gt;scheduleEvery([]{</span></a>
<a name="1170"><span class="lineNum">    1170 </span>                :<span class="lineCov">         32 :         RandAddPeriodic();</span></a>
<a name="1171"><span class="lineNum">    1171 </span>                :<span class="lineCov">        744 :     }, std::chrono::minutes{1});</span></a>
<a name="1172"><span class="lineNum">    1172 </span>                :            : </a>
<a name="1173"><span class="lineNum">    1173 </span>                :<span class="lineCov">        744 :     GetMainSignals().RegisterBackgroundSignalScheduler(*node.scheduler);</span></a>
<a name="1174"><span class="lineNum">    1174 </span>                :            : </a>
<a name="1175"><span class="lineNum">    1175 </span>                :            :     // Create client interfaces for wallets that are supposed to be loaded</a>
<a name="1176"><span class="lineNum">    1176 </span>                :            :     // according to -wallet and -disablewallet options. This only constructs</a>
<a name="1177"><span class="lineNum">    1177 </span>                :            :     // the interfaces, it doesn't load wallet data. Wallets actually get loaded</a>
<a name="1178"><span class="lineNum">    1178 </span>                :            :     // when load() and start() interface methods are called below.</a>
<a name="1179"><span class="lineNum">    1179 </span>                :<span class="lineCov">        744 :     g_wallet_init_interface.Construct(node);</span></a>
<a name="1180"><span class="lineNum">    1180 </span>                :<span class="lineCov">        744 :     uiInterface.InitWallet();</span></a>
<a name="1181"><span class="lineNum">    1181 </span>                :            : </a>
<a name="1182"><span class="lineNum">    1182 </span>                :            :     /* Register RPC commands regardless of -server setting so they will be</a>
<a name="1183"><span class="lineNum">    1183 </span>                :            :      * available in the GUI RPC console even if external calls are disabled.</a>
<a name="1184"><span class="lineNum">    1184 </span>                :            :      */</a>
<a name="1185"><span class="lineNum">    1185 </span>                :<span class="lineCov">        744 :     RegisterAllCoreRPCCommands(tableRPC);</span></a>
<a name="1186"><span class="lineNum">    1186 </span>        [<span class="branchCov" title="Branch 0 was taken 729 times"> + </span><span class="branchCov" title="Branch 1 was taken 744 times"> + </span>]:<span class="lineCov">       1473 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="1187"><span class="lineNum">    1187 </span>                :<span class="lineCov">        729 :         client-&gt;registerRpcs();</span></a>
<a name="1188"><span class="lineNum">    1188 </span>                :            :     }</a>
<a name="1189"><span class="lineNum">    1189 </span>                :            : #if ENABLE_ZMQ</a>
<a name="1190"><span class="lineNum">    1190 </span>                :<span class="lineCov">        744 :     RegisterZMQRPCCommands(tableRPC);</span></a>
<a name="1191"><span class="lineNum">    1191 </span>                :            : #endif</a>
<a name="1192"><span class="lineNum">    1192 </span>                :            : </a>
<a name="1193"><span class="lineNum">    1193 </span>                :            :     /* Start the RPC server already.  It will be started in &quot;warmup&quot; mode</a>
<a name="1194"><span class="lineNum">    1194 </span>                :            :      * and not really process calls already (but it will signify connections</a>
<a name="1195"><span class="lineNum">    1195 </span>                :            :      * that the server is there and will be ready later).  Warmup mode will</a>
<a name="1196"><span class="lineNum">    1196 </span>                :            :      * be disabled when initialisation is finished.</a>
<a name="1197"><span class="lineNum">    1197 </span>                :            :      */</a>
<a name="1198"><span class="lineNum">    1198 </span>  [<span class="branchCov" title="Branch 0 was taken 744 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 742 times"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">        744 :     if (args.GetBoolArg(&quot;-server&quot;, false)) {</span></a>
<a name="1199"><span class="lineNum">    1199 </span>        [<span class="branchCov" title="Branch 0 was taken 742 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1484 :         uiInterface.InitMessage_connect(SetRPCWarmupStatus);</span></a>
<a name="1200"><span class="lineNum">    1200 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 739 times"> + </span>]:<span class="lineCov">        742 :         if (!AppInitServers(node))</span></a>
<a name="1201"><span class="lineNum">    1201 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        749 :             return InitError(_(&quot;Unable to start HTTP server. See debug log for details.&quot;));</span></a>
<a name="1202"><span class="lineNum">    1202 </span>                :            :     }</a>
<a name="1203"><span class="lineNum">    1203 </span>                :            : </a>
<a name="1204"><span class="lineNum">    1204 </span>                :            :     // ********************************************************* Step 5: verify wallet database integrity</a>
<a name="1205"><span class="lineNum">    1205 </span>        [<span class="branchCov" title="Branch 0 was taken 726 times"> + </span><span class="branchCov" title="Branch 1 was taken 718 times"> + </span>]:<span class="lineCov">       1444 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="1206"><span class="lineNum">    1206 </span>        [<span class="branchCov" title="Branch 0 was taken 703 times"> + </span><span class="branchCov" title="Branch 1 was taken 23 times"> + </span>]:<span class="lineCov">        726 :         if (!client-&gt;verify()) {</span></a>
<a name="1207"><span class="lineNum">    1207 </span>                :            :             return false;</a>
<a name="1208"><span class="lineNum">    1208 </span>                :            :         }</a>
<a name="1209"><span class="lineNum">    1209 </span>                :            :     }</a>
<a name="1210"><span class="lineNum">    1210 </span>                :            : </a>
<a name="1211"><span class="lineNum">    1211 </span>                :            :     // ********************************************************* Step 6: network initialization</a>
<a name="1212"><span class="lineNum">    1212 </span>                :            :     // Note that we absolutely cannot open any actual connections</a>
<a name="1213"><span class="lineNum">    1213 </span>                :            :     // until the very end (&quot;start node&quot;) as the UTXO/block state</a>
<a name="1214"><span class="lineNum">    1214 </span>                :            :     // is not yet setup and may end up being set up twice if we</a>
<a name="1215"><span class="lineNum">    1215 </span>                :            :     // need to reindex later.</a>
<a name="1216"><span class="lineNum">    1216 </span>                :            : </a>
<a name="1217"><span class="lineNum">    1217 </span>        [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        718 :     fListen = args.GetBoolArg(&quot;-listen&quot;, DEFAULT_LISTEN);</span></a>
<a name="1218"><span class="lineNum">    1218 </span>        [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        718 :     fDiscover = args.GetBoolArg(&quot;-discover&quot;, true);</span></a>
<a name="1219"><span class="lineNum">    1219 </span>  [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 718 times"> + </span>]:<span class="lineCov">        718 :     const bool ignores_incoming_txs{args.GetBoolArg(&quot;-blocksonly&quot;, DEFAULT_BLOCKSONLY)};</span></a>
<a name="1220"><span class="lineNum">    1220 </span>                :            : </a>
<a name="1221"><span class="lineNum">    1221 </span>                :<span class="lineCov">        718 :     {</span></a>
<a name="1222"><span class="lineNum">    1222 </span>                :            :         // Initialize addrman</a>
<a name="1223"><span class="lineNum">    1223 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 718 times"> + </span>]:<span class="lineCov">        718 :         assert(!node.addrman);</span></a>
<a name="1224"><span class="lineNum">    1224 </span>                :            : </a>
<a name="1225"><span class="lineNum">    1225 </span>                :            :         // Read asmap file if configured</a>
<a name="1226"><span class="lineNum">    1226 </span>        [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        718 :         std::vector&lt;bool&gt; asmap;</span></a>
<a name="1227"><span class="lineNum">    1227 </span>  [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        718 :         if (args.IsArgSet(&quot;-asmap&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 8 times"> + </span><span class="branchCov" title="Branch 5 was taken 710 times"> + </span>]
<a name="1228"><span class="lineNum">    1228 </span>  [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          8 :             fs::path asmap_path = fs::PathFromString(args.GetArg(&quot;-asmap&quot;, &quot;&quot;));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1229"><span class="lineNum">    1229 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          8 :             if (asmap_path.empty()) {</span></a>
<a name="1230"><span class="lineNum">    1230 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         20 :                 asmap_path = fs::PathFromString(DEFAULT_ASMAP_FILENAME);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1231"><span class="lineNum">    1231 </span>                :            :             }</a>
<a name="1232"><span class="lineNum">    1232 </span>  [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">          8 :             if (!asmap_path.is_absolute()) {</span></a>
<a name="1233"><span class="lineNum">    1233 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         14 :                 asmap_path = gArgs.GetDataDirNet() / asmap_path;</span></a>
<a name="1234"><span class="lineNum">    1234 </span>                :            :             }</a>
<a name="1235"><span class="lineNum">    1235 </span>  [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span>]:<span class="lineCov">          8 :             if (!fs::exists(asmap_path)) {</span></a>
<a name="1236"><span class="lineNum">    1236 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          3 :                 InitError(strprintf(_(&quot;Could not find asmap file %s&quot;), fs::quoted(fs::PathToString(asmap_path))));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1237"><span class="lineNum">    1237 </span>                :<span class="lineCov">          1 :                 return false;</span></a>
<a name="1238"><span class="lineNum">    1238 </span>                :            :             }</a>
<a name="1239"><span class="lineNum">    1239 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         14 :             asmap = DecodeAsmap(asmap_path);</span></a>
<a name="1240"><span class="lineNum">    1240 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">          7 :             if (asmap.size() == 0) {</span></a>
<a name="1241"><span class="lineNum">    1241 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          3 :                 InitError(strprintf(_(&quot;Could not parse asmap file %s&quot;), fs::quoted(fs::PathToString(asmap_path))));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1242"><span class="lineNum">    1242 </span>                :<span class="lineCov">          1 :                 return false;</span></a>
<a name="1243"><span class="lineNum">    1243 </span>                :            :             }</a>
<a name="1244"><span class="lineNum">    1244 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :             const uint256 asmap_version = SerializeHash(asmap);</span></a>
<a name="1245"><span class="lineNum">    1245 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         12 :             LogPrintf(&quot;Using asmap version %s for IP bucketing\n&quot;, asmap_version.ToString());</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1246"><span class="lineNum">    1246 </span>                :            :         } else {</a>
<a name="1247"><span class="lineNum">    1247 </span>  [<span class="branchCov" title="Branch 0 was taken 710 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 710 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2136 :             LogPrintf(&quot;Using /16 prefix for IP bucketing\n&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 710 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 716 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1248"><span class="lineNum">    1248 </span>                :            :         }</a>
<a name="1249"><span class="lineNum">    1249 </span>                :            : </a>
<a name="1250"><span class="lineNum">    1250 </span>  [<span class="branchCov" title="Branch 0 was taken 716 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 716 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        716 :         uiInterface.InitMessage(_(&quot;Loading P2P addresses&quot;).translated);</span></a>
<a name="1251"><span class="lineNum">    1251 </span>  [<span class="branchCov" title="Branch 0 was taken 716 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchCov" title="Branch 3 was taken 709 times"> + </span>]:<span class="lineCov">        716 :         if (const auto error{LoadAddrman(asmap, args, node.addrman)}) {</span></a>
<a name="1252"><span class="lineNum">    1252 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         16 :             return InitError(*error);</span></a>
<a name="1253"><span class="lineNum">    1253 </span>                :            :         }</a>
<a name="1254"><span class="lineNum">    1254 </span>                :            :     }</a>
<a name="1255"><span class="lineNum">    1255 </span>                :            : </a>
<a name="1256"><span class="lineNum">    1256 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.banman);</span></a>
<a name="1257"><span class="lineNum">    1257 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        709 :     node.banman = std::make_unique&lt;BanMan&gt;(gArgs.GetDataDirNet() / &quot;banlist&quot;, &amp;uiInterface, args.GetIntArg(&quot;-bantime&quot;, DEFAULT_MISBEHAVING_BANTIME));</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 709 times"> + </span> 
<span class="lineNum">         </span>      <span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 709 times"> + </span>]
<a name="1258"><span class="lineNum">    1258 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.connman);</span></a>
<a name="1259"><span class="lineNum">    1259 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        709 :     node.connman = std::make_unique&lt;CConnman&gt;(GetRand(std::numeric_limits&lt;uint64_t&gt;::max()), GetRand(std::numeric_limits&lt;uint64_t&gt;::max()), *node.addrman, args.GetBoolArg(&quot;-networkactive&quot;, true));</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 709 times"> + </span>]
<a name="1260"><span class="lineNum">    1260 </span>                :            : </a>
<a name="1261"><span class="lineNum">    1261 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.fee_estimator);</span></a>
<a name="1262"><span class="lineNum">    1262 </span>                :            :     // Don't initialize fee estimation with old data if we don't relay transactions,</a>
<a name="1263"><span class="lineNum">    1263 </span>                :            :     // as they would never get updated.</a>
<a name="1264"><span class="lineNum">    1264 </span>        [<span class="branchCov" title="Branch 0 was taken 703 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">        709 :     if (!ignores_incoming_txs) node.fee_estimator = std::make_unique&lt;CBlockPolicyEstimator&gt;();</span></a>
<a name="1265"><span class="lineNum">    1265 </span>                :            : </a>
<a name="1266"><span class="lineNum">    1266 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.mempool);</span></a>
<a name="1267"><span class="lineNum">    1267 </span>  [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 699 times"> + </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        719 :     int check_ratio = std::min&lt;int&gt;(std::max&lt;int&gt;(args.GetIntArg(&quot;-checkmempool&quot;, chainparams.DefaultConsistencyChecks() ? 1 : 0), 0), 1000000);</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchCov" title="Branch 7 was taken 709 times"> + </span>]
<a name="1268"><span class="lineNum">    1268 </span>                :<span class="lineCov">        709 :     node.mempool = std::make_unique&lt;CTxMemPool&gt;(node.fee_estimator.get(), check_ratio);</span></a>
<a name="1269"><span class="lineNum">    1269 </span>                :            : </a>
<a name="1270"><span class="lineNum">    1270 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.chainman);</span></a>
<a name="1271"><span class="lineNum">    1271 </span>                :<span class="lineCov">        709 :     node.chainman = std::make_unique&lt;ChainstateManager&gt;();</span></a>
<a name="1272"><span class="lineNum">    1272 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     ChainstateManager&amp; chainman = *node.chainman;</span></a>
<a name="1273"><span class="lineNum">    1273 </span>                :            : </a>
<a name="1274"><span class="lineNum">    1274 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 709 times"> + </span>]:<span class="lineCov">        709 :     assert(!node.peerman);</span></a>
<a name="1275"><span class="lineNum">    1275 </span>                :<span class="lineCov">       1418 :     node.peerman = PeerManager::make(chainparams, *node.connman, *node.addrman, node.banman.get(),</span></a>
<a name="1276"><span class="lineNum">    1276 </span>                :<span class="lineCov">        709 :                                      chainman, *node.mempool, ignores_incoming_txs);</span></a>
<a name="1277"><span class="lineNum">    1277 </span>                :<span class="lineCov">        709 :     RegisterValidationInterface(node.peerman.get());</span></a>
<a name="1278"><span class="lineNum">    1278 </span>                :            : </a>
<a name="1279"><span class="lineNum">    1279 </span>                :            :     // sanitize comments per BIP-0014, format user agent and check total size</a>
<a name="1280"><span class="lineNum">    1280 </span>        [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        709 :     std::vector&lt;std::string&gt; uacomments;</span></a>
<a name="1281"><span class="lineNum">    1281 </span>  [<span class="branchCov" title="Branch 0 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 709 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1427 :     for (const std::string&amp; cmt : args.GetArgs(&quot;-uacomment&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 724 times"> + </span><span class="branchCov" title="Branch 5 was taken 703 times"> + </span>]
<a name="1282"><span class="lineNum">    1282 </span>  [<span class="branchCov" title="Branch 0 was taken 724 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchCov" title="Branch 3 was taken 718 times"> + </span>]:<span class="lineCov">        724 :         if (cmt != SanitizeString(cmt, SAFE_CHARS_UA_COMMENT))</span></a>
<a name="1283"><span class="lineNum">    1283 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         18 :             return InitError(strprintf(_(&quot;User Agent comment (%s) contains unsafe characters.&quot;), cmt));</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1284"><span class="lineNum">    1284 </span>        [<span class="branchCov" title="Branch 0 was taken 718 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        718 :         uacomments.push_back(cmt);</span></a>
<a name="1285"><span class="lineNum">    1285 </span>                :            :     }</a>
<a name="1286"><span class="lineNum">    1286 </span>        [<span class="branchCov" title="Branch 0 was taken 703 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        703 :     strSubVersion = FormatSubVersion(CLIENT_NAME, CLIENT_VERSION, uacomments);</span></a>
<a name="1287"><span class="lineNum">    1287 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 702 times"> + </span>]:<span class="lineCov">        703 :     if (strSubVersion.size() &gt; MAX_SUBVERSION_LENGTH) {</span></a>
<a name="1288"><span class="lineNum">    1288 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          3 :         return InitError(strprintf(_(&quot;Total length of network version string (%i) exceeds maximum length (%i). Reduce the number or size of uacomments.&quot;),</span></a>
<a name="1289"><span class="lineNum">    1289 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          1 :             strSubVersion.size(), MAX_SUBVERSION_LENGTH));</span></a>
<a name="1290"><span class="lineNum">    1290 </span>                :            :     }</a>
<a name="1291"><span class="lineNum">    1291 </span>                :            : </a>
<a name="1292"><span class="lineNum">    1292 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     if (args.IsArgSet(&quot;-onlynet&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 702 times"> + </span>]
<a name="1293"><span class="lineNum">    1293 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         std::set&lt;enum Network&gt; nets;</span></a>
<a name="1294"><span class="lineNum">    1294 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         for (const std::string&amp; snet : args.GetArgs(&quot;-onlynet&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1295"><span class="lineNum">    1295 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             enum Network net = ParseNetwork(snet);</span></a>
<a name="1296"><span class="lineNum">    1296 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (net == NET_UNROUTABLE)</span></a>
<a name="1297"><span class="lineNum">    1297 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                 return InitError(strprintf(_(&quot;Unknown network specified in -onlynet: '%s'&quot;), snet));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1298"><span class="lineNum">    1298 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             nets.insert(net);</span></a>
<a name="1299"><span class="lineNum">    1299 </span>                :            :         }</a>
<a name="1300"><span class="lineNum">    1300 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         for (int n = 0; n &lt; NET_MAX; n++) {</span></a>
<a name="1301"><span class="lineNum">    1301 </span>                :<span class="lineNoCov">          0 :             enum Network net = (enum Network)n;</span></a>
<a name="1302"><span class="lineNum">    1302 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             if (!nets.count(net))</span></a>
<a name="1303"><span class="lineNum">    1303 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 SetReachable(net, false);</span></a>
<a name="1304"><span class="lineNum">    1304 </span>                :            :         }</a>
<a name="1305"><span class="lineNum">    1305 </span>                :            :     }</a>
<a name="1306"><span class="lineNum">    1306 </span>                :            : </a>
<a name="1307"><span class="lineNum">    1307 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     if (!args.IsArgSet(&quot;-cjdnsreachable&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 701 times"> + </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]
<a name="1308"><span class="lineNum">    1308 </span>        [<span class="branchCov" title="Branch 0 was taken 701 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        701 :         SetReachable(NET_CJDNS, false);</span></a>
<a name="1309"><span class="lineNum">    1309 </span>                :            :     }</a>
<a name="1310"><span class="lineNum">    1310 </span>                :            :     // Now IsReachable(NET_CJDNS) is true if:</a>
<a name="1311"><span class="lineNum">    1311 </span>                :            :     // 1. -cjdnsreachable is given and</a>
<a name="1312"><span class="lineNum">    1312 </span>                :            :     // 2.1. -onlynet is not given or</a>
<a name="1313"><span class="lineNum">    1313 </span>                :            :     // 2.2. -onlynet=cjdns is given</a>
<a name="1314"><span class="lineNum">    1314 </span>                :            : </a>
<a name="1315"><span class="lineNum">    1315 </span>                :            :     // Check for host lookup allowed before parsing any network related parameters</a>
<a name="1316"><span class="lineNum">    1316 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     fNameLookup = args.GetBoolArg(&quot;-dns&quot;, DEFAULT_NAME_LOOKUP);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1317"><span class="lineNum">    1317 </span>                :            : </a>
<a name="1318"><span class="lineNum">    1318 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     bool proxyRandomize = args.GetBoolArg(&quot;-proxyrandomize&quot;, DEFAULT_PROXYRANDOMIZE);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1319"><span class="lineNum">    1319 </span>                :            :     // -proxy sets a proxy for all outgoing network traffic</a>
<a name="1320"><span class="lineNum">    1320 </span>                :            :     // -noproxy (or -proxy=0) as well as the empty string can be used to not set a proxy, this is the default</a>
<a name="1321"><span class="lineNum">    1321 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1411 :     std::string proxyArg = args.GetArg(&quot;-proxy&quot;, &quot;&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1322"><span class="lineNum">    1322 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :     SetReachable(NET_ONION, false);</span></a>
<a name="1323"><span class="lineNum">    1323 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        708 :     if (proxyArg != &quot;&quot; &amp;&amp; proxyArg != &quot;0&quot;) {</span></a>
<a name="1324"><span class="lineNum">    1324 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         CService proxyAddr;</span></a>
<a name="1325"><span class="lineNum">    1325 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          6 :         if (!Lookup(proxyArg, proxyAddr, 9050, fNameLookup)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 6 times"> + </span>]
<a name="1326"><span class="lineNum">    1326 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Invalid -proxy address or hostname: '%s'&quot;), proxyArg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1327"><span class="lineNum">    1327 </span>                :            :         }</a>
<a name="1328"><span class="lineNum">    1328 </span>                :            : </a>
<a name="1329"><span class="lineNum">    1329 </span>                :<span class="lineCov">         12 :         proxyType addrProxy = proxyType(proxyAddr, proxyRandomize);</span></a>
<a name="1330"><span class="lineNum">    1330 </span>  [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 6 times"> + </span>]:<span class="lineCov">          6 :         if (!addrProxy.IsValid())</span></a>
<a name="1331"><span class="lineNum">    1331 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Invalid -proxy address or hostname: '%s'&quot;), proxyArg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1332"><span class="lineNum">    1332 </span>                :            : </a>
<a name="1333"><span class="lineNum">    1333 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetProxy(NET_IPV4, addrProxy);</span></a>
<a name="1334"><span class="lineNum">    1334 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetProxy(NET_IPV6, addrProxy);</span></a>
<a name="1335"><span class="lineNum">    1335 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetProxy(NET_ONION, addrProxy);</span></a>
<a name="1336"><span class="lineNum">    1336 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetProxy(NET_CJDNS, addrProxy);</span></a>
<a name="1337"><span class="lineNum">    1337 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetNameProxy(addrProxy);</span></a>
<a name="1338"><span class="lineNum">    1338 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetReachable(NET_ONION, true); // by default, -proxy sets onion as reachable, unless -noonion later</span></a>
<a name="1339"><span class="lineNum">    1339 </span>                :            :     }</a>
<a name="1340"><span class="lineNum">    1340 </span>                :            : </a>
<a name="1341"><span class="lineNum">    1341 </span>                :            :     // -onion can be used to set only a proxy for .onion, or override normal proxy for .onion addresses</a>
<a name="1342"><span class="lineNum">    1342 </span>                :            :     // -noonion (or -onion=0) disables connecting to .onion entirely</a>
<a name="1343"><span class="lineNum">    1343 </span>                :            :     // An empty string is used to not override the onion proxy (in which case it defaults to -proxy set above, or none)</a>
<a name="1344"><span class="lineNum">    1344 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1404 :     std::string onionArg = args.GetArg(&quot;-onion&quot;, &quot;&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1345"><span class="lineNum">    1345 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 700 times"> + </span>]:<span class="lineCov">        702 :     if (onionArg != &quot;&quot;) {</span></a>
<a name="1346"><span class="lineNum">    1346 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          2 :         if (onionArg == &quot;0&quot;) { // Handle -noonion/-onion=0</span></a>
<a name="1347"><span class="lineNum">    1347 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :             SetReachable(NET_ONION, false);</span></a>
<a name="1348"><span class="lineNum">    1348 </span>                :            :         } else {</a>
<a name="1349"><span class="lineNum">    1349 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :             CService onionProxy;</span></a>
<a name="1350"><span class="lineNum">    1350 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          1 :             if (!Lookup(onionArg, onionProxy, 9050, fNameLookup)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]
<a name="1351"><span class="lineNum">    1351 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                 return InitError(strprintf(_(&quot;Invalid -onion address or hostname: '%s'&quot;), onionArg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1352"><span class="lineNum">    1352 </span>                :            :             }</a>
<a name="1353"><span class="lineNum">    1353 </span>                :<span class="lineCov">          2 :             proxyType addrOnion = proxyType(onionProxy, proxyRandomize);</span></a>
<a name="1354"><span class="lineNum">    1354 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">          1 :             if (!addrOnion.IsValid())</span></a>
<a name="1355"><span class="lineNum">    1355 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                 return InitError(strprintf(_(&quot;Invalid -onion address or hostname: '%s'&quot;), onionArg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1356"><span class="lineNum">    1356 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :             SetProxy(NET_ONION, addrOnion);</span></a>
<a name="1357"><span class="lineNum">    1357 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :             SetReachable(NET_ONION, true);</span></a>
<a name="1358"><span class="lineNum">    1358 </span>                :            :         }</a>
<a name="1359"><span class="lineNum">    1359 </span>                :            :     }</a>
<a name="1360"><span class="lineNum">    1360 </span>                :            : </a>
<a name="1361"><span class="lineNum">    1361 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     for (const std::string&amp; strAddr : args.GetArgs(&quot;-externalip&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 702 times"> + </span>]
<a name="1362"><span class="lineNum">    1362 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         CService addrLocal;</span></a>
<a name="1363"><span class="lineNum">    1363 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         if (Lookup(strAddr, addrLocal, GetListenPort(), fNameLookup) &amp;&amp; addrLocal.IsValid())</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span><span class="branchNoExec" title="Branch 10 was not executed"> # </span><span class="branchNoExec" title="Branch 11 was not executed"> # </span><span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span> 
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 14 was not executed"> # </span><span class="branchNoExec" title="Branch 15 was not executed"> # </span>]
<a name="1364"><span class="lineNum">    1364 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             AddLocal(addrLocal, LOCAL_MANUAL);</span></a>
<a name="1365"><span class="lineNum">    1365 </span>                :            :         else</a>
<a name="1366"><span class="lineNum">    1366 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(ResolveErrMsg(&quot;externalip&quot;, strAddr));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1367"><span class="lineNum">    1367 </span>                :            :     }</a>
<a name="1368"><span class="lineNum">    1368 </span>                :            : </a>
<a name="1369"><span class="lineNum">    1369 </span>                :            : #if ENABLE_ZMQ</a>
<a name="1370"><span class="lineNum">    1370 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :     g_zmq_notification_interface = CZMQNotificationInterface::Create();</span></a>
<a name="1371"><span class="lineNum">    1371 </span>                :            : </a>
<a name="1372"><span class="lineNum">    1372 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span>]:<span class="lineCov">        702 :     if (g_zmq_notification_interface) {</span></a>
<a name="1373"><span class="lineNum">    1373 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         RegisterValidationInterface(g_zmq_notification_interface);</span></a>
<a name="1374"><span class="lineNum">    1374 </span>                :            :     }</a>
<a name="1375"><span class="lineNum">    1375 </span>                :            : #endif</a>
<a name="1376"><span class="lineNum">    1376 </span>                :            : </a>
<a name="1377"><span class="lineNum">    1377 </span>                :            :     // ********************************************************* Step 7: load block chain</a>
<a name="1378"><span class="lineNum">    1378 </span>                :            : </a>
<a name="1379"><span class="lineNum">    1379 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     fReindex = args.GetBoolArg(&quot;-reindex&quot;, false);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1380"><span class="lineNum">    1380 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     bool fReindexChainState = args.GetBoolArg(&quot;-reindex-chainstate&quot;, false);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1381"><span class="lineNum">    1381 </span>                :            : </a>
<a name="1382"><span class="lineNum">    1382 </span>                :            :     // cache size calculations</a>
<a name="1383"><span class="lineNum">    1383 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     int64_t nTotalCache = (args.GetIntArg(&quot;-dbcache&quot;, nDefaultDbCache) &lt;&lt; 20);</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 702 times"> + </span>]
<a name="1384"><span class="lineNum">    1384 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 702 times"> + </span>]:<span class="lineCov">        702 :     nTotalCache = std::max(nTotalCache, nMinDbCache &lt;&lt; 20); // total cache cannot be less than nMinDbCache</span></a>
<a name="1385"><span class="lineNum">    1385 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 702 times"> + </span>]:<span class="lineCov">        702 :     nTotalCache = std::min(nTotalCache, nMaxDbCache &lt;&lt; 20); // total cache cannot be greater than nMaxDbcache</span></a>
<a name="1386"><span class="lineNum">    1386 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :     int64_t nBlockTreeDBCache = std::min(nTotalCache / 8, nMaxBlockDBCache &lt;&lt; 20);</span></a>
<a name="1387"><span class="lineNum">    1387 </span>                :<span class="lineCov">        702 :     nTotalCache -= nBlockTreeDBCache;</span></a>
<a name="1388"><span class="lineNum">    1388 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       2088 :     int64_t nTxIndexCache = std::min(nTotalCache / 8, args.GetBoolArg(&quot;-txindex&quot;, DEFAULT_TXINDEX) ? nMaxTxIndexCache &lt;&lt; 20 : 0);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 693 times"> + </span><span class="branchCov" title="Branch 5 was taken 9 times"> + </span><span class="branchCov" title="Branch 6 was taken 693 times"> + </span><span class="branchCov" title="Branch 7 was taken 9 times"> + </span><span class="branchCov" title="Branch 8 was taken 7 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchCov" title="Branch 9 was taken 695 times"> + </span>]
<a name="1389"><span class="lineNum">    1389 </span>                :<span class="lineCov">        702 :     nTotalCache -= nTxIndexCache;</span></a>
<a name="1390"><span class="lineNum">    1390 </span>                :<span class="lineCov">        702 :     int64_t filter_index_cache = 0;</span></a>
<a name="1391"><span class="lineNum">    1391 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 695 times"> + </span>]:<span class="lineCov">        702 :     if (!g_enabled_filter_types.empty()) {</span></a>
<a name="1392"><span class="lineNum">    1392 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         size_t n_indexes = g_enabled_filter_types.size();</span></a>
<a name="1393"><span class="lineNum">    1393 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>]:<span class="lineCov">          7 :         int64_t max_cache = std::min(nTotalCache / 8, max_filter_index_cache &lt;&lt; 20);</span></a>
<a name="1394"><span class="lineNum">    1394 </span>                :<span class="lineCov">          7 :         filter_index_cache = max_cache / n_indexes;</span></a>
<a name="1395"><span class="lineNum">    1395 </span>                :<span class="lineCov">          7 :         nTotalCache -= filter_index_cache * n_indexes;</span></a>
<a name="1396"><span class="lineNum">    1396 </span>                :            :     }</a>
<a name="1397"><span class="lineNum">    1397 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :     int64_t nCoinDBCache = std::min(nTotalCache / 2, (nTotalCache / 4) + (1 &lt;&lt; 23)); // use 25%-50% of the remainder for disk cache</span></a>
<a name="1398"><span class="lineNum">    1398 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :     nCoinDBCache = std::min(nCoinDBCache, nMaxCoinsDBCache &lt;&lt; 20); // cap total coins db cache</span></a>
<a name="1399"><span class="lineNum">    1399 </span>                :<span class="lineCov">        702 :     nTotalCache -= nCoinDBCache;</span></a>
<a name="1400"><span class="lineNum">    1400 </span>                :<span class="lineCov">        702 :     int64_t nCoinCacheUsage = nTotalCache; // the rest goes to in-memory cache</span></a>
<a name="1401"><span class="lineNum">    1401 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     int64_t nMempoolSizeMax = args.GetIntArg(&quot;-maxmempool&quot;, DEFAULT_MAX_MEMPOOL_SIZE) * 1000000;</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1402"><span class="lineNum">    1402 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1404 :     LogPrintf(&quot;Cache configuration:\n&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1403"><span class="lineNum">    1403 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1404 :     LogPrintf(&quot;* Using %.1f MiB for block index database\n&quot;, nBlockTreeDBCache * (1.0 / 1024 / 1024));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1404"><span class="lineNum">    1404 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :     if (args.GetBoolArg(&quot;-txindex&quot;, DEFAULT_TXINDEX)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 9 times"> + </span><span class="branchCov" title="Branch 5 was taken 693 times"> + </span>]
<a name="1405"><span class="lineNum">    1405 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        720 :         LogPrintf(&quot;* Using %.1f MiB for transaction index database\n&quot;, nTxIndexCache * (1.0 / 1024 / 1024));</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1406"><span class="lineNum">    1406 </span>                :            :     }</a>
<a name="1407"><span class="lineNum">    1407 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 702 times"> + </span>]:<span class="lineCov">        709 :     for (BlockFilterType filter_type : g_enabled_filter_types) {</span></a>
<a name="1408"><span class="lineNum">    1408 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         14 :         LogPrintf(&quot;* Using %.1f MiB for %s block filter index database\n&quot;,</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1409"><span class="lineNum">    1409 </span>                :            :                   filter_index_cache * (1.0 / 1024 / 1024), BlockFilterTypeName(filter_type));</a>
<a name="1410"><span class="lineNum">    1410 </span>                :            :     }</a>
<a name="1411"><span class="lineNum">    1411 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1404 :     LogPrintf(&quot;* Using %.1f MiB for chain state database\n&quot;, nCoinDBCache * (1.0 / 1024 / 1024));</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1412"><span class="lineNum">    1412 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1404 :     LogPrintf(&quot;* Using %.1f MiB for in-memory UTXO set (plus up to %.1f MiB of unused mempool space)\n&quot;, nCoinCacheUsage * (1.0 / 1024 / 1024), nMempoolSizeMax * (1.0 / 1024 / 1024));</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1413"><span class="lineNum">    1413 </span>                :            : </a>
<a name="1414"><span class="lineNum">    1414 </span>                :<span class="lineCov">        702 :     bool fLoaded = false;</span></a>
<a name="1415"><span class="lineNum">    1415 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">        702 :     while (!fLoaded &amp;&amp; !ShutdownRequested()) {</span></a>
<a name="1416"><span class="lineNum">    1416 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :         const bool fReset = fReindex;</span></a>
<a name="1417"><span class="lineNum">    1417 </span>                :<span class="lineCov">       2105 :         auto is_coinsview_empty = [&amp;](CChainState* chainstate) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {</span></a>
<a name="1418"><span class="lineNum">    1418 </span>  [<span class="branchCov" title="Branch 0 was taken 1383 times"> + </span><span class="branchCov" title="Branch 1 was taken 20 times"> + </span><span class="branchCov" title="Branch 2 was taken 1379 times"> + </span><span class="branchCov" title="Branch 3 was taken 4 times"> + </span> :<span class="lineCov">       2782 :             return fReset || fReindexChainState || chainstate-&gt;CoinsTip().GetBestBlock().IsNull();</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 520 times"> + </span><span class="branchCov" title="Branch 5 was taken 859 times"> + </span>]
<a name="1419"><span class="lineNum">    1419 </span>                :<span class="lineCov">        702 :         };</span></a>
<a name="1420"><span class="lineNum">    1420 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchCov" title="Branch 1 was taken 699 times"> + </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2103 :         bilingual_str strLoadError;</span></a>
<a name="1421"><span class="lineNum">    1421 </span>                :            : </a>
<a name="1422"><span class="lineNum">    1422 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        702 :         uiInterface.InitMessage(_(&quot;Loading block index&quot;).translated);</span></a>
<a name="1423"><span class="lineNum">    1423 </span>                :            : </a>
<a name="1424"><span class="lineNum">    1424 </span>                :<span class="lineCov">        702 :         do {</span></a>
<a name="1425"><span class="lineNum">    1425 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :             const int64_t load_block_index_start_time = GetTimeMillis();</span></a>
<a name="1426"><span class="lineNum">    1426 </span>                :<span class="lineCov">        702 :             try {</span></a>
<a name="1427"><span class="lineNum">    1427 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                 LOCK(cs_main);</span></a>
<a name="1428"><span class="lineNum">    1428 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">       1404 :                 chainman.InitializeChainstate(Assert(node.mempool.get()));</span></a>
<a name="1429"><span class="lineNum">    1429 </span>                :<span class="lineCov">        702 :                 chainman.m_total_coinstip_cache = nCoinCacheUsage;</span></a>
<a name="1430"><span class="lineNum">    1430 </span>                :<span class="lineCov">        702 :                 chainman.m_total_coinsdb_cache = nCoinDBCache;</span></a>
<a name="1431"><span class="lineNum">    1431 </span>                :            : </a>
<a name="1432"><span class="lineNum">    1432 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                 UnloadBlockIndex(node.mempool.get(), chainman);</span></a>
<a name="1433"><span class="lineNum">    1433 </span>                :            : </a>
<a name="1434"><span class="lineNum">    1434 </span>                :<span class="lineCov">        702 :                 auto&amp; pblocktree{chainman.m_blockman.m_block_tree_db};</span></a>
<a name="1435"><span class="lineNum">    1435 </span>                :            :                 // new CBlockTreeDB tries to delete the existing file, which</a>
<a name="1436"><span class="lineNum">    1436 </span>                :            :                 // fails if it's still open from the previous loop. Close it first:</a>
<a name="1437"><span class="lineNum">    1437 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 702 times"> + </span>]:<span class="lineCov">        702 :                 pblocktree.reset();</span></a>
<a name="1438"><span class="lineNum">    1438 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        702 :                 pblocktree.reset(new CBlockTreeDB(nBlockTreeDBCache, false, fReset));</span></a>
<a name="1439"><span class="lineNum">    1439 </span>                :            : </a>
<a name="1440"><span class="lineNum">    1440 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 692 times"> + </span>]:<span class="lineCov">        702 :                 if (fReset) {</span></a>
<a name="1441"><span class="lineNum">    1441 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">         10 :                     pblocktree-&gt;WriteReindexing(true);</span></a>
<a name="1442"><span class="lineNum">    1442 </span>                :            :                     //If we're reindexing in prune mode, wipe away unusable block files and all undo data files</a>
<a name="1443"><span class="lineNum">    1443 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 9 times"> + </span>]:<span class="lineCov">         10 :                     if (fPruneMode)</span></a>
<a name="1444"><span class="lineNum">    1444 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                         CleanupBlockRevFiles();</span></a>
<a name="1445"><span class="lineNum">    1445 </span>                :            :                 }</a>
<a name="1446"><span class="lineNum">    1446 </span>                :            : </a>
<a name="1447"><span class="lineNum">    1447 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        702 :                 if (ShutdownRequested()) break;</span></a>
<a name="1448"><span class="lineNum">    1448 </span>                :            : </a>
<a name="1449"><span class="lineNum">    1449 </span>                :            :                 // LoadBlockIndex will load fHavePruned if we've ever removed a</a>
<a name="1450"><span class="lineNum">    1450 </span>                :            :                 // block file from disk.</a>
<a name="1451"><span class="lineNum">    1451 </span>                :            :                 // Note that it also sets fReindex based on the disk flag!</a>
<a name="1452"><span class="lineNum">    1452 </span>                :            :                 // From here on out fReindex and fReset mean something different!</a>
<a name="1453"><span class="lineNum">    1453 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">        702 :                 if (!chainman.LoadBlockIndex()) {</span></a>
<a name="1454"><span class="lineNum">    1454 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     if (ShutdownRequested()) break;</span></a>
<a name="1455"><span class="lineNum">    1455 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     strLoadError = _(&quot;Error loading block database&quot;);</span></a>
<a name="1456"><span class="lineNum">    1456 </span>                :            :                     break;</a>
<a name="1457"><span class="lineNum">    1457 </span>                :            :                 }</a>
<a name="1458"><span class="lineNum">    1458 </span>                :            : </a>
<a name="1459"><span class="lineNum">    1459 </span>                :            :                 // If the loaded chain has a wrong genesis, bail out immediately</a>
<a name="1460"><span class="lineNum">    1460 </span>                :            :                 // (we're likely using a testnet datadir, or the other way around).</a>
<a name="1461"><span class="lineNum">    1461 </span>  [<span class="branchCov" title="Branch 0 was taken 432 times"> + </span><span class="branchCov" title="Branch 1 was taken 270 times"> + </span><span class="branchCov" title="Branch 2 was taken 432 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1134 :                 if (!chainman.BlockIndex().empty() &amp;&amp;</span></a>
<a name="1462"><span class="lineNum">    1462 </span>        [<span class="branchCov" title="Branch 0 was taken 432 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        432 :                         !chainman.m_blockman.LookupBlockIndex(chainparams.GetConsensus().hashGenesisBlock)) {</span></a>
<a name="1463"><span class="lineNum">    1463 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                     return InitError(_(&quot;Incorrect or no genesis block found. Wrong datadir for network?&quot;));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1464"><span class="lineNum">    1464 </span>                :            :                 }</a>
<a name="1465"><span class="lineNum">    1465 </span>                :            : </a>
<a name="1466"><span class="lineNum">    1466 </span>                :            :                 // Check for changed -prune state.  What we are concerned about is a user who has pruned blocks</a>
<a name="1467"><span class="lineNum">    1467 </span>                :            :                 // in the past, but is now trying to run unpruned.</a>
<a name="1468"><span class="lineNum">    1468 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 700 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">        702 :                 if (fHavePruned &amp;&amp; !fPruneMode) {</span></a>
<a name="1469"><span class="lineNum">    1469 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     strLoadError = _(&quot;You need to rebuild the database using -reindex to go back to unpruned mode.  This will redownload the entire blockchain&quot;);</span></a>
<a name="1470"><span class="lineNum">    1470 </span>                :            :                     break;</a>
<a name="1471"><span class="lineNum">    1471 </span>                :            :                 }</a>
<a name="1472"><span class="lineNum">    1472 </span>                :            : </a>
<a name="1473"><span class="lineNum">    1473 </span>                :            :                 // At this point blocktree args are consistent with what's on disk.</a>
<a name="1474"><span class="lineNum">    1474 </span>                :            :                 // If we're not mid-reindex (based on disk + args), add a genesis block on disk</a>
<a name="1475"><span class="lineNum">    1475 </span>                :            :                 // (otherwise we use the one already on disk).</a>
<a name="1476"><span class="lineNum">    1476 </span>                :            :                 // This is called again in ThreadImport after the reindex completes.</a>
<a name="1477"><span class="lineNum">    1477 </span>  [<span class="branchCov" title="Branch 0 was taken 692 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span><span class="branchCov" title="Branch 2 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        702 :                 if (!fReindex &amp;&amp; !chainman.ActiveChainstate().LoadGenesisBlock()) {</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1478"><span class="lineNum">    1478 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     strLoadError = _(&quot;Error initializing block database&quot;);</span></a>
<a name="1479"><span class="lineNum">    1479 </span>                :            :                     break;</a>
<a name="1480"><span class="lineNum">    1480 </span>                :            :                 }</a>
<a name="1481"><span class="lineNum">    1481 </span>                :            : </a>
<a name="1482"><span class="lineNum">    1482 </span>                :            :                 // At this point we're either in reindex or we've loaded a useful</a>
<a name="1483"><span class="lineNum">    1483 </span>                :            :                 // block tree into BlockIndex()!</a>
<a name="1484"><span class="lineNum">    1484 </span>                :            : </a>
<a name="1485"><span class="lineNum">    1485 </span>                :<span class="lineCov">        702 :                 bool failed_chainstate_init = false;</span></a>
<a name="1486"><span class="lineNum">    1486 </span>                :            : </a>
<a name="1487"><span class="lineNum">    1487 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">       1404 :                 for (CChainState* chainstate : chainman.GetAll()) {</span></a>
<a name="1488"><span class="lineNum">    1488 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1404 :                     chainstate-&gt;InitCoinsDB(</span></a>
<a name="1489"><span class="lineNum">    1489 </span>                :            :                         /* cache_size_bytes */ nCoinDBCache,</a>
<a name="1490"><span class="lineNum">    1490 </span>                :            :                         /* in_memory */ false,</a>
<a name="1491"><span class="lineNum">    1491 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 692 times"> + </span><span class="branchCov" title="Branch 3 was taken 10 times"> + </span> :<span class="lineCov">       1404 :                         /* should_wipe */ fReset || fReindexChainState);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 690 times"> + </span><span class="branchCov" title="Branch 5 was taken 2 times"> + </span>]
<a name="1492"><span class="lineNum">    1492 </span>                :            : </a>
<a name="1493"><span class="lineNum">    1493 </span>                :<span class="lineCov">       1404 :                     chainstate-&gt;CoinsErrorCatcher().AddReadErrCallback([]() {</span></a>
<a name="1494"><span class="lineNum">    1494 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         uiInterface.ThreadSafeMessageBox(</span></a>
<a name="1495"><span class="lineNum">    1495 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                             _(&quot;Error reading from database, shutting down.&quot;),</span></a>
<a name="1496"><span class="lineNum">    1496 </span>                :<span class="lineNoCov">          0 :                             &quot;&quot;, CClientUIInterface::MSG_ERROR);</span></a>
<a name="1497"><span class="lineNum">    1497 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                     });</span></a>
<a name="1498"><span class="lineNum">    1498 </span>                :            : </a>
<a name="1499"><span class="lineNum">    1499 </span>                :            :                     // If necessary, upgrade from older database format.</a>
<a name="1500"><span class="lineNum">    1500 </span>                :            :                     // This is a no-op if we cleared the coinsviewdb with -reindex or -reindex-chainstate</a>
<a name="1501"><span class="lineNum">    1501 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">        702 :                     if (!chainstate-&gt;CoinsDB().Upgrade()) {</span></a>
<a name="1502"><span class="lineNum">    1502 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         strLoadError = _(&quot;Error upgrading chainstate database&quot;);</span></a>
<a name="1503"><span class="lineNum">    1503 </span>                :<span class="lineNoCov">          0 :                         failed_chainstate_init = true;</span></a>
<a name="1504"><span class="lineNum">    1504 </span>                :<span class="lineNoCov">          0 :                         break;</span></a>
<a name="1505"><span class="lineNum">    1505 </span>                :            :                     }</a>
<a name="1506"><span class="lineNum">    1506 </span>                :            : </a>
<a name="1507"><span class="lineNum">    1507 </span>                :            :                     // ReplayBlocks is a no-op if we cleared the coinsviewdb with -reindex or -reindex-chainstate</a>
<a name="1508"><span class="lineNum">    1508 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 702 times"> + </span>]:<span class="lineCov">        702 :                     if (!chainstate-&gt;ReplayBlocks()) {</span></a>
<a name="1509"><span class="lineNum">    1509 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         strLoadError = _(&quot;Unable to replay blocks. You will need to rebuild the database using -reindex-chainstate.&quot;);</span></a>
<a name="1510"><span class="lineNum">    1510 </span>                :<span class="lineNoCov">          0 :                         failed_chainstate_init = true;</span></a>
<a name="1511"><span class="lineNum">    1511 </span>                :<span class="lineNoCov">          0 :                         break;</span></a>
<a name="1512"><span class="lineNum">    1512 </span>                :            :                     }</a>
<a name="1513"><span class="lineNum">    1513 </span>                :            : </a>
<a name="1514"><span class="lineNum">    1514 </span>                :            :                     // The on-disk coinsdb is now in a good state, create the cache</a>
<a name="1515"><span class="lineNum">    1515 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                     chainstate-&gt;InitCoinsCache(nCoinCacheUsage);</span></a>
<a name="1516"><span class="lineNum">    1516 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                     assert(chainstate-&gt;CanFlushToDisk());</span></a>
<a name="1517"><span class="lineNum">    1517 </span>                :            : </a>
<a name="1518"><span class="lineNum">    1518 </span>  [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 430 times"> + </span><span class="branchCov" title="Branch 3 was taken 272 times"> + </span>]:<span class="lineCov">        702 :                     if (!is_coinsview_empty(chainstate)) {</span></a>
<a name="1519"><span class="lineNum">    1519 </span>                :            :                         // LoadChainTip initializes the chain based on CoinsTip()'s best block</a>
<a name="1520"><span class="lineNum">    1520 </span>  [<span class="branchCov" title="Branch 0 was taken 430 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 430 times"> + </span>]:<span class="lineCov">        430 :                         if (!chainstate-&gt;LoadChainTip()) {</span></a>
<a name="1521"><span class="lineNum">    1521 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                             strLoadError = _(&quot;Error initializing block database&quot;);</span></a>
<a name="1522"><span class="lineNum">    1522 </span>                :<span class="lineNoCov">          0 :                             failed_chainstate_init = true;</span></a>
<a name="1523"><span class="lineNum">    1523 </span>                :<span class="lineNoCov">          0 :                             break; // out of the per-chainstate loop</span></a>
<a name="1524"><span class="lineNum">    1524 </span>                :            :                         }</a>
<a name="1525"><span class="lineNum">    1525 </span>  [<span class="branchCov" title="Branch 0 was taken 430 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 430 times"> + </span>]:<span class="lineCov">        430 :                         assert(chainstate-&gt;m_chain.Tip() != nullptr);</span></a>
<a name="1526"><span class="lineNum">    1526 </span>                :            :                     }</a>
<a name="1527"><span class="lineNum">    1527 </span>                :            :                 }</a>
<a name="1528"><span class="lineNum">    1528 </span>                :            : </a>
<a name="1529"><span class="lineNum">    1529 </span>        [<span class="branchCov" title="Branch 0 was taken 702 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        702 :                 if (failed_chainstate_init) {</span></a>
<a name="1530"><span class="lineNum">    1530 </span>                :            :                     break; // out of the chainstate activation do-while</a>
<a name="1531"><span class="lineNum">    1531 </span>                :            :                 }</a>
<a name="1532"><span class="lineNum">    1532 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineNoCov">          0 :             } catch (const std::exception&amp; e) {</span></a>
<a name="1533"><span class="lineNum">    1533 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineNoCov">          0 :                 LogPrintf(&quot;%s\n&quot;, e.what());</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1534"><span class="lineNum">    1534 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineNoCov">          0 :                 strLoadError = _(&quot;Error opening block database&quot;);</span></a>
<a name="1535"><span class="lineNum">    1535 </span>                :<span class="lineNoCov">          0 :                 break;</span></a>
<a name="1536"><span class="lineNum">    1536 </span>                :            :             }</a>
<a name="1537"><span class="lineNum">    1537 </span>                :            : </a>
<a name="1538"><span class="lineNum">    1538 </span>        [<span class="branchCov" title="Branch 0 was taken 692 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">        702 :             if (!fReset) {</span></a>
<a name="1539"><span class="lineNum">    1539 </span>        [<span class="branchCov" title="Branch 0 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        692 :                 LOCK(cs_main);</span></a>
<a name="1540"><span class="lineNum">    1540 </span>  [<span class="branchCov" title="Branch 0 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 691 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1383 :                 auto chainstates{chainman.GetAll()};</span></a>
<a name="1541"><span class="lineNum">    1541 </span>  [<span class="branchCov" title="Branch 0 was taken 692 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 691 times"> + </span>]:<span class="lineCov">        692 :                 if (std::any_of(chainstates.begin(), chainstates.end(),</span></a>
<a name="1542"><span class="lineNum">    1542 </span>                :<span class="lineCov">        692 :                                 [](const CChainState* cs) EXCLUSIVE_LOCKS_REQUIRED(cs_main) { return cs-&gt;NeedsRedownload(); })) {</span></a>
<a name="1543"><span class="lineNum">    1543 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                     strLoadError = strprintf(_(&quot;Witness data for blocks after height %d requires validation. Please restart with -reindex.&quot;),</span></a>
<a name="1544"><span class="lineNum">    1544 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          1 :                                              chainparams.GetConsensus().SegwitHeight);</span></a>
<a name="1545"><span class="lineNum">    1545 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                     break;</span></a>
<a name="1546"><span class="lineNum">    1546 </span>                :            :                 }</a>
<a name="1547"><span class="lineNum">    1547 </span>                :            :             }</a>
<a name="1548"><span class="lineNum">    1548 </span>                :            : </a>
<a name="1549"><span class="lineNum">    1549 </span>                :<span class="lineCov">        701 :             bool failed_verification = false;</span></a>
<a name="1550"><span class="lineNum">    1550 </span>                :            : </a>
<a name="1551"><span class="lineNum">    1551 </span>                :<span class="lineCov">        701 :             try {</span></a>
<a name="1552"><span class="lineNum">    1552 </span>        [<span class="branchCov" title="Branch 0 was taken 701 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        701 :                 LOCK(cs_main);</span></a>
<a name="1553"><span class="lineNum">    1553 </span>                :            : </a>
<a name="1554"><span class="lineNum">    1554 </span>  [<span class="branchCov" title="Branch 0 was taken 701 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 701 times"> + </span><span class="branchCov" title="Branch 3 was taken 699 times"> + </span> :<span class="lineCov">       2101 :                 for (CChainState* chainstate : chainman.GetAll()) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 701 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1555"><span class="lineNum">    1555 </span>  [<span class="branchCov" title="Branch 0 was taken 701 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 429 times"> + </span><span class="branchCov" title="Branch 3 was taken 272 times"> + </span>]:<span class="lineCov">        701 :                     if (!is_coinsview_empty(chainstate)) {</span></a>
<a name="1556"><span class="lineNum">    1556 </span>  [<span class="branchCov" title="Branch 0 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        429 :                         uiInterface.InitMessage(_(&quot;Verifying blocks&quot;).translated);</span></a>
<a name="1557"><span class="lineNum">    1557 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 427 times"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        433 :                         if (fHavePruned &amp;&amp; args.GetIntArg(&quot;-checkblocks&quot;, DEFAULT_CHECKBLOCKS) &gt; MIN_BLOCKS_TO_KEEP) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 2 times"> + </span> 
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 9 was taken 427 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 12 was not taken"> - </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<a name="1558"><span class="lineNum">    1558 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        429 :                             LogPrintf(&quot;Prune: pruned datadir may not have more than %d blocks; only checking available blocks\n&quot;,</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1559"><span class="lineNum">    1559 </span>                :            :                                 MIN_BLOCKS_TO_KEEP);</a>
<a name="1560"><span class="lineNum">    1560 </span>                :            :                         }</a>
<a name="1561"><span class="lineNum">    1561 </span>                :            : </a>
<a name="1562"><span class="lineNum">    1562 </span>        [<span class="branchCov" title="Branch 0 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        429 :                         const CBlockIndex* tip = chainstate-&gt;m_chain.Tip();</span></a>
<a name="1563"><span class="lineNum">    1563 </span>        [<span class="branchCov" title="Branch 0 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        429 :                         RPCNotifyBlockChange(tip);</span></a>
<a name="1564"><span class="lineNum">    1564 </span>  [<span class="branchCov" title="Branch 0 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 429 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        429 :                         if (tip &amp;&amp; tip-&gt;nTime &gt; GetTime() + MAX_FUTURE_BLOCK_TIME) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 428 times"> + </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]
<a name="1565"><span class="lineNum">    1565 </span>                :<span class="lineCov">          2 :                             strLoadError = _(&quot;The block database contains a block which appears to be from the future. &quot;</span></a>
<a name="1566"><span class="lineNum">    1566 </span>                :            :                                     &quot;This may be due to your computer's date and time being set incorrectly. &quot;</a>
<a name="1567"><span class="lineNum">    1567 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                                     &quot;Only rebuild the block database if you are sure that your computer's date and time are correct&quot;);</span></a>
<a name="1568"><span class="lineNum">    1568 </span>                :<span class="lineCov">          1 :                             failed_verification = true;</span></a>
<a name="1569"><span class="lineNum">    1569 </span>                :<span class="lineCov">          1 :                             break;</span></a>
<a name="1570"><span class="lineNum">    1570 </span>                :            :                         }</a>
<a name="1571"><span class="lineNum">    1571 </span>                :            : </a>
<a name="1572"><span class="lineNum">    1572 </span>  [<span class="branchCov" title="Branch 0 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1712 :                         if (!CVerifyDB().VerifyDB(</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchCov" title="Branch 7 was taken 427 times"> + </span>]
<a name="1573"><span class="lineNum">    1573 </span>        [<span class="branchCov" title="Branch 0 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        428 :                                 *chainstate, chainparams, chainstate-&gt;CoinsDB(),</span></a>
<a name="1574"><span class="lineNum">    1574 </span>  [<span class="branchCov" title="Branch 0 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        856 :                                 args.GetIntArg(&quot;-checklevel&quot;, DEFAULT_CHECKLEVEL),</span></a>
<a name="1575"><span class="lineNum">    1575 </span>  [<span class="branchCov" title="Branch 0 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 428 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        856 :                                 args.GetIntArg(&quot;-checkblocks&quot;, DEFAULT_CHECKBLOCKS))) {</span></a>
<a name="1576"><span class="lineNum">    1576 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                             strLoadError = _(&quot;Corrupted block database detected&quot;);</span></a>
<a name="1577"><span class="lineNum">    1577 </span>                :<span class="lineCov">          1 :                             failed_verification = true;</span></a>
<a name="1578"><span class="lineNum">    1578 </span>                :<span class="lineCov">          1 :                             break;</span></a>
<a name="1579"><span class="lineNum">    1579 </span>                :            :                         }</a>
<a name="1580"><span class="lineNum">    1580 </span>                :            :                     }</a>
<a name="1581"><span class="lineNum">    1581 </span>                :            :                 }</a>
<a name="1582"><span class="lineNum">    1582 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineNoCov">          0 :             } catch (const std::exception&amp; e) {</span></a>
<a name="1583"><span class="lineNum">    1583 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineNoCov">          0 :                 LogPrintf(&quot;%s\n&quot;, e.what());</span></a>
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1584"><span class="lineNum">    1584 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineNoCov">          0 :                 strLoadError = _(&quot;Error opening block database&quot;);</span></a>
<a name="1585"><span class="lineNum">    1585 </span>                :<span class="lineNoCov">          0 :                 failed_verification = true;</span></a>
<a name="1586"><span class="lineNum">    1586 </span>                :<span class="lineNoCov">          0 :                 break;</span></a>
<a name="1587"><span class="lineNum">    1587 </span>                :            :             }</a>
<a name="1588"><span class="lineNum">    1588 </span>                :            : </a>
<a name="1589"><span class="lineNum">    1589 </span>        [<span class="branchCov" title="Branch 0 was taken 699 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        701 :             if (!failed_verification) {</span></a>
<a name="1590"><span class="lineNum">    1590 </span>                :<span class="lineCov">        699 :                 fLoaded = true;</span></a>
<a name="1591"><span class="lineNum">    1591 </span>  [<span class="branchCov" title="Branch 0 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1401 :                 LogPrintf(&quot; block index %15dms\n&quot;, GetTimeMillis() - load_block_index_start_time);</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 3 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="1592"><span class="lineNum">    1592 </span>                :            :             }</a>
<a name="1593"><span class="lineNum">    1593 </span>                :            :         } while(false);</a>
<a name="1594"><span class="lineNum">    1594 </span>                :            : </a>
<a name="1595"><span class="lineNum">    1595 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        702 :         if (!fLoaded &amp;&amp; !ShutdownRequested()) {</span></a>
<a name="1596"><span class="lineNum">    1596 </span>                :            :             // first suggest a reindex</a>
<a name="1597"><span class="lineNum">    1597 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :             if (!fReset) {</span></a>
<a name="1598"><span class="lineNum">    1598 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :                 bool fRet = uiInterface.ThreadSafeQuestion(</span></a>
<a name="1599"><span class="lineNum">    1599 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         27 :                     strLoadError + Untranslated(&quot;.\n\n&quot;) + _(&quot;Do you want to rebuild the block database now?&quot;),</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 3 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="1600"><span class="lineNum">    1600 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :                     strLoadError.original + &quot;.\nPlease restart with -reindex or -reindex-chainstate to recover.&quot;,</span></a>
<a name="1601"><span class="lineNum">    1601 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">          6 :                     &quot;&quot;, CClientUIInterface::MSG_ERROR | CClientUIInterface::BTN_ABORT);</span></a>
<a name="1602"><span class="lineNum">    1602 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">          3 :                 if (fRet) {</span></a>
<a name="1603"><span class="lineNum">    1603 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     fReindex = true;</span></a>
<a name="1604"><span class="lineNum">    1604 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                     AbortShutdown();</span></a>
<a name="1605"><span class="lineNum">    1605 </span>                :            :                 } else {</a>
<a name="1606"><span class="lineNum">    1606 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          6 :                     LogPrintf(&quot;Aborted block database rebuild. Exiting.\n&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1607"><span class="lineNum">    1607 </span>                :<span class="lineCov">          3 :                     return false;</span></a>
<a name="1608"><span class="lineNum">    1608 </span>                :            :                 }</a>
<a name="1609"><span class="lineNum">    1609 </span>                :            :             } else {</a>
<a name="1610"><span class="lineNum">    1610 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 return InitError(strLoadError);</span></a>
<a name="1611"><span class="lineNum">    1611 </span>                :            :             }</a>
<a name="1612"><span class="lineNum">    1612 </span>                :            :         }</a>
<a name="1613"><span class="lineNum">    1613 </span>                :            :     }</a>
<a name="1614"><span class="lineNum">    1614 </span>                :            : </a>
<a name="1615"><span class="lineNum">    1615 </span>                :            :     // As LoadBlockIndex can take several minutes, it's possible the user</a>
<a name="1616"><span class="lineNum">    1616 </span>                :            :     // requested to kill the GUI during the last operation. If so, exit.</a>
<a name="1617"><span class="lineNum">    1617 </span>                :            :     // As the program has not fully started yet, Shutdown() is possibly overkill.</a>
<a name="1618"><span class="lineNum">    1618 </span>  [<span class="branchCov" title="Branch 0 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 699 times"> + </span>]:<span class="lineCov">        699 :     if (ShutdownRequested()) {</span></a>
<a name="1619"><span class="lineNum">    1619 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         LogPrintf(&quot;Shutdown requested. Exiting.\n&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1620"><span class="lineNum">    1620 </span>                :<span class="lineNoCov">          0 :         return false;</span></a>
<a name="1621"><span class="lineNum">    1621 </span>                :            :     }</a>
<a name="1622"><span class="lineNum">    1622 </span>                :            : </a>
<a name="1623"><span class="lineNum">    1623 </span>                :            :     // ********************************************************* Step 8: start indexers</a>
<a name="1624"><span class="lineNum">    1624 </span>  [<span class="branchCov" title="Branch 0 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 699 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        699 :     if (args.GetBoolArg(&quot;-txindex&quot;, DEFAULT_TXINDEX)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 9 times"> + </span><span class="branchCov" title="Branch 5 was taken 690 times"> + </span>]
<a name="1625"><span class="lineNum">    1625 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 9 times"> + </span> :<span class="lineCov">         18 :         if (const auto error{CheckLegacyTxindex(*Assert(chainman.m_blockman.m_block_tree_db))}) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 9 times"> + </span>]
<a name="1626"><span class="lineNum">    1626 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :             return InitError(*error);</span></a>
<a name="1627"><span class="lineNum">    1627 </span>                :            :         }</a>
<a name="1628"><span class="lineNum">    1628 </span>                :            : </a>
<a name="1629"><span class="lineNum">    1629 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 9 times"> + </span>]:<span class="lineCov">         18 :         g_txindex = std::make_unique&lt;TxIndex&gt;(nTxIndexCache, false, fReindex);</span></a>
<a name="1630"><span class="lineNum">    1630 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          9 :         if (!g_txindex-&gt;Start(chainman.ActiveChainstate())) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1631"><span class="lineNum">    1631 </span>                :            :             return false;</a>
<a name="1632"><span class="lineNum">    1632 </span>                :            :         }</a>
<a name="1633"><span class="lineNum">    1633 </span>                :            :     }</a>
<a name="1634"><span class="lineNum">    1634 </span>                :            : </a>
<a name="1635"><span class="lineNum">    1635 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 698 times"> + </span>]:<span class="lineCov">        705 :     for (const auto&amp; filter_type : g_enabled_filter_types) {</span></a>
<a name="1636"><span class="lineNum">    1636 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          7 :         InitBlockFilterIndex(filter_type, filter_index_cache, false, fReindex);</span></a>
<a name="1637"><span class="lineNum">    1637 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          7 :         if (!GetBlockFilterIndex(filter_type)-&gt;Start(chainman.ActiveChainstate())) {</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 6 times"> + </span><span class="branchCov" title="Branch 7 was taken 1 time"> + </span>]
<a name="1638"><span class="lineNum">    1638 </span>                :            :             return false;</a>
<a name="1639"><span class="lineNum">    1639 </span>                :            :         }</a>
<a name="1640"><span class="lineNum">    1640 </span>                :            :     }</a>
<a name="1641"><span class="lineNum">    1641 </span>                :            : </a>
<a name="1642"><span class="lineNum">    1642 </span>  [<span class="branchCov" title="Branch 0 was taken 698 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 698 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        698 :     if (args.GetBoolArg(&quot;-coinstatsindex&quot;, DEFAULT_COINSTATSINDEX)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchCov" title="Branch 5 was taken 694 times"> + </span>]
<a name="1643"><span class="lineNum">    1643 </span>  [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 4 times"> + </span>]:<span class="lineCov">          8 :         g_coin_stats_index = std::make_unique&lt;CoinStatsIndex&gt;(/* cache size */ 0, false, fReindex);</span></a>
<a name="1644"><span class="lineNum">    1644 </span>  [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          4 :         if (!g_coin_stats_index-&gt;Start(chainman.ActiveChainstate())) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1645"><span class="lineNum">    1645 </span>                :            :             return false;</a>
<a name="1646"><span class="lineNum">    1646 </span>                :            :         }</a>
<a name="1647"><span class="lineNum">    1647 </span>                :            :     }</a>
<a name="1648"><span class="lineNum">    1648 </span>                :            : </a>
<a name="1649"><span class="lineNum">    1649 </span>                :            :     // ********************************************************* Step 9: load wallet</a>
<a name="1650"><span class="lineNum">    1650 </span>        [<span class="branchCov" title="Branch 0 was taken 683 times"> + </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span>]:<span class="lineCov">       1379 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="1651"><span class="lineNum">    1651 </span>  [<span class="branchCov" title="Branch 0 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 681 times"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">        683 :         if (!client-&gt;load()) {</span></a>
<a name="1652"><span class="lineNum">    1652 </span>                :            :             return false;</a>
<a name="1653"><span class="lineNum">    1653 </span>                :            :         }</a>
<a name="1654"><span class="lineNum">    1654 </span>                :            :     }</a>
<a name="1655"><span class="lineNum">    1655 </span>                :            : </a>
<a name="1656"><span class="lineNum">    1656 </span>                :            :     // ********************************************************* Step 10: data directory maintenance</a>
<a name="1657"><span class="lineNum">    1657 </span>                :            : </a>
<a name="1658"><span class="lineNum">    1658 </span>                :            :     // if pruning, unset the service bit and perform the initial blockstore prune</a>
<a name="1659"><span class="lineNum">    1659 </span>                :            :     // after any wallet rescanning has taken place.</a>
<a name="1660"><span class="lineNum">    1660 </span>        [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchCov" title="Branch 1 was taken 688 times"> + </span>]:<span class="lineCov">        696 :     if (fPruneMode) {</span></a>
<a name="1661"><span class="lineNum">    1661 </span>  [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">         16 :         LogPrintf(&quot;Unsetting NODE_NETWORK on prune mode\n&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 8 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 7 times"> + </span><span class="branchCov" title="Branch 7 was taken 1 time"> + </span>]
<a name="1662"><span class="lineNum">    1662 </span>                :<span class="lineCov">          8 :         nLocalServices = ServiceFlags(nLocalServices &amp; ~NODE_NETWORK);</span></a>
<a name="1663"><span class="lineNum">    1663 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          8 :         if (!fReindex) {</span></a>
<a name="1664"><span class="lineNum">    1664 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          7 :             LOCK(cs_main);</span></a>
<a name="1665"><span class="lineNum">    1665 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchCov" title="Branch 3 was taken 7 times"> + </span> :<span class="lineCov">         21 :             for (CChainState* chainstate : chainman.GetAll()) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1666"><span class="lineNum">    1666 </span>  [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          7 :                 uiInterface.InitMessage(_(&quot;Pruning blockstore&quot;).translated);</span></a>
<a name="1667"><span class="lineNum">    1667 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          7 :                 chainstate-&gt;PruneAndFlush();</span></a>
<a name="1668"><span class="lineNum">    1668 </span>                :            :             }</a>
<a name="1669"><span class="lineNum">    1669 </span>                :            :         }</a>
<a name="1670"><span class="lineNum">    1670 </span>                :            :     }</a>
<a name="1671"><span class="lineNum">    1671 </span>                :            : </a>
<a name="1672"><span class="lineNum">    1672 </span>                :            :     // ********************************************************* Step 11: import blocks</a>
<a name="1673"><span class="lineNum">    1673 </span>                :            : </a>
<a name="1674"><span class="lineNum">    1674 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        696 :     if (!CheckDiskSpace(gArgs.GetDataDirNet())) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 696 times"> + </span>]
<a name="1675"><span class="lineNum">    1675 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         InitError(strprintf(_(&quot;Error: Disk space is low for %s&quot;), fs::quoted(fs::PathToString(gArgs.GetDataDirNet()))));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="1676"><span class="lineNum">    1676 </span>                :<span class="lineNoCov">          0 :         return false;</span></a>
<a name="1677"><span class="lineNum">    1677 </span>                :            :     }</a>
<a name="1678"><span class="lineNum">    1678 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        696 :     if (!CheckDiskSpace(gArgs.GetBlocksDirPath())) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 696 times"> + </span>]
<a name="1679"><span class="lineNum">    1679 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         InitError(strprintf(_(&quot;Error: Disk space is low for %s&quot;), fs::quoted(fs::PathToString(gArgs.GetBlocksDirPath()))));</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="1680"><span class="lineNum">    1680 </span>                :<span class="lineNoCov">          0 :         return false;</span></a>
<a name="1681"><span class="lineNum">    1681 </span>                :            :     }</a>
<a name="1682"><span class="lineNum">    1682 </span>                :            : </a>
<a name="1683"><span class="lineNum">    1683 </span>                :            :     // Either install a handler to notify us when genesis activates, or set fHaveGenesis directly.</a>
<a name="1684"><span class="lineNum">    1684 </span>                :            :     // No locking, as this happens before any background thread is started.</a>
<a name="1685"><span class="lineNum">    1685 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1398 :     boost::signals2::connection block_notify_genesis_wait_connection;</span></a>
<a name="1686"><span class="lineNum">    1686 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 424 times"> + </span><span class="branchCov" title="Branch 3 was taken 272 times"> + </span> :<span class="lineCov">        696 :     if (chainman.ActiveChain().Tip() == nullptr) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 424 times"> + </span>]
<a name="1687"><span class="lineNum">    1687 </span>  [<span class="branchCov" title="Branch 0 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        544 :         block_notify_genesis_wait_connection = uiInterface.NotifyBlockTip_connect(std::bind(BlockNotifyGenesisWait, std::placeholders::_2));</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 272 times"> + </span>]
<a name="1688"><span class="lineNum">    1688 </span>                :            :     } else {</a>
<a name="1689"><span class="lineNum">    1689 </span>                :<span class="lineCov">        424 :         fHaveGenesis = true;</span></a>
<a name="1690"><span class="lineNum">    1690 </span>                :            :     }</a>
<a name="1691"><span class="lineNum">    1691 </span>                :            : </a>
<a name="1692"><span class="lineNum">    1692 </span>                :            : #if HAVE_SYSTEM</a>
<a name="1693"><span class="lineNum">    1693 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1392 :     const std::string block_notify = args.GetArg(&quot;-blocknotify&quot;, &quot;&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 272 times"> + </span><span class="branchCov" title="Branch 7 was taken 424 times"> + </span>]
<a name="1694"><span class="lineNum">    1694 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 695 times"> + </span>]:<span class="lineCov">        696 :     if (!block_notify.empty()) {</span></a>
<a name="1695"><span class="lineNum">    1695 </span>  [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         22 :         uiInterface.NotifyBlockTip_connect([block_notify](SynchronizationState sync_state, const CBlockIndex* pBlockIndex) {</span></a>
<a name="1696"><span class="lineNum">    1696 </span>        [<span class="branchCov" title="Branch 0 was taken 112 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">        113 :             if (sync_state != SynchronizationState::POST_INIT || !pBlockIndex) return;</span></a>
<a name="1697"><span class="lineNum">    1697 </span>                :<span class="lineCov">        225 :             std::string command = block_notify;</span></a>
<a name="1698"><span class="lineNum">    1698 </span>  [<span class="branchCov" title="Branch 0 was taken 112 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 112 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        112 :             boost::replace_all(command, &quot;%s&quot;, pBlockIndex-&gt;GetBlockHash().GetHex());</span></a>
<a name="1699"><span class="lineNum">    1699 </span>        [<span class="branchCov" title="Branch 0 was taken 112 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        224 :             std::thread t(runCommand, command);</span></a>
<a name="1700"><span class="lineNum">    1700 </span>        [<span class="branchCov" title="Branch 0 was taken 112 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        112 :             t.detach(); // thread runs free</span></a>
<a name="1701"><span class="lineNum">    1701 </span>  [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          2 :         });</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1702"><span class="lineNum">    1702 </span>                :            :     }</a>
<a name="1703"><span class="lineNum">    1703 </span>                :            : #endif</a>
<a name="1704"><span class="lineNum">    1704 </span>                :            : </a>
<a name="1705"><span class="lineNum">    1705 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1392 :     std::vector&lt;fs::path&gt; vImportFiles;</span></a>
<a name="1706"><span class="lineNum">    1706 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        697 :     for (const std::string&amp; strFile : args.GetArgs(&quot;-loadblock&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchCov" title="Branch 5 was taken 696 times"> + </span>]
<a name="1707"><span class="lineNum">    1707 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :         vImportFiles.push_back(fs::PathFromString(strFile));</span></a>
<a name="1708"><span class="lineNum">    1708 </span>                :            :     }</a>
<a name="1709"><span class="lineNum">    1709 </span>                :            : </a>
<a name="1710"><span class="lineNum">    1710 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       2784 :     chainman.m_load_block = std::thread(&amp;util::TraceThread, &quot;loadblk&quot;, [=, &amp;chainman, &amp;args] {</span></a>
<a name="1711"><span class="lineNum">    1711 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :         ThreadImport(chainman, vImportFiles, args);</span></a>
<a name="1712"><span class="lineNum">    1712 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1392 :     });</span></a>
<a name="1713"><span class="lineNum">    1713 </span>                :            : </a>
<a name="1714"><span class="lineNum">    1714 </span>                :            :     // Wait for genesis block to be processed</a>
<a name="1715"><span class="lineNum">    1715 </span>                :<span class="lineCov">        696 :     {</span></a>
<a name="1716"><span class="lineNum">    1716 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :         WAIT_LOCK(g_genesis_wait_mutex, lock);</span></a>
<a name="1717"><span class="lineNum">    1717 </span>                :            :         // We previously could hang here if StartShutdown() is called prior to</a>
<a name="1718"><span class="lineNum">    1718 </span>                :            :         // ThreadImport getting started, so instead we just wait on a timer to</a>
<a name="1719"><span class="lineNum">    1719 </span>                :            :         // check ShutdownRequested() regularly.</a>
<a name="1720"><span class="lineNum">    1720 </span>  [<span class="branchCov" title="Branch 0 was taken 272 times"> + </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span><span class="branchCov" title="Branch 2 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        968 :         while (!fHaveGenesis &amp;&amp; !ShutdownRequested()) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 272 times"> + </span>]
<a name="1721"><span class="lineNum">    1721 </span>        [<span class="branchCov" title="Branch 0 was taken 272 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        272 :             g_genesis_wait_cv.wait_for(lock, std::chrono::milliseconds(500));</span></a>
<a name="1722"><span class="lineNum">    1722 </span>                :            :         }</a>
<a name="1723"><span class="lineNum">    1723 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :         block_notify_genesis_wait_connection.disconnect();</span></a>
<a name="1724"><span class="lineNum">    1724 </span>                :            :     }</a>
<a name="1725"><span class="lineNum">    1725 </span>                :            : </a>
<a name="1726"><span class="lineNum">    1726 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        696 :     if (ShutdownRequested()) {</span></a>
<a name="1727"><span class="lineNum">    1727 </span>                :            :         return false;</a>
<a name="1728"><span class="lineNum">    1728 </span>                :            :     }</a>
<a name="1729"><span class="lineNum">    1729 </span>                :            : </a>
<a name="1730"><span class="lineNum">    1730 </span>                :            :     // ********************************************************* Step 12: start node</a>
<a name="1731"><span class="lineNum">    1731 </span>                :            : </a>
<a name="1732"><span class="lineNum">    1732 </span>                :<span class="lineCov">        696 :     int chain_active_height;</span></a>
<a name="1733"><span class="lineNum">    1733 </span>                :            : </a>
<a name="1734"><span class="lineNum">    1734 </span>                :            :     //// debug print</a>
<a name="1735"><span class="lineNum">    1735 </span>                :<span class="lineCov">        696 :     {</span></a>
<a name="1736"><span class="lineNum">    1736 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :         LOCK(cs_main);</span></a>
<a name="1737"><span class="lineNum">    1737 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1392 :         LogPrintf(&quot;block tree size = %u\n&quot;, chainman.BlockIndex().size());</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1738"><span class="lineNum">    1738 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 696 times"> + </span>]:<span class="lineCov">        696 :         chain_active_height = chainman.ActiveChain().Height();</span></a>
<a name="1739"><span class="lineNum">    1739 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span>]:<span class="lineCov">        696 :         if (tip_info) {</span></a>
<a name="1740"><span class="lineNum">    1740 </span>                :<span class="lineNoCov">          0 :             tip_info-&gt;block_height = chain_active_height;</span></a>
<a name="1741"><span class="lineNum">    1741 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             tip_info-&gt;block_time = chainman.ActiveChain().Tip() ? chainman.ActiveChain().Tip()-&gt;GetBlockTime() : Params().GenesisBlock().GetBlockTime();</span></a>
<span class="lineNum">         </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span> 
<span class="lineNum">         </span>            <span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<a name="1742"><span class="lineNum">    1742 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             tip_info-&gt;verification_progress = GuessVerificationProgress(Params().TxData(), chainman.ActiveChain().Tip());</span></a>
<span class="lineNum">         </span>   <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<a name="1743"><span class="lineNum">    1743 </span>                :            :         }</a>
<a name="1744"><span class="lineNum">    1744 </span>  [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        696 :         if (tip_info &amp;&amp; ::pindexBestHeader) {</span></a>
<a name="1745"><span class="lineNum">    1745 </span>                :<span class="lineNoCov">          0 :             tip_info-&gt;header_height = ::pindexBestHeader-&gt;nHeight;</span></a>
<a name="1746"><span class="lineNum">    1746 </span>                :<span class="lineNoCov">          0 :             tip_info-&gt;header_time = ::pindexBestHeader-&gt;GetBlockTime();</span></a>
<a name="1747"><span class="lineNum">    1747 </span>                :            :         }</a>
<a name="1748"><span class="lineNum">    1748 </span>                :            :     }</a>
<a name="1749"><span class="lineNum">    1749 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1392 :     LogPrintf(&quot;nBestHeight = %d\n&quot;, chain_active_height);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1750"><span class="lineNum">    1750 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        696 :     if (node.peerman) node.peerman-&gt;SetBestHeight(chain_active_height);</span></a>
<a name="1751"><span class="lineNum">    1751 </span>                :            : </a>
<a name="1752"><span class="lineNum">    1752 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :     Discover();</span></a>
<a name="1753"><span class="lineNum">    1753 </span>                :            : </a>
<a name="1754"><span class="lineNum">    1754 </span>                :            :     // Map ports with UPnP or NAT-PMP.</a>
<a name="1755"><span class="lineNum">    1755 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1392 :     StartMapPort(args.GetBoolArg(&quot;-upnp&quot;, DEFAULT_UPNP), gArgs.GetBoolArg(&quot;-natpmp&quot;, DEFAULT_NATPMP));</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 696 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<a name="1756"><span class="lineNum">    1756 </span>                :            : </a>
<a name="1757"><span class="lineNum">    1757 </span>                :<span class="lineCov">        696 :     CConnman::Options connOptions;</span></a>
<a name="1758"><span class="lineNum">    1758 </span>                :<span class="lineCov">        696 :     connOptions.nLocalServices = nLocalServices;</span></a>
<a name="1759"><span class="lineNum">    1759 </span>                :<span class="lineCov">        696 :     connOptions.nMaxConnections = nMaxConnections;</span></a>
<a name="1760"><span class="lineNum">    1760 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span>]:<span class="lineCov">        696 :     connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);</span></a>
<a name="1761"><span class="lineNum">    1761 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 696 times"> + </span>]:<span class="lineCov">        696 :     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);</span></a>
<a name="1762"><span class="lineNum">    1762 </span>                :<span class="lineCov">        696 :     connOptions.nMaxAddnode = MAX_ADDNODE_CONNECTIONS;</span></a>
<a name="1763"><span class="lineNum">    1763 </span>                :<span class="lineCov">        696 :     connOptions.nMaxFeeler = MAX_FEELER_CONNECTIONS;</span></a>
<a name="1764"><span class="lineNum">    1764 </span>                :<span class="lineCov">        696 :     connOptions.uiInterface = &amp;uiInterface;</span></a>
<a name="1765"><span class="lineNum">    1765 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :     connOptions.m_banman = node.banman.get();</span></a>
<a name="1766"><span class="lineNum">    1766 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :     connOptions.m_msgproc = node.peerman.get();</span></a>
<a name="1767"><span class="lineNum">    1767 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        696 :     connOptions.nSendBufferMaxSize = 1000 * args.GetIntArg(&quot;-maxsendbuffer&quot;, DEFAULT_MAXSENDBUFFER);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1768"><span class="lineNum">    1768 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        696 :     connOptions.nReceiveFloodSize = 1000 * args.GetIntArg(&quot;-maxreceivebuffer&quot;, DEFAULT_MAXRECEIVEBUFFER);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1769"><span class="lineNum">    1769 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1392 :     connOptions.m_added_nodes = args.GetArgs(&quot;-addnode&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1770"><span class="lineNum">    1770 </span>        [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        696 :     connOptions.nMaxOutboundLimit = *opt_max_upload;</span></a>
<a name="1771"><span class="lineNum">    1771 </span>                :<span class="lineCov">        696 :     connOptions.m_peer_connect_timeout = peer_connect_timeout;</span></a>
<a name="1772"><span class="lineNum">    1772 </span>                :            : </a>
<a name="1773"><span class="lineNum">    1773 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1381 :     for (const std::string&amp; bind_arg : args.GetArgs(&quot;-bind&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 685 times"> + </span><span class="branchCov" title="Branch 5 was taken 696 times"> + </span>]
<a name="1774"><span class="lineNum">    1774 </span>        [<span class="branchCov" title="Branch 0 was taken 685 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        685 :         CService bind_addr;</span></a>
<a name="1775"><span class="lineNum">    1775 </span>                :<span class="lineCov">        685 :         const size_t index = bind_arg.rfind('=');</span></a>
<a name="1776"><span class="lineNum">    1776 </span>        [<span class="branchCov" title="Branch 0 was taken 683 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">        685 :         if (index == std::string::npos) {</span></a>
<a name="1777"><span class="lineNum">    1777 </span>  [<span class="branchCov" title="Branch 0 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        683 :             if (Lookup(bind_arg, bind_addr, GetListenPort(), false)) {</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1778"><span class="lineNum">    1778 </span>        [<span class="branchCov" title="Branch 0 was taken 683 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        683 :                 connOptions.vBinds.push_back(bind_addr);</span></a>
<a name="1779"><span class="lineNum">    1779 </span>                :<span class="lineCov">       1368 :                 continue;</span></a>
<a name="1780"><span class="lineNum">    1780 </span>                :            :             }</a>
<a name="1781"><span class="lineNum">    1781 </span>                :            :         } else {</a>
<a name="1782"><span class="lineNum">    1782 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :             const std::string network_type = bind_arg.substr(index + 1);</span></a>
<a name="1783"><span class="lineNum">    1783 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :             if (network_type == &quot;onion&quot;) {</span></a>
<a name="1784"><span class="lineNum">    1784 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                 const std::string truncated_bind_arg = bind_arg.substr(0, index);</span></a>
<a name="1785"><span class="lineNum">    1785 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          2 :                 if (Lookup(truncated_bind_arg, bind_addr, BaseParams().OnionServiceTargetPort(), false)) {</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<a name="1786"><span class="lineNum">    1786 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                     connOptions.onion_binds.push_back(bind_addr);</span></a>
<a name="1787"><span class="lineNum">    1787 </span>                :<span class="lineCov">          2 :                     continue;</span></a>
<a name="1788"><span class="lineNum">    1788 </span>                :            :                 }</a>
<a name="1789"><span class="lineNum">    1789 </span>                :            :             }</a>
<a name="1790"><span class="lineNum">    1790 </span>                :            :         }</a>
<a name="1791"><span class="lineNum">    1791 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :         return InitError(ResolveErrMsg(&quot;bind&quot;, bind_arg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1792"><span class="lineNum">    1792 </span>                :            :     }</a>
<a name="1793"><span class="lineNum">    1793 </span>                :            : </a>
<a name="1794"><span class="lineNum">    1794 </span>  [<span class="branchCov" title="Branch 0 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 696 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        697 :     for (const std::string&amp; strBind : args.GetArgs(&quot;-whitebind&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchCov" title="Branch 5 was taken 695 times"> + </span>]
<a name="1795"><span class="lineNum">    1795 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :         NetWhitebindPermissions whitebind;</span></a>
<a name="1796"><span class="lineNum">    1796 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :         bilingual_str error;</span></a>
<a name="1797"><span class="lineNum">    1797 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span> :<span class="lineCov">          3 :         if (!NetWhitebindPermissions::TryParse(strBind, whitebind, error)) return InitError(error);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1798"><span class="lineNum">    1798 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         connOptions.vWhiteBinds.push_back(whitebind);</span></a>
<a name="1799"><span class="lineNum">    1799 </span>                :            :     }</a>
<a name="1800"><span class="lineNum">    1800 </span>                :            : </a>
<a name="1801"><span class="lineNum">    1801 </span>                :            :     // If the user did not specify -bind= or -whitebind= then we bind</a>
<a name="1802"><span class="lineNum">    1802 </span>                :            :     // on any address - 0.0.0.0 (IPv4) and :: (IPv6).</a>
<a name="1803"><span class="lineNum">    1803 </span>  [<span class="branchCov" title="Branch 0 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1403 :     connOptions.bind_on_any = args.GetArgs(&quot;-bind&quot;).empty() &amp;&amp; args.GetArgs(&quot;-whitebind&quot;).empty();</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 12 times"> + </span><span class="branchCov" title="Branch 5 was taken 683 times"> + </span><span class="branchCov" title="Branch 6 was taken 12 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 12 times"> + </span> 
<span class="lineNum">         </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span><span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchCov" title="Branch 11 was taken 11 times"> + </span><span class="branchCov" title="Branch 12 was taken 12 times"> + </span><span class="branchCov" title="Branch 13 was taken 683 times"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 12 times"> + </span><span class="branchCov" title="Branch 15 was taken 683 times"> + </span><span class="branchCov" title="Branch 16 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 17 was not taken"> - </span><span class="branchNoCov" title="Branch 18 was not taken"> - </span> 
<span class="lineNum">         </span>   <span class="branchNoCov" title="Branch 19 was not taken"> - </span><span class="branchNoCov" title="Branch 20 was not taken"> - </span><span class="branchNoCov" title="Branch 21 was not taken"> - </span><span class="branchNoCov" title="Branch 22 was not taken"> - </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 23 was not taken"> - </span>]
<a name="1804"><span class="lineNum">    1804 </span>                :            : </a>
<a name="1805"><span class="lineNum">    1805 </span>        [<span class="branchCov" title="Branch 0 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1391 :     CService onion_service_target;</span></a>
<a name="1806"><span class="lineNum">    1806 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 693 times"> + </span>]:<span class="lineCov">        695 :     if (!connOptions.onion_binds.empty()) {</span></a>
<a name="1807"><span class="lineNum">    1807 </span>                :<span class="lineCov">          2 :         onion_service_target = connOptions.onion_binds.front();</span></a>
<a name="1808"><span class="lineNum">    1808 </span>                :            :     } else {</a>
<a name="1809"><span class="lineNum">    1809 </span>        [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        693 :         onion_service_target = DefaultOnionServiceTarget();</span></a>
<a name="1810"><span class="lineNum">    1810 </span>        [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        693 :         connOptions.onion_binds.push_back(onion_service_target);</span></a>
<a name="1811"><span class="lineNum">    1811 </span>                :            :     }</a>
<a name="1812"><span class="lineNum">    1812 </span>                :            : </a>
<a name="1813"><span class="lineNum">    1813 </span>  [<span class="branchCov" title="Branch 0 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        695 :     if (args.GetBoolArg(&quot;-listenonion&quot;, DEFAULT_LISTEN_ONION)) {</span></a>
<span class="lineNum">         </span>         <span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 695 times"> + </span>]
<a name="1814"><span class="lineNum">    1814 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if (connOptions.onion_binds.size() &gt; 1) {</span></a>
<a name="1815"><span class="lineNum">    1815 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :             InitWarning(strprintf(_(&quot;More than one onion bind address is provided. Using %s &quot;</span></a>
<a name="1816"><span class="lineNum">    1816 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                     &quot;for the automatically created Tor onion service.&quot;),</span></a>
<a name="1817"><span class="lineNum">    1817 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                   onion_service_target.ToStringIPPort()));</span></a>
<a name="1818"><span class="lineNum">    1818 </span>                :            :         }</a>
<a name="1819"><span class="lineNum">    1819 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         StartTorControl(onion_service_target);</span></a>
<a name="1820"><span class="lineNum">    1820 </span>                :            :     }</a>
<a name="1821"><span class="lineNum">    1821 </span>                :            : </a>
<a name="1822"><span class="lineNum">    1822 </span>  [<span class="branchCov" title="Branch 0 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 695 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        800 :     for (const auto&amp; net : args.GetArgs(&quot;-whitelist&quot;)) {</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 107 times"> + </span><span class="branchCov" title="Branch 5 was taken 693 times"> + </span>]
<a name="1823"><span class="lineNum">    1823 </span>        [<span class="branchCov" title="Branch 0 was taken 107 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        212 :         NetWhitelistPermissions subnet;</span></a>
<a name="1824"><span class="lineNum">    1824 </span>        [<span class="branchCov" title="Branch 0 was taken 107 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        212 :         bilingual_str error;</span></a>
<a name="1825"><span class="lineNum">    1825 </span>  [<span class="branchCov" title="Branch 0 was taken 107 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 105 times"> + </span> :<span class="lineCov">        109 :         if (!NetWhitelistPermissions::TryParse(net, subnet, error)) return InitError(error);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1826"><span class="lineNum">    1826 </span>        [<span class="branchCov" title="Branch 0 was taken 105 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        105 :         connOptions.vWhitelistedRange.push_back(subnet);</span></a>
<a name="1827"><span class="lineNum">    1827 </span>                :            :     }</a>
<a name="1828"><span class="lineNum">    1828 </span>                :            : </a>
<a name="1829"><span class="lineNum">    1829 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1386 :     connOptions.vSeedNodes = args.GetArgs(&quot;-seednode&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1830"><span class="lineNum">    1830 </span>                :            : </a>
<a name="1831"><span class="lineNum">    1831 </span>                :            :     // Initiate outbound connections unless connect=0</a>
<a name="1832"><span class="lineNum">    1832 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        693 :     connOptions.m_use_addrman_outgoing = !args.IsArgSet(&quot;-connect&quot;);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 675 times"> + </span><span class="branchCov" title="Branch 5 was taken 18 times"> + </span>]
<a name="1833"><span class="lineNum">    1833 </span>        [<span class="branchCov" title="Branch 0 was taken 675 times"> + </span><span class="branchCov" title="Branch 1 was taken 18 times"> + </span>]:<span class="lineCov">        693 :     if (!connOptions.m_use_addrman_outgoing) {</span></a>
<a name="1834"><span class="lineNum">    1834 </span>  [<span class="branchCov" title="Branch 0 was taken 675 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 675 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">       1350 :         const auto connect = args.GetArgs(&quot;-connect&quot;);</span></a>
<a name="1835"><span class="lineNum">    1835 </span>  [<span class="branchCov" title="Branch 0 was taken 673 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 672 times"> + </span>]:<span class="lineCov">        675 :         if (connect.size() != 1 || connect[0] != &quot;0&quot;) {</span></a>
<a name="1836"><span class="lineNum">    1836 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :             connOptions.m_specified_outgoing = connect;</span></a>
<a name="1837"><span class="lineNum">    1837 </span>                :            :         }</a>
<a name="1838"><span class="lineNum">    1838 </span>                :            :     }</a>
<a name="1839"><span class="lineNum">    1839 </span>                :            : </a>
<a name="1840"><span class="lineNum">    1840 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">       1388 :     const std::string&amp; i2psam_arg = args.GetArg(&quot;-i2psam&quot;, &quot;&quot;);</span></a>
<span class="lineNum">         </span>   <span class="branchCov" title="Branch 4 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span><span class="branchCov" title="Branch 7 was taken 690 times"> + </span>]
<a name="1841"><span class="lineNum">    1841 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 690 times"> + </span>]:<span class="lineCov">        693 :     if (!i2psam_arg.empty()) {</span></a>
<a name="1842"><span class="lineNum">    1842 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :         CService addr;</span></a>
<a name="1843"><span class="lineNum">    1843 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">          6 :         if (!Lookup(i2psam_arg, addr, 7656, fNameLookup) || !addr.IsValid()) {</span></a>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span> 
<span class="lineNum">         </span>      <span class="branchCov" title="Branch 9 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span><span class="branchCov" title="Branch 11 was taken 3 times"> + </span>]
<a name="1844"><span class="lineNum">    1844 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :             return InitError(strprintf(_(&quot;Invalid -i2psam address or hostname: '%s'&quot;), i2psam_arg));</span></a>
<span class="lineNum">         </span>         <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<a name="1845"><span class="lineNum">    1845 </span>                :            :         }</a>
<a name="1846"><span class="lineNum">    1846 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :         SetReachable(NET_I2P, true);</span></a>
<a name="1847"><span class="lineNum">    1847 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          6 :         SetProxy(NET_I2P, proxyType{addr});</span></a>
<a name="1848"><span class="lineNum">    1848 </span>                :            :     } else {</a>
<a name="1849"><span class="lineNum">    1849 </span>        [<span class="branchCov" title="Branch 0 was taken 690 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        690 :         SetReachable(NET_I2P, false);</span></a>
<a name="1850"><span class="lineNum">    1850 </span>                :            :     }</a>
<a name="1851"><span class="lineNum">    1851 </span>                :            : </a>
<a name="1852"><span class="lineNum">    1852 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span> :<span class="lineCov">        693 :     connOptions.m_i2p_accept_incoming = args.GetBoolArg(&quot;-i2pacceptincoming&quot;, true);</span></a>
<span class="lineNum">         </span>         <span class="branchCov" title="Branch 4 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>]
<a name="1853"><span class="lineNum">    1853 </span>                :            : </a>
<a name="1854"><span class="lineNum">    1854 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        693 :     if (!node.connman-&gt;Start(*node.scheduler, connOptions)) {</span></a>
<a name="1855"><span class="lineNum">    1855 </span>                :            :         return false;</a>
<a name="1856"><span class="lineNum">    1856 </span>                :            :     }</a>
<a name="1857"><span class="lineNum">    1857 </span>                :            : </a>
<a name="1858"><span class="lineNum">    1858 </span>                :            :     // ********************************************************* Step 13: finished</a>
<a name="1859"><span class="lineNum">    1859 </span>                :            : </a>
<a name="1860"><span class="lineNum">    1860 </span>        [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        693 :     SetRPCWarmupFinished();</span></a>
<a name="1861"><span class="lineNum">    1861 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        693 :     uiInterface.InitMessage(_(&quot;Done loading&quot;).translated);</span></a>
<a name="1862"><span class="lineNum">    1862 </span>                :            : </a>
<a name="1863"><span class="lineNum">    1863 </span>        [<span class="branchCov" title="Branch 0 was taken 678 times"> + </span><span class="branchCov" title="Branch 1 was taken 693 times"> + </span>]:<span class="lineCov">       1371 :     for (const auto&amp; client : node.chain_clients) {</span></a>
<a name="1864"><span class="lineNum">    1864 </span>        [<span class="branchCov" title="Branch 0 was taken 678 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        678 :         client-&gt;start(*node.scheduler);</span></a>
<a name="1865"><span class="lineNum">    1865 </span>                :            :     }</a>
<a name="1866"><span class="lineNum">    1866 </span>                :            : </a>
<a name="1867"><span class="lineNum">    1867 </span>                :<span class="lineCov">        693 :     BanMan* banman = node.banman.get();</span></a>
<a name="1868"><span class="lineNum">    1868 </span>        [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">       1386 :     node.scheduler-&gt;scheduleEvery([banman]{</span></a>
<a name="1869"><span class="lineNum">    1869 </span>                :<span class="lineCov">          3 :         banman-&gt;DumpBanlist();</span></a>
<a name="1870"><span class="lineNum">    1870 </span>                :<span class="lineCov">        693 :     }, DUMP_BANS_INTERVAL);</span></a>
<a name="1871"><span class="lineNum">    1871 </span>                :            : </a>
<a name="1872"><span class="lineNum">    1872 </span>  [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">        693 :     if (node.peerman) node.peerman-&gt;StartScheduledTasks(*node.scheduler);</span></a>
<a name="1873"><span class="lineNum">    1873 </span>                :            : </a>
<a name="1874"><span class="lineNum">    1874 </span>                :            : #if HAVE_SYSTEM</a>
<a name="1875"><span class="lineNum">    1875 </span>        [<span class="branchCov" title="Branch 0 was taken 693 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        693 :     StartupNotify(args);</span></a>
<a name="1876"><span class="lineNum">    1876 </span>                :            : #endif</a>
<a name="1877"><span class="lineNum">    1877 </span>                :            : </a>
<a name="1878"><span class="lineNum">    1878 </span>                :            :     return true;</a>
<a name="1879"><span class="lineNum">    1879 </span>                :            : }</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
